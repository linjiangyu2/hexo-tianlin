<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tianlin</title>
  
  <subtitle>Tianlin</subtitle>
  <link href="https://www.linjiangyu.com/atom.xml" rel="self"/>
  
  <link href="https://www.linjiangyu.com/"/>
  <updated>2023-11-27T01:42:42.511Z</updated>
  <id>https://www.linjiangyu.com/</id>
  
  <author>
    <name>Tianlin</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>LB常用调度算法</title>
    <link href="https://www.linjiangyu.com/posts/ed485414.html"/>
    <id>https://www.linjiangyu.com/posts/ed485414.html</id>
    <published>2023-06-11T11:06:38.000Z</published>
    <updated>2023-11-27T01:42:42.511Z</updated>
    
    <content type="html"><![CDATA[<h3 id="LB常用调度算法">LB常用调度算法</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">)</span> <span class="string">轮询:</span> <span class="string">RR（Round</span> <span class="string">Robin）</span></span><br><span class="line"><span class="string">最基本的调度算法，把请求连接依次轮流分配到RS机器，缺点是如果机器性能不一致便会导致资源浪费</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">)</span> <span class="string">加权轮询:</span> <span class="string">WRR（Weighted</span> <span class="string">Round</span> <span class="string">Robin）</span></span><br><span class="line"><span class="string">在RR的基础上添加了设置机器权重，按照权重比例调度请求</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">)</span> <span class="string">源地址哈希:</span> <span class="string">SH</span> <span class="string">（Source</span> <span class="string">Hash）</span></span><br><span class="line"><span class="string">将请求的客户端IP地址进行Hash计算并调度，后面此IP地址发出的请求便会被永久的调度到同一台RS机器上</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="string">)</span> <span class="string">目标地址哈希:</span> <span class="string">DH</span> <span class="string">(Destination</span> <span class="string">Hash)</span></span><br><span class="line"><span class="string">通过一个散列函数将来自同一个源IP的请求地址映射到一台服务器或链路上</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span><span class="string">)</span> <span class="string">最少连接数:</span> <span class="string">LC（Least</span> <span class="string">Connection）</span></span><br><span class="line"><span class="string">根据当前各服务器的连接数来估计服务器的负载情况，把新的连接分配给连接数最小的服务器；负载率=active*256+inactive，值小的优先分配请求</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span><span class="string">）加权最少连接数:</span> <span class="string">WLC（Weighted</span> <span class="string">Least</span> <span class="string">Connection）</span></span><br><span class="line"><span class="string">与LC类似，根据当前各服务器的连接数来估计服务器的负载情况，把新的连接分配给连接数最小的服务器；负载率=(active*256+inactive)/weight，值小的优先分配请求</span></span><br><span class="line"></span><br><span class="line"><span class="number">7</span><span class="string">）最短期望延迟:</span> <span class="string">SED（Shortest</span> <span class="string">Expect</span> <span class="string">Delay）</span></span><br><span class="line"><span class="string">这个算法主要是优化LC的，在服务均在请求少的时候避免负载到一台服务器上做的优化；负载率=(active+1)*256/weight，值小的优先分配请求</span></span><br><span class="line"></span><br><span class="line"><span class="number">8</span><span class="string">)</span> <span class="string">永不排队:</span> <span class="string">NQ</span> <span class="string">（Nerver</span> <span class="string">Queue）</span></span><br><span class="line"><span class="string">在负载低时，请求直接分配到空闲服务器上，不会产生请求等待；当服务器都很忙时，将轮询</span></span><br><span class="line"></span><br><span class="line"><span class="number">9</span><span class="string">)</span> <span class="string">基于本地最少连接:</span> <span class="string">LBLC（Locality-Based</span> <span class="string">Least</span> <span class="string">Connection）</span></span><br><span class="line"><span class="string">根据请求的目标IP地址找出该目标IP地址最近使用的RealServer，若该Real</span> <span class="string">Server是可用的且没有超载，将请求发送到该服务器；若服务器不存在，或者该服务器超载且有服务器处于一半的工作负载，则用“最少链接”的原则选出一个可用的服务器，将请求发送到该服务器</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">LB常用调度算法</summary>
    
    
    
    <category term="演示" scheme="https://www.linjiangyu.com/categories/%E6%BC%94%E7%A4%BA/"/>
    
    
    <category term="服务" scheme="https://www.linjiangyu.com/tags/%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>SD使用和Lora模型训练</title>
    <link href="https://www.linjiangyu.com/posts/ba51ac6f.html"/>
    <id>https://www.linjiangyu.com/posts/ba51ac6f.html</id>
    <published>2023-05-03T03:44:21.000Z</published>
    <updated>2023-11-27T01:42:42.511Z</updated>
    
    <content type="html"><![CDATA[<h2 id="SD使用和Lora模型训练">SD使用和Lora模型训练</h2><p>最近一直没有更新博客，一方面因为自己在准备实习需要的东西时间很赶，另一方面就是因为AI绘画玩具啦。</p><h3 id="Stable-Diffusion">Stable Diffusion</h3><ul><li><p>需要显卡是N卡且安装好<a href="https://www.nvidia.cn/geforce/drivers/">N卡GPU驱动</a></p></li><li><p>这里我是使用的来自<a href="https://space.bilibili.com/12566101">B站阿婆主秋葉</a>所发布的<a href="https://pan.baidu.com/s/1tmYETTYuWYcCTsJUk2zF0A?pwd=6drn">Stable Diffusion V4整合包</a> 部署在本地电脑的AI绘画的</p></li><li><p>整合包下载后包括两个文件</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/DQAX0_I2%5D~%5DX%7BEVR%5BLSK9LL.png" alt=""></p></li></ul><ol><li><p>首先运行启动器依赖</p></li><li><p>解压sd-webui-aki-v4.zip</p></li><li><p>进入sd-webui-aki-v4文件夹打开启动器后一键启动等待控制台输出完毕弹出Web Ui界面就可以开始绘图啦</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683086006853.jpg" alt=""></p></li><li><p>整合包已经安装好汉化，这里的正向提示词就是输入你想要让AI画出人物的描述啦，例如masterpiece,1 girl, very detailed CG, beautiful eyes, very detailed, Blackboard painting, complex details_ 1.2, 8k wallpaper, jk等等，默认使用英文，用逗号分割词语，而负面提示词则是反着来了，例如写入worst quality,bad hands,malformed hands,worst quality,low quality,((((ugly)))),(((duplicate))),(((trans))),((trannsexual)),(out of frame),extra fingers,mutated hands,out of frame,extra limbs,(bad anatomy),grossproportions,(malformed limbs),((missing arms)),((missinglegs)),(((extra arms))),(((extra legs)))</p></li><li><p>等等</p><ul><li>这里推荐使用我的TAG生成器</li></ul><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1682909507747.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">Tianlin_Tag</div>  <p>自用TAG生成工具</p>  <a href='https://tag.linjiangyu.com/'></a>  </figcaption>  </figure>  </div></li><li><p>实际生成一张吧，因为我的破烂电脑显卡不行，显存不够所以这里等上个把分钟都是不奇怪的，具体还是看你与显卡之间的羁绊吧🤣</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683087991679.jpg" alt=""></p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/00010-235500343-masterpiece,1%20girl,%20very%20detailed%20CG,%20beautiful%20eyes,%20very%20detailed,%20Blackboard%20painting,%20complex%20details_%201.2,%208k%20wallpaper,%20jk.png" alt=""></p><p>​这里看可能会有点模糊？我还经过了压缩才上传显示在此网页中的原因吧，可以看到AI可以很好的绘画出我们满意的图片</p><ul><li>而且在Stable Diffusion中也有图片放大的运行，图片放大其实是在已知像素点的位置上估算新的像素点的值。这可以通过计算原图像中的相邻像素点的平均值或加权平均值来实现。这样，我们就可以在原图像中的每个像素点之间估算出新的像素点的值，从而来增加图像的分辨率和清晰度</li><li>Stable Diffusion非常强大，甚至还支持文件夹中图片批量处理输出</li></ul><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683088698837.png" alt=""></p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683089264426.jpg" alt=""></p><p>在这里上传你需要放大处理的图片，我一般都是使用BSRGAN算法来放大处理的，缩放比例也是常用的3，最高可以到8，分辨率调到太高的时候图片的线条会过分明显我并不喜欢。</p><p>以下是使用3倍的缩放比例和BSRGAN算法处理后的图片</p><div class="hide-block"><button type="button" class="hide-button" style="background-color: orange;">点击查看     </button><div class="hide-content"><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1279261927392739.png" alt=""></p></div></div><p>可以看出3倍的缩放比例便已经可以达到非常好的效果了，我的建议是使用3-4之间</p></li></ol><h3 id="Lora的训练">Lora的训练</h3><h4 id="准备条件和素材">准备条件和素材</h4><p>​有些画质也是经过一传再传被各种社交软件一再压缩，到手的图片也总是感觉清晰度不高，而就算你把所有关于你想要生成的人物的各种细节都描述出来，AI绘图也无法将人物的样式完整的复现出来，一般对于专要产出图片的角色就要用到Lora或者embedding了，这里主要讲的是如何训练一个专有人物的Lora模型。</p><ul><li><p>一般的Lora模型文件是以safetensors为后缀的训练模型文件，存放在SD_ROOT/models/Lora中。</p></li><li><p>训练的要求</p><ol><li><p>显存，需要最少为8G的电脑显存才能进行最低的本地运行训练(我的破烂电脑哪里会有8G显存,所以这里写的便是白嫖云端运行训练Lora模型)</p></li><li><p>图片，需要至少10张以上的较高清晰度，较无杂物的人物图片(也就是最好少点背景物品什么的，多为人物的单独展示图最好)，而且需要经过处理把所有的图片的分辨率都调为一致(分辨率要是64的倍数且都不能超过1920),这里一般可以使用SD中的后期处理进行图片的分辨率放大，然后使用SD训练中的图片预处理进行对图片自动面部焦点剪裁的分辨率裁剪(我的推荐是不要超过1280,1280的(这里我使用的差不多30左右张的1280,1280的图片训练的epoches数为20的时候都要训练到差不多4个小时多)，除非家里有条件是用的自己电脑训练的可以把分辨率提高，让训练达到最佳的效果(这里我感觉不是epoches训练数越多越好，而且支持叠加训练的方式训练我在上次叠加训练了8个小时全部白搭了，图片的生成直接整个崩坏，推荐就是一次性练完)</p></li><li><p>google账号,这里是使用谷歌的Colab来进行云端训练,google每周会刷新一次账号的试用Jupyter Notebook笔记本的时长，官网说是一周有12小时的时间，但是实际上为使用的伤害一个账号最多就6个小时左右的时间(之前训练到6个多小时的模型被中断了) (这里会用挂载把谷歌硬盘挂载到Jupyter Notebook笔记本上而且设置模型的输出目录为挂载的路径，这样就可以避免打水漂，因为我都是两个steps就保存一次模型,那么就算训练被中断了也可以在谷歌硬盘中下载最新的中断模型，也是可以正常使用的)</p></li><li><p>给你的图片打标签，这里直接使用SD中的Tagger插件，如果是使用上面的整合包的话是有包含在内的，想要使用这个插件对图片进行批处理都打上标签保存在相同路径下相同名字的txt文件中然后后面要上传到Jupyter Notebook笔记本中<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683166925138.png" alt=""></p></li></ol><p>这里的阀值是定义AI的标签词语强度范围，我自己一般都是使用5.5</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683166978197.jpg" alt=""></p><p>附加提示词则可以理解为给每个图片都加上一个属于自己的标记吧，不懂的话忽略即可，然后点击反推提示词便可以了，默认的输出也是以图片文件名字为前缀以txt为后缀，没有指定目录也是默认的图片路径下输出的</p><ol start="5"><li>具有科学上网的能力(因为访问Colab需要)</li></ol></li></ul><h4 id="开始训练">开始训练</h4><p>说明:这里的每一小步骤都要新添加一个代码单元格</p><ol><li><p>首先进入到<a href="https://colab.research.google.com/">Colab</a> 创建新的笔记本</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683167364878.jpg" alt=""></p></li><li><p>更改运行类型为GPU并保存</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683167480635.jpg" alt=""></p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683167536583.jpg" alt=""> 查看GPU和挂载磁盘</p><p>在代码框输入然后点击左上角启动</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">!nvidia-smi</span><br><span class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> drive</span><br><span class="line">drive.mount(<span class="string">&#x27;/content/drive/&#x27;</span>)</span><br><span class="line">!echo <span class="string">&quot;硬盘挂载完成.&quot;</span></span><br></pre></td></tr></table></figure><p>这里会弹出让你允许笔记本访问并授权到谷歌磁盘，直接允许然后看到输出硬盘挂载完成就可以了</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683167836877.jpg" alt=""></p></li><li><p>运行一系列配置</p><ul><li>点击添加代码框然后输入后执行</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">%cd /content/</span><br><span class="line">git_https = <span class="string">&quot;https://github.com/Akegarasu/lora-scripts&quot;</span></span><br><span class="line">!git clone --recurse-submodules &#123;git_https&#125;  /content/lora-scripts/</span><br><span class="line">!cd lora-scripts &amp;&amp; git pull &amp;&amp; git submodule update --init --recursive</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;克隆完成 你可以在安装依赖时去配置train.sh文件&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment">#########</span></span><br><span class="line"><span class="comment">#设置train.sh文件路径，这个在函数中会被使用</span></span><br><span class="line">train_sh_path = <span class="string">r&#x27;/content/lora-scripts/train.sh&#x27;</span></span><br><span class="line"><span class="comment">#########</span></span><br><span class="line"><span class="comment">#定义函数，编辑train_sh_path路径的文件，为search的参数赋予值input</span></span><br><span class="line"><span class="comment">#search为字符串，input可以为数值和字符串</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_input</span>(<span class="params">search, <span class="built_in">input</span></span>):</span><br><span class="line">  <span class="comment"># 使用正则表达式进行替换</span></span><br><span class="line">  <span class="comment">#匹配标志: 1匹配search=&quot;&quot; ， 2匹配search=5 ， 3专门专门匹配extArgs=()</span></span><br><span class="line">  search_type_flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#search不是字符串就报错</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span>( <span class="built_in">isinstance</span>(search, <span class="built_in">str</span>) ):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;非字符串的&#x27;search&#x27;参数&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#如果search输入的是&quot;&quot;，则专门匹配extArgs=()</span></span><br><span class="line">  <span class="keyword">if</span> search == <span class="string">&quot;&quot;</span>:</span><br><span class="line">    search = <span class="string">&quot;extArgs&quot;</span></span><br><span class="line">    pattern = <span class="string">rf&#x27;^<span class="subst">&#123;search&#125;</span>=(\(.*?\))&#x27;</span></span><br><span class="line">    replace = <span class="string">rf&#x27;<span class="subst">&#123;search&#125;</span>=(<span class="subst">&#123;<span class="built_in">input</span>&#125;</span>)&#x27;</span></span><br><span class="line">    search_type_flag = <span class="number">3</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 如果input是字符串类型，匹配search=&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(<span class="built_in">input</span>, <span class="built_in">str</span>):</span><br><span class="line">      <span class="comment">#pattern = rf&#x27;&#123;search&#125;=(&quot;.*?&quot;)&#x27;</span></span><br><span class="line">      <span class="comment">#replace = f&quot;&#123;search&#125;=\&quot;&#123;input&#125;\&quot;&quot;</span></span><br><span class="line">      pattern = <span class="string">rf&#x27;^<span class="subst">&#123;search&#125;</span>=(&quot;.*?&quot;)&#x27;</span></span><br><span class="line">      replace = <span class="string">rf&#x27;<span class="subst">&#123;search&#125;</span>=&quot;<span class="subst">&#123;<span class="built_in">input</span>&#125;</span>&quot;&#x27;</span></span><br><span class="line">      search_type_flag = <span class="number">1</span></span><br><span class="line">    <span class="comment"># 如果input是数值类型，匹配search= （可以匹配小数、整数、科学计数）</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(<span class="built_in">input</span>, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">      pattern = <span class="string">rf&#x27;^<span class="subst">&#123;search&#125;</span>=([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)&#x27;</span></span><br><span class="line">      replace = <span class="string">rf&#x27;<span class="subst">&#123;search&#125;</span>=<span class="subst">&#123;<span class="built_in">input</span>&#125;</span>&#x27;</span></span><br><span class="line">      search_type_flag = <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># 其他情况，就返回错误信息 </span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;错误的匹配input&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#使用with语句打开文件，并读取内容</span></span><br><span class="line">  <span class="keyword">with</span> <span class="built_in">open</span>(train_sh_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">    re_get = re.findall(pattern, content, flags=re.MULTILINE|re.DOTALL)</span><br><span class="line">    <span class="comment">#检查是否匹配到，匹配不到则报错并退出</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span>(re_get):</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f&quot;警告！！！对于&#x27;<span class="subst">&#123;search&#125;</span>&#x27;的正则表达式并未匹配，请手动设置该参数，并私信我更新！&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="comment">#如果匹配到了执行接下来操作</span></span><br><span class="line">    <span class="comment">#使用re.sub函数进行替换，并加上re.MULTILINE标志</span></span><br><span class="line">    new_content = re.sub(pattern, replace, content, flags=re.MULTILINE|re.DOTALL, count=<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#如果内容未更改，提示未改变以及值</span></span><br><span class="line">    <span class="keyword">if</span> new_content == content:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;search&#125;</span>=<span class="subst">&#123;re_get[<span class="number">0</span>]&#125;</span>&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="comment">#如果改变则写入，输出改变信息</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">with</span> <span class="built_in">open</span>(train_sh_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(new_content)</span><br><span class="line">      <span class="keyword">if</span> search_type_flag == <span class="number">1</span>: right = left = <span class="string">&quot;\&quot;&quot;</span></span><br><span class="line">      <span class="keyword">elif</span> search_type_flag == <span class="number">2</span>: right = left = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="keyword">elif</span> search_type_flag == <span class="number">3</span>: right = <span class="string">&quot;)&quot;</span> ; left = <span class="string">&quot;(&quot;</span> </span><br><span class="line">      <span class="keyword">else</span>: <span class="built_in">print</span>(<span class="string">&quot;输入参数错误&quot;</span>)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f&quot;发生修改，<span class="subst">&#123;search&#125;</span>=<span class="subst">&#123;re_get[<span class="number">0</span>]&#125;</span>现在为<span class="subst">&#123;left&#125;</span><span class="subst">&#123;<span class="built_in">input</span>&#125;</span><span class="subst">&#123;right&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#模型输出地址被更改至&quot;/content/drive/MyDrive/Lora/output/&quot; </span></span><br><span class="line">output_dir = <span class="string">&quot;/content/drive/MyDrive/Lora/output/&quot;</span></span><br><span class="line">search_input(<span class="string">&quot;  --output_dir&quot;</span>, output_dir)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;模型输出地址默认被更改至谷歌硬盘：<span class="subst">&#123;output_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化log输出路径</span></span><br><span class="line">logging_dir = output_dir + <span class="string">&quot;/logs&quot;</span></span><br><span class="line">search_input(<span class="string">&quot;  --logging_dir&quot;</span>, logging_dir)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;log日志默认输出至谷歌硬盘：<span class="subst">&#123;logging_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化sample_prompt.txt路径</span></span><br><span class="line">sample_prompt_txt_path = <span class="string">&quot;/content/lora-scripts/sample_prompt.txt&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;sample_prompt.txt默认路径为：<span class="subst">&#123;sample_prompt_txt_path&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化训练集路径</span></span><br><span class="line">train_data_dir = <span class="string">&quot;/content/lora-scripts/train/aki/&quot;</span></span><br><span class="line">search_input(<span class="string">&quot;train_data_dir&quot;</span>, train_data_dir)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;训练集将拷贝至：<span class="subst">&#123;train_data_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化正则化集路径</span></span><br><span class="line">reg_data_dir = <span class="string">&quot;/content/lora-scripts/train/reg/&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;正则化集将拷贝至：<span class="subst">&#123;reg_data_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#弃用代码</span></span><br><span class="line"><span class="comment">#!sed -i &#x27;s/--output_dir=&quot;.\/output&quot;/--output_dir=&quot;/content/drive/MyDrive/Lora/output/&quot;/&#x27; /content/lora-scripts/train.sh</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment">#声明extArgs_Content类，用于在不同代码块中更新extArgs的内容</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExtArgsContent</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">    self.base_model = <span class="string">&quot;&quot;</span></span><br><span class="line">    self.vae = <span class="string">&quot;&quot;</span></span><br><span class="line">    self.common_parameter = <span class="string">&quot;&quot;</span></span><br><span class="line">    self.sample_parameter = <span class="string">&quot;&quot;</span></span><br><span class="line">    self.plus_parameter = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment">#合并全部类属性字符串</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">all</span>(<span class="params">self</span>):</span><br><span class="line">    result = <span class="string">&quot;&quot;</span></span><br><span class="line">    attributes = self.__dict__.values()</span><br><span class="line">    <span class="keyword">for</span> attribute <span class="keyword">in</span> attributes:</span><br><span class="line">      result += attribute</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="comment">#将在（六、七）中被使用</span></span><br><span class="line">extArgs_content = ExtArgsContent()</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment">#用于读取  --output_dir=&quot;&quot;和  --logging_dir=&quot;&quot;的值，来修改8.2中保存路径</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_get</span>(<span class="params">search</span>):</span><br><span class="line">  <span class="comment"># 如果input是字符串类型，匹配search=&quot;&quot;</span></span><br><span class="line">  <span class="comment">#pattern = rf&#x27;&#123;search&#125;=(&quot;.*?&quot;)&#x27;</span></span><br><span class="line">  pattern = <span class="string">rf&#x27;^<span class="subst">&#123;search&#125;</span>=(&quot;.*?&quot;)&#x27;</span></span><br><span class="line">  <span class="comment">#使用with语句打开文件，并读取内容</span></span><br><span class="line">  <span class="keyword">with</span> <span class="built_in">open</span>(train_sh_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">    re_get = re.findall(pattern, content, flags=re.MULTILINE|re.DOTALL)</span><br><span class="line">    <span class="keyword">return</span> re_get[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment">#初始化，在（八）中执行判断</span></span><br><span class="line">enable_sample = <span class="literal">False</span></span><br><span class="line">use_train_sh_self = <span class="literal">False</span></span><br><span class="line">use_sample_prompt_txt_self = <span class="literal">False</span></span><br></pre></td></tr></table></figure><ul><li><p>创建训练时的文件夹</p><p>这里我要输出的模型为TLailin，所以就直接写上了，如果你要更改的话，后面对应的TLailin也都要更改上，输入后启动运行，然后可以在这里上传之前的已准备好的图片和Tagger文件到这里</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mkdir -pv /content/lora-scripts/train/TLailin/6_TLailin</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683168591611.jpg" alt=""></p><ul><li>安装依赖环境(这里等待的时间会比较长)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">!sudo apt-get update -y &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">!sudo apt-get install python3<span class="number">.10</span> &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment">#change alternatives 首选py3.9</span></span><br><span class="line">!sudo update-alternatives --install /usr/<span class="built_in">bin</span>/python3 python3 /usr/<span class="built_in">bin</span>/python3<span class="number">.9</span> <span class="number">1</span>  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">!sudo update-alternatives --install /usr/<span class="built_in">bin</span>/python3 python3 /usr/<span class="built_in">bin</span>/python3<span class="number">.10</span> <span class="number">2</span>  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment">#check python version 查看版本 #3.10</span></span><br><span class="line">!python --version</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;python升级中&quot;</span>)</span><br><span class="line"><span class="comment"># install pip for new python 为py3.10安装pip</span></span><br><span class="line">!sudo apt-get install python3<span class="number">.10</span>-distutils  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">!wget https://bootstrap.pypa.io/get-pip.py  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">!python get-pip.py  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment">#install colab&#x27;s dependencies 安装colab依赖</span></span><br><span class="line">!python -m pip install ipython ipython_genutils ipykernel jupyter_console prompt_toolkit httplib2 astor  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment"># link to the old google package 将py3.9的谷歌依赖连接至3.10</span></span><br><span class="line">!ln -s /usr/local/lib/python3<span class="number">.9</span>/dist-packages/google \</span><br><span class="line">/usr/local/lib/python3<span class="number">.10</span>/dist-packages/google  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;python升级完成 1/6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#这是一个备份更新python3.10.6的方式</span></span><br><span class="line"><span class="comment">#切换到python3.10</span></span><br><span class="line"><span class="comment">#!wget https://github.com/korakot/kora/releases/download/v0.10/py310.sh</span></span><br><span class="line"><span class="comment">#!bash ./py310.sh -b -f -p /usr/local</span></span><br><span class="line"><span class="comment">#!python -m ipykernel install --name &quot;py310&quot; --user</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###################################################################################</span></span><br><span class="line"><span class="comment">#安装相关环境</span></span><br><span class="line"></span><br><span class="line">pip_all_number = <span class="number">7</span></span><br><span class="line">pip_count = <span class="number">2</span></span><br><span class="line"><span class="comment">#安装aria2</span></span><br><span class="line">!apt -qq install liblz4-tool aria2  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment">#安装其他依赖</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;其他依赖安装中，此步耗时较长，请耐心等待&quot;</span>)</span><br><span class="line">%cd /content/lora-scripts/sd-scripts/</span><br><span class="line">!pip -q install --upgrade -r requirements.txt  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;其他依赖安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"><span class="comment">#安装兼容torch1.14.1的torchvision0.14.1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;torchvision安装中&quot;</span>)</span><br><span class="line">!pip -q install torchvision==<span class="number">0.14</span><span class="number">.1</span>  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;torchvision-0.14.1安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"><span class="comment">#安装xformers 0.0.16版本</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;xformers安装中&quot;</span>)</span><br><span class="line">!pip -q install xformers==<span class="number">0.0</span><span class="number">.16</span>  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;xformers-0.0.16安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"><span class="comment">#安装Triton</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;triton安装中&quot;</span>)</span><br><span class="line">!pip -q install triton==<span class="number">2.0</span><span class="number">.0</span>.dev20221202  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Triton安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"><span class="comment">#安装lion优化器、lycoris</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;lion优化器、lycoris安装中&quot;</span>)</span><br><span class="line">!pip -q install --upgrade lion-pytorch lycoris-lora  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;lion优化器、lycoris安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"><span class="comment">#安装Dadaption优化器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Dadaption优化器安装中&quot;</span>)</span><br><span class="line">!pip -q install dadaptation   &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Dadaption优化器安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#############################</span></span><br><span class="line"><span class="comment">#开启tensorboard</span></span><br><span class="line">%load_ext tensorboard</span><br></pre></td></tr></table></figure><ul><li>下载训练底模，点击选择就可以了，不是很了解的话直接运行就可以</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title ### 6.1 下载模型</span></span><br><span class="line">installModels = []</span><br><span class="line">installv2Models = []</span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown ####**选择优先级从上到下，比如说你想自定义链接，则需要保持两个预设模型为空**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown **预设剪枝模型（`Animefull-final-pruned`即NovelAI官模 ， `Stable-Diffusion-v1-5`即SD1.5）**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown SD1.x model</span></span><br><span class="line">modelName = <span class="string">&quot;Animefull-final-pruned&quot;</span>  <span class="comment"># @param [&quot;&quot;, &quot;Animefull-final-pruned&quot;, &quot;Stable-Diffusion-v1-5&quot;, &quot;Anything-v3-1&quot;, &quot;AnyLoRA&quot;, &quot;AnimePastelDream&quot;, &quot;Chillout-mix&quot;, &quot;OpenJourney-v4&quot;]</span></span><br><span class="line"><span class="comment">#@markdown SD2.x model</span></span><br><span class="line">v2ModelName = <span class="string">&quot;&quot;</span>  <span class="comment"># @param [&quot;&quot;, &quot;stable-diffusion-2-1-base&quot;, &quot;stable-diffusion-2-1-768v&quot;, &quot;plat-diffusion-v1-3-1&quot;, &quot;replicant-v1&quot;, &quot;illuminati-diffusion-v1-0&quot;, &quot;illuminati-diffusion-v1-1&quot;, &quot;waifu-diffusion-1-4-anime-e2&quot;, &quot;waifu-diffusion-1-5-e2&quot;, &quot;waifu-diffusion-1-5-e2-aesthetic&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown **自定义模型链接例如`https://huggingface.co/a1079602570/animefull-final-pruned/resolve/main/novelailatest-pruned.ckpt`）**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown **或者自定义模型路径例如`/content/drive/MyDrive/Lora/model/your_model.ckpt`**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown **如果连接或者路径中包含模型的扩展名(比如我给出的两个例如的末尾都有扩展名)，则会自动指定，否则你需要手动选择**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown - **注意，Colab普通用户仅能选择5G以下的模型**</span></span><br><span class="line"></span><br><span class="line">base_model_url = <span class="string">&quot;https://civitai.com/api/download/models/37521&quot;</span> <span class="comment">#@param &#123;type:&quot;string&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">base_model_self_dir = <span class="string">&quot;&quot;</span> <span class="comment">#@param &#123;type:&quot;string&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">base_model_extension = <span class="string">&quot;ckpt&quot;</span> <span class="comment">#@param [&quot;ckpt&quot;, &quot;safetensors&quot;, &quot;pt&quot;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">modelUrl = [</span><br><span class="line">    <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Linaqruf/personal-backup/resolve/main/models/animefull-final-pruned.ckpt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/cag/anything-v3-1/resolve/main/anything-v3-1.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Lykon/AnyLoRA/resolve/main/AnyLoRA_noVae_fp16.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Lykon/AnimePastelDream/resolve/main/AnimePastelDream_Soft_noVae_fp16.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Linaqruf/stolen/resolve/main/pruned-models/chillout_mix-pruned.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/prompthero/openjourney-v4/resolve/main/openjourney-v4.ckpt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Linaqruf/stolen/resolve/main/pruned-models/stable_diffusion_1_5-pruned.safetensors&quot;</span>,</span><br><span class="line">]</span><br><span class="line">modelList = [</span><br><span class="line">    <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Animefull-final-pruned&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Anything-v3-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;AnyLoRA&quot;</span>,</span><br><span class="line">    <span class="string">&quot;AnimePastelDream&quot;</span>,    </span><br><span class="line">    <span class="string">&quot;Chillout-mix&quot;</span>,</span><br><span class="line">    <span class="string">&quot;OpenJourney-v4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Stable-Diffusion-v1-5&quot;</span>,</span><br><span class="line">]</span><br><span class="line">v2ModelUrl = [</span><br><span class="line">    <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/stabilityai/stable-diffusion-2-1-base/resolve/main/v2-1_512-ema-pruned.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/stabilityai/stable-diffusion-2-1/resolve/main/v2-1_768-ema-pruned.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/p1atdev/pd-archive/resolve/main/plat-v1-3-1.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/gsdf/Replicant-V1.0/resolve/main/Replicant-V1.0.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/IlluminatiAI/Illuminati_Diffusion_v1.0/resolve/main/illuminati_diffusion_v1.0.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/4eJIoBek/Illuminati-Diffusion-v1-1/resolve/main/illuminatiDiffusionV1_v11.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/hakurei/waifu-diffusion-v1-4/resolve/main/wd-1-4-anime_e2.ckpt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/waifu-diffusion/wd-1-5-beta2/resolve/main/checkpoints/wd-1-5-beta2-fp32.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/waifu-diffusion/wd-1-5-beta2/resolve/main/checkpoints/wd-1-5-beta2-aesthetic-fp32.safetensors&quot;</span>,</span><br><span class="line">]</span><br><span class="line">v2ModelList = [</span><br><span class="line">    <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stable-diffusion-2-1-base&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stable-diffusion-2-1-768v&quot;</span>,</span><br><span class="line">    <span class="string">&quot;plat-diffusion-v1-3-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;replicant-v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;illuminati-diffusion-v1-0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;illuminati-diffusion-v1-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;waifu-diffusion-1-4-anime-e2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;waifu-diffusion-1-5-e2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;waifu-diffusion-1-5-e2-aesthetic&quot;</span>,</span><br><span class="line">]</span><br><span class="line"><span class="keyword">if</span> modelName:</span><br><span class="line">    installModels.append((modelName, modelUrl[modelList.index(modelName)]))</span><br><span class="line"><span class="keyword">if</span> v2ModelName:</span><br><span class="line">    installv2Models.append((v2ModelName, v2ModelUrl[v2ModelList.index(v2ModelName)]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#下载路径</span></span><br><span class="line">base_model_dir = <span class="string">&quot;/content/lora-scripts/sd-models/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#检查连接是否含有扩展名信息，不含有则由用户指定</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_ext</span>(<span class="params">url</span>):</span><br><span class="line">  <span class="keyword">if</span> url.endswith(<span class="string">&quot;.ckpt&quot;</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ckpt&quot;</span></span><br><span class="line">  <span class="keyword">elif</span> url.endswith(<span class="string">&quot;.safetensors&quot;</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;safetensors&quot;</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> base_model_extension</span><br><span class="line"><span class="comment">#下载模型</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">install</span>(<span class="params">checkpoint_name, url</span>):</span><br><span class="line">    ext = check_ext(url)</span><br><span class="line">    hf_token = <span class="string">&quot;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&quot;</span></span><br><span class="line">    user_header = <span class="string">f&#x27;&quot;Authorization: Bearer <span class="subst">&#123;hf_token&#125;</span>&quot;&#x27;</span></span><br><span class="line">    !aria2c --console-log-level=error --summary-interval=<span class="number">10</span> --header=&#123;user_header&#125; -c -x <span class="number">16</span> -k 1M -s <span class="number">16</span> -d &#123;base_model_dir&#125; -o &#123;checkpoint_name&#125;.&#123;ext&#125; &#123;url&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;checkpoint_name&#125;</span>.<span class="subst">&#123;ext&#125;</span>&quot;</span>   <span class="comment">#返回模型名称</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">install_checkpoint</span>():</span><br><span class="line">    <span class="keyword">for</span> model <span class="keyword">in</span> installModels:</span><br><span class="line">        <span class="keyword">return</span> install(model[<span class="number">0</span>], model[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">for</span> v2model <span class="keyword">in</span> installv2Models:</span><br><span class="line">        <span class="keyword">return</span> install(v2model[<span class="number">0</span>], v2model[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#尝试下载预设模型</span></span><br><span class="line">base_model_name = install_checkpoint()</span><br><span class="line"><span class="comment">#预设下载成功，则完成路径修改</span></span><br><span class="line"><span class="keyword">if</span> base_model_name:</span><br><span class="line">  pretrained_model = base_model_dir + base_model_name</span><br><span class="line"><span class="comment">#下载失败，base_model_name为non</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="comment">#不留空，则尝试用连接下载</span></span><br><span class="line">  <span class="keyword">if</span> base_model_url:</span><br><span class="line">    base_model_name = <span class="string">&quot;download.&quot;</span> + check_ext(base_model_url)</span><br><span class="line">    pretrained_model = base_model_dir + base_model_name</span><br><span class="line">    !aria2c --console-log-level=error --summary-interval=<span class="number">10</span> -c -x <span class="number">16</span> -k 1M -s <span class="number">16</span> -d &#123;base_model_dir&#125; -o &#123;base_model_name&#125; --allow-overwrite &#123;base_model_url&#125;</span><br><span class="line">  <span class="comment">#留空，将考虑从自定义路径中拷贝</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> base_model_self_dir:</span><br><span class="line">      base_model_name = <span class="string">&quot;self.&quot;</span> + check_ext(base_model_self_dir)</span><br><span class="line">      pretrained_model = base_model_dir + base_model_name</span><br><span class="line">      !cp &#123;base_model_self_dir&#125; &#123;pretrained_model&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;你根本没选择任何模型！&quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment">#修改train.sh的底模路径，并输出信息</span></span><br><span class="line">search_input(<span class="string">&quot;pretrained_model&quot;</span>, pretrained_model)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出模型信息</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;你选择的是: <span class="subst">&#123;base_model_name&#125;</span> 模型&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li>指定使用的外挂Vae，还是一样，不了解的话直接选我推荐的anime然后直接运行即可</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @title ## 6.2 下载vae（可选）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#储存下载信息参数</span></span><br><span class="line">installVae = []</span><br><span class="line"><span class="comment">#@markdown 选择 `none` 意味着不使用vae</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown 选择一个Vae下载并使用`&quot;animevae.pt&quot;, &quot;kl-f8-anime.ckpt&quot;, &quot;vae-ft-mse-840000-ema-pruned.ckpt&quot;`</span></span><br><span class="line"></span><br><span class="line">vaeUrl = [</span><br><span class="line">    <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Linaqruf/personal-backup/resolve/main/vae/animevae.pt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/hakurei/waifu-diffusion-v1-4/resolve/main/vae/kl-f8-anime.ckpt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/stabilityai/sd-vae-ft-mse-original/resolve/main/vae-ft-mse-840000-ema-pruned.ckpt&quot;</span>,</span><br><span class="line">]</span><br><span class="line">vaeList = [<span class="string">&quot;none&quot;</span>, <span class="string">&quot;anime.vae.pt&quot;</span>, <span class="string">&quot;waifudiffusion.vae.pt&quot;</span>, <span class="string">&quot;stablediffusion.vae.pt&quot;</span>]</span><br><span class="line">vaeName = <span class="string">&quot;anime.vae.pt&quot;</span>  <span class="comment"># @param [&quot;none&quot;, &quot;anime.vae.pt&quot;, &quot;waifudiffusion.vae.pt&quot;, &quot;stablediffusion.vae.pt&quot;]</span></span><br><span class="line"></span><br><span class="line">installVae.append((vaeName, vaeUrl[vaeList.index(vaeName)]))</span><br><span class="line"></span><br><span class="line"><span class="comment">#开始下载</span></span><br><span class="line">vae_dir = <span class="string">&quot;/content/lora-scripts/vae/&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">install</span>(<span class="params">vae_name, url</span>):</span><br><span class="line">    hf_token = <span class="string">&quot;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&quot;</span></span><br><span class="line">    user_header = <span class="string">f&#x27;&quot;Authorization: Bearer <span class="subst">&#123;hf_token&#125;</span>&quot;&#x27;</span></span><br><span class="line">    !aria2c --console-log-level=error --allow-overwrite --summary-interval=<span class="number">10</span> --header=&#123;user_header&#125; -c -x <span class="number">16</span> -k 1M -s <span class="number">16</span> -d &#123;vae_dir&#125; -o <span class="string">&quot;vae.pt&quot;</span> <span class="string">&quot;&#123;url&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">install_vae</span>():</span><br><span class="line">    <span class="keyword">if</span> vaeName != <span class="string">&quot;none&quot;</span>:</span><br><span class="line">        <span class="keyword">for</span> vae <span class="keyword">in</span> installVae:</span><br><span class="line">            install(vae[<span class="number">0</span>], vae[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">install_vae()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extArgs_content.vae = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#修改train.sh中参数</span></span><br><span class="line"><span class="keyword">if</span> vaeName == <span class="string">&quot;none&quot;</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;不使用vae&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;使用<span class="subst">&#123;vaeName&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="comment">#写入采样地址f&quot;--vae=&#123;vae_dir&#125;&quot;</span></span><br><span class="line">  extArgs_content.vae += <span class="string">f&quot;\&quot;--vae=<span class="subst">&#123;vae_dir&#125;</span>vae.pt\&quot; &quot;</span></span><br><span class="line"></span><br><span class="line">search_input(<span class="string">&quot;&quot;</span>, extArgs_content.<span class="built_in">all</span>() )</span><br></pre></td></tr></table></figure><ul><li>修改脚本运行参数</li></ul><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683169164742.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是要修改的配置,没有注释的话就直接跟着我复制更改进去就可以</span></span><br><span class="line">train_data_dir=<span class="string">&quot;/content/lora-scripts/train/TLailin/&quot;</span><span class="comment">#这里改成刚才创建文件夹的名字</span></span><br><span class="line">resolution=<span class="string">&quot;512,512&quot;</span><span class="comment"># 这里改成你准备的图片的分辨率</span></span><br><span class="line">batch_size=<span class="number">1</span></span><br><span class="line">max_train_epoches=<span class="number">20</span></span><br><span class="line">output_name=<span class="string">&quot;TLailin&quot;</span><span class="comment"># 想要输出的模型名</span></span><br><span class="line"></span><br><span class="line">min_bucket_reso=<span class="number">256</span></span><br><span class="line">max_bucket_reso=<span class="number">1920</span></span><br><span class="line"><span class="comment"># 这两个参数是要根据你准备的图片的分辨率来调的,max的可以直接拉到最高1920，但是min是要在你的最低分辨率往下或者一样,比如说我现在准备的图片分辨率是1280,1408，那么这里我的min_bucket_reso最高就只能填1280</span></span><br></pre></td></tr></table></figure><ul><li>输入启动开始运行</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title  ### 8.2开始训练</span></span><br><span class="line"><span class="comment">#@markdown 若正确运行，训练完成后，模型会自动保存至你的谷歌硬盘中`我的云端硬盘/Lora/output/`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown 如果不到1分钟就运行完了，多半是出错了，把输出信息复制到ChatGPT问下罢！ :(</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown - Q：输出代码的最后出现（kill:9）字样 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown - A：爆ram了，更换小的底模</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown ---</span></span><br><span class="line"><span class="comment">#@markdown 是否保存本次训练的train.sh和采样配置（如果你启用采样功能的话）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown 保存路径： `留空则保存至当前train.sh中指定的输出路径`</span></span><br><span class="line">save_files = <span class="literal">True</span> <span class="comment">#@param &#123;type:&quot;boolean&quot;&#125;</span></span><br><span class="line">save_files_dir_self = <span class="string">&quot;&quot;</span> <span class="comment">#@param &#123;type:&quot;string&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> save_files:</span><br><span class="line">  <span class="comment">#指定保存路径</span></span><br><span class="line">  <span class="keyword">if</span> save_files_dir_self:</span><br><span class="line">    save_files_dir = save_files_dir_self</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;你指定了自定义的配置保存路径：<span class="subst">&#123;save_files_dir&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    save_files_dir = search_get(<span class="string">&quot;  --output_dir&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;采用trian.sh中指定的输出路径：<span class="subst">&#123;save_files_dir&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="comment">#保存训练参数文件至谷歌硬盘</span></span><br><span class="line">  !mkdir -p &#123;save_files_dir&#125;</span><br><span class="line">  !cp &#123;train_sh_path&#125; &#123;save_files_dir&#125;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;训练参数被保存至<span class="subst">&#123;save_files_dir&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="comment">#保存采样参数文件至谷歌硬盘</span></span><br><span class="line">  <span class="keyword">if</span> enable_sample <span class="keyword">or</span> use_sample_prompt_txt_self:</span><br><span class="line">    !cp &#123;sample_prompt_txt_path&#125; &#123;save_files_dir&#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;采样参数被保存至<span class="subst">&#123;save_files_dir&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;未启用采样功能，不保存采样配置&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;不保存配置文件&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#开始训练！</span></span><br><span class="line">%cd /content/lora-scripts/</span><br><span class="line">!bash train.sh</span><br><span class="line"></span><br><span class="line">!echo <span class="string">&quot;完成了 XXXD.&quot;</span></span><br></pre></td></tr></table></figure><p>后面就是漫长的等待啦</p><ul><li><p>这里要注意的是Colab一旦关闭就很大概率会连不上，连不上的话会重置笔记本，也就会前功尽弃，所以在运行的时候你要时刻保持着科学上网，而且要在控制台输入刷新代码防止中途给你卡出个验证</p></li><li><p>按F12开启控制台，选择Console，然后在最下面粘贴下面给出的代码并回车就可以了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function getElementByXpath(path) &#123;</span><br><span class="line">       <span class="keyword">return</span> document.evaluate(path, document, null, </span><br><span class="line">       XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">function reconnect()&#123;</span><br><span class="line">  console.log(<span class="string">&#x27;working&#x27;</span>)</span><br><span class="line">  getElementByXpath(<span class="string">&quot;//div[@id=&#x27;top-toolbar&#x27;]/colab-connect-button&quot;</span>).click()</span><br><span class="line">&#125;</span><br><span class="line">var a = setInterval(reconnect, <span class="number">1</span>*<span class="number">60</span>*<span class="number">1000</span>);</span><br><span class="line">function stop()&#123;</span><br><span class="line"> clearInterval(a)</span><br><span class="line">&#125;</span><br><span class="line">function start()&#123;</span><br><span class="line"> a = setInterval(reconnect, <span class="number">1</span>*<span class="number">60</span>*<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/%7B40I%5DMXKPDUHE@U2$SKAR_M.png" alt=""></p></li></ul></li></ol><h4 id="Lora的使用">Lora的使用</h4><p>把输出到google磁盘中的训练好的模型下载下来然后放在SD_ROOT/models/Lora目录下然后刷新Web UI界面就，Lora的使用只需要你点击<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683189185284.png" alt=""><br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683189426645.jpg" alt=""><br>然后点击自己的Lora模型，就会自动写入到正向提示词啦，其他的按平时的SD操作来就可以了。<br>这里我有上传自己的模型到C站中,分别是轻小说里的角色艾琳和沙季</p><style>.stars_box {    display: flex;    gap: 15px;    flex-wrap: wrap;    justify-content: center;}.stars_box .card_box {    margin: 0px !important}@media screen and (max-width: 768px) {    .stars_box{        padding: 0 5px    }    .stars_box .card_box {        width: calc(100%/2 - 8px) !important;        height: 240px !important;        margin: 8px 0 !important    }}html.hide-aside .layout > div:first-child {    width: 90%;}@media screen and (max-width: 768px).layout > div:first-child:not(.recent-posts) {    padding: 0px 14px !important;}.layout > div:first-child:not(.recent-posts) {    padding: 0px 12px!important;}</style><div class="stars_box"><div title="不时轻声地以俄语遮羞的邻座艾莉同学" referrerPolicy="no-referrer" class="card_box" style="background-image: url(https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1679060367555.png); width:200px; height:275px;">    <div class="card_mask">      <span>此作品博主暂未作出评价</span>      <a href="https://zh.moegirl.org.cn/%E4%B8%8D%E6%97%B6%E8%BD%BB%E5%A3%B0%E5%9C%B0%E4%BB%A5%E4%BF%84%E8%AF%AD%E9%81%AE%E7%BE%9E%E7%9A%84%E9%82%BB%E5%BA%A7%E8%89%BE%E8%8E%89%E5%90%8C%E5%AD%A6">查看详情</a>    </div>    <div class="card_top">      <i class=""></i>      <span>轻小说</span>    </div>    <div class="card_content">      <span>不时轻声地以俄语遮羞的邻座艾莉同学</span>      <div><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></div>    </div>  </div><div title="义妹生活" referrerPolicy="no-referrer" class="card_box" style="background-image: url(https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/qxssj.jpg); width:200px; height:275px;">    <div class="card_mask">      <span>此作品博主暂未作出评价</span>      <a href="https://zh.moegirl.org.cn/%E4%B9%89%E5%A6%B9%E7%94%9F%E6%B4%BB">查看详情</a>    </div>    <div class="card_top">      <i class=""></i>      <span>轻小说</span>    </div>    <div class="card_content">      <span>义妹生活</span>      <div><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></div>    </div>  </div></div><div class="note warning simple"><p>PS: 重要的事情说三遍！不要使用此模型画18+的图片！！！不要使用此模型画18+的图片！！！不要使用此模型画18+的图片！！</p></div><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683190141926.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">Lora</div>  <p>分别是艾琳和绫濑沙季</p>  <a href='https://civitai.com/user/Tianlin/models'></a>  </figcaption>  </figure>  </div><div class="note warning simple"><p>本模型仅限于个人学习和非商业用途。作者提供的模型没有任何明示或暗示的保证和担保，作者不对任何由于使用本模型所引起的直接、间接、偶然、特殊及后果性损失或其他任何类型的损失承担责任。使用者应对使用本模型所引起的风险承担完全责任，作者不承担任何法律义务和赔偿责任</p></div>]]></content>
    
    
    <summary type="html">SD使用和Lora模型训练</summary>
    
    
    
    <category term="演示" scheme="https://www.linjiangyu.com/categories/%E6%BC%94%E7%A4%BA/"/>
    
    
    <category term="AI" scheme="https://www.linjiangyu.com/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>日志轮询</title>
    <link href="https://www.linjiangyu.com/posts/3f7ad5be.html"/>
    <id>https://www.linjiangyu.com/posts/3f7ad5be.html</id>
    <published>2023-03-14T11:27:14.000Z</published>
    <updated>2023-11-27T01:42:42.511Z</updated>
    
    <content type="html"><![CDATA[<h3 id="日志轮询">日志轮询</h3><h4 id="意义">意义</h4><ul><li>1.日志轮询可以确保系统日志文件不会无限增长，以免影响系统性能并占用过多的磁盘空间。通过定期轮询日志文件，旧的日志信息可以得到保留，从而为故障排除和性能分析提供重要的历史数据</li><li>2.日志轮询可以将日志文件分割为多个较小的文件，每个文件包含一段时间内的日志信息。这将使日志检索更加高效，因为只需要搜索特定时间段内的日志文件，而不需要搜索整个日志文件。这也有助于加快故障排除和性能分析的速度</li><li>3.日志轮询可以使日志管理和维护更加方便。由于每个日志文件都包含一段时间范围内的日志信息，因此可以轻松地对特定时间段内的日志进行备份、压缩、归档或删除。此外，日志轮询还可以帮助识别和修复日志文件中的错误或损坏</li></ul><h4 id="实操">实操</h4><ul><li>example<ul><li>日志文件/var/log/messages一月一轮询</li><li>日志文件大于10M时，直接主动进行轮询不需要考虑一月一轮询</li><li>保存5个备份文件</li><li>备份文件需要压缩<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chattr +a /var/log/messages</span></span><br><span class="line"><span class="comment"># vim /etc/logrotate.d/messages        # 定义轮询规则</span></span><br><span class="line">/var/log/<span class="section">messages</span> &#123;</span><br><span class="line">        <span class="attribute">monthly</span><span class="comment"># 每个月进行一次</span></span><br><span class="line">        size=<span class="number">8M</span><span class="comment"># 文件容量大于10M时开始轮询</span></span><br><span class="line">        rotate  <span class="number">5</span><span class="comment"># 保留五个文件</span></span><br><span class="line">        compress<span class="comment"># 进行压缩</span></span><br><span class="line">        sharedscripts</span><br><span class="line">        prerotate</span><br><span class="line">                /usr/bin/chattr -a /var/log/messages</span><br><span class="line">        endscript</span><br><span class="line">        sharedscripts</span><br><span class="line">        postrotate</span><br><span class="line">                /bin/kill -HUP `cat /var/run/syslogd.pid <span class="number">2</span>&gt;/dev/null` <span class="number">2</span>&gt;/dev/null || <span class="literal">true</span></span><br><span class="line">                /usr/bin/chattr +a /var/log/messages</span><br><span class="line">        endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># logrotate -vf /etc/logrotate.conf   // 查看轮询</span></span><br><span class="line">// 可以通过别的文件重定向到/var/log/messages中让文件达到<span class="number">10M</span>大小测试轮询</span><br></pre></td></tr></table></figure></li></ul></li></ul>]]></content>
    
    
    <summary type="html">日志轮询</summary>
    
    
    
    <category term="演示" scheme="https://www.linjiangyu.com/categories/%E6%BC%94%E7%A4%BA/"/>
    
    
  </entry>
  
  <entry>
    <title>HTTP/3新优势</title>
    <link href="https://www.linjiangyu.com/posts/3b54fb61.html"/>
    <id>https://www.linjiangyu.com/posts/3b54fb61.html</id>
    <published>2023-03-03T08:41:41.000Z</published>
    <updated>2023-11-27T01:42:42.511Z</updated>
    
    <content type="html"><![CDATA[<h3 id="HTTP3">HTTP3</h3><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>HTTP/1.x</p>            </div><ul><li>开始便有了队头阻塞问题，请求头部未经压缩便发送，而且发送冗长的首部每次还会发出重复的为压缩头部报文。<ul><li>按顺序请求响应的，如果服务器响应慢会导致后面的数据阻塞。</li></ul><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>HTTP/2</p>            </div></li><li>头部压缩，HTTP/2 通过 Stream 的并发能力，解决了队头阻塞问题，但是却卡在了TCP这一层。<ul><li>TCP层必须保证收到的字节数据是完整且连续的如果当前字节没有到达时后面的字节只能暂时存放在缓冲区中等待这个字节到达，这就是HTTP2的队头阻塞问题。</li></ul><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>HTTP/3</p>            </div></li><li>使用了以不可靠传输协议UDP为基本的UQIC可靠协议。<ul><li>QUIC协议的某个流发生丢包时，只会阻塞这个流，其他流不会受到影响，因此不存在队头阻塞问题</li><li>更快的建立连接，比起HTTP2的首先要经过TCP握手然后再TLS握手，QUIC内部便包含了TLS，会在自己的帧中携带TLS里的&quot;记录&quot;,加上QUIC使用的是TLS1.3，所以连接的建立也会更快。</li></ul></li></ul>]]></content>
    
    
    <summary type="html">HTTP/3新优势</summary>
    
    
    
    <category term="演示" scheme="https://www.linjiangyu.com/categories/%E6%BC%94%E7%A4%BA/"/>
    
    
  </entry>
  
  <entry>
    <title>给友链页面添加一个Sakana~</title>
    <link href="https://www.linjiangyu.com/posts/e5482ed2.html"/>
    <id>https://www.linjiangyu.com/posts/e5482ed2.html</id>
    <published>2023-02-27T00:28:49.000Z</published>
    <updated>2023-11-27T01:42:42.513Z</updated>
    
    <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h2 id="给hexo博客添加一个Sakana">给hexo博客添加一个Sakana~</h2></div></div><div class='checkbox'><input type="radio" />            <h3 id="来自开源项目itorr-sakana">来自开源项目<a href="https://github.com/itorr/sakana/">itorr/sakana</a></h3>            </div><div class='checkbox'><input type="radio" />            <p>同<a href="https://naokuoteng.cn/">脑阔疼ﻩ٥</a>一同制作完成</p>            </div><details class="folding-tag" cyan open orange><summary> 效果如下 </summary>              <div class='content'>              <div class="hide-block"><button type="button" class="hide-button" style="background-color: orange;">预览点我     </button><div class="hide-content"><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/sakana.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div></div></div><div class="site-card-group"><a class="site-card" href="https://blog.linjiangyu.com/link/"><div class="img"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/saka.png"/></div><div class="info"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/><span class="title">Tianlin</span><span class="desc">我的站点</span></div></a></div>              </div>            </details><h3 id="教程">教程</h3><div class='checkbox'><input type="radio" />            <p>写入到root_blog\themes\butterfly\source\css\custom.css文件中并引用</p>            </div><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> <span class="selector-class">.sakana-box</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transform-origin</span>: <span class="number">100%</span> <span class="number">100%</span>; <span class="comment">/* 从右下开始变换 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sakana-box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">pointer-events</span>: none;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>)&#123;</span><br><span class="line">  <span class="selector-class">.sakana-box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>)&#123;</span><br><span class="line">  <span class="selector-tag">html</span> <span class="selector-class">.sakana-box</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: inherit;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">36%</span> <span class="number">160%</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;light&quot;</span>]</span> <span class="selector-class">.layout</span> &gt; <span class="selector-tag">div</span><span class="selector-pseudo">:first</span>-child<span class="selector-pseudo">:not</span>(<span class="selector-class">.recent-posts</span>) &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">8</span>);</span><br><span class="line">    -webkit-backdrop-<span class="attribute">filter</span>: none;</span><br><span class="line">    backdrop-<span class="attribute">filter</span>: none<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.layout</span> &gt; <span class="selector-tag">div</span><span class="selector-pseudo">:first</span>-child<span class="selector-pseudo">:not</span>(<span class="selector-class">.recent-posts</span>) &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">15</span>, <span class="number">15</span>, <span class="number">15</span>, .<span class="number">75</span>);</span><br><span class="line">    -webkit-backdrop-<span class="attribute">filter</span>: none;</span><br><span class="line">    backdrop-<span class="attribute">filter</span>: none<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">html</span><span class="selector-class">.hide-aside</span> <span class="selector-class">.layout</span> &gt; <span class="selector-tag">div</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class='checkbox'><input type="radio" />            <p>直接写入到root_blog\source\link\index.md文件中</p>            </div><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;sakana-box&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;script <span class="attribute">src</span>=&quot;https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/js/sakana.js<span class="string">&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">Sakana.init(&#123;</span></span><br><span class="line"><span class="string">  el:         &#x27;.sakana-box&#x27;,     // 启动元素 node 或 选择器</span></span><br><span class="line"><span class="string">  scale:      .5,                // 缩放倍数</span></span><br><span class="line"><span class="string">  canSwitchCharacter: true,      // 允许换角色</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><div class='checkbox'><input type="radio" />            <p>修改root_blog\themes\butterfly_config.yml</p>            </div><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line"><span class="string">+</span>    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/custom.css&quot;&gt;</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="attr">pjax:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br><span class="line"><span class="string">+</span>    <span class="bullet">-</span> <span class="string">/link/</span></span><br><span class="line">    <span class="comment"># - xxxx</span></span><br><span class="line">    <span class="comment"># - xxxx</span></span><br></pre></td></tr></table></figure><p>就可以得到一个Sakana了~</p><div class='checkbox'><input type="radio" />            <h3 id="这里我还给Heo的音乐播放器加上了">这里我还给<a href="https://github.com/zhheo/HeoMusic">Heo的音乐播放器</a>加上了</h3>            </div><details class="folding-tag" cyan open orange><summary> 效果如下 </summary>              <div class='content'>              <div class="hide-block"><button type="button" class="hide-button" style="background-color: orange;">预览点我     </button><div class="hide-content"><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1677466852471.png" alt=""></p></div></div><div class="site-card-group"><a class="site-card" href="https://music.linjiangyu.com/"><div class="img"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1677466852471.png"/></div><div class="info"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/><span class="title">心灵庇护所</span><span class="desc">我的站点</span></div></a></div>              </div>            </details><div class='checkbox'><input type="radio" />            <p>修改index.html文件</p>            </div><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon-precomposed&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;180x180&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./img/icon-r.webp&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;念念不忘 必有回响&quot;</span>&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">+  <span class="selector-tag">html</span> <span class="selector-class">.sakana-box</span>&#123;</span></span><br><span class="line"><span class="language-css">+    <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="language-css">+    <span class="attribute">right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">+    <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">+    <span class="attribute">transform-origin</span>: <span class="number">100%</span> <span class="number">100%</span>; <span class="comment">/* 从右下开始变换 */</span></span></span><br><span class="line"><span class="language-css">+  &#125;</span></span><br><span class="line"><span class="language-css">+  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">......</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/APlayer.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/Meting2.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">data-pjax</span> <span class="attr">src</span>=<span class="string">&quot;./js/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sakana-box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/gh/linjiangyu2/halo/js/sakana.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">+  <span class="comment">// 取消静音</span></span></span><br><span class="line"><span class="language-javascript">+  <span class="title class_">Sakana</span>.<span class="title function_">setMute</span>(<span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">+  <span class="comment">// 启动</span></span></span><br><span class="line"><span class="language-javascript">+  <span class="title class_">Sakana</span>.<span class="title function_">init</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">+    <span class="attr">el</span>:         <span class="string">&#x27;.sakana-box&#x27;</span>,     <span class="comment">// 启动元素 node 或 选择器</span></span></span><br><span class="line"><span class="language-javascript">+    <span class="attr">scale</span>:      <span class="number">.5</span>,                <span class="comment">// 缩放倍数</span></span></span><br><span class="line"><span class="language-javascript">+    <span class="attr">canSwitchCharacter</span>: <span class="literal">true</span>,      <span class="comment">// 允许换角色</span></span></span><br><span class="line"><span class="language-javascript">+  &#125;);</span></span><br><span class="line"><span class="language-javascript">+  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git add index.html</span></span><br><span class="line"><span class="comment"># git commit -m &#x27;none&#x27;</span></span><br><span class="line"><span class="comment"># git push</span></span><br></pre></td></tr></table></figure><p>推到github就可以了</p>]]></content>
    
    
    <summary type="html">给博客友链页面添加一个Sakana~</summary>
    
    
    
    <category term="魔改教程" scheme="https://www.linjiangyu.com/categories/%E9%AD%94%E6%94%B9%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="butterfly" scheme="https://www.linjiangyu.com/tags/butterfly/"/>
    
  </entry>
  
  <entry>
    <title>kvm-qemu虚拟化</title>
    <link href="https://www.linjiangyu.com/posts/2388a20a.html"/>
    <id>https://www.linjiangyu.com/posts/2388a20a.html</id>
    <published>2023-02-25T12:13:51.000Z</published>
    <updated>2023-11-27T01:42:42.513Z</updated>
    
    <content type="html"><![CDATA[<p>编写中…</p>]]></content>
    
    
    <summary type="html">kvm-qemu虚拟化</summary>
    
    
    
    <category term="运维" scheme="https://www.linjiangyu.com/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="Linux" scheme="https://www.linjiangyu.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>缓存代理中间件squid</title>
    <link href="https://www.linjiangyu.com/posts/e56cd95.html"/>
    <id>https://www.linjiangyu.com/posts/e56cd95.html</id>
    <published>2023-02-25T00:48:36.000Z</published>
    <updated>2023-11-27T01:42:42.513Z</updated>
    
    <content type="html"><![CDATA[<div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="编译安装">编译安装</h3></div><div class="note default orange simple"><h4 id="编译参数">编译参数</h4></div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--preifx：指定安装路径</span><br><span class="line">--sysconfdir：指定配置文件目录</span><br><span class="line">--enable-arp-acl：可以在规则中设置为直接通过客户端MAC进行管理，防止客户端使用IP欺骗</span><br><span class="line">--enable-linux-netfilter：使用内核过滤</span><br><span class="line">--enable-linux-tproxy：支持透明模式</span><br><span class="line">--enable-async-io=100：异步I/O，提升存储性能，相当于 --enable-<span class="attribute">pthreads</span>   --enable-storeio=ufs,aufs</span><br><span class="line">--enable-err-language=<span class="string">&quot;Simplify_Chinese&quot;</span>：报错时显示的语音，这里指定为Chinese</span><br><span class="line">--enable-underscore：允许URL中有下划线</span><br><span class="line">--enable-<span class="literal">poll</span>：使用Poll()模式，提升性能</span><br><span class="line">--enable-gnuregex：使用GUN正则表达式</span><br></pre></td></tr></table></figure><div class="note default orange simple"><h4 id="编译">编译</h4></div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># useradd -r -s /sbin/nologin -M squid</span></span><br><span class="line"><span class="comment"># tar xf squid-release.tar.gz</span></span><br><span class="line"><span class="comment"># cd squid-release</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/usr/local/squid --sysconfdir=/usr/local/squid/conf --enable-arp-acl --enable-linux-netfilter --enable-linux-tproxy --enable-async-io=100 --enable-err-language=&quot;Simplify_Chinese&quot; --enable-underscore --enable-poll --enable-gnuregex</span></span><br><span class="line"><span class="comment"># make -j2 &amp;&amp; make install</span></span><br><span class="line"><span class="comment"># usradd -r -s /sbin/nologin -M squid</span></span><br><span class="line"><span class="comment"># chown -R squid. /usr/local/squid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/init.d/squid.sh</span></span><br><span class="line"><span class="attribute">export</span> SQUID_HOME=/usr/local/squid</span><br><span class="line">export PATH=<span class="variable">$&#123;SQUID_HOME&#125;</span>/sbin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># source !$</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><h4 id="unit">unit</h4></div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat &gt; /usr/lib/systemd/system/squid.service &lt;&lt;END</span></span><br><span class="line"><span class="comment"># /usr/lib/systemd/system/squid.service</span></span><br><span class="line"><span class="comment"># author: linjiangyu</span></span><br><span class="line"><span class="comment"># cc: https://creativecommons.org/licenses/by-nc-sa/4.0/</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=<span class="attribute">Unit</span> squid by linjiangyu</span><br><span class="line">Documentation=https://linjiangyu.com/squid</span><br><span class="line">After=network-online.target nss-lookup.target remote-fs.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=/usr/local/squid/var/run/squid.pid</span><br><span class="line">ExecStart=/usr/local/squid/sbin/squid -f /usr/local/squid/conf/squid.conf</span><br><span class="line">ExecReload=/bin/kill -s HUP <span class="variable">$MAINPID</span></span><br><span class="line">ExecStop=/bin/kill -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line">User=squid</span><br><span class="line">Group=squid</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">END</span><br></pre></td></tr></table></figure><div class="note default orange simple"><h4 id="服务启动前先修改一下配置文件让squid用户启动服务">服务启动前先修改一下配置文件让squid用户启动服务</h4></div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/local/squid/conf/squid.conf</span></span><br><span class="line"><span class="attribute">cache_effective_user</span>squid</span><br><span class="line">cache_effective_groupsquid</span><br><span class="line">cache_dir ufs /usr/local/squid/var/cache/squid <span class="number">100</span> <span class="number">16</span> <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl daemon-reload</span></span><br><span class="line"><span class="comment"># systemctl start squid.service</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">缓存代理中间件squid</summary>
    
    
    
    <category term="服务集群" scheme="https://www.linjiangyu.com/categories/%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>多线程解压缩之pigz</title>
    <link href="https://www.linjiangyu.com/posts/d932a11.html"/>
    <id>https://www.linjiangyu.com/posts/d932a11.html</id>
    <published>2023-02-24T09:23:41.000Z</published>
    <updated>2023-11-27T01:42:42.513Z</updated>
    
    <content type="html"><![CDATA[<div class="note default orange simple"><p>现在都是多核的高性能服务器，如果还一直单使用tar的话可就太捞了</p></div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y pigz</span></span><br></pre></td></tr></table></figure><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>Options</p>            </div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-<span class="attribute">b</span> 设置压缩块大小(default <span class="number">128k</span>)</span><br><span class="line">-d 解压</span><br><span class="line">-k 不删除原始文件</span><br><span class="line">-I 输出压缩目录</span><br><span class="line">-p 最大使用线程数</span><br><span class="line">-q 不输出信息</span><br><span class="line">-r 递归</span><br><span class="line">-S 使用sss后缀替换gz</span><br><span class="line">-v 显示解压缩过程</span><br></pre></td></tr></table></figure><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>Example</p>            </div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar --use-compress-program=&quot;pigz -k -p4&quot; k.tar.gz ./k</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">多线程解压缩之pigz</summary>
    
    
    
    <category term="运维" scheme="https://www.linjiangyu.com/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
  </entry>
  
  <entry>
    <title>swap使用过度后果</title>
    <link href="https://www.linjiangyu.com/posts/6f3762be.html"/>
    <id>https://www.linjiangyu.com/posts/6f3762be.html</id>
    <published>2022-12-28T13:57:08.000Z</published>
    <updated>2023-11-27T01:42:42.513Z</updated>
    
    <content type="html"><![CDATA[<p>###SWAP使用过多的后果</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">swap</span>是使用磁盘空间制作的交换分区，一般在机器的物理内存不够使用时才会把部分比较不活跃数据暂时缓存在<span class="keyword">swap</span>分区中</span><br></pre></td></tr></table></figure><ul><li>简单举一下例子<ul><li>在一个运维的交流群里面有人说他的1G内存服务器划分了8G的swap空间然后跑了<strong>gitlab</strong>和8个<strong>java</strong>服务和<strong>cicd</strong>(我纯路人)</li></ul></li></ul><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">不说Java服务的内存起伏了，就单聊聊这个gitlab，官方推荐的最低配置是<span class="number">2</span>核<span class="number">4</span>G才可以跑，我在虚拟机的测试中<span class="number">4</span>G也是远远不够给gitlab使用，个人感觉最少给个<span class="number">8</span>G才能勉强使用，毕竟启动便要<span class="number">2</span>G内存（使用docker安装的可能会偏低一些但是不会低到哪去）</span><br><span class="line"></span><br><span class="line">本来是在内存中都需要保底点说<span class="number">6</span>G的内存，在真实内存只有<span class="number">1</span>G的云服务器上和<span class="number">8</span>G的<span class="keyword">swap</span>空间，要怎么使用呢，其中<span class="number">5</span>G的内存需求<span class="number">8</span>G的<span class="keyword">swap</span>空间要怎么顶替，众所周知内存的速度无比的快，底部是磁盘存储的<span class="keyword">swap</span>要承担其中<span class="number">5</span>G内存空间的快速频繁的读写操作会导致机器的磁盘IO繁忙，自然便会极大降低操作系统的运行速率，甚至导致宕机，这也是为什么k8s禁止使用<span class="keyword">swap</span>的部分原因</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">swap使用过度的后果</summary>
    
    
    
    <category term="演示" scheme="https://www.linjiangyu.com/categories/%E6%BC%94%E7%A4%BA/"/>
    
    
  </entry>
  
  <entry>
    <title>cpio</title>
    <link href="https://www.linjiangyu.com/posts/35144386.html"/>
    <id>https://www.linjiangyu.com/posts/35144386.html</id>
    <published>2022-12-08T02:05:45.000Z</published>
    <updated>2023-11-27T01:42:42.512Z</updated>
    
    <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="cpio">cpio</h3></div></div><div class="note default orange simple"><p>优点: 可以备份任何的文件</p><p>缺点: 需要配合别的命令才能实现</p></div><h4 id="command">command</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cpio <span class="literal">-ovcB</span> &gt; [<span class="type">file</span>|<span class="type">device</span>]        //备份</span><br><span class="line">cpio <span class="literal">-ivcdu</span> &lt; [<span class="type">file</span>|<span class="type">device</span>]       //还原</span><br><span class="line">cpio <span class="literal">-ivct</span> &lt; [<span class="type">file</span>|<span class="type">device</span>]        //查看</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份会使用到的参数</span></span><br><span class="line"><span class="literal">-o</span>   将数据复制输出到文件或设备上</span><br><span class="line"><span class="literal">-B</span>   让默认的blocks可以增加至<span class="number">5120</span>字节(默认是<span class="number">512</span>字节),可以让大文件的存储速度加快</span><br><span class="line"></span><br><span class="line"><span class="comment"># 还原会使用到的参数</span></span><br><span class="line"><span class="literal">-i</span>   将数据自文或设备复制出来</span><br><span class="line"><span class="literal">-d</span>   自动建立目录,使用cpio所备份的内容不见得会在同一层目录中,所以要让cpio在复制的时候可以自己创建目录</span><br><span class="line"><span class="literal">-u</span>   自动把新文件覆盖旧文件</span><br><span class="line"><span class="literal">-t</span>   配合<span class="literal">-i</span>查看以cpio建立的文件或设备的你内容</span><br><span class="line"><span class="literal">-v</span>   显示过程</span><br><span class="line"><span class="literal">-c</span>   以portable format方式存储</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>example:</p><p>备份/boot目录中的内容</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /</span></span><br><span class="line"><span class="comment"># find boot | cpio -ocvB &gt; /opt/boot.cpio       //打包</span></span><br><span class="line">这里绝对不能使用绝对路径(所以使用find命令的时候在/下运行出来就会是./PATH),要不然解包的时候cpio会自动把数据解包覆盖原目录</span><br><span class="line"><span class="comment"># cd</span></span><br><span class="line"><span class="comment"># cpio /opt/boot.cpio &lt; /opt/boot.cpio   //解包到当前目录</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>事实上cpio可以把一整个系统的数据完整的备份到光盘中</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / | cpio -ocvB &gt; /dev/st0     //备份</span></span><br><span class="line"><span class="comment"># cpio -idvc &lt; /dev/st0              //还原</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">cpio</summary>
    
    
    
    <category term="Linux基础" scheme="https://www.linjiangyu.com/categories/Linux%E5%9F%BA%E7%A1%80/"/>
    
    
  </entry>
  
  <entry>
    <title>dd</title>
    <link href="https://www.linjiangyu.com/posts/a97191d.html"/>
    <id>https://www.linjiangyu.com/posts/a97191d.html</id>
    <published>2022-12-08T01:51:53.000Z</published>
    <updated>2023-11-27T01:42:42.512Z</updated>
    
    <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="dd">dd</h3></div></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lsblk</span></span><br><span class="line">/dev/sdb10G</span><br><span class="line">/dev/sdc10G</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mkfs.xfs /dev/sdb</span> </span><br><span class="line">/dev/sdc是作为要复制的&quot;路径&quot;设备,不需要格式化成xfs文件系统,dd命令可以将源块设备的磁盘分区上扇区的数据整个复制,连同超级区块、启动扇区、元数据和UUID都会一致复制</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> /&#123;sdb,sdc&#125; -v</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mount /dev/sdb /sdb</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mounr /dev/sdc /sdc</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cp</span> -a /etc/. /sdb/</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdb of=/dev/sdc  //直接把/dev/sdb设备块复制到/dev/sdc,不指定bs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xfs_repair -L /dev/sdc      //让日志文件归零,清理一下日志</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xfs_admin -U `uuid` /dev/sdc    //重新指定一下UUID,因为使用<span class="built_in">dd</span>命令拷贝的时候连UUID也一并拷贝相同了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mount /dev/sdc /sdc        //查看一下复制过来的和/dev/sdb设备上的数据是否一致</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">dd</summary>
    
    
    
    <category term="Linux基础" scheme="https://www.linjiangyu.com/categories/Linux%E5%9F%BA%E7%A1%80/"/>
    
    
  </entry>
  
  <entry>
    <title>私人云盘之Alist</title>
    <link href="https://www.linjiangyu.com/posts/e7cd4481.html"/>
    <id>https://www.linjiangyu.com/posts/e7cd4481.html</id>
    <published>2022-11-22T20:54:36.000Z</published>
    <updated>2023-11-27T01:42:42.513Z</updated>
    
    <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="Alist">Alist</h3></div></div><details class="folding-tag" ><summary> 预览 </summary>              <div class='content'>              <div class="hide-block"><button type="button" class="hide-button" style="background-color: orange;">效果预览     </button><div class="hide-content"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/temp/alist.jpg"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/temp/al.png"/></div></div></div></div>              </div>            </details><p>详情看<a href="https://alist.nn.ci/">Alist</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -fsSL <span class="string">&quot;https://alist.nn.ci/v3.sh&quot;</span> | bash -s install// 新手使用一键脚本安装是最简单的啦</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认运行在5244端口，我这里是基于域名的多https服务，后面可能会写上</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认二进制文件存放在了/opt/alist下，这里要获取一下初始密码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /opt/alist</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./alist admin  <span class="comment"># 会显示你的初始密码，记录起来</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>Alist默认支持了本地存储的挂载和多种当前比较流行的网盘挂载例如百度网盘，阿里云盘等等，但和我都没关系因为我使用的是天翼云盘</p></div><details class="folding-tag" cyan open><summary> 天翼云盘挂载 </summary>              <div class='content'>              <p>首先在pc网页端登陆上天翼云盘,设置好密码,进入到想要挂载的目录下，查看当前网址的最后一串数字便是文件夹ID<br>像我一样挂载的也是天翼云盘中alist下的目录，进入到alist目录然后查看</p><div class="hide-block"><button type="button" class="hide-button" style="background-color: orange;">预览    </button><div class="hide-content"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/temp/1669152925609.png"/></div></div></div></div><p>这里我遮掉的那部分就是文件夹ID了，记录下来下面要使用到<br>使用IP:5244或者你已经设置好了域名访问Web界面，Alist可以通过图形化后台管理在最下方点击登陆按之前获取的初始密码,登陆后可修改密码<br>点击Storages&gt;Add&gt;189Cloud<br>Mount Path 输入要挂载到的目录，比如我现在的alist目录中的文件全部要挂载到主目录下便填/，要挂载到主目录下的opt目录下便填/opt<br>Username 输入登陆的手机号<br>Password 输入账号密码<br>Rooy folder id 输入上面获得的文件夹ID<br>最后ADD添加启用便获得了一个私人的白嫖云盘啦,这里选择天翼云盘是因为支持在线浏览上传和下载，速度亲测平均10M/s</p>              </div>            </details>]]></content>
    
    
    <summary type="html">私人云盘之Alist</summary>
    
    
    
    <category term="服务集群" scheme="https://www.linjiangyu.com/categories/%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4/"/>
    
    <category term="演示" scheme="https://www.linjiangyu.com/categories/%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4/%E6%BC%94%E7%A4%BA/"/>
    
    
    <category term="storage" scheme="https://www.linjiangyu.com/tags/storage/"/>
    
  </entry>
  
  <entry>
    <title>safe-rm</title>
    <link href="https://www.linjiangyu.com/posts/87519fc9.html"/>
    <id>https://www.linjiangyu.com/posts/87519fc9.html</id>
    <published>2022-11-19T16:25:10.000Z</published>
    <updated>2023-11-27T01:42:42.513Z</updated>
    
    <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>safe-rm</p></div></div><div class='checkbox orange checked'><input type="checkbox" checked="checked"/>            <p>看名字就能知道是什么了，安全的rm命令</p>            </div><div class="note default orange simple"><p>比rm命令增加的功能，skip Directory or file</p></div><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="safe-rm.tar.gz" href="https://alist.linjiangyu.com/d/Linux/safe-rm-0.12.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">safe-rm.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/safe-rm-0.12.tar.gz</p></div></a></div>              </div>            </details>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tar xf safe-rm.tar.gz</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> safe-rm-0.12</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">chown</span> root. safe-rm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> safe-rm /usr/local/bin/rm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/profile</span></span><br><span class="line">export PATH=/usr/local/bin:$PATH</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> /etc/profile</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>编写一下禁止删除的文件或文件夹</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">touch</span> /opt/t1                    // 测试文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/safe-rm.conf         // 这个文件是自己创建的,safe-rm会默认去找这个文件的规则</span></span><br><span class="line">/</span><br><span class="line">/*</span><br><span class="line">/etc</span><br><span class="line">/etc/*</span><br><span class="line">/usr</span><br><span class="line">/usr/local</span><br><span class="line">/usr/local/bin</span><br><span class="line">/usr/local/bin/*</span><br><span class="line">/root</span><br><span class="line">/root/*</span><br><span class="line">/opt/t1         # 为了测试</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">rm</span> -f /opt/t1</span>  </span><br><span class="line">safe-rm: skipping t1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">会无法删除,把/etc/safe-rm.conf中的/opt/t1删除后再<span class="built_in">rm</span> -f /opt/t1便可删除</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">safe-rm</summary>
    
    
    
    <category term="运维" scheme="https://www.linjiangyu.com/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="Linux" scheme="https://www.linjiangyu.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>hadoop+spark+zookeeper+hive分布式集群搭建</title>
    <link href="https://www.linjiangyu.com/posts/b10cf3a3.html"/>
    <id>https://www.linjiangyu.com/posts/b10cf3a3.html</id>
    <published>2022-11-18T00:42:26.000Z</published>
    <updated>2023-11-27T01:42:42.512Z</updated>
    
    <content type="html"><![CDATA[<div class="timeline orange"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>大数据服务合集</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2022-09-01 <a href="https://linjiangyu.com/posts/b10cf3a3.html">hadoop+spark</a></p></div></div><div class='timeline-item-content'><p>hadoop+spark初识</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2022-11-11 <a href="https://linjiangyu.com/posts/b10cf3a3.html#zookeeper%E5%88%86%E5%B8%83%E5%BC%8F">zookeeper</a></p></div></div><div class='timeline-item-content'><p>向集群加入了zookeeper分布式</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2022-11-19 <a href="https://linjiangyu.com/posts/b10cf3a3.html#hive">hive</a></p></div></div><div class='timeline-item-content'><p>这里也写了适配CentOS6.x的配置</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2022-11-19 <a href="https://linjiangyu.com/posts/b10cf3a3.html#flume">flume</a></p></div></div><div class='timeline-item-content'><p>日志采集</p></div></div></div><details class="folding-tag" cyan orang open><summary> 大数据服务合集 </summary>              <div class='content'>              <p><span class='nota' data-nota='hadoop+spark+zookeeper+hive分布式集群'>大数据服务合集</span></p>              </div>            </details><p>2022-09-01hadoop和spark的初识<span class="hidden-anchor" id="referto_[1]"></span><sup class="reference"><a href="#referfrom_[1]">[1]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">hadoop and spark</span><span class="reference-title">参考资料</span></span></span><br>2022-11-11添加了zookeeper分布式<span class="hidden-anchor" id="referto_[2]"></span><sup class="reference"><a href="#referfrom_[2]">[2]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">zookeeper</span><span class="reference-title">参考资料</span></span></span><br>2022-11-19添加了结合Mariadb的hive数据库使用<span class="hidden-anchor" id="referto_[3]"></span><sup class="reference"><a href="#referfrom_[3]">[3]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">hive</span><span class="reference-title">参考资料</span></span></span></p><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://www.linjiangyu.com/2022/09/01/hadoop-spark%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%AD%E5%BB%BA/">hadoop and spark分布式</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[2]"></span><a class="reference-anchor" href="#referto_[2]">[2]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://www.linjiangyu.com/2022/11/11/hadoop-spark-zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">zookeeper</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[3]"></span><a class="reference-anchor" href="#referto_[3]">[3]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://www.linjiangyu.com/2022/11/18/hadoop-spark-zookeeper-hive%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">hive</a></div><p>hadoop+spark+zookeeper+hive分布式集群部署</p><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="环境准备">环境准备</h3></div></div><div class="note default orange simple"><p>环境的准备基于我写的初始化脚本,自用7.x系列的CentOS,老版本的就支持CentOS/Redhat6,7,8但是有点不完善，需要可以邮箱或者博客留言。</p></div><table><thead><tr><th style="text-align:center">os\ip</th><th style="text-align:center">hostname</th><th style="text-align:center">block</th></tr></thead><tbody><tr><td style="text-align:center">centos7.9 192.168.222.226</td><td style="text-align:center">master</td><td style="text-align:center">rsmanager,datanode,namenode.snamenode,nmanager</td></tr><tr><td style="text-align:center">centos7.9 192.168.222.227</td><td style="text-align:center">node1</td><td style="text-align:center">snamenode,nmnager,datanode</td></tr><tr><td style="text-align:center">centos7.9 192.168.222.228</td><td style="text-align:center">node2</td><td style="text-align:center">datanode,nmanager</td></tr></tbody></table><div class="tabs" id="初始化"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#初始化-1">旧版</button></li><li class="tab active"><button type="button" data-href="#初始化-2">新版(推荐)</button></li><li class="tab"><button type="button" data-href="#初始化-3">船新版</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="初始化-1"><div class='checkbox times red checked'><input type="checkbox" checked="checked"/>            <p>国外服务器托管代码，可能被墙</p>            </div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/linjiangyu2/K.git   //可能会拉不下来，多拉几次就下来了，因为托管代码的服务器是国外的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> K</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> README.md  //不会使用的要看一下这个文件，了解脚本需要输入的配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./ksh  //依次输入你自己的配置，第一次使用这个脚本一定要看README.md文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果需要有时候改IP地址图方便的话，直接把ksh这个二进制的脚本放在/usr/bin下，便可以在全局执行了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> ksh /usr/bin/ksh</span></span><br><span class="line">使用ksh初始化后，开始配置</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="初始化-2"><div class='checkbox orange checked'><input type="checkbox" checked="checked"/>            <p>本站托管代码放心食用</p>            </div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum install -y https://mirrors.linjiangyu.com/centos/tianlin-release.noarch-7-1.x86_64.rpm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum --enablerepo=<span class="string">&#x27;tianlin&#x27;</span> install -y ksh-5.0-1.x86_64</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /usr/share/K/README.md  //不会使用的要看一下这个文件，了解脚本需要输入的配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ksh  //依次输入你自己的配置，第一次使用这个脚本一定要看README.md文件</span></span><br><span class="line">使用ksh初始化后，继续下文配置</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="初始化-3"><div class='checkbox orange checked'><input type="checkbox" checked="checked"/>            <p>CDN托管放心食用</p>            </div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">wget https://cdn.staticaly.com/gh/linjiangyu2/K@master/ksh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">chmod</span> +x ./ksh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./ksh  //依次输入你自己的配置，第一次使用这个脚本一定要看https://github.com/linjiangyu2/K</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果需要有时候改IP地址图方便的话，直接把ksh这个二进制的脚本放在/usr/bin下，便可以在全局执行了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> ksh /usr/bin/ksh</span></span><br><span class="line">使用ksh初始化后，继续下文配置</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note default orange simple"><p>对应自己的IP地址，最好/etc/hosts的解析名和我一致，不然下面的配置文件需要自己对应自己的解析名修改</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="built_in">cat</span> &gt; /etc/hosts &lt;&lt;<span class="string">END</span></span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 </span><br><span class="line">192.168.222.226 master</span><br><span class="line">192.168.222.227 node1</span><br><span class="line">192.168.222.228 node2</span><br><span class="line">END</span><br><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="string">ssh-keygen -P &#x27;&#x27; -f ~/.ssh/id_rsa</span></span></span><br><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="string">for i in master node&#123;1..2&#125;;do ssh-copy-id $i;done</span></span></span><br><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="string">for i in node&#123;1..2&#125;;do rsync -av /etc/hosts root@$i:/etc/hosts;done</span></span></span><br><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="string">for i in master node&#123;1..2&#125;;do ssh $i yum install -y openssl-devel;done</span></span></span><br></pre></td></tr></table></figure><p>2.搭建</p><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="hadoop分布式">hadoop分布式</h3></div></div><h4 id="上传jdk和hadoop的tar包">上传jdk和hadoop的tar包</h4><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="hadoop-2.8.5.tar.gz" href="https://alist.linjiangyu.com/d/Linux/hadoop-2.8.5.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">hadoop-2.8.5.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/hadoop-2.8.5.tar.gz</p></div></a></div><div class="tag link"><a class="link-card" title="jdk-8u212-linux-x64.tar.gz" href="https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">jdk-8u212-linux-x64.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz</p></div></a></div>              </div>            </details><h4 id="配置">配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">  [master]# </span><span class="language-bash">tar xf hadoop...  //不知道你使用的版本，写了...，以下也是，tab键或者对应修改就可以</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">...是表示我不知道你使用的版本，自己改</span></span><br><span class="line">  [root@ master]# tar xf jdk...</span><br><span class="line">  [root@ master]# tar xf hadoop...</span><br><span class="line">  [root@ master]# mv hadoop... /opt/hadoop285</span><br><span class="line">  [root@ master]# mv jdk... /usr/local/jdk</span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/profile</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export HADOOP_HOME=/opt/hadoop285</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/sbin:$PATH</span><br><span class="line">export HADOOP_COMMON_LIB_NATIVE_DIR=$HADOOP_HOME/lib/native </span><br><span class="line">export HADOOP_OPTS=&quot;-Djava.library.path=$HADOOP_HOME/lib/native&quot;</span><br><span class="line">export LD_LIBRARY_PATH=$HADOOP_HOME/lib/native/:$LD_LIBRARY_PATH</span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> !$</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以下是自己直接写入配置，在master服务器上进行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /opt/hadoop285/etc/hadoop</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim hadoop-env.sh  //修改文件里面的<span class="built_in">export</span> JAVA_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>为</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim yarn-env.sh //修改前面有注释的<span class="built_in">export</span> JAVA_HOME为</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># vim core-site.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://master:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># vim hdfs-site.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/data/hdfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/data/hdfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># vim yarn-site.xml </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>master<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># cp mapred-site.xml.template mapred-site.xml</span><br><span class="line"># vim mapred-site.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim slaves</span></span><br><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>然后在master节点把配置发到各个节点</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /usr/local/jdk root@<span class="variable">$i</span>:/usr/local/;<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /opt/hadoop285 root@<span class="variable">$i</span>:/opt/;<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /etc/profile root@<span class="variable">$i</span>:/etc/profile;<span class="keyword">done</span></span></span><br><span class="line">然后到各个节点</span><br><span class="line">[node1,2]# source /etc/profile</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在node1,2上操作，最后在master操作</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hdfs namenode -format   //初始化</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> -d /opt/data   //此文件夹产生就是初始化成功</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在master上操作</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ master]# start-all.sh</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>最后可以在各个节点使用jps命令查看各自的部件</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ xxx]# jps</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>当然web界面也可以访问的，浏览器访问192.168.222.226:8088和192.168.222.226:50070(对应自己IP地址)</p></div><div class="note default orange simple"><p>来尝试运行一下第一个hadoop分布式任务吧</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ master]# hdfs dfs -put /etc/passwd /t1</span><br><span class="line">[root@ master]# hadoop jar /opt/hadoop285/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.8.5.jar wordcount /t1 /output/00</span><br><span class="line">[root@ master]# hdfs dfs -ls /output/00  //查看运行后的结果文件,运行后的数据在part-r-00000</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="spark分布式">spark分布式</h3></div></div><div class="note default orange simple"><p>下面开始搭建分布式spark</p></div><details class="folding-tag" cyan open><summary> 这里使用spark的3.3.0版本 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="spark-3.3.0-bin-hadoop3.tgz" href="https://alist.linjiangyu.com/d/Linux/spark-3.3.0-bin-hadoop3.tgz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">spark-3.3.0-bin-hadoop3.tgz</p><p class="url">https://alist.linjiangyu.com/d/Linux/spark-3.3.0-bin-hadoop3.tgz</p></div></a></div>              </div>            </details><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把spark包上传到机器上，然后到该包的目录，这里统一以spark-3.3.0-bin-hadoop3.tgz这个包为演示</span></span><br><span class="line">[root@ master]# tar xf spark-3.3.0-bin-hadoop3.tgz</span><br><span class="line">[root@ master]# mv spark-3.3.0-bin-hadoop3 /opt/spark</span><br><span class="line">[root@ master]# vim /etc/profile</span><br><span class="line">export PATH=/opt/spark/bin:/opt/spark/sbin:$PATH</span><br><span class="line">[root@ master]# cd /opt/spark/conf</span><br><span class="line">[root@ master]# mv spark-env.sh.template spark-env.sh</span><br><span class="line">[root@ master]# vim spark-env.sh</span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export HADOOP_CONF_DIR=/opt/hadoop285/etc/hadoop</span><br><span class="line">export SPARK_MASTER_IP=master   #对应自己的master机器IP或者master解析的域名，如果是按照我上面做的直接写master即可</span><br><span class="line">export SPARK_WORKER_MEMORY=1024m</span><br><span class="line">export SPARK_WORKER_CORES=2 </span><br><span class="line">export SPARK_EXECUTOR_MEMORY=1024m</span><br><span class="line">export SPARK_WORKER_INSTANCES=1</span><br><span class="line">export SOARK_MASTER_PORT=7077</span><br><span class="line">export SPARK_EXECUTOR_CORES=1</span><br><span class="line">SPARK_HISTORY_OPTS=&quot;-Dspark.history.fs.logDirectory=hdfs://master:9000/spark_logs&quot;</span><br><span class="line">[root@ master]# cp spark-defaults.conf.template spark-defaults.conf</span><br><span class="line">[root@ master]# vim spark-defaults.conf</span><br><span class="line">spark.master                     spark://master:7077</span><br><span class="line">spark.eventLog.enabled           true</span><br><span class="line">spark.eventLog.dir               hdfs://master:9000/spark_logs</span><br><span class="line">[root@ master]# vim slaves     //对应自己的三台主机IP地址或者解析的域名</span><br><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line">[root@ master]# cd /opt/spark/sbin</span><br><span class="line">[root@ master]# mv start-all.sh spark-start.sh</span><br><span class="line">[root@ master]# mv stop-all.sh spark-stop.sh</span><br><span class="line">[root@ master]# source /etc/profile</span><br><span class="line">[root@ master]# scp -r /opt/spark root@node1:/opt/</span><br><span class="line">[root@ master]# scp -r /opt/spark root@node2:/opt/</span><br><span class="line">[root@ master]# scp -r /etc/profile root@node1:/etc/</span><br><span class="line">[root@ master]# scp -r /etc/profile root@node2:/etc/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后在各工作节点执行命令</span></span><br><span class="line">[root@ node1,node2]# source /etc/profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在master节点执行</span></span><br><span class="line">[root@ master]# start-all.sh</span><br><span class="line">[root@ master]# hdfs dfs -mkdir /spark_logs</span><br><span class="line">[root@ master]# spark-start.sh  //启动spark集群</span><br><span class="line">[root@ master]# jps     //查看</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以上便搭建好了spark结合hadoop的分布式集群，spark也有自己的web界面，可以浏览器访问192.168.222.226:8080来查看(对应自己IP地址)</p></div><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="zookeeper分布式">zookeeper分布式</h3></div></div><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="apache-zookeeper-3.5.10.tar.gz" href="https://alist.linjiangyu.com/d/Linux/zookeeper-3.4.14.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">apache-zookeeper-3.5.10.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/zookeeper-3.4.14.tar.gz</p></div></a></div>              </div>            </details><div class="note default orange simple"><p>在master机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tar xf zookeeper*</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> zookeeper* /opt/zookeeper</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> /opt/zookeeper/conf/zoo_sample.cfg /opt/zookeeper/conf/zoo.cfg</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /opt/zookeeper/conf/zoo.cfg</span></span><br><span class="line">修改</span><br><span class="line">dataDir=/opt/data/zookeeper</span><br><span class="line">添加</span><br><span class="line">dataLogDir=/opt/data/zookeeper/logs</span><br><span class="line">server.1=master:2888:3888</span><br><span class="line">server.2=node1:2888:3888</span><br><span class="line">server.3=node2:2888:3888</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里对应自己的主机名</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在各机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> -p /opt/data/zookeeper/logs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> 1 &gt; /opt/data/zookeeper/myid             <span class="comment">#这里master对应上面的server.1 便要echo1,node1对应server.2便要echo 2,node3对应server.3便要echo 3</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在master机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/profile</span></span><br><span class="line">export ZOOKEEPER_HOME=/opt/zookeeper</span><br><span class="line">export PATH=$&#123;ZOOKEEPER_HOME&#125;/bin:$PATH</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /opt/zookeeper root@<span class="variable">$i</span>:/opt/;<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /etc/profile /etc/;<span class="keyword">done</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在各机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> /etc/profile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zkServer.sh start             <span class="comment">#这个命令最好使用多命令一起执行,就是多个机器的执行时间要差不多一直,因为zookeeper对时间的要求性很高和各种问题</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zkServer.sh status    <span class="comment"># 可以在各节点查看自己的角色是leader还是follower</span></span></span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="hive">hive</h3></div></div><h4 id="Mariadb">Mariadb</h4><div class="note default orange simple"><p>这里为了方便直接安装mariadb作为MySQL使用,CentOS7.x和CentOS6.x使用方法不同(为了朋友写了CentOS6的，泪目了),使用前提网络要能访问外网</p></div><div class="tabs" id="mariadb"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#mariadb-1">CentOS 7.x</button></li><li class="tab"><button type="button" data-href="#mariadb-2">CentOS 6.x</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="mariadb-1"><div class="tip sync"><p>CentOS 7.x</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install -y mariadb mariadb-server</span><br><span class="line">[root@master ~]# systemctl enable mariadb &amp;&amp; systemctl start mariadb</span><br><span class="line">[root@master ~]# mysqladmin password abcd1234</span><br><span class="line">[root@master ~]# mysql -uroot -pabcd1234 -e &quot;create user &#x27;root&#x27;@&#x27;%&#x27; identified by &#x27;abcd1234&#x27;;&quot; -e &quot;grant all privileges on *.* to &#x27;root&#x27;@&#x27;%&#x27;;&quot;</span><br><span class="line">[root@master ~]# mysql_secure_installation</span><br><span class="line">按顺序输入abcd1234,n,y,n,y,y</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="mariadb-2"><div class="tip sync"><p>CentOS 6.x</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mkdir /etc/yum.repos.d/bak</span><br><span class="line">[root@master ~]# mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak/</span><br><span class="line">[root@master ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/repo/CentOS-Base.repo &amp;&amp; yum install -y epel-release</span><br><span class="line">[root@master ~]# vim /etc/yum.repos.d/mariadb.repo</span><br><span class="line">[mariadb]</span><br><span class="line">name=MariaDB</span><br><span class="line">baseurl=https://mirrors.aliyun.com/mariadb/yum/10.4/centos6-amd64</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/mariadb/yum/RPM-GPG-KEY-MariaDB</span><br><span class="line">gpgcheck=1</span><br><span class="line">[root@master ~]# yum install -y mysql mysql-devel mysql-server</span><br><span class="line">[root@master ~]# service mysql start &amp;&amp; chkconfig --add mysql &amp;&amp; chkconfig mysql on</span><br><span class="line">[root@master ~]# mysqladmin password abcd1234</span><br><span class="line">[root@master ~]# mysql -uroot -pabcd1234 -e &quot;create user &#x27;root&#x27;@&#x27;%&#x27; identified by &#x27;abcd1234&#x27;;&quot; -e &quot;grant all privileges on *.* to &#x27;root&#x27;@&#x27;%&#x27;;&quot;</span><br><span class="line">[root@master ~]# mysql_secure_installation</span><br><span class="line">按顺序输入abcd1234,n,y,n,y,y</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="apache-hive-3.1.2-bin.tar.gz" href="https://alist.linjiangyu.com/d/Linux/apache-hive-3.1.2-bin.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">apache-hive-3.1.2-bin.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/apache-hive-3.1.2-bin.tar.gz</p></div></a></div>              </div>            </details><div class="note default orange simple"><p>把二进制包上传到master机器的opt目录下</p></div><h4 id="hive配置">hive配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cd /opt</span><br><span class="line">[root@master opt]# tar xf apache-hive-3.1.2-bin.tar.gz</span><br><span class="line">[root@master opt]# mv apache-hive-3.1.2-bin hive</span><br><span class="line">[root@master opt]# cd hive/conf</span><br><span class="line">[root@master conf]# cp -a hive-env.sh.template hive-env.sh</span><br><span class="line">[root@master conf]# vim hive-env.sh</span><br><span class="line">在最前面添加,这里对应好自己的目录</span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export HADOOP_HOME=/opt/hadoop285</span><br><span class="line">export HADOOP_CONF_DIR=$&#123;HADOOP_HOME&#125;/etc/hadoop</span><br><span class="line">export HADOOP_HEAPSIZE=1024</span><br><span class="line">export HIVE_HOME=/opt/hive</span><br><span class="line">export HIVE_CONF_DIR=$&#123;HIVE_HOME&#125;/conf</span><br><span class="line">export HIVE_AUX_JARS_PATH=$&#123;HIVE_HOME&#125;/lib</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@master conf]# vim hive-site.xml// 以下对应注释更改自己的配置</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这里对应填入自己主节点机器在hosts文件解析的域名，我是master，运行错误的话应该是你哪里的设置有问题就换成IP地址,后面对应的也就都换成IP地址--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://master:3306/hive?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--MySQL登陆用户--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--用户密码--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>abcd1234<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--这里对应解析第二台的hosts文件解析的域名--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>node1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server3.thrift.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server3.thrift.bind.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--这里对应解析第三台的hosts文件解析的域名--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>node2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master conf]# cp hive-log4j2.properties.template hive-log4j2.properties</span><br><span class="line">[root@master conf]# vim hive-log4j2.properties</span><br><span class="line">把INFO全部更改为ERROR</span><br><span class="line">[root@master conf]# vim /etc/profile</span><br><span class="line">export HIVE_HOME=/opt/hive</span><br><span class="line">export PATH=$&#123;HIVE_HOME&#125;/bin:$PATH</span><br><span class="line">[root@master conf]# source /etc/profile</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>上传连接MySQL需要的jar包</p></div><details class="folding-tag" cyan open><summary> mysql-connector-java-8.0.17.jar </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="mysql-connector-java-8.0.17.jar" href="https://alist.linjiangyu.com/d/Linux/mysql-connector-java-8.0.17.jar"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">mysql-connector-java-8.0.17.jar</p><p class="url">https://alist.linjiangyu.com/d/Linux/mysql-connector-java-8.0.17.jar</p></div></a></div>              </div>            </details><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mv  mysql-connector-java-8.0.17.jar /opt/hive/lib/</span><br><span class="line">[root@master ~]# cd /opt/hive/bin</span><br><span class="line">[root@master bin]# ./schematool -initSchema -dbType mysql// 初始化</span><br><span class="line">[root@master ~]# mysql -uroot -pabcd1234</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show tables from hive;// 有数据则初始化成功</span></span><br></pre></td></tr></table></figure><h4 id="连接操作测试">连接操作测试</h4><div class="note default orange simple"><p>hive的启动需要先启动hadoop和spark服务</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">start-all.sh &amp;&amp; spark-start.sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把服务放在不同节点测试连接数据库操作</span></span><br><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">scp -r /opt/hive root@node1:/opt/</span></span><br><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">scp -r /opt/hive root@node2:/opt/</span></span><br><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">scp /etc/profile root@node1:/etc/</span></span><br><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">scp /etc/profile root@node2:/etc/</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后在各节点上使用命令</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> /etc/profile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">回到master机器操作</span></span><br><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">hiveserver2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重开终端开启一个可被另外节点连接的服务终端</span></span><br><span class="line">[root@master ~]# hive --service metastore</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里使用node1来连接,可能要等待久点才能起10000端口</span></span><br><span class="line"><span class="meta prompt_">[root@node1]# </span><span class="language-bash">beeline<span class="comment"># 依次自己尝试</span></span></span><br><span class="line"><span class="meta prompt_">beeline&gt; </span><span class="language-bash">!connect jdbc:hive2://master:10000</span></span><br><span class="line">Connecting to jdbc:hive2://master:10000</span><br><span class="line">Enter username for jdbc:hive2://master:10000: root</span><br><span class="line">Enter password for jdbc:hive2://master:10000: ***</span><br><span class="line">Connected to: Apache Hive (version 3.1.2)</span><br><span class="line">Driver: Hive JDBC (version 2.3.9)</span><br><span class="line">Transaction isolation: TRANSACTION_REPEATABLE_READ</span><br><span class="line">0: jdbc:hive2://master:10000&gt; show databases;</span><br><span class="line">+----------------+</span><br><span class="line">| database_name  |</span><br><span class="line">+----------------+</span><br><span class="line">| default        |</span><br><span class="line">+----------------+</span><br><span class="line">1 row selected (1.442 seconds)</span><br></pre></td></tr></table></figure><h4 id="表创建测试">表创建测试</h4><div class="note default orange simple"><p>在master机器上准备一下用到的txt文件,上传到hdfs文件系统</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[master@root ~]# vim t.txt</span><br><span class="line">1,linjiangyu,20</span><br><span class="line">2,lintian,20</span><br><span class="line">3,k,20</span><br><span class="line">[master@root ~]# hdfs dfs -mkdir /t</span><br><span class="line">[master@root ~]# hdfs dfs -put ./t.txt /t/</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>回到node1</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://master:10000&gt; create database k ;</span><br><span class="line">No rows affected (0.267 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://master:10000&gt; use k;</span><br><span class="line">No rows affected (0.078 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://master:10000&gt; create table k_user(kid int,kname string,kage int) row format delimited fields terminated by &#x27;,&#x27; location &#x27;/t&#x27;;</span><br><span class="line">No rows affected (0.558 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://master:10000&gt; show tables;</span><br><span class="line">+-----------+</span><br><span class="line">| tab_name  |</span><br><span class="line">+-----------+</span><br><span class="line">| k_user    |</span><br><span class="line">+-----------+</span><br><span class="line">1 row selected (0.114 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://master:10000&gt; select * from k_user;</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">| k_user.kid  | k_user.kname  | k_user.kage  |</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">| 1           | linjiangyu    | 20           |</span><br><span class="line">| 2           | lintian       | 20           |</span><br><span class="line">| 3           | k             | 20           |</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">3 rows selected (3.141 seconds)</span><br></pre></td></tr></table></figure><h3 id="flume">flume</h3><div class="note default orange simple"><p>貌似是日志收集应用</p></div><ul><li><p>把<a href="https://dlcdn.apache.org/flume/1.11.0/apache-flume-1.11.0-bin.tar.gz">apache-flume-bin.tar.gz</a>下载并上传到系统中</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar xf apache-flume-1.11.0-bin.tar.gz &amp;&amp; rm -f apache-flume-1.11.0-bin.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mv apache-flume* /usr/local/flume</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="attribute">export</span> FLUME_HOME=/usr/local/flume</span><br><span class="line">export PATH=<span class="variable">$&#123;FLUME_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># source /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cd /usr/local/flume/conf/</span></span><br><span class="line"><span class="comment"># cp flume-env.sh.template flume-env.sh</span></span><br><span class="line"><span class="comment"># vim flume-env.sh</span></span><br><span class="line">// 在最上面添加</span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># vim netcat-logger.conf </span></span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = <span class="number">0.0.0.0</span></span><br><span class="line">a1.sources.r1.port = <span class="number">44444</span></span><br><span class="line">a1.sinks.k1.type = logger</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = <span class="number">1000</span></span><br><span class="line">a1.channels.c1.transactionCapacity = <span class="number">100</span></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line"><span class="comment"># flume-ng agent -n a1 -c ./ -f ./netcat-logger.conf -Dflume.root.logger=INFO,console  // 启动服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># yum install -y telnet</span></span><br><span class="line"><span class="comment"># telnet 127.0.0.1 44444</span></span><br><span class="line">  // 随便写点东西回车会有OK出现就行了</span><br></pre></td></tr></table></figure></li></ul><h3 id="sqoop">sqoop</h3><ol><li><p>下载包<a href="https://archive.apache.org/dist/sqoop/1.4.7/sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz">sqoop</a>放到/opt下</p></li><li><p>整</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tar xf sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> sqoop-1.4.7.bin__hadoop-2.6.0 sqoop</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> sqoop</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cp</span> conf/sqoop-env-template.sh conf/sqoop-env.sh</span></span><br><span class="line">export HADOOP_COMMON_HOME=/opt/hadoop285</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Set path to <span class="built_in">where</span> hadoop-*-core.jar is available</span></span><br><span class="line">export HADOOP_MAPRED_HOME=/opt/hadoop285</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">set</span> the path to <span class="built_in">where</span> bin/hbase is available</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">export</span> HBASE_HOME=</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Set the path to <span class="built_in">where</span> bin/hive is available</span></span><br><span class="line">export HIVE_HOME=/opt/hive</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Set the path <span class="keyword">for</span> <span class="built_in">where</span> zookeper config <span class="built_in">dir</span> is</span></span><br><span class="line">export ZOOCFGDIR=/opt/zookeeper/conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/profile</span></span><br><span class="line">export SQOOP_HOME=/opt/sqoop</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;SQOOP_HOME&#125;/lib</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/sbin:$&#123;HIVE_HOME&#125;/bin:$&#123;SQOOP_HOME&#125;/bin:$PATH</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> /etc/profile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cp</span> /opt/hive/lib/mysql-connector-java-8.0.17.jar /opt/sqoop/lib/</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim bin/configure-sqoop把文件全部替换为以下</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright 2011 The Apache Software Foundation</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Licensed to the Apache Software Foundation (ASF) under one</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">distributed with this work <span class="keyword">for</span> additional information</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;License&quot;</span>); you may not use this file except <span class="keyword">in</span> compliance</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">distributed under the License is distributed on an <span class="string">&quot;AS IS&quot;</span> BASIS,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">See the License <span class="keyword">for</span> the specific language governing permissions and</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">limitations under the License.</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is sourced <span class="keyword">in</span> by bin/sqoop to <span class="built_in">set</span> environment variables prior to</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">invoking Hadoop.</span></span><br><span class="line"></span><br><span class="line">bin=&quot;$1&quot;</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;bin&#125;&quot; ]; then</span><br><span class="line">  bin=`dirname $0`</span><br><span class="line">  bin=`cd $&#123;bin&#125; &amp;&amp; pwd`</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$SQOOP_HOME&quot; ]; then</span><br><span class="line">  export SQOOP_HOME=$&#123;bin&#125;/..</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">SQOOP_CONF_DIR=$&#123;SQOOP_CONF_DIR:-$&#123;SQOOP_HOME&#125;/conf&#125;</span><br><span class="line"></span><br><span class="line">if [ -f &quot;$&#123;SQOOP_CONF_DIR&#125;/sqoop-env.sh&quot; ]; then</span><br><span class="line">  . &quot;$&#123;SQOOP_CONF_DIR&#125;/sqoop-env.sh&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Find paths to our dependency systems. If they are <span class="built_in">unset</span>, use CDH defaults.</span></span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;HADOOP_COMMON_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -n &quot;$&#123;HADOOP_HOME&#125;&quot; ]; then</span><br><span class="line">    HADOOP_COMMON_HOME=$&#123;HADOOP_HOME&#125;</span><br><span class="line">  else</span><br><span class="line">    if [ -d &quot;/usr/lib/hadoop&quot; ]; then</span><br><span class="line">      HADOOP_COMMON_HOME=/usr/lib/hadoop</span><br><span class="line">    else</span><br><span class="line">      HADOOP_COMMON_HOME=$&#123;SQOOP_HOME&#125;/../hadoop</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;HADOOP_MAPRED_HOME&#125;&quot; ]; then</span><br><span class="line">  HADOOP_MAPRED_HOME=/usr/lib/hadoop-mapreduce</span><br><span class="line">  if [ ! -d &quot;$&#123;HADOOP_MAPRED_HOME&#125;&quot; ]; then</span><br><span class="line">    if [ -n &quot;$&#123;HADOOP_HOME&#125;&quot; ]; then</span><br><span class="line">      HADOOP_MAPRED_HOME=$&#123;HADOOP_HOME&#125;</span><br><span class="line">    else</span><br><span class="line">      HADOOP_MAPRED_HOME=$&#123;SQOOP_HOME&#125;/../hadoop-mapreduce</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">We are setting HADOOP_HOME to HADOOP_COMMON_HOME <span class="keyword">if</span> it is not <span class="built_in">set</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">so that hcat script works correctly on BigTop</span></span><br><span class="line">if [ -z &quot;$&#123;HADOOP_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -n &quot;$&#123;HADOOP_COMMON_HOME&#125;&quot; ]; then</span><br><span class="line">     HADOOP_HOME=$&#123;HADOOP_COMMON_HOME&#125;</span><br><span class="line">     export HADOOP_HOME</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;HBASE_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -d &quot;/usr/lib/hbase&quot; ]; then</span><br><span class="line">    HBASE_HOME=/usr/lib/hbase</span><br><span class="line">  else</span><br><span class="line">    HBASE_HOME=$&#123;SQOOP_HOME&#125;/../hbase</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line">if [ -z &quot;$&#123;HCAT_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -d &quot;/usr/lib/hive-hcatalog&quot; ]; then</span><br><span class="line">    HCAT_HOME=/usr/lib/hive-hcatalog</span><br><span class="line">  elif [ -d &quot;/usr/lib/hcatalog&quot; ]; then</span><br><span class="line">    HCAT_HOME=/usr/lib/hcatalog</span><br><span class="line">  else</span><br><span class="line">    HCAT_HOME=$&#123;SQOOP_HOME&#125;/../hive-hcatalog</span><br><span class="line">    if [ ! -d $&#123;HCAT_HOME&#125; ]; then</span><br><span class="line">       HCAT_HOME=$&#123;SQOOP_HOME&#125;/../hcatalog</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line">if [ -z &quot;$&#123;ACCUMULO_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -d &quot;/usr/lib/accumulo&quot; ]; then</span><br><span class="line">    ACCUMULO_HOME=/usr/lib/accumulo</span><br><span class="line">  else</span><br><span class="line">    ACCUMULO_HOME=$&#123;SQOOP_HOME&#125;/../accumulo</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line">if [ -z &quot;$&#123;ZOOKEEPER_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -d &quot;/usr/lib/zookeeper&quot; ]; then</span><br><span class="line">    ZOOKEEPER_HOME=/usr/lib/zookeeper</span><br><span class="line">  else</span><br><span class="line">    ZOOKEEPER_HOME=$&#123;SQOOP_HOME&#125;/../zookeeper</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line">if [ -z &quot;$&#123;HIVE_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -d &quot;/usr/lib/hive&quot; ]; then</span><br><span class="line">    export HIVE_HOME=/usr/lib/hive</span><br><span class="line">  elif [ -d $&#123;SQOOP_HOME&#125;/../hive ]; then</span><br><span class="line">    export HIVE_HOME=$&#123;SQOOP_HOME&#125;/../hive</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Check: If we can<span class="string">&#x27;t find our dependencies, give up here.</span></span></span><br><span class="line">if [ ! -d &quot;$&#123;HADOOP_COMMON_HOME&#125;&quot; ]; then</span><br><span class="line">  echo &quot;Error: $HADOOP_COMMON_HOME does not exist!&quot;</span><br><span class="line">  echo &#x27;Please set $HADOOP_COMMON_HOME to the root of your Hadoop installation.&#x27;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line">if [ ! -d &quot;$&#123;HADOOP_MAPRED_HOME&#125;&quot; ]; then</span><br><span class="line">  echo &quot;Error: $HADOOP_MAPRED_HOME does not exist!&quot;</span><br><span class="line">  echo &#x27;Please set $HADOOP_MAPRED_HOME to the root of your Hadoop MapReduce installation.&#x27;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># Moved to be a runtime check in sqoop.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">if [ ! -d &quot;$&#123;HBASE_HOME&#125;&quot; ]; then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &quot;Warning: $HBASE_HOME does not exist! HBase imports will fail.&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &#x27;</span>Please <span class="built_in">set</span> <span class="variable">$HBASE_HOME</span> to the root of your HBase installation.<span class="string">&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">fi</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">### Moved to be a runtime check in sqoop.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">if [ ! -d &quot;$&#123;HCAT_HOME&#125;&quot; ]; then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &quot;Warning: $HCAT_HOME does not exist! HCatalog jobs will fail.&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &#x27;</span>Please <span class="built_in">set</span> <span class="variable">$HCAT_HOME</span> to the root of your HCatalog installation.<span class="string">&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">fi</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#if [ ! -d &quot;$&#123;ACCUMULO_HOME&#125;&quot; ]; then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &quot;Warning: $ACCUMULO_HOME does not exist! Accumulo imports will fail.&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &#x27;</span>Please <span class="built_in">set</span> <span class="variable">$ACCUMULO_HOME</span> to the root of your Accumulo installation.<span class="string">&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">fi</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">if [ ! -d &quot;$&#123;ZOOKEEPER_HOME&#125;&quot; ]; then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &quot;Warning: $ZOOKEEPER_HOME does not exist! Accumulo imports will fail.&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &#x27;</span>Please <span class="built_in">set</span> <span class="variable">$ZOOKEEPER_HOME</span> to the root of your Zookeeper installation.<span class="string">&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">fi</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Where to find the main Sqoop jar</span></span></span><br><span class="line">SQOOP_JAR_DIR=$SQOOP_HOME</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">If there&#x27;</span>s a <span class="string">&quot;build&quot;</span> subdir, override with this, so we use</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the newly-compiled copy.</span></span><br><span class="line">if [ -d &quot;$SQOOP_JAR_DIR/build&quot; ]; then</span><br><span class="line">  SQOOP_JAR_DIR=&quot;$&#123;SQOOP_JAR_DIR&#125;/build&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">function add_to_classpath() &#123;</span><br><span class="line">  dir=$1</span><br><span class="line">  for f in $dir/*.jar; do</span><br><span class="line">    SQOOP_CLASSPATH=$&#123;SQOOP_CLASSPATH&#125;:$f;</span><br><span class="line">  done</span><br><span class="line"></span><br><span class="line">  export SQOOP_CLASSPATH</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Add sqoop dependencies to classpath.</span></span><br><span class="line">SQOOP_CLASSPATH=&quot;&quot;</span><br><span class="line">if [ -d &quot;$SQOOP_HOME/lib&quot; ]; then</span><br><span class="line">  add_to_classpath $SQOOP_HOME/lib</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Add HBase to dependency list</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$HBASE_HOME</span>/bin/hbase&quot;</span> ]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> TMP_SQOOP_CLASSPATH=<span class="variable">$&#123;SQOOP_CLASSPATH&#125;</span>:`<span class="variable">$HBASE_HOME</span>/bin/hbase classpath`</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> SQOOP_CLASSPATH=<span class="variable">$&#123;TMP_SQOOP_CLASSPATH&#125;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">fi</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">## Add HCatalog to dependency list</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$&#123;HCAT_HOME&#125;</span>/bin/hcat&quot;</span> ]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> TMP_SQOOP_CLASSPATH=<span class="variable">$&#123;SQOOP_CLASSPATH&#125;</span>:`<span class="variable">$&#123;HCAT_HOME&#125;</span>/bin/hcat -classpath`</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$&#123;HIVE_CONF_DIR&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   TMP_SQOOP_CLASSPATH=<span class="variable">$&#123;TMP_SQOOP_CLASSPATH&#125;</span>:<span class="variable">$&#123;HIVE_CONF_DIR&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="keyword">fi</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> SQOOP_CLASSPATH=<span class="variable">$&#123;TMP_SQOOP_CLASSPATH&#125;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">fi</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Add Accumulo to dependency list</span></span><br><span class="line">if [ -e &quot;$ACCUMULO_HOME/bin/accumulo&quot; ]; then</span><br><span class="line">  for jn in `$ACCUMULO_HOME/bin/accumulo classpath | grep file:.*accumulo.*jar | cut -d&#x27;:&#x27; -f2`; do</span><br><span class="line">    SQOOP_CLASSPATH=$SQOOP_CLASSPATH:$jn</span><br><span class="line">  done</span><br><span class="line">  for jn in `$ACCUMULO_HOME/bin/accumulo classpath | grep file:.*zookeeper.*jar | cut -d&#x27;:&#x27; -f2`; do</span><br><span class="line">    SQOOP_CLASSPATH=$SQOOP_CLASSPATH:$jn</span><br><span class="line">  done</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">ZOOCFGDIR=$&#123;ZOOCFGDIR:-/etc/zookeeper&#125;</span><br><span class="line">if [ -d &quot;$&#123;ZOOCFGDIR&#125;&quot; ]; then</span><br><span class="line">  SQOOP_CLASSPATH=$ZOOCFGDIR:$SQOOP_CLASSPATH</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">SQOOP_CLASSPATH=$&#123;SQOOP_CONF_DIR&#125;:$&#123;SQOOP_CLASSPATH&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">If there<span class="string">&#x27;s a build subdir, use Ivy-retrieved dependencies too.</span></span></span><br><span class="line">if [ -d &quot;$SQOOP_HOME/build/ivy/lib/sqoop&quot; ]; then</span><br><span class="line">  for f in $SQOOP_HOME/build/ivy/lib/sqoop/*/*.jar; do</span><br><span class="line">    SQOOP_CLASSPATH=$&#123;SQOOP_CLASSPATH&#125;:$f;</span><br><span class="line">  done</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">add_to_classpath $&#123;SQOOP_JAR_DIR&#125;</span><br><span class="line"></span><br><span class="line">HADOOP_CLASSPATH=&quot;$&#123;SQOOP_CLASSPATH&#125;:$&#123;HADOOP_CLASSPATH&#125;&quot;</span><br><span class="line">if [ ! -z &quot;$SQOOP_USER_CLASSPATH&quot; ]; then</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"><span class="string">User has elements to prepend to the classpath, forcibly overriding</span></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"><span class="string">Sqoop&#x27;</span>s own lib directories.</span></span><br><span class="line">  export HADOOP_CLASSPATH=&quot;$&#123;SQOOP_USER_CLASSPATH&#125;:$&#123;HADOOP_CLASSPATH&#125;&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">export SQOOP_CLASSPATH</span><br><span class="line">export SQOOP_CONF_DIR</span><br><span class="line">export SQOOP_JAR_DIR</span><br><span class="line">export HADOOP_CLASSPATH</span><br><span class="line">export HADOOP_COMMON_HOME</span><br><span class="line">export HADOOP_MAPRED_HOME</span><br><span class="line">export HBASE_HOME</span><br><span class="line">export HCAT_HOME</span><br><span class="line">export HIVE_CONF_DIR</span><br><span class="line">export ACCUMULO_HOME</span><br><span class="line">export ZOOKEEPER_HOME</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mysql -uroot -p123</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant all privileges on *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure></li><li><p>测试连接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sqoop list-databases -connect jdbc:mysql://localhost:3306/ --username root --password 123</span></span><br><span class="line">输出</span><br><span class="line">23/05/20 23:14:23 INFO sqoop.Sqoop: Running Sqoop version: 1.4.7</span><br><span class="line">23/05/20 23:14:23 WARN tool.BaseSqoopTool: Setting your password on the command-line is insecure. Consider using -P instead.</span><br><span class="line">23/05/20 23:14:23 INFO manager.MySQLManager: Preparing to use a MySQL streaming resultset.</span><br><span class="line">Loading class `com.mysql.jdbc.Driver&#x27;. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver&#x27;. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.</span><br><span class="line">mysql</span><br><span class="line">information_schema</span><br><span class="line">performance_schema</span><br><span class="line">sys</span><br><span class="line">hive</span><br><span class="line">rsyslog</span><br><span class="line">Syslo</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <summary type="html">hadoop+spark+zookeeper+hive分布式集群搭建</summary>
    
    
    
    <category term="服务集群" scheme="https://www.linjiangyu.com/categories/%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>ecy</title>
    <link href="https://www.linjiangyu.com/posts/d6542125.html"/>
    <id>https://www.linjiangyu.com/posts/d6542125.html</id>
    <published>2022-11-15T02:16:58.000Z</published>
    <updated>2023-11-27T01:42:42.512Z</updated>
    
    <content type="html"><![CDATA[<div class="tip warning faa-horizontal animated faa-fast"><p>网页视频素材</p></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/relife.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/02.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/aila.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/aill.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/ecy.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/ecysg.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/eee.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/gyx.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/jiojio.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/onepis.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/wzzs.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/plmm.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div>]]></content>
    
    
    <summary type="html">ecy</summary>
    
    
    
    <category term="演示" scheme="https://www.linjiangyu.com/categories/%E6%BC%94%E7%A4%BA/"/>
    
    
  </entry>
  
  <entry>
    <title>sersync2实时监控同步文件</title>
    <link href="https://www.linjiangyu.com/posts/f2af38d6.html"/>
    <id>https://www.linjiangyu.com/posts/f2af38d6.html</id>
    <published>2022-11-12T15:20:01.000Z</published>
    <updated>2023-11-27T01:42:42.513Z</updated>
    
    <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>sesync的实时同步</p></div></div><div class="tag link"><a class="link-card" title="sesync2" href="https://alist.linjiangyu.com/d/Linux/sersync2.5.4_64bit_binary_stable_final.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">sesync2</p><p class="url">https://alist.linjiangyu.com/d/Linux/sersync2.5.4_64bit_binary_stable_final.tar.gz</p></div></a></div><div class="note default orange simple"><p>也要结合rsync和Inotify一起使用</p></div><table><thead><tr><th style="text-align:center">IP</th><th style="text-align:center">HOSTNAME</th></tr></thead><tbody><tr><td style="text-align:center">192.168.222.160</td><td style="text-align:center">master</td></tr><tr><td style="text-align:center">192.168.222.161</td><td style="text-align:center">backup</td></tr></tbody></table><div class="note default orange simple"><p>backup的rsyncd的配置</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y rsync</span></span><br><span class="line"><span class="comment"># vim /etc/rsyncd.conf</span></span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line"><span class="comment">#use chroot = yes</span></span><br><span class="line">max connections = <span class="number">0</span></span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">exclude = lost+found/</span><br><span class="line"><span class="comment">#transfer logging = yes</span></span><br><span class="line"><span class="comment">#timeout = 900</span></span><br><span class="line"><span class="comment">#ignore nonreadable = yes</span></span><br><span class="line"><span class="comment">#dont compress   = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2</span></span><br><span class="line">reverse lookup = no</span><br><span class="line"></span><br><span class="line">[<span class="type">backup</span>]</span><br><span class="line">       path = /opt      <span class="comment"># 共享的目录</span></span><br><span class="line">       comment = ftp export area </span><br><span class="line">       read only = no</span><br><span class="line">       auth users = lt         <span class="comment"># 登陆的用户名</span></span><br><span class="line">       secrets file = /etc/rsync.pas   <span class="comment"># 认证文件</span></span><br><span class="line"> <span class="comment"># 创建认证文件</span></span><br><span class="line"> <span class="comment"># echo &#x27;lt:123&#x27; &gt; /etc/rsync.pas</span></span><br><span class="line"> <span class="comment"># systemctl restart rsyncd</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>master的配置</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># yum install -y rsync inotify-tools</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># rsync rsync://192.168.222.161  //显示192.168.222.161服务器共享的rsyncd的名字</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># rsync rsync://lt@192.168.222.161/backup   //查看目录,也可以上传目录,但是也可以上传发送文件,但是是需要交互式输入密码认证的</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># echo 123 &gt; /etc/rsync.pas         //认证文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># rsync --password-file=/etc/rsync.pas lt@192.168.222.161::backup</span></span><br><span class="line">或者</span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># rsync --password-file=/etc/rsync.pas rsync://lt@192.168.222.161/backup</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># tar xf sersync* </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># mv sersync* /usr/local/sersync</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># vim /etc/profile</span></span><br><span class="line">export SERSYNC_HOME=/usr/local/sersync</span><br><span class="line">export PATH=<span class="variable">$</span>&#123;SERSYNC_HOME&#125;:<span class="variable">$PATH</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># source /etc/profile</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># cd /usr/local/sersync</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># vim confxml.xml</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="line">&lt;head version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line">    &lt;host hostip=<span class="string">&quot;localhost&quot;</span> port=<span class="string">&quot;8008&quot;</span>&gt;&lt;/host&gt;</span><br><span class="line">    &lt;debug <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;fileSystem xfs=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="keyword">filter</span> <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;   &lt;!<span class="literal">--</span>&lt;是否开启过滤功能，为true的话设置以下的类型文件不同步 &gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;(.*)\.svn&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;(.*)\.gz&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;^info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;^static/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">    &lt;/<span class="keyword">filter</span>&gt;</span><br><span class="line">    &lt;inotify&gt;</span><br><span class="line">        &lt;delete <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;createFolder <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;createFile <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;      &lt;!<span class="literal">--</span>&lt;修改&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;closeWrite <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;moveFrom <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;moveTo <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;attrib <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;     &lt;!<span class="literal">--</span>&lt;修改&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;modify <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;/inotify&gt;</span><br><span class="line"></span><br><span class="line">    &lt;sersync&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/opt/&quot;</span>&gt;               &lt;!<span class="literal">--</span>&lt;监控的目录&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;remote ip=<span class="string">&quot;192.168.222.161&quot;</span> name=<span class="string">&quot;backup&quot;</span>/&gt;   &lt;!<span class="literal">--</span>&lt;修改目标IP地址,backup是共享出来的服务名称&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;remote ip=<span class="string">&quot;192.168.8.39&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;remote ip=<span class="string">&quot;192.168.8.40&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">        &lt;rsync&gt;</span><br><span class="line">            &lt;commonParams params=<span class="string">&quot;-artuz&quot;</span>/&gt;             &lt;!<span class="literal">--</span>&lt;rsync传输时间携带的参数&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;修改,开启才能修改,还有登陆的lt用户和认证的文件&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;auth <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span> users=<span class="string">&quot;lt&quot;</span> passwordfile=<span class="string">&quot;/etc/rsync.pas&quot;</span>/&gt;</span><br><span class="line">            &lt;userDefinedPort <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!<span class="literal">--</span> port=<span class="number">874</span> <span class="literal">--</span>&gt;</span><br><span class="line">            &lt;timeout <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> time=<span class="string">&quot;100&quot;</span>/&gt;&lt;!<span class="literal">--</span> timeout=<span class="number">100</span> <span class="literal">--</span>&gt;</span><br><span class="line">            &lt;ssh <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">        &lt;/rsync&gt;</span><br><span class="line">        &lt;failLog path=<span class="string">&quot;/tmp/rsync_fail_log.sh&quot;</span> timeToExecute=<span class="string">&quot;60&quot;</span>/&gt;&lt;!<span class="literal">--default</span> every <span class="number">60</span>mins execute once<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;crontab <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> schedule=<span class="string">&quot;600&quot;</span>&gt;&lt;!<span class="literal">--600mins--</span>&gt;</span><br><span class="line">            &lt;crontabfilter <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">                &lt;exclude expression=<span class="string">&quot;*.php&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">                &lt;exclude expression=<span class="string">&quot;info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">            &lt;/crontabfilter&gt;</span><br><span class="line">        &lt;/crontab&gt;</span><br><span class="line">        &lt;plugin <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;command&quot;</span>/&gt;</span><br><span class="line">    &lt;/sersync&gt;</span><br><span class="line">                                &lt;!<span class="literal">--</span>&lt;以下不需要修改 &gt;<span class="literal">--</span>&gt;</span><br><span class="line">    &lt;plugin name=<span class="string">&quot;command&quot;</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">param</span> prefix=<span class="string">&quot;/bin/sh&quot;</span> suffix=<span class="string">&quot;&quot;</span> ignoreError=<span class="string">&quot;true&quot;</span>/&gt;  &lt;!<span class="literal">--prefix</span> /opt/tongbu/mmm.sh suffix<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">filter</span> <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">            &lt;include expression=<span class="string">&quot;(.*)\.php&quot;</span>/&gt;</span><br><span class="line">            &lt;include expression=<span class="string">&quot;(.*)\.sh&quot;</span>/&gt;</span><br><span class="line">        &lt;/<span class="keyword">filter</span>&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line">    &lt;plugin name=<span class="string">&quot;socket&quot;</span>&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/opt/tongbu&quot;</span>&gt;</span><br><span class="line">            &lt;deshost ip=<span class="string">&quot;192.168.138.20&quot;</span> port=<span class="string">&quot;8009&quot;</span>/&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">    &lt;plugin name=<span class="string">&quot;refreshCDN&quot;</span>&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/data0/htdocs/cms.xoyo.com/site/&quot;</span>&gt;</span><br><span class="line">            &lt;cdninfo domainname=<span class="string">&quot;ccms.chinacache.com&quot;</span> port=<span class="string">&quot;80&quot;</span> username=<span class="string">&quot;xxxx&quot;</span> passwd=<span class="string">&quot;xxxx&quot;</span>/&gt;</span><br><span class="line">            &lt;sendurl base=<span class="string">&quot;http://pic.xoyo.com/cms&quot;</span>/&gt;</span><br><span class="line">            &lt;regexurl regex=<span class="string">&quot;false&quot;</span> match=<span class="string">&quot;cms.xoyo.com/site([/a-zA-Z0-9]*).xoyo.com/images&quot;</span>/&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">&lt;/head&gt;</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>了解一下sersync2命令的参数</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">参数<span class="literal">-d</span>:启用守护进程模式</span><br><span class="line">参数<span class="literal">-r</span>:在监控前，将监控目录与远程主机用rsync命令推送一遍</span><br><span class="line">参数<span class="literal">-n</span>: 指定开启守护线程的数量，默认为<span class="number">10</span>个</span><br><span class="line">参数<span class="literal">-o</span>:指定配置文件，默认使用confxml.xml文件</span><br><span class="line">参数<span class="literal">-m</span>:单独启用其他模块，使用 <span class="literal">-m</span> refreshCDN 开启刷新CDN模块</span><br><span class="line">参数<span class="literal">-m</span>:单独启用其他模块，使用 <span class="literal">-m</span> socket 开启socket模块</span><br><span class="line">参数<span class="literal">-m</span>:单独启用其他模块，使用 <span class="literal">-m</span> http 开启http模块</span><br><span class="line">不加<span class="literal">-m</span>参数，则默认执行同步程序</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">所以使用</span><br><span class="line"><span class="comment"># sersync2 -dro /usr/local/sesync/confxml.xml      //第一次使用先同步一次,第二次使用就可以去除-r参数</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>ssh的连接</p></div><div class="note default orange simple"><p>rsync的服务连接貌似是没有数据加密的，为了安全起见需要使用ssh</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/local/sesync/confxml.xml</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="line">&lt;head version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line">    &lt;host hostip=<span class="string">&quot;localhost&quot;</span> port=<span class="string">&quot;8008&quot;</span>&gt;&lt;/host&gt;</span><br><span class="line">    &lt;debug <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;fileSystem xfs=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="keyword">filter</span> <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;   &lt;!<span class="literal">--</span>&lt;是否开启过滤功能，为true的话设置以下的类型文件不同步 &gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;(.*)\.svn&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;(.*)\.gz&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;^info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;^static/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">    &lt;/<span class="keyword">filter</span>&gt;</span><br><span class="line">    &lt;inotify&gt;</span><br><span class="line">        &lt;delete <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;createFolder <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;createFile <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">        &lt;closeWrite <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;moveFrom <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;moveTo <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;attrib <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;     &lt;!<span class="literal">--</span>&lt;修改&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;modify <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;/inotify&gt;</span><br><span class="line"></span><br><span class="line">    &lt;sersync&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/opt/&quot;</span>&gt;</span><br><span class="line">            &lt;remote ip=<span class="string">&quot;192.168.222.161&quot;</span> name=<span class="string">&quot;/opt&quot;</span>/&gt;   &lt;!<span class="literal">--</span>&lt;修改为要传输到backup机器的目标地址&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;remote ip=<span class="string">&quot;192.168.8.39&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;remote ip=<span class="string">&quot;192.168.8.40&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">        &lt;rsync&gt;</span><br><span class="line">            &lt;commonParams params=<span class="string">&quot;-artuz&quot;</span>/&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;修改,关闭&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;auth <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> users=<span class="string">&quot;lt&quot;</span> passwordfile=<span class="string">&quot;/etc/rsync.pas&quot;</span>/&gt;</span><br><span class="line">            &lt;userDefinedPort <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!<span class="literal">--</span> port=<span class="number">874</span> <span class="literal">--</span>&gt;</span><br><span class="line">            &lt;timeout <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> time=<span class="string">&quot;100&quot;</span>/&gt;&lt;!<span class="literal">--</span> timeout=<span class="number">100</span> <span class="literal">--</span>&gt;</span><br><span class="line">            &lt;ssh <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;          &lt;!<span class="literal">--</span>&lt;修改,开启ssh连接&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;/rsync&gt;</span><br><span class="line">        &lt;failLog path=<span class="string">&quot;/tmp/rsync_fail_log.sh&quot;</span> timeToExecute=<span class="string">&quot;60&quot;</span>/&gt;&lt;!<span class="literal">--default</span> every <span class="number">60</span>mins execute once<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;crontab <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> schedule=<span class="string">&quot;600&quot;</span>&gt;&lt;!<span class="literal">--600mins--</span>&gt;</span><br><span class="line">            &lt;crontabfilter <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">                &lt;exclude expression=<span class="string">&quot;*.php&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">                &lt;exclude expression=<span class="string">&quot;info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">            &lt;/crontabfilter&gt;</span><br><span class="line">        &lt;/crontab&gt;</span><br><span class="line">        &lt;plugin <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;command&quot;</span>/&gt;</span><br><span class="line">    &lt;/sersync&gt;</span><br><span class="line">                                &lt;!<span class="literal">--</span>&lt;以下不需要修改 &gt;<span class="literal">--</span>&gt;</span><br><span class="line">    &lt;plugin name=<span class="string">&quot;command&quot;</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">param</span> prefix=<span class="string">&quot;/bin/sh&quot;</span> suffix=<span class="string">&quot;&quot;</span> ignoreError=<span class="string">&quot;true&quot;</span>/&gt;  &lt;!<span class="literal">--prefix</span> /opt/tongbu/mmm.sh suffix<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">filter</span> <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">            &lt;include expression=<span class="string">&quot;(.*)\.php&quot;</span>/&gt;</span><br><span class="line">            &lt;include expression=<span class="string">&quot;(.*)\.sh&quot;</span>/&gt;</span><br><span class="line">        &lt;/<span class="keyword">filter</span>&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line">    &lt;plugin name=<span class="string">&quot;socket&quot;</span>&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/opt/tongbu&quot;</span>&gt;</span><br><span class="line">            &lt;deshost ip=<span class="string">&quot;192.168.138.20&quot;</span> port=<span class="string">&quot;8009&quot;</span>/&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">    &lt;plugin name=<span class="string">&quot;refreshCDN&quot;</span>&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/data0/htdocs/cms.xoyo.com/site/&quot;</span>&gt;</span><br><span class="line">            &lt;cdninfo domainname=<span class="string">&quot;ccms.chinacache.com&quot;</span> port=<span class="string">&quot;80&quot;</span> username=<span class="string">&quot;xxxx&quot;</span> passwd=<span class="string">&quot;xxxx&quot;</span>/&gt;</span><br><span class="line">            &lt;sendurl base=<span class="string">&quot;http://pic.xoyo.com/cms&quot;</span>/&gt;</span><br><span class="line">            &lt;regexurl regex=<span class="string">&quot;false&quot;</span> match=<span class="string">&quot;cms.xoyo.com/site([/a-zA-Z0-9]*).xoyo.com/images&quot;</span>/&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">&lt;/head&gt;</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>需要同步多个目录就需要编写多个confxml.xml然后不同进程地执行</p></div>]]></content>
    
    
    <summary type="html">sersync2实时监控同步文件</summary>
    
    
    
    <category term="服务集群" scheme="https://www.linjiangyu.com/categories/%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4/"/>
    
    <category term="演示" scheme="https://www.linjiangyu.com/categories/%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4/%E6%BC%94%E7%A4%BA/"/>
    
    
    <category term="Linux" scheme="https://www.linjiangyu.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>hadoop+spark+zookeeper分布式集群搭建</title>
    <link href="https://www.linjiangyu.com/posts/371a3fb1.html"/>
    <id>https://www.linjiangyu.com/posts/371a3fb1.html</id>
    <published>2022-11-11T03:42:26.000Z</published>
    <updated>2023-11-27T01:42:42.513Z</updated>
    
    <content type="html"><![CDATA[<h1>hadoop+spark+zookeeper分布式集群部署</h1><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>1.环境准备</p></div></div><div class="note default orange simple"><p>环境的准备基于我写的初始化脚本,自用7.x系列的CentOS,老版本的就支持CentOS/Redhat6,7,8但是有点不完善，需要可以邮箱或者博客留言。</p></div><table><thead><tr><th style="text-align:center">os\ip</th><th style="text-align:center">hostname</th><th style="text-align:center">block</th></tr></thead><tbody><tr><td style="text-align:center">centos7.9 192.168.222.226</td><td style="text-align:center">master</td><td style="text-align:center">rsmanager,datanode,namenode.snamenode,nmanager</td></tr><tr><td style="text-align:center">centos7.9 192.168.222.227</td><td style="text-align:center">node1</td><td style="text-align:center">snamenode,nmnager,datanode</td></tr><tr><td style="text-align:center">centos7.9 192.168.222.228</td><td style="text-align:center">node2</td><td style="text-align:center">datanode,nmanager</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/linjiangyu2/K.git   //可能会拉不下来，多拉几次就下来了，因为托管代码的服务器是国外的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> K</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> README.md  //不会使用的要看一下这个文件，了解脚本需要输入的配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./ksh  //依次输入你自己的配置，第一次使用这个脚本一定要看README.md文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果需要有时候改IP地址图方便的话，直接把ksh这个二进制的脚本放在/usr/bin下，便可以在全局执行了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> ksh /usr/bin/ksh</span></span><br><span class="line">使用ksh初始化后，开始配置</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>对应自己的IP地址，最好/etc/hosts的解析名和我一致，不然下面的配置文件需要自己对应自己的解析名修改</p></div><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[master]</span># </span><br><span class="line">cat &gt; /etc/hosts &lt;&lt;END</span><br><span class="line"><span class="number">127.0.0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 </span><br><span class="line"><span class="number">192.168.222.226</span> master</span><br><span class="line"><span class="number">192.168.222.227</span> node1</span><br><span class="line"><span class="number">192.168.222.228</span> node2</span><br><span class="line">END</span><br><span class="line"><span class="string">[master]</span># ssh-keygen -P &#x27;&#x27; -f ~/.ssh/id_rsa</span><br><span class="line"><span class="string">[master]</span># for i in master node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;do ssh-copy-id $i;done</span><br><span class="line"><span class="string">[master]</span># for i in node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;do rsync -av /etc/hosts root@$i:/etc/hosts;done</span><br><span class="line"><span class="string">[master]</span># for i in master node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;do ssh $i yum install -y openssl-devel;done</span><br><span class="line"><span class="string">[master]</span># cd /usr/lib64</span><br><span class="line"><span class="string">[master]</span># ln -s libcrypto.so.<span class="number">1</span>.<span class="number">0</span>.2k libcrypto.so</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>2.搭建</p></div></div><h4 id="2-1-hadoop分布式">2.1 hadoop分布式</h4><h4 id="上传jdk和hadoop的tar包">上传jdk和hadoop的tar包</h4><div class="note default orange simple"><p>这里使用的二进制包</p></div><div class="tag link"><a class="link-card" title="hadoop-2.8.5.tar.gz" href="https://alist.linjiangyu.com/d/Linux/hadoop-2.8.5.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">hadoop-2.8.5.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/hadoop-2.8.5.tar.gz</p></div></a></div><div class="tag link"><a class="link-card" title="jdk-8u212-linux-x64.tar.gz" href="https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">jdk-8u212-linux-x64.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz</p></div></a></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  [master]<span class="comment"># tar xf hadoop...  //不知道你使用的版本，写了...，以下也是，tab键或者对应修改就可以</span></span><br><span class="line">  <span class="comment"># ...是表示我不知道你使用的版本，自己改</span></span><br><span class="line">  [root@ master]<span class="comment"># tar xf jdk...</span></span><br><span class="line">  [root@ master]<span class="comment"># tar xf hadoop...</span></span><br><span class="line">  [root@ master]<span class="comment"># mv hadoop... /opt/hadoop285</span></span><br><span class="line">  [root@ master]<span class="comment"># mv jdk... /usr/local/jdk</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/opt/hadoop285</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$&#123;HADOOP_HOME&#125;</span>/bin:<span class="variable">$&#123;HADOOP_HOME&#125;</span>/sbin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class="variable">$HADOOP_HOME</span>/lib/native </span><br><span class="line"><span class="built_in">export</span> HADOOP_OPTS=<span class="string">&quot;-Djava.library.path=<span class="variable">$HADOOP_HOME</span>/lib/native&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$HADOOP_HOME</span>/lib/native/:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># source !$</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以下是自己直接写入配置，在master服务器上进行</p></div><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/hadoop285/etc/hadoop</span></span><br><span class="line"><span class="comment"># vim hadoop-env.sh  //修改文件里面的export JAVA_HOME=$&#123;JAVA_HOME&#125;为</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="comment"># vim yarn-env.sh //修改前面有注释的export JAVA_HOME为</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="comment"># vim core-site.xml</span></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>hadoop.tmp.dir<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>/opt/data<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>fs.defaultFS<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>hdfs://master:9000<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim hdfs-site.xml</span></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>dfs.replication<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>1<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>dfs.namenode.name.dir<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>/opt/data/hdfs/name<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>dfs.datanode.data.dir<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>/opt/data/hdfs/data<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim yarn-site.xml </span></span><br><span class="line"></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>yarn.resourcemanager.hostname<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>master<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>yarn.nodemanager.aux-services<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>mapreduce_shuffle<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cp mapred-site.xml.template mapred-site.xml</span></span><br><span class="line"><span class="comment"># vim mapred-site.xml</span></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">    <span class="variable">&lt;property&gt;</span></span><br><span class="line">        <span class="variable">&lt;name&gt;</span>mapreduce.framework.name<span class="variable">&lt;/name&gt;</span></span><br><span class="line">        <span class="variable">&lt;value&gt;</span>yarn<span class="variable">&lt;/value&gt;</span></span><br><span class="line">    <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim slaves</span></span><br><span class="line"><span class="keyword">master</span></span><br><span class="line"><span class="title">node1</span></span><br><span class="line">node2</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>然后在master节点把配置发到各个节点</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /usr/local/jdk root@<span class="variable">$i</span>:/usr/local/;<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /opt/hadoop285 root@<span class="variable">$i</span>:/opt/;<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /etc/profile root@<span class="variable">$i</span>:/etc/profile;<span class="keyword">done</span></span></span><br><span class="line">然后到各个节点</span><br><span class="line">[node1,2]# source /etc/profile</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在node1,2上操作，最后在master操作</p></div><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># hdfs namenode -format   <span class="comment">//初始化</span></span></span><br><span class="line"><span class="meta"># ls -d /opt/data   <span class="comment">//此文件夹产生就是初始化成功</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在master上操作</p></div><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ <span class="literal">master</span>]<span class="comment"># start-all.sh</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>最后可以在各个节点使用jps命令查看各自的部件</p></div><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@ xxx</span>]<span class="meta"># jps</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>当然web界面也可以访问的，浏览器访问192.168.222.226:8088和192.168.222.226:50070(对应自己IP地址)</p></div><div class="note default orange simple"><p>来尝试运行一下第一个hadoop分布式任务吧</p></div><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ master]# hdfs dfs -put <span class="regexp">/etc/</span>passwd /t1</span><br><span class="line">[root@ master]# hadoop jar <span class="regexp">/opt/</span>hadoop285<span class="regexp">/share/</span>hadoop<span class="regexp">/mapreduce/</span>hadoop-mapreduce-examples-<span class="number">2.8</span>.<span class="number">5</span>.jar wordcount <span class="regexp">/t1 /</span>output/<span class="number">00</span></span><br><span class="line">[root@ master]# hdfs dfs -ls <span class="regexp">/output/</span><span class="number">00</span>  <span class="comment">//查看运行后的结果文件,运行后的数据在part-r-00000</span></span><br></pre></td></tr></table></figure><h4 id="2-2-spark分布式">2.2 spark分布式</h4><div class="note default orange simple"><p>下面开始搭建分布式spark，这里使用的是spark的3.3.0版本</p></div><div class="tag link"><a class="link-card" title="spark-3.3.0-bin-hadoop3.tgz" href="https://alist.linjiangyu.com/d/Linux/spark-3.3.0-bin-hadoop3.tgz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">spark-3.3.0-bin-hadoop3.tgz</p><p class="url">https://alist.linjiangyu.com/d/Linux/spark-3.3.0-bin-hadoop3.tgz</p></div></a></div><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 把spark包上传到机器上，然后到该包的目录，这里统一以spark-3.3.0-bin-hadoop3.tgz这个包为演示</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># tar xf spark-3.3.0-bin-hadoop3.tgz</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv spark-3.3.0-bin-hadoop3 /opt/spark</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim /etc/profile</span></span><br><span class="line">export PATH=/opt/spark/bin:/opt/spark/sbin:$PATH</span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># cd /opt/spark/conf</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv spark-env.sh.template spark-env.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim spark-env.sh</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export HADOOP_CONF_DIR=/opt/hadoop285/etc/hadoop</span><br><span class="line">export SPARK_MASTER_IP=master   <span class="meta">#对应自己的master机器IP或者master解析的域名，如果是按照我上面做的直接写master即可</span></span><br><span class="line">export SPARK_WORKER_MEMORY=<span class="number">1024</span>m</span><br><span class="line">export SPARK_WORKER_CORES=<span class="number">2</span> </span><br><span class="line">export SPARK_EXECUTOR_MEMORY=<span class="number">1024</span>m</span><br><span class="line">export SPARK_WORKER_INSTANCES=<span class="number">1</span></span><br><span class="line">export SOARK_MASTER_PORT=<span class="number">7077</span></span><br><span class="line">export SPARK_EXECUTOR_CORES=<span class="number">1</span></span><br><span class="line">SPARK_HISTORY_OPTS=<span class="string">&quot;-Dspark.history.fs.logDirectory=hdfs://master:9000/spark_logs&quot;</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># cp spark-defaults.conf.template spark-defaults.conf</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim spark-defaults.conf</span></span><br><span class="line">spark.master                     spark:<span class="comment">//master:7077</span></span><br><span class="line">spark.eventLog.enabled           <span class="literal">true</span></span><br><span class="line">spark.eventLog.dir               hdfs:<span class="comment">//master:9000/spark_logs</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim slaves     //对应自己的三台主机IP地址或者解析的域名</span></span><br><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># cd /opt/spark/sbin</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv start-all.sh spark-start.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv stop-all.sh spark-stop.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># source /etc/profile</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /opt/spark root@node1:/opt/</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /opt/spark root@node2:/opt/</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /etc/profile root@node1:/etc/</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /etc/profile root@node2:/etc/</span></span><br><span class="line"><span class="meta"># 然后在各工作节点执行命令</span></span><br><span class="line">[<span class="meta">root@ node1,node2</span>]<span class="meta"># source /etc/profile</span></span><br><span class="line"><span class="meta"># 在master节点执行</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># start-all.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># hdfs dfs -mkdir /spark_logs</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># spark-start.sh  //启动spark集群</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># jps     //查看</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以上便搭建好了spark结合hadoop的分布式集群，spark也有自己的web界面，可以浏览器访问192.168.222.226:8080来查看(对应自己IP地址)</p></div><h4 id="2-3-zookeeper分布式">2.3 zookeeper分布式</h4><div class="tag link"><a class="link-card" title="apache-zookeeper-3.5.10.tar.gz" href="https://alist.linjiangyu.com/d/Linux/zookeeper-3.4.14.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">apache-zookeeper-3.5.10.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/zookeeper-3.4.14.tar.gz</p></div></a></div><div class="note default orange simple"><p>在master机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tar xf zookeeper*</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> zookeeper* /opt/zookeeper</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> /opt/zookeeper/conf/zoo_sample.cfg /opt/zookeeper/conf/zoo.cfg</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /opt/zookeeper/conf/zoo.cfg</span></span><br><span class="line">修改</span><br><span class="line">dataDir=/opt/data/zookeeper</span><br><span class="line">添加</span><br><span class="line">dataLogDir=/opt/data/zookeeper/logs</span><br><span class="line">server.1=master:2888:3888</span><br><span class="line">server.2=node1:2888:3888</span><br><span class="line">server.3=node2:2888:3888</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里对应自己的主机名</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在各机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> -p /opt/data/zookeeper/logs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> 1 &gt; /opt/data/zookeeper/myid             <span class="comment">#这里master对应上面的server.1 便要echo1,node1对应server.2便要echo 2,node3对应server.3便要echo 3</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在master机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/profile</span></span><br><span class="line">export ZOOKEEPER_HOME=/opt/zookeeper</span><br><span class="line">export PATH=$&#123;ZOOKEEPER_HOME&#125;/bin:$PATH</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /opt/zookeeper root@<span class="variable">$i</span>:/opt/;<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /etc/profile /etc/;<span class="keyword">done</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在各机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> /etc/profile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zkServer.sh start             <span class="comment">#这个命令最好使用多命令一起执行,就是多个机器的执行时间要差不多一直,因为zookeeper对时间的要求性很高和各种问题</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zkServer.sh status    <span class="comment"># 可以在各节点查看自己的角色是leader还是follower</span></span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">hadoop+spark+zookeeper分布式集群搭建</summary>
    
    
    
    <category term="服务集群" scheme="https://www.linjiangyu.com/categories/%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>不怎么好走的路 才是上坡路</title>
    <link href="https://www.linjiangyu.com/posts/78ceeb56.html"/>
    <id>https://www.linjiangyu.com/posts/78ceeb56.html</id>
    <published>2022-11-06T08:17:21.000Z</published>
    <updated>2023-11-27T01:42:42.513Z</updated>
    
    <content type="html"><![CDATA[<span class='p center red logo large'>不怎么好走的路 才是上坡路</span><p>一件事做过一百遍，也还有可以精进之处;<br>一篇文章写过一百遍，也还有可以改进之处;<br>一种方法用过一百遍，也还有可以完善之处。<br>一旦停止学习，人就会止步不前。</p>]]></content>
    
    
    <summary type="html">不怎么好走的路 才是上坡路</summary>
    
    
    
    <category term="演示" scheme="https://www.linjiangyu.com/categories/%E6%BC%94%E7%A4%BA/"/>
    
    
  </entry>
  
  <entry>
    <title>Web应用之Tomcat</title>
    <link href="https://www.linjiangyu.com/posts/d5d9f79c.html"/>
    <id>https://www.linjiangyu.com/posts/d5d9f79c.html</id>
    <published>2022-11-03T07:50:40.000Z</published>
    <updated>2022-11-03T07:53:03.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Tomcat">Tomcat</h2><h3 id="二进制安装">二进制安装</h3><div class="note default orange simple"><p>安装jdk</p></div><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="jdk-8u212-linux-x64.tar.gz" href="https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">jdk-8u212-linux-x64.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz</p></div></a></div>              </div>            </details><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar xf jdk-8u212-linux-x64.tar.gz</span></span><br><span class="line"><span class="comment"># mv jdk-8u212-linux /usr/local/jdk</span></span><br></pre></td></tr></table></figure><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="apache-tomcat-9.0.65-src.tar.gz" href="https://alist.linjiangyu.com/d/Linux/apache-tomcat-9.0.65-src.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">apache-tomcat-9.0.65-src.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/apache-tomcat-9.0.65-src.tar.gz</p></div></a></div><div class="tag link"><a class="link-card" title="tomcat-native-1.2.23-src.tar.gz" href="https://alist.linjiangyu.com/d/Linux/tomcat-native-1.2.23-src.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">tomcat-native-1.2.23-src.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/tomcat-native-1.2.23-src.tar.gz</p></div></a></div>              </div>            </details><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar xf apache-tomcat-9.0.65-src.tar.gz</span></span><br><span class="line"><span class="comment"># mv apache-tomcat-9.0.65-src /usr/local/tomcat</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install apr apr-devel apr-utils openssl-devel</span></span><br><span class="line"><span class="comment"># tar xf tomcat-native-1.2.23-src.tar.gz </span></span><br><span class="line"><span class="comment"># cd tomcat-native-1.2.23-src/native/</span></span><br><span class="line"><span class="comment"># ./configure --with-apr=/usr/bin/apr-1-config --with-java-home=/usr/local/jdk --prefix=/usr/local/tomcat</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>将jdk和tomcat写入环境变量</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export JRE_HOME=/usr/local/jdk/jre</span><br><span class="line">export TOMCAT_HOME=/usr/local/tomcat</span><br><span class="line">export PATH=<span class="variable">$</span>&#123;JAVA_HOME&#125;/bin:<span class="variable">$</span>&#123;JRE_HOME&#125;/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>可以自己写一个小脚本</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;<span class="keyword">END</span></span><br><span class="line">author: linjiangyu</span><br><span class="line">cc: http://creativecommons.org/licenses/by<span class="literal">-nc-sa</span>/<span class="number">4.0</span>/</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="comment"># vim /etc/init.d/tomcat</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#chkconfig: 2345 85 15</span></span><br><span class="line"><span class="comment">#description: By K &lt;linjiangyu0702@qq.com&gt;</span></span><br><span class="line">case <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"><span class="built_in">start</span>)</span><br><span class="line">    /usr/local/tomcat/bin/startup.sh </span><br><span class="line">    ;;</span><br><span class="line">stop)</span><br><span class="line">    /usr/local/tomcat/bin/shutdown.sh</span><br><span class="line">    ;;</span><br><span class="line">status)    </span><br><span class="line">    /usr/local/tomcat/bin/configtest.sh</span><br><span class="line">    ;;</span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="literal">-e</span> <span class="string">&quot;\033[31mUsage: <span class="variable">$</span>(basename <span class="variable">$0</span>) (start|stop|status)\033[0m&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">&lt;!<span class="literal">--</span>这里要吐槽一下java的程序运行的是真的慢，服务刚启动的话<span class="number">8005</span>的套接字端口不会那么快就启用，而关闭服务的时候是要使用到<span class="number">8005</span>端口shutdown的，所以应该把restart服务加上一段时间<span class="literal">--</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># chmod +x /etc/init.d/tomcat</span></span><br><span class="line"><span class="comment"># vim /usr/local/tomcat/bin/catalina.sh# 把环境变量写入相应需要的文件中(tomcat的变量这里没有引用系统环境变量,所以要自己再写上)</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export JRE_HOME=/usr/local/jdk/jre</span><br><span class="line"><span class="comment"># chkconfig --add tomcat</span></span><br><span class="line"><span class="comment"># chkconfig tomcat on</span></span><br><span class="line"><span class="comment"># service tomcat start</span></span><br></pre></td></tr></table></figure><h4 id="1-优点和功能">1.优点和功能</h4><div class="note default orange simple"><p>优点和功能</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Tomcat运行时占用的系统资源小，扩展性好，支持负载均衡与邮件服务等开发应用系统常用的功能；</span><br><span class="line"></span><br><span class="line">Tomcat是一个开源的web服务器 ;</span><br><span class="line"></span><br><span class="line">Tomcat是一个小型的轻量级应用服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试JSP程序的首选。</span><br><span class="line"></span><br><span class="line">对于一个初学者来说，可以这样认为，当在一台机器上配置好Apache服务器，可利用它响应对HTML页面的访问请求。实际上Tomcat部分是Apache服务器的扩展，所以当你运行tomcat时，它实际上作为一个Apache独立的进程单独运行的。 当配置正确时，Apache为HTML页面服务，而Tomcat实际上运行JSP页面和Servlet。另外，Tomcat和IIS、Apache等Web服务器一样，具有处理HTML页面的功能，另外它还是一个Servlet和JSP容器，独立的Servlet容器是Tomcat的默认模式。</span><br><span class="line"></span><br><span class="line">不过，Tomcat处理静态HTML的能力不如Apache服务器。</span><br></pre></td></tr></table></figure><h4 id="2-组件">2.组件</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Server: 控制tomcat的启动和关闭,tomcat的生命周期由Server控制</span><br><span class="line"></span><br><span class="line">Engine: 负责处理所有的请求,处理后将结果返回给Service,而connector是作为service与engine的作为中间交流者；一个engine下可以配置一个默认主机，每个虚拟主机都有一个域名</span><br><span class="line"></span><br><span class="line">Connector 主要负责对外交流</span><br><span class="line"></span><br><span class="line">Host：代表一个虚拟主机，每个虚拟主机和某个网络域名（Domain Name）相匹配。 每个虚拟主机下都可以部署一个或多个web应用，每个web应用对应于一个context，有一个context path。 当Host获得一个请求时，将把该请求匹配到某个Context上</span><br><span class="line"></span><br><span class="line">Wrapper： 代表一个 Servlet，它负责管理一个 Servlet，包括的 Servlet 的装载、初始化、执行以及资源回收。Wrapper 是最底层的容器，它没有子容器</span><br></pre></td></tr></table></figure><h4 id="3-配置">3.配置</h4><div class="note default orange simple"><p>用户认证登陆</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/tomcat/tomcat-user.xml</span></span><br><span class="line">&lt;user username=<span class="string">&quot;tomcat&quot;</span> password=<span class="string">&quot;abcd0702&quot;</span> roles=<span class="string">&quot;manager-gui&quot;</span>/&gt;  设置登陆用户和密码,role设置为可以查看管理web界面的权限manager<span class="literal">-gui</span></span><br><span class="line"></span><br><span class="line">- manager<span class="literal">-gui</span> -允许访问HTML GUI和状态页面</span><br><span class="line"></span><br><span class="line">- manager<span class="literal">-script</span> -允许访问HTTP API和状态页面</span><br><span class="line"></span><br><span class="line">- manager<span class="literal">-jmx</span> -允许访问JMX代理和状态页</span><br><span class="line"></span><br><span class="line">- manager<span class="literal">-status</span> -只允许访问状态页</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>tomcat默认静态网页的存放位置在/usr/share/tomcat/webapps/ROOT/下</p></div><p>…还在编写中</p>]]></content>
    
    
    <summary type="html">Web应用之Tomcat</summary>
    
    
    
    <category term="服务集群" scheme="https://www.linjiangyu.com/categories/%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4/"/>
    
    
    <category term="Linux" scheme="https://www.linjiangyu.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>redis持久化存储切换</title>
    <link href="https://www.linjiangyu.com/posts/86ed3030.html"/>
    <id>https://www.linjiangyu.com/posts/86ed3030.html</id>
    <published>2022-10-26T02:29:27.000Z</published>
    <updated>2022-10-26T13:38:58.000Z</updated>
    
    <content type="html"><![CDATA[<div class="note default orange simple"><p>分享一个坑</p></div><p>redis数据库的持久化存储有snapshot和aof两种</p><p>如果是使用过snapshot之后已经有了存储数据然后要开启aof的话,因为aof比snapshot机制的rdb文件的优先级高,redis默认会去加载第一次生成的aof的空文件,会导致全部数据未能被加载,然后如果这个时候你使用了save或bgsave或者触发了配置中的save机制,那就直接把当前的空数据库覆盖到rdb文件中了,那就可以准备收拾行李连夜坐船转到老挝,缅甸,柬埔寨了</p><p>解决方法:</p><p>命令行的动态更改,命令行的修改不会和重启服务一般去更新你的数据库,所以在你动态更改为aof机制后再执行重启会连同以前的数据一同备份进aof文件,当然动态更改后你还是需要把配置文件中的参数更改</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># redis-cli </span></span><br><span class="line"></span><br><span class="line">127.0.0.1&gt;<span class="built_in"> config </span><span class="built_in">set</span> appendonly <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># vim redis.conf</span></span><br><span class="line"></span><br><span class="line">appendonly <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl restart redis.service</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">redis持久化存储切换</summary>
    
    
    
    <category term="演示" scheme="https://www.linjiangyu.com/categories/%E6%BC%94%E7%A4%BA/"/>
    
    <category term="数据库" scheme="https://www.linjiangyu.com/categories/%E6%BC%94%E7%A4%BA/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="redis" scheme="https://www.linjiangyu.com/tags/redis/"/>
    
  </entry>
  
</feed>
