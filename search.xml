<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>LB常用调度算法</title>
      <link href="/posts/ed485414.html"/>
      <url>/posts/ed485414.html</url>
      
        <content type="html"><![CDATA[<h3 id="LB常用调度算法">LB常用调度算法</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">)</span> <span class="string">轮询:</span> <span class="string">RR（Round</span> <span class="string">Robin）</span></span><br><span class="line"><span class="string">最基本的调度算法，把请求连接依次轮流分配到RS机器，缺点是如果机器性能不一致便会导致资源浪费</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">)</span> <span class="string">加权轮询:</span> <span class="string">WRR（Weighted</span> <span class="string">Round</span> <span class="string">Robin）</span></span><br><span class="line"><span class="string">在RR的基础上添加了设置机器权重，按照权重比例调度请求</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">)</span> <span class="string">源地址哈希:</span> <span class="string">SH</span> <span class="string">（Source</span> <span class="string">Hash）</span></span><br><span class="line"><span class="string">将请求的客户端IP地址进行Hash计算并调度，后面此IP地址发出的请求便会被永久的调度到同一台RS机器上</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="string">)</span> <span class="string">目标地址哈希:</span> <span class="string">DH</span> <span class="string">(Destination</span> <span class="string">Hash)</span></span><br><span class="line"><span class="string">通过一个散列函数将来自同一个源IP的请求地址映射到一台服务器或链路上</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span><span class="string">)</span> <span class="string">最少连接数:</span> <span class="string">LC（Least</span> <span class="string">Connection）</span></span><br><span class="line"><span class="string">根据当前各服务器的连接数来估计服务器的负载情况，把新的连接分配给连接数最小的服务器；负载率=active*256+inactive，值小的优先分配请求</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span><span class="string">）加权最少连接数:</span> <span class="string">WLC（Weighted</span> <span class="string">Least</span> <span class="string">Connection）</span></span><br><span class="line"><span class="string">与LC类似，根据当前各服务器的连接数来估计服务器的负载情况，把新的连接分配给连接数最小的服务器；负载率=(active*256+inactive)/weight，值小的优先分配请求</span></span><br><span class="line"></span><br><span class="line"><span class="number">7</span><span class="string">）最短期望延迟:</span> <span class="string">SED（Shortest</span> <span class="string">Expect</span> <span class="string">Delay）</span></span><br><span class="line"><span class="string">这个算法主要是优化LC的，在服务均在请求少的时候避免负载到一台服务器上做的优化；负载率=(active+1)*256/weight，值小的优先分配请求</span></span><br><span class="line"></span><br><span class="line"><span class="number">8</span><span class="string">)</span> <span class="string">永不排队:</span> <span class="string">NQ</span> <span class="string">（Nerver</span> <span class="string">Queue）</span></span><br><span class="line"><span class="string">在负载低时，请求直接分配到空闲服务器上，不会产生请求等待；当服务器都很忙时，将轮询</span></span><br><span class="line"></span><br><span class="line"><span class="number">9</span><span class="string">)</span> <span class="string">基于本地最少连接:</span> <span class="string">LBLC（Locality-Based</span> <span class="string">Least</span> <span class="string">Connection）</span></span><br><span class="line"><span class="string">根据请求的目标IP地址找出该目标IP地址最近使用的RealServer，若该Real</span> <span class="string">Server是可用的且没有超载，将请求发送到该服务器；若服务器不存在，或者该服务器超载且有服务器处于一半的工作负载，则用“最少链接”的原则选出一个可用的服务器，将请求发送到该服务器</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""><br>我的博客即将同步至腾讯云开发者社区，邀请大家一同入驻：<a href="https://cloud.tencent.com/developer/support-plan?invite_code=1azt3h0ol0r9g">https://cloud.tencent.com/developer/support-plan?invite_code=1azt3h0ol0r9g</a></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SD使用和Lora模型训练</title>
      <link href="/posts/ba51ac6f.html"/>
      <url>/posts/ba51ac6f.html</url>
      
        <content type="html"><![CDATA[<h2 id="SD使用和Lora模型训练">SD使用和Lora模型训练</h2><p>最近一直没有更新博客，一方面因为自己在准备实习需要的东西时间很赶，另一方面就是因为AI绘画玩具啦。</p><h3 id="Stable-Diffusion">Stable Diffusion</h3><ul><li><p>需要显卡是N卡且安装好<a href="https://www.nvidia.cn/geforce/drivers/">N卡GPU驱动</a></p></li><li><p>这里我是使用的来自<a href="https://space.bilibili.com/12566101">B站阿婆主秋葉</a>所发布的<a href="https://pan.baidu.com/s/1tmYETTYuWYcCTsJUk2zF0A?pwd=6drn">Stable Diffusion V4整合包</a> 部署在本地电脑的AI绘画的</p></li><li><p>整合包下载后包括两个文件</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/DQAX0_I2%5D~%5DX%7BEVR%5BLSK9LL.png" alt=""></p></li></ul><ol><li><p>首先运行启动器依赖</p></li><li><p>解压sd-webui-aki-v4.zip</p></li><li><p>进入sd-webui-aki-v4文件夹打开启动器后一键启动等待控制台输出完毕弹出Web Ui界面就可以开始绘图啦</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683086006853.jpg" alt=""></p></li><li><p>整合包已经安装好汉化，这里的正向提示词就是输入你想要让AI画出人物的描述啦，例如masterpiece,1 girl, very detailed CG, beautiful eyes, very detailed, Blackboard painting, complex details_ 1.2, 8k wallpaper, jk等等，默认使用英文，用逗号分割词语，而负面提示词则是反着来了，例如写入worst quality,bad hands,malformed hands,worst quality,low quality,((((ugly)))),(((duplicate))),(((trans))),((trannsexual)),(out of frame),extra fingers,mutated hands,out of frame,extra limbs,(bad anatomy),grossproportions,(malformed limbs),((missing arms)),((missinglegs)),(((extra arms))),(((extra legs)))</p></li><li><p>等等</p><ul><li>这里推荐使用我的TAG生成器</li></ul><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1682909507747.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">Tianlin_Tag</div>  <p>自用TAG生成工具</p>  <a href='https://tag.linjiangyu.com/'></a>  </figcaption>  </figure>  </div></li><li><p>实际生成一张吧，因为我的破烂电脑显卡不行，显存不够所以这里等上个把分钟都是不奇怪的，具体还是看你与显卡之间的羁绊吧🤣</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683087991679.jpg" alt=""></p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/00010-235500343-masterpiece,1%20girl,%20very%20detailed%20CG,%20beautiful%20eyes,%20very%20detailed,%20Blackboard%20painting,%20complex%20details_%201.2,%208k%20wallpaper,%20jk.png" alt=""></p><p>​这里看可能会有点模糊？我还经过了压缩才上传显示在此网页中的原因吧，可以看到AI可以很好的绘画出我们满意的图片</p><ul><li>而且在Stable Diffusion中也有图片放大的运行，图片放大其实是在已知像素点的位置上估算新的像素点的值。这可以通过计算原图像中的相邻像素点的平均值或加权平均值来实现。这样，我们就可以在原图像中的每个像素点之间估算出新的像素点的值，从而来增加图像的分辨率和清晰度</li><li>Stable Diffusion非常强大，甚至还支持文件夹中图片批量处理输出</li></ul><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683088698837.png" alt=""></p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683089264426.jpg" alt=""></p><p>在这里上传你需要放大处理的图片，我一般都是使用BSRGAN算法来放大处理的，缩放比例也是常用的3，最高可以到8，分辨率调到太高的时候图片的线条会过分明显我并不喜欢。</p><p>以下是使用3倍的缩放比例和BSRGAN算法处理后的图片</p><div class="hide-block"><button type="button" class="hide-button" style="background-color: orange;">点击查看     </button><div class="hide-content"><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1279261927392739.png" alt=""></p></div></div><p>可以看出3倍的缩放比例便已经可以达到非常好的效果了，我的建议是使用3-4之间</p></li></ol><h3 id="Lora的训练">Lora的训练</h3><h4 id="准备条件和素材">准备条件和素材</h4><p>​对于一个喜欢看轻小说的死二次元来说，轻小说中的插图总是觉得怎么看都看不够，而且有些画质也是经过一传再传被各种社交软件一再压缩，到手的图片也总是感觉清晰度不高，而就算你把所有关于你想要生成的人物的各种细节都描述出来，AI绘图也无法将人物的样式完整的复现出来，一般对于专要产出图片的角色就要用到Lora或者embedding了，这里主要讲的是如何训练一个专有人物的Lora模型。</p><ul><li><p>一般的Lora模型文件是以safetensors为后缀的训练模型文件，存放在SD_ROOT/models/Lora中。</p></li><li><p>训练的要求</p><ol><li><p>显存，需要最少为8G的电脑显存才能进行最低的本地运行训练(我的破烂电脑哪里会有8G显存,所以这里写的便是白嫖云端运行训练Lora模型)</p></li><li><p>图片，需要至少10张以上的较高清晰度，较无杂物的人物图片(也就是最好少点背景物品什么的，多为人物的单独展示图最好)，而且需要经过处理把所有的图片的分辨率都调为一致(分辨率要是64的倍数且都不能超过1920),这里一般可以使用SD中的后期处理进行图片的分辨率放大，然后使用SD训练中的图片预处理进行对图片自动面部焦点剪裁的分辨率裁剪(我的推荐是不要超过1280,1280的(这里我使用的差不多30左右张的1280,1280的图片训练的epoches数为20的时候都要训练到差不多4个小时多)，除非家里有条件是用的自己电脑训练的可以把分辨率提高，让训练达到最佳的效果(这里我感觉不是epoches训练数越多越好，而且支持叠加训练的方式训练我在上次叠加训练了8个小时全部白搭了，图片的生成直接整个崩坏，推荐就是一次性练完)</p></li><li><p>google账号,这里是使用谷歌的Colab来进行云端训练,google每周会刷新一次账号的试用Jupyter Notebook笔记本的时长，官网说是一周有12小时的时间，但是实际上为使用的伤害一个账号最多就6个小时左右的时间(之前训练到6个多小时的模型被中断了) (这里会用挂载把谷歌硬盘挂载到Jupyter Notebook笔记本上而且设置模型的输出目录为挂载的路径，这样就可以避免打水漂，因为我都是两个steps就保存一次模型,那么就算训练被中断了也可以在谷歌硬盘中下载最新的中断模型，也是可以正常使用的)</p></li><li><p>给你的图片打标签，这里直接使用SD中的Tagger插件，如果是使用上面的整合包的话是有包含在内的，想要使用这个插件对图片进行批处理都打上标签保存在相同路径下相同名字的txt文件中然后后面要上传到Jupyter Notebook笔记本中<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683166925138.png" alt=""></p></li></ol><p>这里的阀值是定义AI的标签词语强度范围，我自己一般都是使用5.5</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683166978197.jpg" alt=""></p><p>附加提示词则可以理解为给每个图片都加上一个属于自己的标记吧，不懂的话忽略即可，然后点击反推提示词便可以了，默认的输出也是以图片文件名字为前缀以txt为后缀，没有指定目录也是默认的图片路径下输出的</p><ol start="5"><li>具有科学上网的能力(因为访问Colab需要)</li></ol></li></ul><h4 id="开始训练">开始训练</h4><p>说明:这里的每一小步骤都要新添加一个代码单元格</p><ol><li><p>首先进入到<a href="https://colab.research.google.com/">Colab</a> 创建新的笔记本</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683167364878.jpg" alt=""></p></li><li><p>更改运行类型为GPU并保存</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683167480635.jpg" alt=""></p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683167536583.jpg" alt=""> 查看GPU和挂载磁盘</p><p>在代码框输入然后点击左上角启动</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">!nvidia-smi</span><br><span class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> drive</span><br><span class="line">drive.mount(<span class="string">&#x27;/content/drive/&#x27;</span>)</span><br><span class="line">!echo <span class="string">&quot;硬盘挂载完成.&quot;</span></span><br></pre></td></tr></table></figure><p>这里会弹出让你允许笔记本访问并授权到谷歌磁盘，直接允许然后看到输出硬盘挂载完成就可以了</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683167836877.jpg" alt=""></p></li><li><p>运行一系列配置</p><ul><li>点击添加代码框然后输入后执行</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">%cd /content/</span><br><span class="line">git_https = <span class="string">&quot;https://github.com/Akegarasu/lora-scripts&quot;</span></span><br><span class="line">!git clone --recurse-submodules &#123;git_https&#125;  /content/lora-scripts/</span><br><span class="line">!cd lora-scripts &amp;&amp; git pull &amp;&amp; git submodule update --init --recursive</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;克隆完成 你可以在安装依赖时去配置train.sh文件&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment">#########</span></span><br><span class="line"><span class="comment">#设置train.sh文件路径，这个在函数中会被使用</span></span><br><span class="line">train_sh_path = <span class="string">r&#x27;/content/lora-scripts/train.sh&#x27;</span></span><br><span class="line"><span class="comment">#########</span></span><br><span class="line"><span class="comment">#定义函数，编辑train_sh_path路径的文件，为search的参数赋予值input</span></span><br><span class="line"><span class="comment">#search为字符串，input可以为数值和字符串</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_input</span>(<span class="params">search, <span class="built_in">input</span></span>):</span><br><span class="line">  <span class="comment"># 使用正则表达式进行替换</span></span><br><span class="line">  <span class="comment">#匹配标志: 1匹配search=&quot;&quot; ， 2匹配search=5 ， 3专门专门匹配extArgs=()</span></span><br><span class="line">  search_type_flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#search不是字符串就报错</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span>( <span class="built_in">isinstance</span>(search, <span class="built_in">str</span>) ):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;非字符串的&#x27;search&#x27;参数&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#如果search输入的是&quot;&quot;，则专门匹配extArgs=()</span></span><br><span class="line">  <span class="keyword">if</span> search == <span class="string">&quot;&quot;</span>:</span><br><span class="line">    search = <span class="string">&quot;extArgs&quot;</span></span><br><span class="line">    pattern = <span class="string">rf&#x27;^<span class="subst">&#123;search&#125;</span>=(\(.*?\))&#x27;</span></span><br><span class="line">    replace = <span class="string">rf&#x27;<span class="subst">&#123;search&#125;</span>=(<span class="subst">&#123;<span class="built_in">input</span>&#125;</span>)&#x27;</span></span><br><span class="line">    search_type_flag = <span class="number">3</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 如果input是字符串类型，匹配search=&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(<span class="built_in">input</span>, <span class="built_in">str</span>):</span><br><span class="line">      <span class="comment">#pattern = rf&#x27;&#123;search&#125;=(&quot;.*?&quot;)&#x27;</span></span><br><span class="line">      <span class="comment">#replace = f&quot;&#123;search&#125;=\&quot;&#123;input&#125;\&quot;&quot;</span></span><br><span class="line">      pattern = <span class="string">rf&#x27;^<span class="subst">&#123;search&#125;</span>=(&quot;.*?&quot;)&#x27;</span></span><br><span class="line">      replace = <span class="string">rf&#x27;<span class="subst">&#123;search&#125;</span>=&quot;<span class="subst">&#123;<span class="built_in">input</span>&#125;</span>&quot;&#x27;</span></span><br><span class="line">      search_type_flag = <span class="number">1</span></span><br><span class="line">    <span class="comment"># 如果input是数值类型，匹配search= （可以匹配小数、整数、科学计数）</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(<span class="built_in">input</span>, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">      pattern = <span class="string">rf&#x27;^<span class="subst">&#123;search&#125;</span>=([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)&#x27;</span></span><br><span class="line">      replace = <span class="string">rf&#x27;<span class="subst">&#123;search&#125;</span>=<span class="subst">&#123;<span class="built_in">input</span>&#125;</span>&#x27;</span></span><br><span class="line">      search_type_flag = <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># 其他情况，就返回错误信息 </span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;错误的匹配input&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#使用with语句打开文件，并读取内容</span></span><br><span class="line">  <span class="keyword">with</span> <span class="built_in">open</span>(train_sh_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">    re_get = re.findall(pattern, content, flags=re.MULTILINE|re.DOTALL)</span><br><span class="line">    <span class="comment">#检查是否匹配到，匹配不到则报错并退出</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span>(re_get):</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f&quot;警告！！！对于&#x27;<span class="subst">&#123;search&#125;</span>&#x27;的正则表达式并未匹配，请手动设置该参数，并私信我更新！&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="comment">#如果匹配到了执行接下来操作</span></span><br><span class="line">    <span class="comment">#使用re.sub函数进行替换，并加上re.MULTILINE标志</span></span><br><span class="line">    new_content = re.sub(pattern, replace, content, flags=re.MULTILINE|re.DOTALL, count=<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#如果内容未更改，提示未改变以及值</span></span><br><span class="line">    <span class="keyword">if</span> new_content == content:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;search&#125;</span>=<span class="subst">&#123;re_get[<span class="number">0</span>]&#125;</span>&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="comment">#如果改变则写入，输出改变信息</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">with</span> <span class="built_in">open</span>(train_sh_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(new_content)</span><br><span class="line">      <span class="keyword">if</span> search_type_flag == <span class="number">1</span>: right = left = <span class="string">&quot;\&quot;&quot;</span></span><br><span class="line">      <span class="keyword">elif</span> search_type_flag == <span class="number">2</span>: right = left = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="keyword">elif</span> search_type_flag == <span class="number">3</span>: right = <span class="string">&quot;)&quot;</span> ; left = <span class="string">&quot;(&quot;</span> </span><br><span class="line">      <span class="keyword">else</span>: <span class="built_in">print</span>(<span class="string">&quot;输入参数错误&quot;</span>)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f&quot;发生修改，<span class="subst">&#123;search&#125;</span>=<span class="subst">&#123;re_get[<span class="number">0</span>]&#125;</span>现在为<span class="subst">&#123;left&#125;</span><span class="subst">&#123;<span class="built_in">input</span>&#125;</span><span class="subst">&#123;right&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#模型输出地址被更改至&quot;/content/drive/MyDrive/Lora/output/&quot; </span></span><br><span class="line">output_dir = <span class="string">&quot;/content/drive/MyDrive/Lora/output/&quot;</span></span><br><span class="line">search_input(<span class="string">&quot;  --output_dir&quot;</span>, output_dir)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;模型输出地址默认被更改至谷歌硬盘：<span class="subst">&#123;output_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化log输出路径</span></span><br><span class="line">logging_dir = output_dir + <span class="string">&quot;/logs&quot;</span></span><br><span class="line">search_input(<span class="string">&quot;  --logging_dir&quot;</span>, logging_dir)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;log日志默认输出至谷歌硬盘：<span class="subst">&#123;logging_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化sample_prompt.txt路径</span></span><br><span class="line">sample_prompt_txt_path = <span class="string">&quot;/content/lora-scripts/sample_prompt.txt&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;sample_prompt.txt默认路径为：<span class="subst">&#123;sample_prompt_txt_path&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化训练集路径</span></span><br><span class="line">train_data_dir = <span class="string">&quot;/content/lora-scripts/train/aki/&quot;</span></span><br><span class="line">search_input(<span class="string">&quot;train_data_dir&quot;</span>, train_data_dir)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;训练集将拷贝至：<span class="subst">&#123;train_data_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化正则化集路径</span></span><br><span class="line">reg_data_dir = <span class="string">&quot;/content/lora-scripts/train/reg/&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;正则化集将拷贝至：<span class="subst">&#123;reg_data_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#弃用代码</span></span><br><span class="line"><span class="comment">#!sed -i &#x27;s/--output_dir=&quot;.\/output&quot;/--output_dir=&quot;/content/drive/MyDrive/Lora/output/&quot;/&#x27; /content/lora-scripts/train.sh</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment">#声明extArgs_Content类，用于在不同代码块中更新extArgs的内容</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExtArgsContent</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">    self.base_model = <span class="string">&quot;&quot;</span></span><br><span class="line">    self.vae = <span class="string">&quot;&quot;</span></span><br><span class="line">    self.common_parameter = <span class="string">&quot;&quot;</span></span><br><span class="line">    self.sample_parameter = <span class="string">&quot;&quot;</span></span><br><span class="line">    self.plus_parameter = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment">#合并全部类属性字符串</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">all</span>(<span class="params">self</span>):</span><br><span class="line">    result = <span class="string">&quot;&quot;</span></span><br><span class="line">    attributes = self.__dict__.values()</span><br><span class="line">    <span class="keyword">for</span> attribute <span class="keyword">in</span> attributes:</span><br><span class="line">      result += attribute</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="comment">#将在（六、七）中被使用</span></span><br><span class="line">extArgs_content = ExtArgsContent()</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment">#用于读取  --output_dir=&quot;&quot;和  --logging_dir=&quot;&quot;的值，来修改8.2中保存路径</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_get</span>(<span class="params">search</span>):</span><br><span class="line">  <span class="comment"># 如果input是字符串类型，匹配search=&quot;&quot;</span></span><br><span class="line">  <span class="comment">#pattern = rf&#x27;&#123;search&#125;=(&quot;.*?&quot;)&#x27;</span></span><br><span class="line">  pattern = <span class="string">rf&#x27;^<span class="subst">&#123;search&#125;</span>=(&quot;.*?&quot;)&#x27;</span></span><br><span class="line">  <span class="comment">#使用with语句打开文件，并读取内容</span></span><br><span class="line">  <span class="keyword">with</span> <span class="built_in">open</span>(train_sh_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">    re_get = re.findall(pattern, content, flags=re.MULTILINE|re.DOTALL)</span><br><span class="line">    <span class="keyword">return</span> re_get[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment">#初始化，在（八）中执行判断</span></span><br><span class="line">enable_sample = <span class="literal">False</span></span><br><span class="line">use_train_sh_self = <span class="literal">False</span></span><br><span class="line">use_sample_prompt_txt_self = <span class="literal">False</span></span><br></pre></td></tr></table></figure><ul><li><p>创建训练时的文件夹</p><p>这里我要输出的模型为TLailin，所以就直接写上了，如果你要更改的话，后面对应的TLailin也都要更改上，输入后启动运行，然后可以在这里上传之前的已准备好的图片和Tagger文件到这里</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mkdir -pv /content/lora-scripts/train/TLailin/6_TLailin</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683168591611.jpg" alt=""></p><ul><li>安装依赖环境(这里等待的时间会比较长)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">!sudo apt-get update -y &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">!sudo apt-get install python3<span class="number">.10</span> &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment">#change alternatives 首选py3.9</span></span><br><span class="line">!sudo update-alternatives --install /usr/<span class="built_in">bin</span>/python3 python3 /usr/<span class="built_in">bin</span>/python3<span class="number">.9</span> <span class="number">1</span>  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">!sudo update-alternatives --install /usr/<span class="built_in">bin</span>/python3 python3 /usr/<span class="built_in">bin</span>/python3<span class="number">.10</span> <span class="number">2</span>  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment">#check python version 查看版本 #3.10</span></span><br><span class="line">!python --version</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;python升级中&quot;</span>)</span><br><span class="line"><span class="comment"># install pip for new python 为py3.10安装pip</span></span><br><span class="line">!sudo apt-get install python3<span class="number">.10</span>-distutils  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">!wget https://bootstrap.pypa.io/get-pip.py  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">!python get-pip.py  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment">#install colab&#x27;s dependencies 安装colab依赖</span></span><br><span class="line">!python -m pip install ipython ipython_genutils ipykernel jupyter_console prompt_toolkit httplib2 astor  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment"># link to the old google package 将py3.9的谷歌依赖连接至3.10</span></span><br><span class="line">!ln -s /usr/local/lib/python3<span class="number">.9</span>/dist-packages/google \</span><br><span class="line">/usr/local/lib/python3<span class="number">.10</span>/dist-packages/google  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;python升级完成 1/6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#这是一个备份更新python3.10.6的方式</span></span><br><span class="line"><span class="comment">#切换到python3.10</span></span><br><span class="line"><span class="comment">#!wget https://github.com/korakot/kora/releases/download/v0.10/py310.sh</span></span><br><span class="line"><span class="comment">#!bash ./py310.sh -b -f -p /usr/local</span></span><br><span class="line"><span class="comment">#!python -m ipykernel install --name &quot;py310&quot; --user</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###################################################################################</span></span><br><span class="line"><span class="comment">#安装相关环境</span></span><br><span class="line"></span><br><span class="line">pip_all_number = <span class="number">7</span></span><br><span class="line">pip_count = <span class="number">2</span></span><br><span class="line"><span class="comment">#安装aria2</span></span><br><span class="line">!apt -qq install liblz4-tool aria2  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment">#安装其他依赖</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;其他依赖安装中，此步耗时较长，请耐心等待&quot;</span>)</span><br><span class="line">%cd /content/lora-scripts/sd-scripts/</span><br><span class="line">!pip -q install --upgrade -r requirements.txt  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;其他依赖安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"><span class="comment">#安装兼容torch1.14.1的torchvision0.14.1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;torchvision安装中&quot;</span>)</span><br><span class="line">!pip -q install torchvision==<span class="number">0.14</span><span class="number">.1</span>  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;torchvision-0.14.1安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"><span class="comment">#安装xformers 0.0.16版本</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;xformers安装中&quot;</span>)</span><br><span class="line">!pip -q install xformers==<span class="number">0.0</span><span class="number">.16</span>  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;xformers-0.0.16安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"><span class="comment">#安装Triton</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;triton安装中&quot;</span>)</span><br><span class="line">!pip -q install triton==<span class="number">2.0</span><span class="number">.0</span>.dev20221202  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Triton安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"><span class="comment">#安装lion优化器、lycoris</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;lion优化器、lycoris安装中&quot;</span>)</span><br><span class="line">!pip -q install --upgrade lion-pytorch lycoris-lora  &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;lion优化器、lycoris安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"><span class="comment">#安装Dadaption优化器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Dadaption优化器安装中&quot;</span>)</span><br><span class="line">!pip -q install dadaptation   &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Dadaption优化器安装完成 <span class="subst">&#123;pip_count&#125;</span>/<span class="subst">&#123;pip_all_number&#125;</span>&quot;</span>)</span><br><span class="line">pip_count+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#############################</span></span><br><span class="line"><span class="comment">#开启tensorboard</span></span><br><span class="line">%load_ext tensorboard</span><br></pre></td></tr></table></figure><ul><li>下载训练底模，点击选择就可以了，不是很了解的话直接运行就可以</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title ### 6.1 下载模型</span></span><br><span class="line">installModels = []</span><br><span class="line">installv2Models = []</span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown ####**选择优先级从上到下，比如说你想自定义链接，则需要保持两个预设模型为空**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown **预设剪枝模型（`Animefull-final-pruned`即NovelAI官模 ， `Stable-Diffusion-v1-5`即SD1.5）**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown SD1.x model</span></span><br><span class="line">modelName = <span class="string">&quot;Animefull-final-pruned&quot;</span>  <span class="comment"># @param [&quot;&quot;, &quot;Animefull-final-pruned&quot;, &quot;Stable-Diffusion-v1-5&quot;, &quot;Anything-v3-1&quot;, &quot;AnyLoRA&quot;, &quot;AnimePastelDream&quot;, &quot;Chillout-mix&quot;, &quot;OpenJourney-v4&quot;]</span></span><br><span class="line"><span class="comment">#@markdown SD2.x model</span></span><br><span class="line">v2ModelName = <span class="string">&quot;&quot;</span>  <span class="comment"># @param [&quot;&quot;, &quot;stable-diffusion-2-1-base&quot;, &quot;stable-diffusion-2-1-768v&quot;, &quot;plat-diffusion-v1-3-1&quot;, &quot;replicant-v1&quot;, &quot;illuminati-diffusion-v1-0&quot;, &quot;illuminati-diffusion-v1-1&quot;, &quot;waifu-diffusion-1-4-anime-e2&quot;, &quot;waifu-diffusion-1-5-e2&quot;, &quot;waifu-diffusion-1-5-e2-aesthetic&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown **自定义模型链接例如`https://huggingface.co/a1079602570/animefull-final-pruned/resolve/main/novelailatest-pruned.ckpt`）**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown **或者自定义模型路径例如`/content/drive/MyDrive/Lora/model/your_model.ckpt`**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown **如果连接或者路径中包含模型的扩展名(比如我给出的两个例如的末尾都有扩展名)，则会自动指定，否则你需要手动选择**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown - **注意，Colab普通用户仅能选择5G以下的模型**</span></span><br><span class="line"></span><br><span class="line">base_model_url = <span class="string">&quot;https://civitai.com/api/download/models/37521&quot;</span> <span class="comment">#@param &#123;type:&quot;string&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">base_model_self_dir = <span class="string">&quot;&quot;</span> <span class="comment">#@param &#123;type:&quot;string&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">base_model_extension = <span class="string">&quot;ckpt&quot;</span> <span class="comment">#@param [&quot;ckpt&quot;, &quot;safetensors&quot;, &quot;pt&quot;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">modelUrl = [</span><br><span class="line">    <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Linaqruf/personal-backup/resolve/main/models/animefull-final-pruned.ckpt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/cag/anything-v3-1/resolve/main/anything-v3-1.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Lykon/AnyLoRA/resolve/main/AnyLoRA_noVae_fp16.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Lykon/AnimePastelDream/resolve/main/AnimePastelDream_Soft_noVae_fp16.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Linaqruf/stolen/resolve/main/pruned-models/chillout_mix-pruned.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/prompthero/openjourney-v4/resolve/main/openjourney-v4.ckpt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Linaqruf/stolen/resolve/main/pruned-models/stable_diffusion_1_5-pruned.safetensors&quot;</span>,</span><br><span class="line">]</span><br><span class="line">modelList = [</span><br><span class="line">    <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Animefull-final-pruned&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Anything-v3-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;AnyLoRA&quot;</span>,</span><br><span class="line">    <span class="string">&quot;AnimePastelDream&quot;</span>,    </span><br><span class="line">    <span class="string">&quot;Chillout-mix&quot;</span>,</span><br><span class="line">    <span class="string">&quot;OpenJourney-v4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Stable-Diffusion-v1-5&quot;</span>,</span><br><span class="line">]</span><br><span class="line">v2ModelUrl = [</span><br><span class="line">    <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/stabilityai/stable-diffusion-2-1-base/resolve/main/v2-1_512-ema-pruned.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/stabilityai/stable-diffusion-2-1/resolve/main/v2-1_768-ema-pruned.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/p1atdev/pd-archive/resolve/main/plat-v1-3-1.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/gsdf/Replicant-V1.0/resolve/main/Replicant-V1.0.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/IlluminatiAI/Illuminati_Diffusion_v1.0/resolve/main/illuminati_diffusion_v1.0.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/4eJIoBek/Illuminati-Diffusion-v1-1/resolve/main/illuminatiDiffusionV1_v11.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/hakurei/waifu-diffusion-v1-4/resolve/main/wd-1-4-anime_e2.ckpt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/waifu-diffusion/wd-1-5-beta2/resolve/main/checkpoints/wd-1-5-beta2-fp32.safetensors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/waifu-diffusion/wd-1-5-beta2/resolve/main/checkpoints/wd-1-5-beta2-aesthetic-fp32.safetensors&quot;</span>,</span><br><span class="line">]</span><br><span class="line">v2ModelList = [</span><br><span class="line">    <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stable-diffusion-2-1-base&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stable-diffusion-2-1-768v&quot;</span>,</span><br><span class="line">    <span class="string">&quot;plat-diffusion-v1-3-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;replicant-v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;illuminati-diffusion-v1-0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;illuminati-diffusion-v1-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;waifu-diffusion-1-4-anime-e2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;waifu-diffusion-1-5-e2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;waifu-diffusion-1-5-e2-aesthetic&quot;</span>,</span><br><span class="line">]</span><br><span class="line"><span class="keyword">if</span> modelName:</span><br><span class="line">    installModels.append((modelName, modelUrl[modelList.index(modelName)]))</span><br><span class="line"><span class="keyword">if</span> v2ModelName:</span><br><span class="line">    installv2Models.append((v2ModelName, v2ModelUrl[v2ModelList.index(v2ModelName)]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#下载路径</span></span><br><span class="line">base_model_dir = <span class="string">&quot;/content/lora-scripts/sd-models/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#检查连接是否含有扩展名信息，不含有则由用户指定</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_ext</span>(<span class="params">url</span>):</span><br><span class="line">  <span class="keyword">if</span> url.endswith(<span class="string">&quot;.ckpt&quot;</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ckpt&quot;</span></span><br><span class="line">  <span class="keyword">elif</span> url.endswith(<span class="string">&quot;.safetensors&quot;</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;safetensors&quot;</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> base_model_extension</span><br><span class="line"><span class="comment">#下载模型</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">install</span>(<span class="params">checkpoint_name, url</span>):</span><br><span class="line">    ext = check_ext(url)</span><br><span class="line">    hf_token = <span class="string">&quot;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&quot;</span></span><br><span class="line">    user_header = <span class="string">f&#x27;&quot;Authorization: Bearer <span class="subst">&#123;hf_token&#125;</span>&quot;&#x27;</span></span><br><span class="line">    !aria2c --console-log-level=error --summary-interval=<span class="number">10</span> --header=&#123;user_header&#125; -c -x <span class="number">16</span> -k 1M -s <span class="number">16</span> -d &#123;base_model_dir&#125; -o &#123;checkpoint_name&#125;.&#123;ext&#125; &#123;url&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;checkpoint_name&#125;</span>.<span class="subst">&#123;ext&#125;</span>&quot;</span>   <span class="comment">#返回模型名称</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">install_checkpoint</span>():</span><br><span class="line">    <span class="keyword">for</span> model <span class="keyword">in</span> installModels:</span><br><span class="line">        <span class="keyword">return</span> install(model[<span class="number">0</span>], model[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">for</span> v2model <span class="keyword">in</span> installv2Models:</span><br><span class="line">        <span class="keyword">return</span> install(v2model[<span class="number">0</span>], v2model[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#尝试下载预设模型</span></span><br><span class="line">base_model_name = install_checkpoint()</span><br><span class="line"><span class="comment">#预设下载成功，则完成路径修改</span></span><br><span class="line"><span class="keyword">if</span> base_model_name:</span><br><span class="line">  pretrained_model = base_model_dir + base_model_name</span><br><span class="line"><span class="comment">#下载失败，base_model_name为non</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="comment">#不留空，则尝试用连接下载</span></span><br><span class="line">  <span class="keyword">if</span> base_model_url:</span><br><span class="line">    base_model_name = <span class="string">&quot;download.&quot;</span> + check_ext(base_model_url)</span><br><span class="line">    pretrained_model = base_model_dir + base_model_name</span><br><span class="line">    !aria2c --console-log-level=error --summary-interval=<span class="number">10</span> -c -x <span class="number">16</span> -k 1M -s <span class="number">16</span> -d &#123;base_model_dir&#125; -o &#123;base_model_name&#125; --allow-overwrite &#123;base_model_url&#125;</span><br><span class="line">  <span class="comment">#留空，将考虑从自定义路径中拷贝</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> base_model_self_dir:</span><br><span class="line">      base_model_name = <span class="string">&quot;self.&quot;</span> + check_ext(base_model_self_dir)</span><br><span class="line">      pretrained_model = base_model_dir + base_model_name</span><br><span class="line">      !cp &#123;base_model_self_dir&#125; &#123;pretrained_model&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;你根本没选择任何模型！&quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment">#修改train.sh的底模路径，并输出信息</span></span><br><span class="line">search_input(<span class="string">&quot;pretrained_model&quot;</span>, pretrained_model)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出模型信息</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;你选择的是: <span class="subst">&#123;base_model_name&#125;</span> 模型&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li>指定使用的外挂Vae，还是一样，不了解的话直接选我推荐的anime然后直接运行即可</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @title ## 6.2 下载vae（可选）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#储存下载信息参数</span></span><br><span class="line">installVae = []</span><br><span class="line"><span class="comment">#@markdown 选择 `none` 意味着不使用vae</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown 选择一个Vae下载并使用`&quot;animevae.pt&quot;, &quot;kl-f8-anime.ckpt&quot;, &quot;vae-ft-mse-840000-ema-pruned.ckpt&quot;`</span></span><br><span class="line"></span><br><span class="line">vaeUrl = [</span><br><span class="line">    <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/Linaqruf/personal-backup/resolve/main/vae/animevae.pt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/hakurei/waifu-diffusion-v1-4/resolve/main/vae/kl-f8-anime.ckpt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://huggingface.co/stabilityai/sd-vae-ft-mse-original/resolve/main/vae-ft-mse-840000-ema-pruned.ckpt&quot;</span>,</span><br><span class="line">]</span><br><span class="line">vaeList = [<span class="string">&quot;none&quot;</span>, <span class="string">&quot;anime.vae.pt&quot;</span>, <span class="string">&quot;waifudiffusion.vae.pt&quot;</span>, <span class="string">&quot;stablediffusion.vae.pt&quot;</span>]</span><br><span class="line">vaeName = <span class="string">&quot;anime.vae.pt&quot;</span>  <span class="comment"># @param [&quot;none&quot;, &quot;anime.vae.pt&quot;, &quot;waifudiffusion.vae.pt&quot;, &quot;stablediffusion.vae.pt&quot;]</span></span><br><span class="line"></span><br><span class="line">installVae.append((vaeName, vaeUrl[vaeList.index(vaeName)]))</span><br><span class="line"></span><br><span class="line"><span class="comment">#开始下载</span></span><br><span class="line">vae_dir = <span class="string">&quot;/content/lora-scripts/vae/&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">install</span>(<span class="params">vae_name, url</span>):</span><br><span class="line">    hf_token = <span class="string">&quot;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&quot;</span></span><br><span class="line">    user_header = <span class="string">f&#x27;&quot;Authorization: Bearer <span class="subst">&#123;hf_token&#125;</span>&quot;&#x27;</span></span><br><span class="line">    !aria2c --console-log-level=error --allow-overwrite --summary-interval=<span class="number">10</span> --header=&#123;user_header&#125; -c -x <span class="number">16</span> -k 1M -s <span class="number">16</span> -d &#123;vae_dir&#125; -o <span class="string">&quot;vae.pt&quot;</span> <span class="string">&quot;&#123;url&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">install_vae</span>():</span><br><span class="line">    <span class="keyword">if</span> vaeName != <span class="string">&quot;none&quot;</span>:</span><br><span class="line">        <span class="keyword">for</span> vae <span class="keyword">in</span> installVae:</span><br><span class="line">            install(vae[<span class="number">0</span>], vae[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">install_vae()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extArgs_content.vae = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#修改train.sh中参数</span></span><br><span class="line"><span class="keyword">if</span> vaeName == <span class="string">&quot;none&quot;</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;不使用vae&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;使用<span class="subst">&#123;vaeName&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="comment">#写入采样地址f&quot;--vae=&#123;vae_dir&#125;&quot;</span></span><br><span class="line">  extArgs_content.vae += <span class="string">f&quot;\&quot;--vae=<span class="subst">&#123;vae_dir&#125;</span>vae.pt\&quot; &quot;</span></span><br><span class="line"></span><br><span class="line">search_input(<span class="string">&quot;&quot;</span>, extArgs_content.<span class="built_in">all</span>() )</span><br></pre></td></tr></table></figure><ul><li>修改脚本运行参数</li></ul><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683169164742.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是要修改的配置,没有注释的话就直接跟着我复制更改进去就可以</span></span><br><span class="line">train_data_dir=<span class="string">&quot;/content/lora-scripts/train/TLailin/&quot;</span><span class="comment">#这里改成刚才创建文件夹的名字</span></span><br><span class="line">resolution=<span class="string">&quot;512,512&quot;</span><span class="comment"># 这里改成你准备的图片的分辨率</span></span><br><span class="line">batch_size=<span class="number">1</span></span><br><span class="line">max_train_epoches=<span class="number">20</span></span><br><span class="line">output_name=<span class="string">&quot;TLailin&quot;</span><span class="comment"># 想要输出的模型名</span></span><br><span class="line"></span><br><span class="line">min_bucket_reso=<span class="number">256</span></span><br><span class="line">max_bucket_reso=<span class="number">1920</span></span><br><span class="line"><span class="comment"># 这两个参数是要根据你准备的图片的分辨率来调的,max的可以直接拉到最高1920，但是min是要在你的最低分辨率往下或者一样,比如说我现在准备的图片分辨率是1280,1408，那么这里我的min_bucket_reso最高就只能填1280</span></span><br></pre></td></tr></table></figure><ul><li>输入启动开始运行</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title  ### 8.2开始训练</span></span><br><span class="line"><span class="comment">#@markdown 若正确运行，训练完成后，模型会自动保存至你的谷歌硬盘中`我的云端硬盘/Lora/output/`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown 如果不到1分钟就运行完了，多半是出错了，把输出信息复制到ChatGPT问下罢！ :(</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown - Q：输出代码的最后出现（kill:9）字样 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown - A：爆ram了，更换小的底模</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown ---</span></span><br><span class="line"><span class="comment">#@markdown 是否保存本次训练的train.sh和采样配置（如果你启用采样功能的话）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#@markdown 保存路径： `留空则保存至当前train.sh中指定的输出路径`</span></span><br><span class="line">save_files = <span class="literal">True</span> <span class="comment">#@param &#123;type:&quot;boolean&quot;&#125;</span></span><br><span class="line">save_files_dir_self = <span class="string">&quot;&quot;</span> <span class="comment">#@param &#123;type:&quot;string&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> save_files:</span><br><span class="line">  <span class="comment">#指定保存路径</span></span><br><span class="line">  <span class="keyword">if</span> save_files_dir_self:</span><br><span class="line">    save_files_dir = save_files_dir_self</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;你指定了自定义的配置保存路径：<span class="subst">&#123;save_files_dir&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    save_files_dir = search_get(<span class="string">&quot;  --output_dir&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;采用trian.sh中指定的输出路径：<span class="subst">&#123;save_files_dir&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="comment">#保存训练参数文件至谷歌硬盘</span></span><br><span class="line">  !mkdir -p &#123;save_files_dir&#125;</span><br><span class="line">  !cp &#123;train_sh_path&#125; &#123;save_files_dir&#125;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;训练参数被保存至<span class="subst">&#123;save_files_dir&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="comment">#保存采样参数文件至谷歌硬盘</span></span><br><span class="line">  <span class="keyword">if</span> enable_sample <span class="keyword">or</span> use_sample_prompt_txt_self:</span><br><span class="line">    !cp &#123;sample_prompt_txt_path&#125; &#123;save_files_dir&#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;采样参数被保存至<span class="subst">&#123;save_files_dir&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;未启用采样功能，不保存采样配置&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;不保存配置文件&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#开始训练！</span></span><br><span class="line">%cd /content/lora-scripts/</span><br><span class="line">!bash train.sh</span><br><span class="line"></span><br><span class="line">!echo <span class="string">&quot;完成了 XXXD.&quot;</span></span><br></pre></td></tr></table></figure><p>后面就是漫长的等待啦</p><ul><li><p>这里要注意的是Colab一旦关闭就很大概率会连不上，连不上的话会重置笔记本，也就会前功尽弃，所以在运行的时候你要时刻保持着科学上网，而且要在控制台输入刷新代码防止中途给你卡出个验证</p></li><li><p>按F12开启控制台，选择Console，然后在最下面粘贴下面给出的代码并回车就可以了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function getElementByXpath(path) &#123;</span><br><span class="line">       <span class="keyword">return</span> document.evaluate(path, document, null, </span><br><span class="line">       XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">function reconnect()&#123;</span><br><span class="line">  console.log(<span class="string">&#x27;working&#x27;</span>)</span><br><span class="line">  getElementByXpath(<span class="string">&quot;//div[@id=&#x27;top-toolbar&#x27;]/colab-connect-button&quot;</span>).click()</span><br><span class="line">&#125;</span><br><span class="line">var a = setInterval(reconnect, <span class="number">1</span>*<span class="number">60</span>*<span class="number">1000</span>);</span><br><span class="line">function stop()&#123;</span><br><span class="line"> clearInterval(a)</span><br><span class="line">&#125;</span><br><span class="line">function start()&#123;</span><br><span class="line"> a = setInterval(reconnect, <span class="number">1</span>*<span class="number">60</span>*<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/%7B40I%5DMXKPDUHE@U2$SKAR_M.png" alt=""></p></li></ul></li></ol><h4 id="Lora的使用">Lora的使用</h4><p>把输出到google磁盘中的训练好的模型下载下来然后放在SD_ROOT/models/Lora目录下然后刷新Web UI界面就，Lora的使用只需要你点击<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683189185284.png" alt=""><br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683189426645.jpg" alt=""><br>然后点击自己的Lora模型，就会自动写入到正向提示词啦，其他的按平时的SD操作来就可以了。<br>这里我有上传自己的模型到C站中,分别是轻小说里的角色艾琳和沙季</p><style>.stars_box {    display: flex;    gap: 15px;    flex-wrap: wrap;    justify-content: center;}.stars_box .card_box {    margin: 0px !important}@media screen and (max-width: 768px) {    .stars_box{        padding: 0 5px    }    .stars_box .card_box {        width: calc(100%/2 - 8px) !important;        height: 240px !important;        margin: 8px 0 !important    }}html.hide-aside .layout > div:first-child {    width: 90%;}@media screen and (max-width: 768px).layout > div:first-child:not(.recent-posts) {    padding: 0px 14px !important;}.layout > div:first-child:not(.recent-posts) {    padding: 0px 12px!important;}</style><div class="stars_box"><div title="不时轻声地以俄语遮羞的邻座艾莉同学" referrerPolicy="no-referrer" class="card_box" style="background-image: url(https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1679060367555.png); width:200px; height:275px;">    <div class="card_mask">      <span>此作品博主暂未作出评价</span>      <a href="https://zh.moegirl.org.cn/%E4%B8%8D%E6%97%B6%E8%BD%BB%E5%A3%B0%E5%9C%B0%E4%BB%A5%E4%BF%84%E8%AF%AD%E9%81%AE%E7%BE%9E%E7%9A%84%E9%82%BB%E5%BA%A7%E8%89%BE%E8%8E%89%E5%90%8C%E5%AD%A6">查看详情</a>    </div>    <div class="card_top">      <i class=""></i>      <span>轻小说</span>    </div>    <div class="card_content">      <span>不时轻声地以俄语遮羞的邻座艾莉同学</span>      <div><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></div>    </div>  </div><div title="义妹生活" referrerPolicy="no-referrer" class="card_box" style="background-image: url(https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/qxssj.jpg); width:200px; height:275px;">    <div class="card_mask">      <span>此作品博主暂未作出评价</span>      <a href="https://zh.moegirl.org.cn/%E4%B9%89%E5%A6%B9%E7%94%9F%E6%B4%BB">查看详情</a>    </div>    <div class="card_top">      <i class=""></i>      <span>轻小说</span>    </div>    <div class="card_content">      <span>义妹生活</span>      <div><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></div>    </div>  </div></div><div class="note warning simple"><p>PS: 重要的事情说三遍！不要使用此模型画18+的图片！！！不要使用此模型画18+的图片！！！不要使用此模型画18+的图片！！</p></div><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1683190141926.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">Lora</div>  <p>分别是艾琳和绫濑沙季</p>  <a href='https://civitai.com/user/Tianlin/models'></a>  </figcaption>  </figure>  </div><div class="note warning simple"><p>本模型仅限于个人学习和非商业用途。作者提供的模型没有任何明示或暗示的保证和担保，作者不对任何由于使用本模型所引起的直接、间接、偶然、特殊及后果性损失或其他任何类型的损失承担责任。使用者应对使用本模型所引起的风险承担完全责任，作者不承担任何法律义务和赔偿责任</p></div><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>日志轮询</title>
      <link href="/posts/3f7ad5be.html"/>
      <url>/posts/3f7ad5be.html</url>
      
        <content type="html"><![CDATA[<h3 id="日志轮询">日志轮询</h3><h4 id="意义">意义</h4><ul><li>1.日志轮询可以确保系统日志文件不会无限增长，以免影响系统性能并占用过多的磁盘空间。通过定期轮询日志文件，旧的日志信息可以得到保留，从而为故障排除和性能分析提供重要的历史数据</li><li>2.日志轮询可以将日志文件分割为多个较小的文件，每个文件包含一段时间内的日志信息。这将使日志检索更加高效，因为只需要搜索特定时间段内的日志文件，而不需要搜索整个日志文件。这也有助于加快故障排除和性能分析的速度</li><li>3.日志轮询可以使日志管理和维护更加方便。由于每个日志文件都包含一段时间范围内的日志信息，因此可以轻松地对特定时间段内的日志进行备份、压缩、归档或删除。此外，日志轮询还可以帮助识别和修复日志文件中的错误或损坏</li></ul><h4 id="实操">实操</h4><ul><li>example<ul><li>日志文件/var/log/messages一月一轮询</li><li>日志文件大于10M时，直接主动进行轮询不需要考虑一月一轮询</li><li>保存5个备份文件</li><li>备份文件需要压缩<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chattr +a /var/log/messages</span></span><br><span class="line"><span class="comment"># vim /etc/logrotate.d/messages        # 定义轮询规则</span></span><br><span class="line">/var/log/<span class="section">messages</span> &#123;</span><br><span class="line">        <span class="attribute">monthly</span><span class="comment"># 每个月进行一次</span></span><br><span class="line">        size=<span class="number">8M</span><span class="comment"># 文件容量大于10M时开始轮询</span></span><br><span class="line">        rotate  <span class="number">5</span><span class="comment"># 保留五个文件</span></span><br><span class="line">        compress<span class="comment"># 进行压缩</span></span><br><span class="line">        sharedscripts</span><br><span class="line">        prerotate</span><br><span class="line">                /usr/bin/chattr -a /var/log/messages</span><br><span class="line">        endscript</span><br><span class="line">        sharedscripts</span><br><span class="line">        postrotate</span><br><span class="line">                /bin/kill -HUP `cat /var/run/syslogd.pid <span class="number">2</span>&gt;/dev/null` <span class="number">2</span>&gt;/dev/null || <span class="literal">true</span></span><br><span class="line">                /usr/bin/chattr +a /var/log/messages</span><br><span class="line">        endscript</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># logrotate -vf /etc/logrotate.conf   // 查看轮询</span></span><br><span class="line">// 可以通过别的文件重定向到/var/log/messages中让文件达到<span class="number">10M</span>大小测试轮询</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HTTP/3新优势</title>
      <link href="/posts/3b54fb61.html"/>
      <url>/posts/3b54fb61.html</url>
      
        <content type="html"><![CDATA[<h3 id="HTTP3">HTTP3</h3><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>HTTP/1.x</p>            </div><ul><li>开始便有了队头阻塞问题，请求头部未经压缩便发送，而且发送冗长的首部每次还会发出重复的为压缩头部报文。<ul><li>按顺序请求响应的，如果服务器响应慢会导致后面的数据阻塞。</li></ul><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>HTTP/2</p>            </div></li><li>头部压缩，HTTP/2 通过 Stream 的并发能力，解决了队头阻塞问题，但是却卡在了TCP这一层。<ul><li>TCP层必须保证收到的字节数据是完整且连续的如果当前字节没有到达时后面的字节只能暂时存放在缓冲区中等待这个字节到达，这就是HTTP2的队头阻塞问题。</li></ul><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>HTTP/3</p>            </div></li><li>使用了以不可靠传输协议UDP为基本的UQIC可靠协议。<ul><li>QUIC协议的某个流发生丢包时，只会阻塞这个流，其他流不会受到影响，因此不存在队头阻塞问题</li><li>更快的建立连接，比起HTTP2的首先要经过TCP握手然后再TLS握手，QUIC内部便包含了TLS，会在自己的帧中携带TLS里的&quot;记录&quot;,加上QUIC使用的是TLS1.3，所以连接的建立也会更快。</li></ul></li></ul><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>给友链页面添加一个Sakana~</title>
      <link href="/posts/e5482ed2.html"/>
      <url>/posts/e5482ed2.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h2 id="给hexo博客添加一个Sakana">给hexo博客添加一个Sakana~</h2></div></div><div class='checkbox'><input type="radio" />            <h3 id="来自开源项目itorr-sakana">来自开源项目<a href="https://github.com/itorr/sakana/">itorr/sakana</a></h3>            </div><div class='checkbox'><input type="radio" />            <p>同<a href="https://naokuoteng.cn/">脑阔疼ﻩ٥</a>一同制作完成</p>            </div><details class="folding-tag" cyan open orange><summary> 效果如下 </summary>              <div class='content'>              <div class="hide-block"><button type="button" class="hide-button" style="background-color: orange;">预览点我     </button><div class="hide-content"><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/sakana.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div></div></div><div class="site-card-group"><a class="site-card" href="https://blog.linjiangyu.com/link/"><div class="img"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/saka.png"/></div><div class="info"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/><span class="title">Tianlin</span><span class="desc">我的站点</span></div></a></div>              </div>            </details><h3 id="教程">教程</h3><div class='checkbox'><input type="radio" />            <p>写入到root_blog\themes\butterfly\source\css\custom.css文件中并引用</p>            </div><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> <span class="selector-class">.sakana-box</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transform-origin</span>: <span class="number">100%</span> <span class="number">100%</span>; <span class="comment">/* 从右下开始变换 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sakana-box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">pointer-events</span>: none;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>)&#123;</span><br><span class="line">  <span class="selector-class">.sakana-box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>)&#123;</span><br><span class="line">  <span class="selector-tag">html</span> <span class="selector-class">.sakana-box</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: inherit;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">36%</span> <span class="number">160%</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;light&quot;</span>]</span> <span class="selector-class">.layout</span> &gt; <span class="selector-tag">div</span><span class="selector-pseudo">:first</span>-child<span class="selector-pseudo">:not</span>(<span class="selector-class">.recent-posts</span>) &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">8</span>);</span><br><span class="line">    -webkit-backdrop-<span class="attribute">filter</span>: none;</span><br><span class="line">    backdrop-<span class="attribute">filter</span>: none<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.layout</span> &gt; <span class="selector-tag">div</span><span class="selector-pseudo">:first</span>-child<span class="selector-pseudo">:not</span>(<span class="selector-class">.recent-posts</span>) &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">15</span>, <span class="number">15</span>, <span class="number">15</span>, .<span class="number">75</span>);</span><br><span class="line">    -webkit-backdrop-<span class="attribute">filter</span>: none;</span><br><span class="line">    backdrop-<span class="attribute">filter</span>: none<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">html</span><span class="selector-class">.hide-aside</span> <span class="selector-class">.layout</span> &gt; <span class="selector-tag">div</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class='checkbox'><input type="radio" />            <p>直接写入到root_blog\source\link\index.md文件中</p>            </div><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;sakana-box&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">&lt;script <span class="attribute">src</span>=&quot;https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/js/sakana.js<span class="string">&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">Sakana.init(&#123;</span></span><br><span class="line"><span class="string">  el:         &#x27;.sakana-box&#x27;,     // 启动元素 node 或 选择器</span></span><br><span class="line"><span class="string">  scale:      .5,                // 缩放倍数</span></span><br><span class="line"><span class="string">  canSwitchCharacter: true,      // 允许换角色</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><div class='checkbox'><input type="radio" />            <p>修改root_blog\themes\butterfly_config.yml</p>            </div><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line"><span class="string">+</span>    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/custom.css&quot;&gt;</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="attr">pjax:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br><span class="line"><span class="string">+</span>    <span class="bullet">-</span> <span class="string">/link/</span></span><br><span class="line">    <span class="comment"># - xxxx</span></span><br><span class="line">    <span class="comment"># - xxxx</span></span><br></pre></td></tr></table></figure><p>就可以得到一个Sakana了~</p><div class='checkbox'><input type="radio" />            <h3 id="这里我还给Heo的音乐播放器加上了">这里我还给<a href="https://github.com/zhheo/HeoMusic">Heo的音乐播放器</a>加上了</h3>            </div><details class="folding-tag" cyan open orange><summary> 效果如下 </summary>              <div class='content'>              <div class="hide-block"><button type="button" class="hide-button" style="background-color: orange;">预览点我     </button><div class="hide-content"><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1677466852471.png" alt=""></p></div></div><div class="site-card-group"><a class="site-card" href="https://music.linjiangyu.com/"><div class="img"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1677466852471.png"/></div><div class="info"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/><span class="title">心灵庇护所</span><span class="desc">我的站点</span></div></a></div>              </div>            </details><div class='checkbox'><input type="radio" />            <p>修改index.html文件</p>            </div><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon-precomposed&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;180x180&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./img/icon-r.webp&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;念念不忘 必有回响&quot;</span>&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">+  <span class="selector-tag">html</span> <span class="selector-class">.sakana-box</span>&#123;</span></span><br><span class="line"><span class="language-css">+    <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="language-css">+    <span class="attribute">right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">+    <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">+    <span class="attribute">transform-origin</span>: <span class="number">100%</span> <span class="number">100%</span>; <span class="comment">/* 从右下开始变换 */</span></span></span><br><span class="line"><span class="language-css">+  &#125;</span></span><br><span class="line"><span class="language-css">+  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">......</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/APlayer.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/Meting2.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">data-pjax</span> <span class="attr">src</span>=<span class="string">&quot;./js/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sakana-box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/gh/linjiangyu2/halo/js/sakana.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">+  <span class="comment">// 取消静音</span></span></span><br><span class="line"><span class="language-javascript">+  <span class="title class_">Sakana</span>.<span class="title function_">setMute</span>(<span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">+  <span class="comment">// 启动</span></span></span><br><span class="line"><span class="language-javascript">+  <span class="title class_">Sakana</span>.<span class="title function_">init</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">+    <span class="attr">el</span>:         <span class="string">&#x27;.sakana-box&#x27;</span>,     <span class="comment">// 启动元素 node 或 选择器</span></span></span><br><span class="line"><span class="language-javascript">+    <span class="attr">scale</span>:      <span class="number">.5</span>,                <span class="comment">// 缩放倍数</span></span></span><br><span class="line"><span class="language-javascript">+    <span class="attr">canSwitchCharacter</span>: <span class="literal">true</span>,      <span class="comment">// 允许换角色</span></span></span><br><span class="line"><span class="language-javascript">+  &#125;);</span></span><br><span class="line"><span class="language-javascript">+  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git add index.html</span></span><br><span class="line"><span class="comment"># git commit -m &#x27;none&#x27;</span></span><br><span class="line"><span class="comment"># git push</span></span><br></pre></td></tr></table></figure><p>推到github就可以了<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 魔改教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kvm-qemu虚拟化</title>
      <link href="/posts/2388a20a.html"/>
      <url>/posts/2388a20a.html</url>
      
        <content type="html"><![CDATA[<p>编写中…<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>缓存代理中间件squid</title>
      <link href="/posts/e56cd95.html"/>
      <url>/posts/e56cd95.html</url>
      
        <content type="html"><![CDATA[<div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="编译安装">编译安装</h3></div><div class="note default orange simple"><h4 id="编译参数">编译参数</h4></div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--preifx：指定安装路径</span><br><span class="line">--sysconfdir：指定配置文件目录</span><br><span class="line">--enable-arp-acl：可以在规则中设置为直接通过客户端MAC进行管理，防止客户端使用IP欺骗</span><br><span class="line">--enable-linux-netfilter：使用内核过滤</span><br><span class="line">--enable-linux-tproxy：支持透明模式</span><br><span class="line">--enable-async-io=100：异步I/O，提升存储性能，相当于 --enable-<span class="attribute">pthreads</span>   --enable-storeio=ufs,aufs</span><br><span class="line">--enable-err-language=<span class="string">&quot;Simplify_Chinese&quot;</span>：报错时显示的语音，这里指定为Chinese</span><br><span class="line">--enable-underscore：允许URL中有下划线</span><br><span class="line">--enable-<span class="literal">poll</span>：使用Poll()模式，提升性能</span><br><span class="line">--enable-gnuregex：使用GUN正则表达式</span><br></pre></td></tr></table></figure><div class="note default orange simple"><h4 id="编译">编译</h4></div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># useradd -r -s /sbin/nologin -M squid</span></span><br><span class="line"><span class="comment"># tar xf squid-release.tar.gz</span></span><br><span class="line"><span class="comment"># cd squid-release</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/usr/local/squid --sysconfdir=/usr/local/squid/conf --enable-arp-acl --enable-linux-netfilter --enable-linux-tproxy --enable-async-io=100 --enable-err-language=&quot;Simplify_Chinese&quot; --enable-underscore --enable-poll --enable-gnuregex</span></span><br><span class="line"><span class="comment"># make -j2 &amp;&amp; make install</span></span><br><span class="line"><span class="comment"># usradd -r -s /sbin/nologin -M squid</span></span><br><span class="line"><span class="comment"># chown -R squid. /usr/local/squid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/init.d/squid.sh</span></span><br><span class="line"><span class="attribute">export</span> SQUID_HOME=/usr/local/squid</span><br><span class="line">export PATH=<span class="variable">$&#123;SQUID_HOME&#125;</span>/sbin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># source !$</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><h4 id="unit">unit</h4></div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat &gt; /usr/lib/systemd/system/squid.service &lt;&lt;END</span></span><br><span class="line"><span class="comment"># /usr/lib/systemd/system/squid.service</span></span><br><span class="line"><span class="comment"># author: linjiangyu</span></span><br><span class="line"><span class="comment"># cc: https://creativecommons.org/licenses/by-nc-sa/4.0/</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=<span class="attribute">Unit</span> squid by linjiangyu</span><br><span class="line">Documentation=https://linjiangyu.com/squid</span><br><span class="line">After=network-online.target nss-lookup.target remote-fs.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=/usr/local/squid/var/run/squid.pid</span><br><span class="line">ExecStart=/usr/local/squid/sbin/squid -f /usr/local/squid/conf/squid.conf</span><br><span class="line">ExecReload=/bin/kill -s HUP <span class="variable">$MAINPID</span></span><br><span class="line">ExecStop=/bin/kill -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line">User=squid</span><br><span class="line">Group=squid</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">END</span><br></pre></td></tr></table></figure><div class="note default orange simple"><h4 id="服务启动前先修改一下配置文件让squid用户启动服务">服务启动前先修改一下配置文件让squid用户启动服务</h4></div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/local/squid/conf/squid.conf</span></span><br><span class="line"><span class="attribute">cache_effective_user</span>squid</span><br><span class="line">cache_effective_groupsquid</span><br><span class="line">cache_dir ufs /usr/local/squid/var/cache/squid <span class="number">100</span> <span class="number">16</span> <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl daemon-reload</span></span><br><span class="line"><span class="comment"># systemctl start squid.service</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>多线程解压缩之pigz</title>
      <link href="/posts/d932a11.html"/>
      <url>/posts/d932a11.html</url>
      
        <content type="html"><![CDATA[<div class="note default orange simple"><p>现在都是多核的高性能服务器，如果还一直单使用tar的话可就太捞了</p></div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y pigz</span></span><br></pre></td></tr></table></figure><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>Options</p>            </div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-<span class="attribute">b</span> 设置压缩块大小(default <span class="number">128k</span>)</span><br><span class="line">-d 解压</span><br><span class="line">-k 不删除原始文件</span><br><span class="line">-I 输出压缩目录</span><br><span class="line">-p 最大使用线程数</span><br><span class="line">-q 不输出信息</span><br><span class="line">-r 递归</span><br><span class="line">-S 使用sss后缀替换gz</span><br><span class="line">-v 显示解压缩过程</span><br></pre></td></tr></table></figure><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>Example</p>            </div><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar --use-compress-program=&quot;pigz -k -p4&quot; k.tar.gz ./k</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>swap使用过度后果</title>
      <link href="/posts/6f3762be.html"/>
      <url>/posts/6f3762be.html</url>
      
        <content type="html"><![CDATA[<p>###SWAP使用过多的后果</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">swap</span>是使用磁盘空间制作的交换分区，一般在机器的物理内存不够使用时才会把部分比较不活跃数据暂时缓存在<span class="keyword">swap</span>分区中</span><br></pre></td></tr></table></figure><ul><li>简单举一下例子<ul><li>在一个运维的交流群里面有人说他的1G内存服务器划分了8G的swap空间然后跑了<strong>gitlab</strong>和8个<strong>java</strong>服务和<strong>cicd</strong>(我纯路人)</li></ul></li></ul><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">不说Java服务的内存起伏了，就单聊聊这个gitlab，官方推荐的最低配置是<span class="number">2</span>核<span class="number">4</span>G才可以跑，我在虚拟机的测试中<span class="number">4</span>G也是远远不够给gitlab使用，个人感觉最少给个<span class="number">8</span>G才能勉强使用，毕竟启动便要<span class="number">2</span>G内存（使用docker安装的可能会偏低一些但是不会低到哪去）</span><br><span class="line"></span><br><span class="line">本来是在内存中都需要保底点说<span class="number">6</span>G的内存，在真实内存只有<span class="number">1</span>G的云服务器上和<span class="number">8</span>G的<span class="keyword">swap</span>空间，要怎么使用呢，其中<span class="number">5</span>G的内存需求<span class="number">8</span>G的<span class="keyword">swap</span>空间要怎么顶替，众所周知内存的速度无比的快，底部是磁盘存储的<span class="keyword">swap</span>要承担其中<span class="number">5</span>G内存空间的快速频繁的读写操作会导致机器的磁盘IO繁忙，自然便会极大降低操作系统的运行速率，甚至导致宕机，这也是为什么k8s禁止使用<span class="keyword">swap</span>的部分原因</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>cpio</title>
      <link href="/posts/35144386.html"/>
      <url>/posts/35144386.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="cpio">cpio</h3></div></div><div class="note default orange simple"><p>优点: 可以备份任何的文件</p><p>缺点: 需要配合别的命令才能实现</p></div><h4 id="command">command</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cpio <span class="literal">-ovcB</span> &gt; [<span class="type">file</span>|<span class="type">device</span>]        //备份</span><br><span class="line">cpio <span class="literal">-ivcdu</span> &lt; [<span class="type">file</span>|<span class="type">device</span>]       //还原</span><br><span class="line">cpio <span class="literal">-ivct</span> &lt; [<span class="type">file</span>|<span class="type">device</span>]        //查看</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份会使用到的参数</span></span><br><span class="line"><span class="literal">-o</span>   将数据复制输出到文件或设备上</span><br><span class="line"><span class="literal">-B</span>   让默认的blocks可以增加至<span class="number">5120</span>字节(默认是<span class="number">512</span>字节),可以让大文件的存储速度加快</span><br><span class="line"></span><br><span class="line"><span class="comment"># 还原会使用到的参数</span></span><br><span class="line"><span class="literal">-i</span>   将数据自文或设备复制出来</span><br><span class="line"><span class="literal">-d</span>   自动建立目录,使用cpio所备份的内容不见得会在同一层目录中,所以要让cpio在复制的时候可以自己创建目录</span><br><span class="line"><span class="literal">-u</span>   自动把新文件覆盖旧文件</span><br><span class="line"><span class="literal">-t</span>   配合<span class="literal">-i</span>查看以cpio建立的文件或设备的你内容</span><br><span class="line"><span class="literal">-v</span>   显示过程</span><br><span class="line"><span class="literal">-c</span>   以portable format方式存储</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>example:</p><p>备份/boot目录中的内容</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /</span></span><br><span class="line"><span class="comment"># find boot | cpio -ocvB &gt; /opt/boot.cpio       //打包</span></span><br><span class="line">这里绝对不能使用绝对路径(所以使用find命令的时候在/下运行出来就会是./PATH),要不然解包的时候cpio会自动把数据解包覆盖原目录</span><br><span class="line"><span class="comment"># cd</span></span><br><span class="line"><span class="comment"># cpio /opt/boot.cpio &lt; /opt/boot.cpio   //解包到当前目录</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>事实上cpio可以把一整个系统的数据完整的备份到光盘中</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / | cpio -ocvB &gt; /dev/st0     //备份</span></span><br><span class="line"><span class="comment"># cpio -idvc &lt; /dev/st0              //还原</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Linux基础 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>dd</title>
      <link href="/posts/a97191d.html"/>
      <url>/posts/a97191d.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="dd">dd</h3></div></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lsblk</span></span><br><span class="line">/dev/sdb10G</span><br><span class="line">/dev/sdc10G</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mkfs.xfs /dev/sdb</span> </span><br><span class="line">/dev/sdc是作为要复制的&quot;路径&quot;设备,不需要格式化成xfs文件系统,dd命令可以将源块设备的磁盘分区上扇区的数据整个复制,连同超级区块、启动扇区、元数据和UUID都会一致复制</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> /&#123;sdb,sdc&#125; -v</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mount /dev/sdb /sdb</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mounr /dev/sdc /sdc</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cp</span> -a /etc/. /sdb/</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdb of=/dev/sdc  //直接把/dev/sdb设备块复制到/dev/sdc,不指定bs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xfs_repair -L /dev/sdc      //让日志文件归零,清理一下日志</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xfs_admin -U `uuid` /dev/sdc    //重新指定一下UUID,因为使用<span class="built_in">dd</span>命令拷贝的时候连UUID也一并拷贝相同了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mount /dev/sdc /sdc        //查看一下复制过来的和/dev/sdb设备上的数据是否一致</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Linux基础 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>私人云盘之Alist</title>
      <link href="/posts/e7cd4481.html"/>
      <url>/posts/e7cd4481.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="Alist">Alist</h3></div></div><details class="folding-tag" ><summary> 预览 </summary>              <div class='content'>              <div class="hide-block"><button type="button" class="hide-button" style="background-color: orange;">效果预览     </button><div class="hide-content"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/temp/alist.jpg"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/temp/al.png"/></div></div></div></div>              </div>            </details><p>详情看<a href="https://alist.nn.ci/">Alist</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -fsSL <span class="string">&quot;https://alist.nn.ci/v3.sh&quot;</span> | bash -s install// 新手使用一键脚本安装是最简单的啦</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认运行在5244端口，我这里是基于域名的多https服务，后面可能会写上</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认二进制文件存放在了/opt/alist下，这里要获取一下初始密码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /opt/alist</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./alist admin  <span class="comment"># 会显示你的初始密码，记录起来</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>Alist默认支持了本地存储的挂载和多种当前比较流行的网盘挂载例如百度网盘，阿里云盘等等，但和我都没关系因为我使用的是天翼云盘</p></div><details class="folding-tag" cyan open><summary> 天翼云盘挂载 </summary>              <div class='content'>              <p>首先在pc网页端登陆上天翼云盘,设置好密码,进入到想要挂载的目录下，查看当前网址的最后一串数字便是文件夹ID<br>像我一样挂载的也是天翼云盘中alist下的目录，进入到alist目录然后查看</p><div class="hide-block"><button type="button" class="hide-button" style="background-color: orange;">预览    </button><div class="hide-content"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/temp/1669152925609.png"/></div></div></div></div><p>这里我遮掉的那部分就是文件夹ID了，记录下来下面要使用到<br>使用IP:5244或者你已经设置好了域名访问Web界面，Alist可以通过图形化后台管理在最下方点击登陆按之前获取的初始密码,登陆后可修改密码<br>点击Storages&gt;Add&gt;189Cloud<br>Mount Path 输入要挂载到的目录，比如我现在的alist目录中的文件全部要挂载到主目录下便填/，要挂载到主目录下的opt目录下便填/opt<br>Username 输入登陆的手机号<br>Password 输入账号密码<br>Rooy folder id 输入上面获得的文件夹ID<br>最后ADD添加启用便获得了一个私人的白嫖云盘啦,这里选择天翼云盘是因为支持在线浏览上传和下载，速度亲测平均10M/s</p>              </div>            </details><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
          <category> 演示 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> storage </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>safe-rm</title>
      <link href="/posts/87519fc9.html"/>
      <url>/posts/87519fc9.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>safe-rm</p></div></div><div class='checkbox orange checked'><input type="checkbox" checked="checked"/>            <p>看名字就能知道是什么了，安全的rm命令</p>            </div><div class="note default orange simple"><p>比rm命令增加的功能，skip Directory or file</p></div><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="safe-rm.tar.gz" href="https://alist.linjiangyu.com/d/Linux/safe-rm-0.12.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">safe-rm.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/safe-rm-0.12.tar.gz</p></div></a></div>              </div>            </details>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tar xf safe-rm.tar.gz</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> safe-rm-0.12</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">chown</span> root. safe-rm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> safe-rm /usr/local/bin/rm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/profile</span></span><br><span class="line">export PATH=/usr/local/bin:$PATH</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> /etc/profile</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>编写一下禁止删除的文件或文件夹</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">touch</span> /opt/t1                    // 测试文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/safe-rm.conf         // 这个文件是自己创建的,safe-rm会默认去找这个文件的规则</span></span><br><span class="line">/</span><br><span class="line">/*</span><br><span class="line">/etc</span><br><span class="line">/etc/*</span><br><span class="line">/usr</span><br><span class="line">/usr/local</span><br><span class="line">/usr/local/bin</span><br><span class="line">/usr/local/bin/*</span><br><span class="line">/root</span><br><span class="line">/root/*</span><br><span class="line">/opt/t1         # 为了测试</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">rm</span> -f /opt/t1</span>  </span><br><span class="line">safe-rm: skipping t1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">会无法删除,把/etc/safe-rm.conf中的/opt/t1删除后再<span class="built_in">rm</span> -f /opt/t1便可删除</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hadoop+spark+zookeeper+hive分布式集群搭建</title>
      <link href="/posts/b10cf3a3.html"/>
      <url>/posts/b10cf3a3.html</url>
      
        <content type="html"><![CDATA[<div class="timeline orange"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>大数据服务合集</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2022-09-01 <a href="https://linjiangyu.com/posts/b10cf3a3.html">hadoop+spark</a></p></div></div><div class='timeline-item-content'><p>hadoop+spark初识</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2022-11-11 <a href="https://linjiangyu.com/posts/b10cf3a3.html#zookeeper%E5%88%86%E5%B8%83%E5%BC%8F">zookeeper</a></p></div></div><div class='timeline-item-content'><p>向集群加入了zookeeper分布式</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2022-11-19 <a href="https://linjiangyu.com/posts/b10cf3a3.html#hive">hive</a></p></div></div><div class='timeline-item-content'><p>这里也写了适配CentOS6.x的配置</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2022-11-19 <a href="https://linjiangyu.com/posts/b10cf3a3.html#flume">flume</a></p></div></div><div class='timeline-item-content'><p>日志采集</p></div></div></div><details class="folding-tag" cyan orang open><summary> 大数据服务合集 </summary>              <div class='content'>              <p><span class='nota' data-nota='hadoop+spark+zookeeper+hive分布式集群'>大数据服务合集</span></p>              </div>            </details><p>2022-09-01hadoop和spark的初识<span class="hidden-anchor" id="referto_[1]"></span><sup class="reference"><a href="#referfrom_[1]">[1]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">hadoop and spark</span><span class="reference-title">参考资料</span></span></span><br>2022-11-11添加了zookeeper分布式<span class="hidden-anchor" id="referto_[2]"></span><sup class="reference"><a href="#referfrom_[2]">[2]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">zookeeper</span><span class="reference-title">参考资料</span></span></span><br>2022-11-19添加了结合Mariadb的hive数据库使用<span class="hidden-anchor" id="referto_[3]"></span><sup class="reference"><a href="#referfrom_[3]">[3]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">hive</span><span class="reference-title">参考资料</span></span></span></p><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://www.linjiangyu.com/2022/09/01/hadoop-spark%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%AD%E5%BB%BA/">hadoop and spark分布式</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[2]"></span><a class="reference-anchor" href="#referto_[2]">[2]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://www.linjiangyu.com/2022/11/11/hadoop-spark-zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">zookeeper</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[3]"></span><a class="reference-anchor" href="#referto_[3]">[3]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://www.linjiangyu.com/2022/11/18/hadoop-spark-zookeeper-hive%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">hive</a></div><p>hadoop+spark+zookeeper+hive分布式集群部署</p><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="环境准备">环境准备</h3></div></div><div class="note default orange simple"><p>环境的准备基于我写的初始化脚本,自用7.x系列的CentOS,老版本的就支持CentOS/Redhat6,7,8但是有点不完善，需要可以邮箱或者博客留言。</p></div><table><thead><tr><th style="text-align:center">os\ip</th><th style="text-align:center">hostname</th><th style="text-align:center">block</th></tr></thead><tbody><tr><td style="text-align:center">centos7.9 192.168.222.226</td><td style="text-align:center">master</td><td style="text-align:center">rsmanager,datanode,namenode.snamenode,nmanager</td></tr><tr><td style="text-align:center">centos7.9 192.168.222.227</td><td style="text-align:center">node1</td><td style="text-align:center">snamenode,nmnager,datanode</td></tr><tr><td style="text-align:center">centos7.9 192.168.222.228</td><td style="text-align:center">node2</td><td style="text-align:center">datanode,nmanager</td></tr></tbody></table><div class="tabs" id="初始化"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#初始化-1">旧版</button></li><li class="tab active"><button type="button" data-href="#初始化-2">新版(推荐)</button></li><li class="tab"><button type="button" data-href="#初始化-3">船新版</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="初始化-1"><div class='checkbox times red checked'><input type="checkbox" checked="checked"/>            <p>国外服务器托管代码，可能被墙</p>            </div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/linjiangyu2/K.git   //可能会拉不下来，多拉几次就下来了，因为托管代码的服务器是国外的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> K</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> README.md  //不会使用的要看一下这个文件，了解脚本需要输入的配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./ksh  //依次输入你自己的配置，第一次使用这个脚本一定要看README.md文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果需要有时候改IP地址图方便的话，直接把ksh这个二进制的脚本放在/usr/bin下，便可以在全局执行了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> ksh /usr/bin/ksh</span></span><br><span class="line">使用ksh初始化后，开始配置</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="初始化-2"><div class='checkbox orange checked'><input type="checkbox" checked="checked"/>            <p>本站托管代码放心食用</p>            </div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum install -y https://mirrors.linjiangyu.com/centos/tianlin-release.noarch-7-1.x86_64.rpm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum --enablerepo=<span class="string">&#x27;tianlin&#x27;</span> install -y ksh-5.0-1.x86_64</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /usr/share/K/README.md  //不会使用的要看一下这个文件，了解脚本需要输入的配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ksh  //依次输入你自己的配置，第一次使用这个脚本一定要看README.md文件</span></span><br><span class="line">使用ksh初始化后，继续下文配置</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="初始化-3"><div class='checkbox orange checked'><input type="checkbox" checked="checked"/>            <p>CDN托管放心食用</p>            </div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">wget https://cdn.staticaly.com/gh/linjiangyu2/K@master/ksh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">chmod</span> +x ./ksh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./ksh  //依次输入你自己的配置，第一次使用这个脚本一定要看https://github.com/linjiangyu2/K</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果需要有时候改IP地址图方便的话，直接把ksh这个二进制的脚本放在/usr/bin下，便可以在全局执行了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> ksh /usr/bin/ksh</span></span><br><span class="line">使用ksh初始化后，继续下文配置</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note default orange simple"><p>对应自己的IP地址，最好/etc/hosts的解析名和我一致，不然下面的配置文件需要自己对应自己的解析名修改</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="built_in">cat</span> &gt; /etc/hosts &lt;&lt;<span class="string">END</span></span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 </span><br><span class="line">192.168.222.226 master</span><br><span class="line">192.168.222.227 node1</span><br><span class="line">192.168.222.228 node2</span><br><span class="line">END</span><br><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="string">ssh-keygen -P &#x27;&#x27; -f ~/.ssh/id_rsa</span></span></span><br><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="string">for i in master node&#123;1..2&#125;;do ssh-copy-id $i;done</span></span></span><br><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="string">for i in node&#123;1..2&#125;;do rsync -av /etc/hosts root@$i:/etc/hosts;done</span></span></span><br><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="string">for i in master node&#123;1..2&#125;;do ssh $i yum install -y openssl-devel;done</span></span></span><br></pre></td></tr></table></figure><p>2.搭建</p><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="hadoop分布式">hadoop分布式</h3></div></div><h4 id="上传jdk和hadoop的tar包">上传jdk和hadoop的tar包</h4><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="hadoop-2.8.5.tar.gz" href="https://alist.linjiangyu.com/d/Linux/hadoop-2.8.5.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">hadoop-2.8.5.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/hadoop-2.8.5.tar.gz</p></div></a></div><div class="tag link"><a class="link-card" title="jdk-8u212-linux-x64.tar.gz" href="https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">jdk-8u212-linux-x64.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz</p></div></a></div>              </div>            </details><h4 id="配置">配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">  [master]# </span><span class="language-bash">tar xf hadoop...  //不知道你使用的版本，写了...，以下也是，tab键或者对应修改就可以</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">...是表示我不知道你使用的版本，自己改</span></span><br><span class="line">  [root@ master]# tar xf jdk...</span><br><span class="line">  [root@ master]# tar xf hadoop...</span><br><span class="line">  [root@ master]# mv hadoop... /opt/hadoop285</span><br><span class="line">  [root@ master]# mv jdk... /usr/local/jdk</span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/profile</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export HADOOP_HOME=/opt/hadoop285</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/sbin:$PATH</span><br><span class="line">export HADOOP_COMMON_LIB_NATIVE_DIR=$HADOOP_HOME/lib/native </span><br><span class="line">export HADOOP_OPTS=&quot;-Djava.library.path=$HADOOP_HOME/lib/native&quot;</span><br><span class="line">export LD_LIBRARY_PATH=$HADOOP_HOME/lib/native/:$LD_LIBRARY_PATH</span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> !$</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以下是自己直接写入配置，在master服务器上进行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /opt/hadoop285/etc/hadoop</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim hadoop-env.sh  //修改文件里面的<span class="built_in">export</span> JAVA_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>为</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim yarn-env.sh //修改前面有注释的<span class="built_in">export</span> JAVA_HOME为</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># vim core-site.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://master:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># vim hdfs-site.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/data/hdfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/data/hdfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># vim yarn-site.xml </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>master<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># cp mapred-site.xml.template mapred-site.xml</span><br><span class="line"># vim mapred-site.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim slaves</span></span><br><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>然后在master节点把配置发到各个节点</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[master]# </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /usr/local/jdk root@<span class="variable">$i</span>:/usr/local/;<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /opt/hadoop285 root@<span class="variable">$i</span>:/opt/;<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /etc/profile root@<span class="variable">$i</span>:/etc/profile;<span class="keyword">done</span></span></span><br><span class="line">然后到各个节点</span><br><span class="line">[node1,2]# source /etc/profile</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在node1,2上操作，最后在master操作</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hdfs namenode -format   //初始化</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> -d /opt/data   //此文件夹产生就是初始化成功</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在master上操作</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ master]# start-all.sh</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>最后可以在各个节点使用jps命令查看各自的部件</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ xxx]# jps</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>当然web界面也可以访问的，浏览器访问192.168.222.226:8088和192.168.222.226:50070(对应自己IP地址)</p></div><div class="note default orange simple"><p>来尝试运行一下第一个hadoop分布式任务吧</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ master]# hdfs dfs -put /etc/passwd /t1</span><br><span class="line">[root@ master]# hadoop jar /opt/hadoop285/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.8.5.jar wordcount /t1 /output/00</span><br><span class="line">[root@ master]# hdfs dfs -ls /output/00  //查看运行后的结果文件,运行后的数据在part-r-00000</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="spark分布式">spark分布式</h3></div></div><div class="note default orange simple"><p>下面开始搭建分布式spark</p></div><details class="folding-tag" cyan open><summary> 这里使用spark的3.3.0版本 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="spark-3.3.0-bin-hadoop3.tgz" href="https://alist.linjiangyu.com/d/Linux/spark-3.3.0-bin-hadoop3.tgz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">spark-3.3.0-bin-hadoop3.tgz</p><p class="url">https://alist.linjiangyu.com/d/Linux/spark-3.3.0-bin-hadoop3.tgz</p></div></a></div>              </div>            </details><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把spark包上传到机器上，然后到该包的目录，这里统一以spark-3.3.0-bin-hadoop3.tgz这个包为演示</span></span><br><span class="line">[root@ master]# tar xf spark-3.3.0-bin-hadoop3.tgz</span><br><span class="line">[root@ master]# mv spark-3.3.0-bin-hadoop3 /opt/spark</span><br><span class="line">[root@ master]# vim /etc/profile</span><br><span class="line">export PATH=/opt/spark/bin:/opt/spark/sbin:$PATH</span><br><span class="line">[root@ master]# cd /opt/spark/conf</span><br><span class="line">[root@ master]# mv spark-env.sh.template spark-env.sh</span><br><span class="line">[root@ master]# vim spark-env.sh</span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export HADOOP_CONF_DIR=/opt/hadoop285/etc/hadoop</span><br><span class="line">export SPARK_MASTER_IP=master   #对应自己的master机器IP或者master解析的域名，如果是按照我上面做的直接写master即可</span><br><span class="line">export SPARK_WORKER_MEMORY=1024m</span><br><span class="line">export SPARK_WORKER_CORES=2 </span><br><span class="line">export SPARK_EXECUTOR_MEMORY=1024m</span><br><span class="line">export SPARK_WORKER_INSTANCES=1</span><br><span class="line">export SOARK_MASTER_PORT=7077</span><br><span class="line">export SPARK_EXECUTOR_CORES=1</span><br><span class="line">SPARK_HISTORY_OPTS=&quot;-Dspark.history.fs.logDirectory=hdfs://master:9000/spark_logs&quot;</span><br><span class="line">[root@ master]# cp spark-defaults.conf.template spark-defaults.conf</span><br><span class="line">[root@ master]# vim spark-defaults.conf</span><br><span class="line">spark.master                     spark://master:7077</span><br><span class="line">spark.eventLog.enabled           true</span><br><span class="line">spark.eventLog.dir               hdfs://master:9000/spark_logs</span><br><span class="line">[root@ master]# vim slaves     //对应自己的三台主机IP地址或者解析的域名</span><br><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line">[root@ master]# cd /opt/spark/sbin</span><br><span class="line">[root@ master]# mv start-all.sh spark-start.sh</span><br><span class="line">[root@ master]# mv stop-all.sh spark-stop.sh</span><br><span class="line">[root@ master]# source /etc/profile</span><br><span class="line">[root@ master]# scp -r /opt/spark root@node1:/opt/</span><br><span class="line">[root@ master]# scp -r /opt/spark root@node2:/opt/</span><br><span class="line">[root@ master]# scp -r /etc/profile root@node1:/etc/</span><br><span class="line">[root@ master]# scp -r /etc/profile root@node2:/etc/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后在各工作节点执行命令</span></span><br><span class="line">[root@ node1,node2]# source /etc/profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在master节点执行</span></span><br><span class="line">[root@ master]# start-all.sh</span><br><span class="line">[root@ master]# hdfs dfs -mkdir /spark_logs</span><br><span class="line">[root@ master]# spark-start.sh  //启动spark集群</span><br><span class="line">[root@ master]# jps     //查看</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以上便搭建好了spark结合hadoop的分布式集群，spark也有自己的web界面，可以浏览器访问192.168.222.226:8080来查看(对应自己IP地址)</p></div><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="zookeeper分布式">zookeeper分布式</h3></div></div><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="apache-zookeeper-3.5.10.tar.gz" href="https://alist.linjiangyu.com/d/Linux/zookeeper-3.4.14.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">apache-zookeeper-3.5.10.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/zookeeper-3.4.14.tar.gz</p></div></a></div>              </div>            </details><div class="note default orange simple"><p>在master机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tar xf zookeeper*</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> zookeeper* /opt/zookeeper</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> /opt/zookeeper/conf/zoo_sample.cfg /opt/zookeeper/conf/zoo.cfg</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /opt/zookeeper/conf/zoo.cfg</span></span><br><span class="line">修改</span><br><span class="line">dataDir=/opt/data/zookeeper</span><br><span class="line">添加</span><br><span class="line">dataLogDir=/opt/data/zookeeper/logs</span><br><span class="line">server.1=master:2888:3888</span><br><span class="line">server.2=node1:2888:3888</span><br><span class="line">server.3=node2:2888:3888</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里对应自己的主机名</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在各机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> -p /opt/data/zookeeper/logs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> 1 &gt; /opt/data/zookeeper/myid             <span class="comment">#这里master对应上面的server.1 便要echo1,node1对应server.2便要echo 2,node3对应server.3便要echo 3</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在master机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/profile</span></span><br><span class="line">export ZOOKEEPER_HOME=/opt/zookeeper</span><br><span class="line">export PATH=$&#123;ZOOKEEPER_HOME&#125;/bin:$PATH</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /opt/zookeeper root@<span class="variable">$i</span>:/opt/;<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /etc/profile /etc/;<span class="keyword">done</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在各机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> /etc/profile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zkServer.sh start             <span class="comment">#这个命令最好使用多命令一起执行,就是多个机器的执行时间要差不多一直,因为zookeeper对时间的要求性很高和各种问题</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zkServer.sh status    <span class="comment"># 可以在各节点查看自己的角色是leader还是follower</span></span></span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="hive">hive</h3></div></div><h4 id="Mariadb">Mariadb</h4><div class="note default orange simple"><p>这里为了方便直接安装mariadb作为MySQL使用,CentOS7.x和CentOS6.x使用方法不同(为了朋友写了CentOS6的，泪目了),使用前提网络要能访问外网</p></div><div class="tabs" id="mariadb"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#mariadb-1">CentOS 7.x</button></li><li class="tab"><button type="button" data-href="#mariadb-2">CentOS 6.x</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="mariadb-1"><div class="tip sync"><p>CentOS 7.x</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install -y mariadb mariadb-server</span><br><span class="line">[root@master ~]# systemctl enable mariadb &amp;&amp; systemctl start mariadb</span><br><span class="line">[root@master ~]# mysqladmin password abcd1234</span><br><span class="line">[root@master ~]# mysql -uroot -pabcd1234 -e &quot;create user &#x27;root&#x27;@&#x27;%&#x27; identified by &#x27;abcd1234&#x27;;&quot; -e &quot;grant all privileges on *.* to &#x27;root&#x27;@&#x27;%&#x27;;&quot;</span><br><span class="line">[root@master ~]# mysql_secure_installation</span><br><span class="line">按顺序输入abcd1234,n,y,n,y,y</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="mariadb-2"><div class="tip sync"><p>CentOS 6.x</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mkdir /etc/yum.repos.d/bak</span><br><span class="line">[root@master ~]# mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak/</span><br><span class="line">[root@master ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/repo/CentOS-Base.repo &amp;&amp; yum install -y epel-release</span><br><span class="line">[root@master ~]# vim /etc/yum.repos.d/mariadb.repo</span><br><span class="line">[mariadb]</span><br><span class="line">name=MariaDB</span><br><span class="line">baseurl=https://mirrors.aliyun.com/mariadb/yum/10.4/centos6-amd64</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/mariadb/yum/RPM-GPG-KEY-MariaDB</span><br><span class="line">gpgcheck=1</span><br><span class="line">[root@master ~]# yum install -y mysql mysql-devel mysql-server</span><br><span class="line">[root@master ~]# service mysql start &amp;&amp; chkconfig --add mysql &amp;&amp; chkconfig mysql on</span><br><span class="line">[root@master ~]# mysqladmin password abcd1234</span><br><span class="line">[root@master ~]# mysql -uroot -pabcd1234 -e &quot;create user &#x27;root&#x27;@&#x27;%&#x27; identified by &#x27;abcd1234&#x27;;&quot; -e &quot;grant all privileges on *.* to &#x27;root&#x27;@&#x27;%&#x27;;&quot;</span><br><span class="line">[root@master ~]# mysql_secure_installation</span><br><span class="line">按顺序输入abcd1234,n,y,n,y,y</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="apache-hive-3.1.2-bin.tar.gz" href="https://alist.linjiangyu.com/d/Linux/apache-hive-3.1.2-bin.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">apache-hive-3.1.2-bin.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/apache-hive-3.1.2-bin.tar.gz</p></div></a></div>              </div>            </details><div class="note default orange simple"><p>把二进制包上传到master机器的opt目录下</p></div><h4 id="hive配置">hive配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cd /opt</span><br><span class="line">[root@master opt]# tar xf apache-hive-3.1.2-bin.tar.gz</span><br><span class="line">[root@master opt]# mv apache-hive-3.1.2-bin hive</span><br><span class="line">[root@master opt]# cd hive/conf</span><br><span class="line">[root@master conf]# cp -a hive-env.sh.template hive-env.sh</span><br><span class="line">[root@master conf]# vim hive-env.sh</span><br><span class="line">在最前面添加,这里对应好自己的目录</span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export HADOOP_HOME=/opt/hadoop285</span><br><span class="line">export HADOOP_CONF_DIR=$&#123;HADOOP_HOME&#125;/etc/hadoop</span><br><span class="line">export HADOOP_HEAPSIZE=1024</span><br><span class="line">export HIVE_HOME=/opt/hive</span><br><span class="line">export HIVE_CONF_DIR=$&#123;HIVE_HOME&#125;/conf</span><br><span class="line">export HIVE_AUX_JARS_PATH=$&#123;HIVE_HOME&#125;/lib</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@master conf]# vim hive-site.xml// 以下对应注释更改自己的配置</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这里对应填入自己主节点机器在hosts文件解析的域名，我是master，运行错误的话应该是你哪里的设置有问题就换成IP地址,后面对应的也就都换成IP地址--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://master:3306/hive?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--MySQL登陆用户--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--用户密码--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>abcd1234<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--这里对应解析第二台的hosts文件解析的域名--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>node1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server3.thrift.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server3.thrift.bind.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--这里对应解析第三台的hosts文件解析的域名--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>node2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master conf]# cp hive-log4j2.properties.template hive-log4j2.properties</span><br><span class="line">[root@master conf]# vim hive-log4j2.properties</span><br><span class="line">把INFO全部更改为ERROR</span><br><span class="line">[root@master conf]# vim /etc/profile</span><br><span class="line">export HIVE_HOME=/opt/hive</span><br><span class="line">export PATH=$&#123;HIVE_HOME&#125;/bin:$PATH</span><br><span class="line">[root@master conf]# source /etc/profile</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>上传连接MySQL需要的jar包</p></div><details class="folding-tag" cyan open><summary> mysql-connector-java-8.0.17.jar </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="mysql-connector-java-8.0.17.jar" href="https://alist.linjiangyu.com/d/Linux/mysql-connector-java-8.0.17.jar"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">mysql-connector-java-8.0.17.jar</p><p class="url">https://alist.linjiangyu.com/d/Linux/mysql-connector-java-8.0.17.jar</p></div></a></div>              </div>            </details><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mv  mysql-connector-java-8.0.17.jar /opt/hive/lib/</span><br><span class="line">[root@master ~]# cd /opt/hive/bin</span><br><span class="line">[root@master bin]# ./schematool -initSchema -dbType mysql// 初始化</span><br><span class="line">[root@master ~]# mysql -uroot -pabcd1234</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show tables from hive;// 有数据则初始化成功</span></span><br></pre></td></tr></table></figure><h4 id="连接操作测试">连接操作测试</h4><div class="note default orange simple"><p>hive的启动需要先启动hadoop和spark服务</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">start-all.sh &amp;&amp; spark-start.sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把服务放在不同节点测试连接数据库操作</span></span><br><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">scp -r /opt/hive root@node1:/opt/</span></span><br><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">scp -r /opt/hive root@node2:/opt/</span></span><br><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">scp /etc/profile root@node1:/etc/</span></span><br><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">scp /etc/profile root@node2:/etc/</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后在各节点上使用命令</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> /etc/profile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">回到master机器操作</span></span><br><span class="line"><span class="meta prompt_">[root@master]# </span><span class="language-bash">hiveserver2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重开终端开启一个可被另外节点连接的服务终端</span></span><br><span class="line">[root@master ~]# hive --service metastore</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里使用node1来连接,可能要等待久点才能起10000端口</span></span><br><span class="line"><span class="meta prompt_">[root@node1]# </span><span class="language-bash">beeline<span class="comment"># 依次自己尝试</span></span></span><br><span class="line"><span class="meta prompt_">beeline&gt; </span><span class="language-bash">!connect jdbc:hive2://master:10000</span></span><br><span class="line">Connecting to jdbc:hive2://master:10000</span><br><span class="line">Enter username for jdbc:hive2://master:10000: root</span><br><span class="line">Enter password for jdbc:hive2://master:10000: ***</span><br><span class="line">Connected to: Apache Hive (version 3.1.2)</span><br><span class="line">Driver: Hive JDBC (version 2.3.9)</span><br><span class="line">Transaction isolation: TRANSACTION_REPEATABLE_READ</span><br><span class="line">0: jdbc:hive2://master:10000&gt; show databases;</span><br><span class="line">+----------------+</span><br><span class="line">| database_name  |</span><br><span class="line">+----------------+</span><br><span class="line">| default        |</span><br><span class="line">+----------------+</span><br><span class="line">1 row selected (1.442 seconds)</span><br></pre></td></tr></table></figure><h4 id="表创建测试">表创建测试</h4><div class="note default orange simple"><p>在master机器上准备一下用到的txt文件,上传到hdfs文件系统</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[master@root ~]# vim t.txt</span><br><span class="line">1,linjiangyu,20</span><br><span class="line">2,lintian,20</span><br><span class="line">3,k,20</span><br><span class="line">[master@root ~]# hdfs dfs -mkdir /t</span><br><span class="line">[master@root ~]# hdfs dfs -put ./t.txt /t/</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>回到node1</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://master:10000&gt; create database k ;</span><br><span class="line">No rows affected (0.267 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://master:10000&gt; use k;</span><br><span class="line">No rows affected (0.078 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://master:10000&gt; create table k_user(kid int,kname string,kage int) row format delimited fields terminated by &#x27;,&#x27; location &#x27;/t&#x27;;</span><br><span class="line">No rows affected (0.558 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://master:10000&gt; show tables;</span><br><span class="line">+-----------+</span><br><span class="line">| tab_name  |</span><br><span class="line">+-----------+</span><br><span class="line">| k_user    |</span><br><span class="line">+-----------+</span><br><span class="line">1 row selected (0.114 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://master:10000&gt; select * from k_user;</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">| k_user.kid  | k_user.kname  | k_user.kage  |</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">| 1           | linjiangyu    | 20           |</span><br><span class="line">| 2           | lintian       | 20           |</span><br><span class="line">| 3           | k             | 20           |</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">3 rows selected (3.141 seconds)</span><br></pre></td></tr></table></figure><h3 id="flume">flume</h3><div class="note default orange simple"><p>貌似是日志收集应用</p></div><ul><li><p>把<a href="https://dlcdn.apache.org/flume/1.11.0/apache-flume-1.11.0-bin.tar.gz">apache-flume-bin.tar.gz</a>下载并上传到系统中</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar xf apache-flume-1.11.0-bin.tar.gz &amp;&amp; rm -f apache-flume-1.11.0-bin.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mv apache-flume* /usr/local/flume</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="attribute">export</span> FLUME_HOME=/usr/local/flume</span><br><span class="line">export PATH=<span class="variable">$&#123;FLUME_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># source /etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cd /usr/local/flume/conf/</span></span><br><span class="line"><span class="comment"># cp flume-env.sh.template flume-env.sh</span></span><br><span class="line"><span class="comment"># vim flume-env.sh</span></span><br><span class="line">// 在最上面添加</span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># vim netcat-logger.conf </span></span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = <span class="number">0.0.0.0</span></span><br><span class="line">a1.sources.r1.port = <span class="number">44444</span></span><br><span class="line">a1.sinks.k1.type = logger</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = <span class="number">1000</span></span><br><span class="line">a1.channels.c1.transactionCapacity = <span class="number">100</span></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line"><span class="comment"># flume-ng agent -n a1 -c ./ -f ./netcat-logger.conf -Dflume.root.logger=INFO,console  // 启动服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># yum install -y telnet</span></span><br><span class="line"><span class="comment"># telnet 127.0.0.1 44444</span></span><br><span class="line">  // 随便写点东西回车会有OK出现就行了</span><br></pre></td></tr></table></figure></li></ul><h3 id="sqoop">sqoop</h3><ol><li><p>下载包<a href="https://archive.apache.org/dist/sqoop/1.4.7/sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz">sqoop</a>放到/opt下</p></li><li><p>整</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tar xf sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> sqoop-1.4.7.bin__hadoop-2.6.0 sqoop</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> sqoop</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cp</span> conf/sqoop-env-template.sh conf/sqoop-env.sh</span></span><br><span class="line">export HADOOP_COMMON_HOME=/opt/hadoop285</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Set path to <span class="built_in">where</span> hadoop-*-core.jar is available</span></span><br><span class="line">export HADOOP_MAPRED_HOME=/opt/hadoop285</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">set</span> the path to <span class="built_in">where</span> bin/hbase is available</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">export</span> HBASE_HOME=</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Set the path to <span class="built_in">where</span> bin/hive is available</span></span><br><span class="line">export HIVE_HOME=/opt/hive</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Set the path <span class="keyword">for</span> <span class="built_in">where</span> zookeper config <span class="built_in">dir</span> is</span></span><br><span class="line">export ZOOCFGDIR=/opt/zookeeper/conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/profile</span></span><br><span class="line">export SQOOP_HOME=/opt/sqoop</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;SQOOP_HOME&#125;/lib</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/sbin:$&#123;HIVE_HOME&#125;/bin:$&#123;SQOOP_HOME&#125;/bin:$PATH</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> /etc/profile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cp</span> /opt/hive/lib/mysql-connector-java-8.0.17.jar /opt/sqoop/lib/</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim bin/configure-sqoop把文件全部替换为以下</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright 2011 The Apache Software Foundation</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Licensed to the Apache Software Foundation (ASF) under one</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">distributed with this work <span class="keyword">for</span> additional information</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;License&quot;</span>); you may not use this file except <span class="keyword">in</span> compliance</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">distributed under the License is distributed on an <span class="string">&quot;AS IS&quot;</span> BASIS,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">See the License <span class="keyword">for</span> the specific language governing permissions and</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">limitations under the License.</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is sourced <span class="keyword">in</span> by bin/sqoop to <span class="built_in">set</span> environment variables prior to</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">invoking Hadoop.</span></span><br><span class="line"></span><br><span class="line">bin=&quot;$1&quot;</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;bin&#125;&quot; ]; then</span><br><span class="line">  bin=`dirname $0`</span><br><span class="line">  bin=`cd $&#123;bin&#125; &amp;&amp; pwd`</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$SQOOP_HOME&quot; ]; then</span><br><span class="line">  export SQOOP_HOME=$&#123;bin&#125;/..</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">SQOOP_CONF_DIR=$&#123;SQOOP_CONF_DIR:-$&#123;SQOOP_HOME&#125;/conf&#125;</span><br><span class="line"></span><br><span class="line">if [ -f &quot;$&#123;SQOOP_CONF_DIR&#125;/sqoop-env.sh&quot; ]; then</span><br><span class="line">  . &quot;$&#123;SQOOP_CONF_DIR&#125;/sqoop-env.sh&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Find paths to our dependency systems. If they are <span class="built_in">unset</span>, use CDH defaults.</span></span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;HADOOP_COMMON_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -n &quot;$&#123;HADOOP_HOME&#125;&quot; ]; then</span><br><span class="line">    HADOOP_COMMON_HOME=$&#123;HADOOP_HOME&#125;</span><br><span class="line">  else</span><br><span class="line">    if [ -d &quot;/usr/lib/hadoop&quot; ]; then</span><br><span class="line">      HADOOP_COMMON_HOME=/usr/lib/hadoop</span><br><span class="line">    else</span><br><span class="line">      HADOOP_COMMON_HOME=$&#123;SQOOP_HOME&#125;/../hadoop</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;HADOOP_MAPRED_HOME&#125;&quot; ]; then</span><br><span class="line">  HADOOP_MAPRED_HOME=/usr/lib/hadoop-mapreduce</span><br><span class="line">  if [ ! -d &quot;$&#123;HADOOP_MAPRED_HOME&#125;&quot; ]; then</span><br><span class="line">    if [ -n &quot;$&#123;HADOOP_HOME&#125;&quot; ]; then</span><br><span class="line">      HADOOP_MAPRED_HOME=$&#123;HADOOP_HOME&#125;</span><br><span class="line">    else</span><br><span class="line">      HADOOP_MAPRED_HOME=$&#123;SQOOP_HOME&#125;/../hadoop-mapreduce</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">We are setting HADOOP_HOME to HADOOP_COMMON_HOME <span class="keyword">if</span> it is not <span class="built_in">set</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">so that hcat script works correctly on BigTop</span></span><br><span class="line">if [ -z &quot;$&#123;HADOOP_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -n &quot;$&#123;HADOOP_COMMON_HOME&#125;&quot; ]; then</span><br><span class="line">     HADOOP_HOME=$&#123;HADOOP_COMMON_HOME&#125;</span><br><span class="line">     export HADOOP_HOME</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;HBASE_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -d &quot;/usr/lib/hbase&quot; ]; then</span><br><span class="line">    HBASE_HOME=/usr/lib/hbase</span><br><span class="line">  else</span><br><span class="line">    HBASE_HOME=$&#123;SQOOP_HOME&#125;/../hbase</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line">if [ -z &quot;$&#123;HCAT_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -d &quot;/usr/lib/hive-hcatalog&quot; ]; then</span><br><span class="line">    HCAT_HOME=/usr/lib/hive-hcatalog</span><br><span class="line">  elif [ -d &quot;/usr/lib/hcatalog&quot; ]; then</span><br><span class="line">    HCAT_HOME=/usr/lib/hcatalog</span><br><span class="line">  else</span><br><span class="line">    HCAT_HOME=$&#123;SQOOP_HOME&#125;/../hive-hcatalog</span><br><span class="line">    if [ ! -d $&#123;HCAT_HOME&#125; ]; then</span><br><span class="line">       HCAT_HOME=$&#123;SQOOP_HOME&#125;/../hcatalog</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line">if [ -z &quot;$&#123;ACCUMULO_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -d &quot;/usr/lib/accumulo&quot; ]; then</span><br><span class="line">    ACCUMULO_HOME=/usr/lib/accumulo</span><br><span class="line">  else</span><br><span class="line">    ACCUMULO_HOME=$&#123;SQOOP_HOME&#125;/../accumulo</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line">if [ -z &quot;$&#123;ZOOKEEPER_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -d &quot;/usr/lib/zookeeper&quot; ]; then</span><br><span class="line">    ZOOKEEPER_HOME=/usr/lib/zookeeper</span><br><span class="line">  else</span><br><span class="line">    ZOOKEEPER_HOME=$&#123;SQOOP_HOME&#125;/../zookeeper</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line">if [ -z &quot;$&#123;HIVE_HOME&#125;&quot; ]; then</span><br><span class="line">  if [ -d &quot;/usr/lib/hive&quot; ]; then</span><br><span class="line">    export HIVE_HOME=/usr/lib/hive</span><br><span class="line">  elif [ -d $&#123;SQOOP_HOME&#125;/../hive ]; then</span><br><span class="line">    export HIVE_HOME=$&#123;SQOOP_HOME&#125;/../hive</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Check: If we can<span class="string">&#x27;t find our dependencies, give up here.</span></span></span><br><span class="line">if [ ! -d &quot;$&#123;HADOOP_COMMON_HOME&#125;&quot; ]; then</span><br><span class="line">  echo &quot;Error: $HADOOP_COMMON_HOME does not exist!&quot;</span><br><span class="line">  echo &#x27;Please set $HADOOP_COMMON_HOME to the root of your Hadoop installation.&#x27;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line">if [ ! -d &quot;$&#123;HADOOP_MAPRED_HOME&#125;&quot; ]; then</span><br><span class="line">  echo &quot;Error: $HADOOP_MAPRED_HOME does not exist!&quot;</span><br><span class="line">  echo &#x27;Please set $HADOOP_MAPRED_HOME to the root of your Hadoop MapReduce installation.&#x27;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># Moved to be a runtime check in sqoop.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">if [ ! -d &quot;$&#123;HBASE_HOME&#125;&quot; ]; then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &quot;Warning: $HBASE_HOME does not exist! HBase imports will fail.&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &#x27;</span>Please <span class="built_in">set</span> <span class="variable">$HBASE_HOME</span> to the root of your HBase installation.<span class="string">&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">fi</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">### Moved to be a runtime check in sqoop.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">if [ ! -d &quot;$&#123;HCAT_HOME&#125;&quot; ]; then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &quot;Warning: $HCAT_HOME does not exist! HCatalog jobs will fail.&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &#x27;</span>Please <span class="built_in">set</span> <span class="variable">$HCAT_HOME</span> to the root of your HCatalog installation.<span class="string">&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">fi</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#if [ ! -d &quot;$&#123;ACCUMULO_HOME&#125;&quot; ]; then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &quot;Warning: $ACCUMULO_HOME does not exist! Accumulo imports will fail.&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &#x27;</span>Please <span class="built_in">set</span> <span class="variable">$ACCUMULO_HOME</span> to the root of your Accumulo installation.<span class="string">&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">fi</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">if [ ! -d &quot;$&#123;ZOOKEEPER_HOME&#125;&quot; ]; then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &quot;Warning: $ZOOKEEPER_HOME does not exist! Accumulo imports will fail.&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> echo &#x27;</span>Please <span class="built_in">set</span> <span class="variable">$ZOOKEEPER_HOME</span> to the root of your Zookeeper installation.<span class="string">&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">fi</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Where to find the main Sqoop jar</span></span></span><br><span class="line">SQOOP_JAR_DIR=$SQOOP_HOME</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">If there&#x27;</span>s a <span class="string">&quot;build&quot;</span> subdir, override with this, so we use</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the newly-compiled copy.</span></span><br><span class="line">if [ -d &quot;$SQOOP_JAR_DIR/build&quot; ]; then</span><br><span class="line">  SQOOP_JAR_DIR=&quot;$&#123;SQOOP_JAR_DIR&#125;/build&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">function add_to_classpath() &#123;</span><br><span class="line">  dir=$1</span><br><span class="line">  for f in $dir/*.jar; do</span><br><span class="line">    SQOOP_CLASSPATH=$&#123;SQOOP_CLASSPATH&#125;:$f;</span><br><span class="line">  done</span><br><span class="line"></span><br><span class="line">  export SQOOP_CLASSPATH</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Add sqoop dependencies to classpath.</span></span><br><span class="line">SQOOP_CLASSPATH=&quot;&quot;</span><br><span class="line">if [ -d &quot;$SQOOP_HOME/lib&quot; ]; then</span><br><span class="line">  add_to_classpath $SQOOP_HOME/lib</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Add HBase to dependency list</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$HBASE_HOME</span>/bin/hbase&quot;</span> ]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> TMP_SQOOP_CLASSPATH=<span class="variable">$&#123;SQOOP_CLASSPATH&#125;</span>:`<span class="variable">$HBASE_HOME</span>/bin/hbase classpath`</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> SQOOP_CLASSPATH=<span class="variable">$&#123;TMP_SQOOP_CLASSPATH&#125;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">fi</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">## Add HCatalog to dependency list</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$&#123;HCAT_HOME&#125;</span>/bin/hcat&quot;</span> ]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> TMP_SQOOP_CLASSPATH=<span class="variable">$&#123;SQOOP_CLASSPATH&#125;</span>:`<span class="variable">$&#123;HCAT_HOME&#125;</span>/bin/hcat -classpath`</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$&#123;HIVE_CONF_DIR&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   TMP_SQOOP_CLASSPATH=<span class="variable">$&#123;TMP_SQOOP_CLASSPATH&#125;</span>:<span class="variable">$&#123;HIVE_CONF_DIR&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> <span class="keyword">fi</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> SQOOP_CLASSPATH=<span class="variable">$&#123;TMP_SQOOP_CLASSPATH&#125;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">fi</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Add Accumulo to dependency list</span></span><br><span class="line">if [ -e &quot;$ACCUMULO_HOME/bin/accumulo&quot; ]; then</span><br><span class="line">  for jn in `$ACCUMULO_HOME/bin/accumulo classpath | grep file:.*accumulo.*jar | cut -d&#x27;:&#x27; -f2`; do</span><br><span class="line">    SQOOP_CLASSPATH=$SQOOP_CLASSPATH:$jn</span><br><span class="line">  done</span><br><span class="line">  for jn in `$ACCUMULO_HOME/bin/accumulo classpath | grep file:.*zookeeper.*jar | cut -d&#x27;:&#x27; -f2`; do</span><br><span class="line">    SQOOP_CLASSPATH=$SQOOP_CLASSPATH:$jn</span><br><span class="line">  done</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">ZOOCFGDIR=$&#123;ZOOCFGDIR:-/etc/zookeeper&#125;</span><br><span class="line">if [ -d &quot;$&#123;ZOOCFGDIR&#125;&quot; ]; then</span><br><span class="line">  SQOOP_CLASSPATH=$ZOOCFGDIR:$SQOOP_CLASSPATH</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">SQOOP_CLASSPATH=$&#123;SQOOP_CONF_DIR&#125;:$&#123;SQOOP_CLASSPATH&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">If there<span class="string">&#x27;s a build subdir, use Ivy-retrieved dependencies too.</span></span></span><br><span class="line">if [ -d &quot;$SQOOP_HOME/build/ivy/lib/sqoop&quot; ]; then</span><br><span class="line">  for f in $SQOOP_HOME/build/ivy/lib/sqoop/*/*.jar; do</span><br><span class="line">    SQOOP_CLASSPATH=$&#123;SQOOP_CLASSPATH&#125;:$f;</span><br><span class="line">  done</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">add_to_classpath $&#123;SQOOP_JAR_DIR&#125;</span><br><span class="line"></span><br><span class="line">HADOOP_CLASSPATH=&quot;$&#123;SQOOP_CLASSPATH&#125;:$&#123;HADOOP_CLASSPATH&#125;&quot;</span><br><span class="line">if [ ! -z &quot;$SQOOP_USER_CLASSPATH&quot; ]; then</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"><span class="string">User has elements to prepend to the classpath, forcibly overriding</span></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"><span class="string">Sqoop&#x27;</span>s own lib directories.</span></span><br><span class="line">  export HADOOP_CLASSPATH=&quot;$&#123;SQOOP_USER_CLASSPATH&#125;:$&#123;HADOOP_CLASSPATH&#125;&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">export SQOOP_CLASSPATH</span><br><span class="line">export SQOOP_CONF_DIR</span><br><span class="line">export SQOOP_JAR_DIR</span><br><span class="line">export HADOOP_CLASSPATH</span><br><span class="line">export HADOOP_COMMON_HOME</span><br><span class="line">export HADOOP_MAPRED_HOME</span><br><span class="line">export HBASE_HOME</span><br><span class="line">export HCAT_HOME</span><br><span class="line">export HIVE_CONF_DIR</span><br><span class="line">export ACCUMULO_HOME</span><br><span class="line">export ZOOKEEPER_HOME</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mysql -uroot -p123</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant all privileges on *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure></li><li><p>测试连接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sqoop list-databases -connect jdbc:mysql://localhost:3306/ --username root --password 123</span></span><br><span class="line">输出</span><br><span class="line">23/05/20 23:14:23 INFO sqoop.Sqoop: Running Sqoop version: 1.4.7</span><br><span class="line">23/05/20 23:14:23 WARN tool.BaseSqoopTool: Setting your password on the command-line is insecure. Consider using -P instead.</span><br><span class="line">23/05/20 23:14:23 INFO manager.MySQLManager: Preparing to use a MySQL streaming resultset.</span><br><span class="line">Loading class `com.mysql.jdbc.Driver&#x27;. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver&#x27;. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.</span><br><span class="line">mysql</span><br><span class="line">information_schema</span><br><span class="line">performance_schema</span><br><span class="line">sys</span><br><span class="line">hive</span><br><span class="line">rsyslog</span><br><span class="line">Syslo</span><br></pre></td></tr></table></figure></li></ol><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ecy</title>
      <link href="/posts/d6542125.html"/>
      <url>/posts/d6542125.html</url>
      
        <content type="html"><![CDATA[<div class="tip warning faa-horizontal animated faa-fast"><p>网页视频素材</p></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/relife.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/02.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/aila.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/aill.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/ecy.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/ecysg.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/eee.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/gyx.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/jiojio.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/onepis.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/wzzs.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/video/plmm.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sersync2实时监控同步文件</title>
      <link href="/posts/f2af38d6.html"/>
      <url>/posts/f2af38d6.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>sesync的实时同步</p></div></div><div class="tag link"><a class="link-card" title="sesync2" href="https://alist.linjiangyu.com/d/Linux/sersync2.5.4_64bit_binary_stable_final.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">sesync2</p><p class="url">https://alist.linjiangyu.com/d/Linux/sersync2.5.4_64bit_binary_stable_final.tar.gz</p></div></a></div><div class="note default orange simple"><p>也要结合rsync和Inotify一起使用</p></div><table><thead><tr><th style="text-align:center">IP</th><th style="text-align:center">HOSTNAME</th></tr></thead><tbody><tr><td style="text-align:center">192.168.222.160</td><td style="text-align:center">master</td></tr><tr><td style="text-align:center">192.168.222.161</td><td style="text-align:center">backup</td></tr></tbody></table><div class="note default orange simple"><p>backup的rsyncd的配置</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y rsync</span></span><br><span class="line"><span class="comment"># vim /etc/rsyncd.conf</span></span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line"><span class="comment">#use chroot = yes</span></span><br><span class="line">max connections = <span class="number">0</span></span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">exclude = lost+found/</span><br><span class="line"><span class="comment">#transfer logging = yes</span></span><br><span class="line"><span class="comment">#timeout = 900</span></span><br><span class="line"><span class="comment">#ignore nonreadable = yes</span></span><br><span class="line"><span class="comment">#dont compress   = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2</span></span><br><span class="line">reverse lookup = no</span><br><span class="line"></span><br><span class="line">[<span class="type">backup</span>]</span><br><span class="line">       path = /opt      <span class="comment"># 共享的目录</span></span><br><span class="line">       comment = ftp export area </span><br><span class="line">       read only = no</span><br><span class="line">       auth users = lt         <span class="comment"># 登陆的用户名</span></span><br><span class="line">       secrets file = /etc/rsync.pas   <span class="comment"># 认证文件</span></span><br><span class="line"> <span class="comment"># 创建认证文件</span></span><br><span class="line"> <span class="comment"># echo &#x27;lt:123&#x27; &gt; /etc/rsync.pas</span></span><br><span class="line"> <span class="comment"># systemctl restart rsyncd</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>master的配置</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># yum install -y rsync inotify-tools</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># rsync rsync://192.168.222.161  //显示192.168.222.161服务器共享的rsyncd的名字</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># rsync rsync://lt@192.168.222.161/backup   //查看目录,也可以上传目录,但是也可以上传发送文件,但是是需要交互式输入密码认证的</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># echo 123 &gt; /etc/rsync.pas         //认证文件</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># rsync --password-file=/etc/rsync.pas lt@192.168.222.161::backup</span></span><br><span class="line">或者</span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># rsync --password-file=/etc/rsync.pas rsync://lt@192.168.222.161/backup</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># tar xf sersync* </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># mv sersync* /usr/local/sersync</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># vim /etc/profile</span></span><br><span class="line">export SERSYNC_HOME=/usr/local/sersync</span><br><span class="line">export PATH=<span class="variable">$</span>&#123;SERSYNC_HOME&#125;:<span class="variable">$PATH</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># source /etc/profile</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># cd /usr/local/sersync</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span>~]<span class="comment"># vim confxml.xml</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="line">&lt;head version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line">    &lt;host hostip=<span class="string">&quot;localhost&quot;</span> port=<span class="string">&quot;8008&quot;</span>&gt;&lt;/host&gt;</span><br><span class="line">    &lt;debug <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;fileSystem xfs=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="keyword">filter</span> <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;   &lt;!<span class="literal">--</span>&lt;是否开启过滤功能，为true的话设置以下的类型文件不同步 &gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;(.*)\.svn&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;(.*)\.gz&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;^info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;^static/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">    &lt;/<span class="keyword">filter</span>&gt;</span><br><span class="line">    &lt;inotify&gt;</span><br><span class="line">        &lt;delete <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;createFolder <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;createFile <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;      &lt;!<span class="literal">--</span>&lt;修改&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;closeWrite <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;moveFrom <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;moveTo <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;attrib <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;     &lt;!<span class="literal">--</span>&lt;修改&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;modify <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;/inotify&gt;</span><br><span class="line"></span><br><span class="line">    &lt;sersync&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/opt/&quot;</span>&gt;               &lt;!<span class="literal">--</span>&lt;监控的目录&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;remote ip=<span class="string">&quot;192.168.222.161&quot;</span> name=<span class="string">&quot;backup&quot;</span>/&gt;   &lt;!<span class="literal">--</span>&lt;修改目标IP地址,backup是共享出来的服务名称&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;remote ip=<span class="string">&quot;192.168.8.39&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;remote ip=<span class="string">&quot;192.168.8.40&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">        &lt;rsync&gt;</span><br><span class="line">            &lt;commonParams params=<span class="string">&quot;-artuz&quot;</span>/&gt;             &lt;!<span class="literal">--</span>&lt;rsync传输时间携带的参数&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;修改,开启才能修改,还有登陆的lt用户和认证的文件&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;auth <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span> users=<span class="string">&quot;lt&quot;</span> passwordfile=<span class="string">&quot;/etc/rsync.pas&quot;</span>/&gt;</span><br><span class="line">            &lt;userDefinedPort <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!<span class="literal">--</span> port=<span class="number">874</span> <span class="literal">--</span>&gt;</span><br><span class="line">            &lt;timeout <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> time=<span class="string">&quot;100&quot;</span>/&gt;&lt;!<span class="literal">--</span> timeout=<span class="number">100</span> <span class="literal">--</span>&gt;</span><br><span class="line">            &lt;ssh <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">        &lt;/rsync&gt;</span><br><span class="line">        &lt;failLog path=<span class="string">&quot;/tmp/rsync_fail_log.sh&quot;</span> timeToExecute=<span class="string">&quot;60&quot;</span>/&gt;&lt;!<span class="literal">--default</span> every <span class="number">60</span>mins execute once<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;crontab <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> schedule=<span class="string">&quot;600&quot;</span>&gt;&lt;!<span class="literal">--600mins--</span>&gt;</span><br><span class="line">            &lt;crontabfilter <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">                &lt;exclude expression=<span class="string">&quot;*.php&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">                &lt;exclude expression=<span class="string">&quot;info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">            &lt;/crontabfilter&gt;</span><br><span class="line">        &lt;/crontab&gt;</span><br><span class="line">        &lt;plugin <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;command&quot;</span>/&gt;</span><br><span class="line">    &lt;/sersync&gt;</span><br><span class="line">                                &lt;!<span class="literal">--</span>&lt;以下不需要修改 &gt;<span class="literal">--</span>&gt;</span><br><span class="line">    &lt;plugin name=<span class="string">&quot;command&quot;</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">param</span> prefix=<span class="string">&quot;/bin/sh&quot;</span> suffix=<span class="string">&quot;&quot;</span> ignoreError=<span class="string">&quot;true&quot;</span>/&gt;  &lt;!<span class="literal">--prefix</span> /opt/tongbu/mmm.sh suffix<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">filter</span> <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">            &lt;include expression=<span class="string">&quot;(.*)\.php&quot;</span>/&gt;</span><br><span class="line">            &lt;include expression=<span class="string">&quot;(.*)\.sh&quot;</span>/&gt;</span><br><span class="line">        &lt;/<span class="keyword">filter</span>&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line">    &lt;plugin name=<span class="string">&quot;socket&quot;</span>&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/opt/tongbu&quot;</span>&gt;</span><br><span class="line">            &lt;deshost ip=<span class="string">&quot;192.168.138.20&quot;</span> port=<span class="string">&quot;8009&quot;</span>/&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">    &lt;plugin name=<span class="string">&quot;refreshCDN&quot;</span>&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/data0/htdocs/cms.xoyo.com/site/&quot;</span>&gt;</span><br><span class="line">            &lt;cdninfo domainname=<span class="string">&quot;ccms.chinacache.com&quot;</span> port=<span class="string">&quot;80&quot;</span> username=<span class="string">&quot;xxxx&quot;</span> passwd=<span class="string">&quot;xxxx&quot;</span>/&gt;</span><br><span class="line">            &lt;sendurl base=<span class="string">&quot;http://pic.xoyo.com/cms&quot;</span>/&gt;</span><br><span class="line">            &lt;regexurl regex=<span class="string">&quot;false&quot;</span> match=<span class="string">&quot;cms.xoyo.com/site([/a-zA-Z0-9]*).xoyo.com/images&quot;</span>/&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">&lt;/head&gt;</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>了解一下sersync2命令的参数</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">参数<span class="literal">-d</span>:启用守护进程模式</span><br><span class="line">参数<span class="literal">-r</span>:在监控前，将监控目录与远程主机用rsync命令推送一遍</span><br><span class="line">参数<span class="literal">-n</span>: 指定开启守护线程的数量，默认为<span class="number">10</span>个</span><br><span class="line">参数<span class="literal">-o</span>:指定配置文件，默认使用confxml.xml文件</span><br><span class="line">参数<span class="literal">-m</span>:单独启用其他模块，使用 <span class="literal">-m</span> refreshCDN 开启刷新CDN模块</span><br><span class="line">参数<span class="literal">-m</span>:单独启用其他模块，使用 <span class="literal">-m</span> socket 开启socket模块</span><br><span class="line">参数<span class="literal">-m</span>:单独启用其他模块，使用 <span class="literal">-m</span> http 开启http模块</span><br><span class="line">不加<span class="literal">-m</span>参数，则默认执行同步程序</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">所以使用</span><br><span class="line"><span class="comment"># sersync2 -dro /usr/local/sesync/confxml.xml      //第一次使用先同步一次,第二次使用就可以去除-r参数</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>ssh的连接</p></div><div class="note default orange simple"><p>rsync的服务连接貌似是没有数据加密的，为了安全起见需要使用ssh</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/local/sesync/confxml.xml</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="line">&lt;head version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line">    &lt;host hostip=<span class="string">&quot;localhost&quot;</span> port=<span class="string">&quot;8008&quot;</span>&gt;&lt;/host&gt;</span><br><span class="line">    &lt;debug <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;fileSystem xfs=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="keyword">filter</span> <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;   &lt;!<span class="literal">--</span>&lt;是否开启过滤功能，为true的话设置以下的类型文件不同步 &gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;(.*)\.svn&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;(.*)\.gz&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;^info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">        &lt;exclude expression=<span class="string">&quot;^static/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">    &lt;/<span class="keyword">filter</span>&gt;</span><br><span class="line">    &lt;inotify&gt;</span><br><span class="line">        &lt;delete <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;createFolder <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;createFile <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">        &lt;closeWrite <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;moveFrom <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;moveTo <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">        &lt;attrib <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;     &lt;!<span class="literal">--</span>&lt;修改&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;modify <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;/inotify&gt;</span><br><span class="line"></span><br><span class="line">    &lt;sersync&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/opt/&quot;</span>&gt;</span><br><span class="line">            &lt;remote ip=<span class="string">&quot;192.168.222.161&quot;</span> name=<span class="string">&quot;/opt&quot;</span>/&gt;   &lt;!<span class="literal">--</span>&lt;修改为要传输到backup机器的目标地址&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;remote ip=<span class="string">&quot;192.168.8.39&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;remote ip=<span class="string">&quot;192.168.8.40&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">        &lt;rsync&gt;</span><br><span class="line">            &lt;commonParams params=<span class="string">&quot;-artuz&quot;</span>/&gt;</span><br><span class="line">            &lt;!<span class="literal">--</span>&lt;修改,关闭&gt;<span class="literal">--</span>&gt;</span><br><span class="line">            &lt;auth <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> users=<span class="string">&quot;lt&quot;</span> passwordfile=<span class="string">&quot;/etc/rsync.pas&quot;</span>/&gt;</span><br><span class="line">            &lt;userDefinedPort <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!<span class="literal">--</span> port=<span class="number">874</span> <span class="literal">--</span>&gt;</span><br><span class="line">            &lt;timeout <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> time=<span class="string">&quot;100&quot;</span>/&gt;&lt;!<span class="literal">--</span> timeout=<span class="number">100</span> <span class="literal">--</span>&gt;</span><br><span class="line">            &lt;ssh <span class="built_in">start</span>=<span class="string">&quot;true&quot;</span>/&gt;          &lt;!<span class="literal">--</span>&lt;修改,开启ssh连接&gt;<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;/rsync&gt;</span><br><span class="line">        &lt;failLog path=<span class="string">&quot;/tmp/rsync_fail_log.sh&quot;</span> timeToExecute=<span class="string">&quot;60&quot;</span>/&gt;&lt;!<span class="literal">--default</span> every <span class="number">60</span>mins execute once<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;crontab <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> schedule=<span class="string">&quot;600&quot;</span>&gt;&lt;!<span class="literal">--600mins--</span>&gt;</span><br><span class="line">            &lt;crontabfilter <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">                &lt;exclude expression=<span class="string">&quot;*.php&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">                &lt;exclude expression=<span class="string">&quot;info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">            &lt;/crontabfilter&gt;</span><br><span class="line">        &lt;/crontab&gt;</span><br><span class="line">        &lt;plugin <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;command&quot;</span>/&gt;</span><br><span class="line">    &lt;/sersync&gt;</span><br><span class="line">                                &lt;!<span class="literal">--</span>&lt;以下不需要修改 &gt;<span class="literal">--</span>&gt;</span><br><span class="line">    &lt;plugin name=<span class="string">&quot;command&quot;</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">param</span> prefix=<span class="string">&quot;/bin/sh&quot;</span> suffix=<span class="string">&quot;&quot;</span> ignoreError=<span class="string">&quot;true&quot;</span>/&gt;  &lt;!<span class="literal">--prefix</span> /opt/tongbu/mmm.sh suffix<span class="literal">--</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">filter</span> <span class="built_in">start</span>=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">            &lt;include expression=<span class="string">&quot;(.*)\.php&quot;</span>/&gt;</span><br><span class="line">            &lt;include expression=<span class="string">&quot;(.*)\.sh&quot;</span>/&gt;</span><br><span class="line">        &lt;/<span class="keyword">filter</span>&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line">    &lt;plugin name=<span class="string">&quot;socket&quot;</span>&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/opt/tongbu&quot;</span>&gt;</span><br><span class="line">            &lt;deshost ip=<span class="string">&quot;192.168.138.20&quot;</span> port=<span class="string">&quot;8009&quot;</span>/&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">    &lt;plugin name=<span class="string">&quot;refreshCDN&quot;</span>&gt;</span><br><span class="line">        &lt;localpath watch=<span class="string">&quot;/data0/htdocs/cms.xoyo.com/site/&quot;</span>&gt;</span><br><span class="line">            &lt;cdninfo domainname=<span class="string">&quot;ccms.chinacache.com&quot;</span> port=<span class="string">&quot;80&quot;</span> username=<span class="string">&quot;xxxx&quot;</span> passwd=<span class="string">&quot;xxxx&quot;</span>/&gt;</span><br><span class="line">            &lt;sendurl base=<span class="string">&quot;http://pic.xoyo.com/cms&quot;</span>/&gt;</span><br><span class="line">            &lt;regexurl regex=<span class="string">&quot;false&quot;</span> match=<span class="string">&quot;cms.xoyo.com/site([/a-zA-Z0-9]*).xoyo.com/images&quot;</span>/&gt;</span><br><span class="line">        &lt;/localpath&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">&lt;/head&gt;</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>需要同步多个目录就需要编写多个confxml.xml然后不同进程地执行</p></div><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
          <category> 演示 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hadoop+spark+zookeeper分布式集群搭建</title>
      <link href="/posts/371a3fb1.html"/>
      <url>/posts/371a3fb1.html</url>
      
        <content type="html"><![CDATA[<h1>hadoop+spark+zookeeper分布式集群部署</h1><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>1.环境准备</p></div></div><div class="note default orange simple"><p>环境的准备基于我写的初始化脚本,自用7.x系列的CentOS,老版本的就支持CentOS/Redhat6,7,8但是有点不完善，需要可以邮箱或者博客留言。</p></div><table><thead><tr><th style="text-align:center">os\ip</th><th style="text-align:center">hostname</th><th style="text-align:center">block</th></tr></thead><tbody><tr><td style="text-align:center">centos7.9 192.168.222.226</td><td style="text-align:center">master</td><td style="text-align:center">rsmanager,datanode,namenode.snamenode,nmanager</td></tr><tr><td style="text-align:center">centos7.9 192.168.222.227</td><td style="text-align:center">node1</td><td style="text-align:center">snamenode,nmnager,datanode</td></tr><tr><td style="text-align:center">centos7.9 192.168.222.228</td><td style="text-align:center">node2</td><td style="text-align:center">datanode,nmanager</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/linjiangyu2/K.git   //可能会拉不下来，多拉几次就下来了，因为托管代码的服务器是国外的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> K</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> README.md  //不会使用的要看一下这个文件，了解脚本需要输入的配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./ksh  //依次输入你自己的配置，第一次使用这个脚本一定要看README.md文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果需要有时候改IP地址图方便的话，直接把ksh这个二进制的脚本放在/usr/bin下，便可以在全局执行了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> ksh /usr/bin/ksh</span></span><br><span class="line">使用ksh初始化后，开始配置</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>对应自己的IP地址，最好/etc/hosts的解析名和我一致，不然下面的配置文件需要自己对应自己的解析名修改</p></div><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[master]</span># </span><br><span class="line">cat &gt; /etc/hosts &lt;&lt;END</span><br><span class="line"><span class="number">127.0.0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 </span><br><span class="line"><span class="number">192.168.222.226</span> master</span><br><span class="line"><span class="number">192.168.222.227</span> node1</span><br><span class="line"><span class="number">192.168.222.228</span> node2</span><br><span class="line">END</span><br><span class="line"><span class="string">[master]</span># ssh-keygen -P &#x27;&#x27; -f ~/.ssh/id_rsa</span><br><span class="line"><span class="string">[master]</span># for i in master node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;do ssh-copy-id $i;done</span><br><span class="line"><span class="string">[master]</span># for i in node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;do rsync -av /etc/hosts root@$i:/etc/hosts;done</span><br><span class="line"><span class="string">[master]</span># for i in master node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;do ssh $i yum install -y openssl-devel;done</span><br><span class="line"><span class="string">[master]</span># cd /usr/lib64</span><br><span class="line"><span class="string">[master]</span># ln -s libcrypto.so.<span class="number">1</span>.<span class="number">0</span>.2k libcrypto.so</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>2.搭建</p></div></div><h4 id="2-1-hadoop分布式">2.1 hadoop分布式</h4><h4 id="上传jdk和hadoop的tar包">上传jdk和hadoop的tar包</h4><div class="note default orange simple"><p>这里使用的二进制包</p></div><div class="tag link"><a class="link-card" title="hadoop-2.8.5.tar.gz" href="https://alist.linjiangyu.com/d/Linux/hadoop-2.8.5.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">hadoop-2.8.5.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/hadoop-2.8.5.tar.gz</p></div></a></div><div class="tag link"><a class="link-card" title="jdk-8u212-linux-x64.tar.gz" href="https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">jdk-8u212-linux-x64.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz</p></div></a></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  [master]<span class="comment"># tar xf hadoop...  //不知道你使用的版本，写了...，以下也是，tab键或者对应修改就可以</span></span><br><span class="line">  <span class="comment"># ...是表示我不知道你使用的版本，自己改</span></span><br><span class="line">  [root@ master]<span class="comment"># tar xf jdk...</span></span><br><span class="line">  [root@ master]<span class="comment"># tar xf hadoop...</span></span><br><span class="line">  [root@ master]<span class="comment"># mv hadoop... /opt/hadoop285</span></span><br><span class="line">  [root@ master]<span class="comment"># mv jdk... /usr/local/jdk</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/opt/hadoop285</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$&#123;HADOOP_HOME&#125;</span>/bin:<span class="variable">$&#123;HADOOP_HOME&#125;</span>/sbin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class="variable">$HADOOP_HOME</span>/lib/native </span><br><span class="line"><span class="built_in">export</span> HADOOP_OPTS=<span class="string">&quot;-Djava.library.path=<span class="variable">$HADOOP_HOME</span>/lib/native&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$HADOOP_HOME</span>/lib/native/:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># source !$</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以下是自己直接写入配置，在master服务器上进行</p></div><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/hadoop285/etc/hadoop</span></span><br><span class="line"><span class="comment"># vim hadoop-env.sh  //修改文件里面的export JAVA_HOME=$&#123;JAVA_HOME&#125;为</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="comment"># vim yarn-env.sh //修改前面有注释的export JAVA_HOME为</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="comment"># vim core-site.xml</span></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>hadoop.tmp.dir<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>/opt/data<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>fs.defaultFS<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>hdfs://master:9000<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim hdfs-site.xml</span></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>dfs.replication<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>1<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>dfs.namenode.name.dir<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>/opt/data/hdfs/name<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>dfs.datanode.data.dir<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>/opt/data/hdfs/data<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim yarn-site.xml </span></span><br><span class="line"></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>yarn.resourcemanager.hostname<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>master<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>yarn.nodemanager.aux-services<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>mapreduce_shuffle<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cp mapred-site.xml.template mapred-site.xml</span></span><br><span class="line"><span class="comment"># vim mapred-site.xml</span></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">    <span class="variable">&lt;property&gt;</span></span><br><span class="line">        <span class="variable">&lt;name&gt;</span>mapreduce.framework.name<span class="variable">&lt;/name&gt;</span></span><br><span class="line">        <span class="variable">&lt;value&gt;</span>yarn<span class="variable">&lt;/value&gt;</span></span><br><span class="line">    <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim slaves</span></span><br><span class="line"><span class="keyword">master</span></span><br><span class="line"><span class="title">node1</span></span><br><span class="line">node2</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>然后在master节点把配置发到各个节点</p></div><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[master]# <span class="keyword">for</span> i in node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;<span class="keyword">do</span> rsync -av <span class="regexp">/usr/</span>local<span class="regexp">/jdk root@$i:/u</span>sr<span class="regexp">/local/</span>;done</span><br><span class="line"># <span class="keyword">for</span> i in node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;<span class="keyword">do</span> rsync -av <span class="regexp">/opt/</span>hadoop285 root@$i:<span class="regexp">/opt/</span>;done</span><br><span class="line"># <span class="keyword">for</span> i in node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;<span class="keyword">do</span> rsync -av <span class="regexp">/etc/</span>profile root@$i:<span class="regexp">/etc/</span>profile;done</span><br><span class="line">然后到各个节点</span><br><span class="line">[node1,<span class="number">2</span>]# <span class="keyword">source</span> <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在node1,2上操作，最后在master操作</p></div><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># hdfs namenode -format   <span class="comment">//初始化</span></span></span><br><span class="line"><span class="meta"># ls -d /opt/data   <span class="comment">//此文件夹产生就是初始化成功</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在master上操作</p></div><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ <span class="literal">master</span>]<span class="comment"># start-all.sh</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>最后可以在各个节点使用jps命令查看各自的部件</p></div><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@ xxx</span>]<span class="meta"># jps</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>当然web界面也可以访问的，浏览器访问192.168.222.226:8088和192.168.222.226:50070(对应自己IP地址)</p></div><div class="note default orange simple"><p>来尝试运行一下第一个hadoop分布式任务吧</p></div><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ master]# hdfs dfs -put <span class="regexp">/etc/</span>passwd /t1</span><br><span class="line">[root@ master]# hadoop jar <span class="regexp">/opt/</span>hadoop285<span class="regexp">/share/</span>hadoop<span class="regexp">/mapreduce/</span>hadoop-mapreduce-examples-<span class="number">2.8</span>.<span class="number">5</span>.jar wordcount <span class="regexp">/t1 /</span>output/<span class="number">00</span></span><br><span class="line">[root@ master]# hdfs dfs -ls <span class="regexp">/output/</span><span class="number">00</span>  <span class="comment">//查看运行后的结果文件,运行后的数据在part-r-00000</span></span><br></pre></td></tr></table></figure><h4 id="2-2-spark分布式">2.2 spark分布式</h4><div class="note default orange simple"><p>下面开始搭建分布式spark，这里使用的是spark的3.3.0版本</p></div><div class="tag link"><a class="link-card" title="spark-3.3.0-bin-hadoop3.tgz" href="https://alist.linjiangyu.com/d/Linux/spark-3.3.0-bin-hadoop3.tgz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">spark-3.3.0-bin-hadoop3.tgz</p><p class="url">https://alist.linjiangyu.com/d/Linux/spark-3.3.0-bin-hadoop3.tgz</p></div></a></div><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 把spark包上传到机器上，然后到该包的目录，这里统一以spark-3.3.0-bin-hadoop3.tgz这个包为演示</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># tar xf spark-3.3.0-bin-hadoop3.tgz</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv spark-3.3.0-bin-hadoop3 /opt/spark</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim /etc/profile</span></span><br><span class="line">export PATH=/opt/spark/bin:/opt/spark/sbin:$PATH</span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># cd /opt/spark/conf</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv spark-env.sh.template spark-env.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim spark-env.sh</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export HADOOP_CONF_DIR=/opt/hadoop285/etc/hadoop</span><br><span class="line">export SPARK_MASTER_IP=master   <span class="meta">#对应自己的master机器IP或者master解析的域名，如果是按照我上面做的直接写master即可</span></span><br><span class="line">export SPARK_WORKER_MEMORY=<span class="number">1024</span>m</span><br><span class="line">export SPARK_WORKER_CORES=<span class="number">2</span> </span><br><span class="line">export SPARK_EXECUTOR_MEMORY=<span class="number">1024</span>m</span><br><span class="line">export SPARK_WORKER_INSTANCES=<span class="number">1</span></span><br><span class="line">export SOARK_MASTER_PORT=<span class="number">7077</span></span><br><span class="line">export SPARK_EXECUTOR_CORES=<span class="number">1</span></span><br><span class="line">SPARK_HISTORY_OPTS=<span class="string">&quot;-Dspark.history.fs.logDirectory=hdfs://master:9000/spark_logs&quot;</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># cp spark-defaults.conf.template spark-defaults.conf</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim spark-defaults.conf</span></span><br><span class="line">spark.master                     spark:<span class="comment">//master:7077</span></span><br><span class="line">spark.eventLog.enabled           <span class="literal">true</span></span><br><span class="line">spark.eventLog.dir               hdfs:<span class="comment">//master:9000/spark_logs</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim slaves     //对应自己的三台主机IP地址或者解析的域名</span></span><br><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># cd /opt/spark/sbin</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv start-all.sh spark-start.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv stop-all.sh spark-stop.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># source /etc/profile</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /opt/spark root@node1:/opt/</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /opt/spark root@node2:/opt/</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /etc/profile root@node1:/etc/</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /etc/profile root@node2:/etc/</span></span><br><span class="line"><span class="meta"># 然后在各工作节点执行命令</span></span><br><span class="line">[<span class="meta">root@ node1,node2</span>]<span class="meta"># source /etc/profile</span></span><br><span class="line"><span class="meta"># 在master节点执行</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># start-all.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># hdfs dfs -mkdir /spark_logs</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># spark-start.sh  //启动spark集群</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># jps     //查看</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以上便搭建好了spark结合hadoop的分布式集群，spark也有自己的web界面，可以浏览器访问192.168.222.226:8080来查看(对应自己IP地址)</p></div><h4 id="2-3-zookeeper分布式">2.3 zookeeper分布式</h4><div class="tag link"><a class="link-card" title="apache-zookeeper-3.5.10.tar.gz" href="https://alist.linjiangyu.com/d/Linux/zookeeper-3.4.14.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">apache-zookeeper-3.5.10.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/zookeeper-3.4.14.tar.gz</p></div></a></div><div class="note default orange simple"><p>在master机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tar xf zookeeper*</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> zookeeper* /opt/zookeeper</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> /opt/zookeeper/conf/zoo_sample.cfg /opt/zookeeper/conf/zoo.cfg</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /opt/zookeeper/conf/zoo.cfg</span></span><br><span class="line">修改</span><br><span class="line">dataDir=/opt/data/zookeeper</span><br><span class="line">添加</span><br><span class="line">dataLogDir=/opt/data/zookeeper/logs</span><br><span class="line">server.1=master:2888:3888</span><br><span class="line">server.2=node1:2888:3888</span><br><span class="line">server.3=node2:2888:3888</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里对应自己的主机名</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在各机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> -p /opt/data/zookeeper/logs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> 1 &gt; /opt/data/zookeeper/myid             <span class="comment">#这里master对应上面的server.1 便要echo1,node1对应server.2便要echo 2,node3对应server.3便要echo 3</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在master机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/profile</span></span><br><span class="line">export ZOOKEEPER_HOME=/opt/zookeeper</span><br><span class="line">export PATH=$&#123;ZOOKEEPER_HOME&#125;/bin:$PATH</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /opt/zookeeper root@<span class="variable">$i</span>:/opt/;<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> node&#123;1..2&#125;;<span class="keyword">do</span> rsync -av /etc/profile /etc/;<span class="keyword">done</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在各机器上执行</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> /etc/profile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zkServer.sh start             <span class="comment">#这个命令最好使用多命令一起执行,就是多个机器的执行时间要差不多一直,因为zookeeper对时间的要求性很高和各种问题</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zkServer.sh status    <span class="comment"># 可以在各节点查看自己的角色是leader还是follower</span></span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>不怎么好走的路 才是上坡路</title>
      <link href="/posts/78ceeb56.html"/>
      <url>/posts/78ceeb56.html</url>
      
        <content type="html"><![CDATA[<span class='p center red logo large'>不怎么好走的路 才是上坡路</span><p>人生所有往上的路，都与我们本能的懒惰、懈怠和拖延不相容。<br>当你觉得很苦很累时，千万不要泄气，<br>因为你可能正走在上坡的路上。<br>请相信，正是因为那些看起来很难的努力、付出和坚持，<br>才成就了那个不断变得更好的自己。永远不要停止学习<br>一件事你做过一百遍，也还有可以精进之处;<br>一篇文章你写过一百遍，也还有可以改进之处;<br>一种方法你用过一百遍，也还有可以完善之处。<br>一旦停止学习，人就会止步不前。<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Web应用之Tomcat</title>
      <link href="/posts/d5d9f79c.html"/>
      <url>/posts/d5d9f79c.html</url>
      
        <content type="html"><![CDATA[<h2 id="Tomcat">Tomcat</h2><h3 id="二进制安装">二进制安装</h3><div class="note default orange simple"><p>安装jdk</p></div><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="jdk-8u212-linux-x64.tar.gz" href="https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">jdk-8u212-linux-x64.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz</p></div></a></div>              </div>            </details><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar xf jdk-8u212-linux-x64.tar.gz</span></span><br><span class="line"><span class="comment"># mv jdk-8u212-linux /usr/local/jdk</span></span><br></pre></td></tr></table></figure><details class="folding-tag" cyan open><summary> 这里使用的二进制包 </summary>              <div class='content'>              <div class="tag link"><a class="link-card" title="apache-tomcat-9.0.65-src.tar.gz" href="https://alist.linjiangyu.com/d/Linux/apache-tomcat-9.0.65-src.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">apache-tomcat-9.0.65-src.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/apache-tomcat-9.0.65-src.tar.gz</p></div></a></div><div class="tag link"><a class="link-card" title="tomcat-native-1.2.23-src.tar.gz" href="https://alist.linjiangyu.com/d/Linux/tomcat-native-1.2.23-src.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">tomcat-native-1.2.23-src.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/tomcat-native-1.2.23-src.tar.gz</p></div></a></div>              </div>            </details><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar xf apache-tomcat-9.0.65-src.tar.gz</span></span><br><span class="line"><span class="comment"># mv apache-tomcat-9.0.65-src /usr/local/tomcat</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install apr apr-devel apr-utils openssl-devel</span></span><br><span class="line"><span class="comment"># tar xf tomcat-native-1.2.23-src.tar.gz </span></span><br><span class="line"><span class="comment"># cd tomcat-native-1.2.23-src/native/</span></span><br><span class="line"><span class="comment"># ./configure --with-apr=/usr/bin/apr-1-config --with-java-home=/usr/local/jdk --prefix=/usr/local/tomcat</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>将jdk和tomcat写入环境变量</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export JRE_HOME=/usr/local/jdk/jre</span><br><span class="line">export TOMCAT_HOME=/usr/local/tomcat</span><br><span class="line">export PATH=<span class="variable">$</span>&#123;JAVA_HOME&#125;/bin:<span class="variable">$</span>&#123;JRE_HOME&#125;/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>可以自己写一个小脚本</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;<span class="keyword">END</span></span><br><span class="line">author: linjiangyu</span><br><span class="line">cc: http://creativecommons.org/licenses/by<span class="literal">-nc-sa</span>/<span class="number">4.0</span>/</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="comment"># vim /etc/init.d/tomcat</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#chkconfig: 2345 85 15</span></span><br><span class="line"><span class="comment">#description: By K &lt;linjiangyu0702@qq.com&gt;</span></span><br><span class="line">case <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"><span class="built_in">start</span>)</span><br><span class="line">    /usr/local/tomcat/bin/startup.sh </span><br><span class="line">    ;;</span><br><span class="line">stop)</span><br><span class="line">    /usr/local/tomcat/bin/shutdown.sh</span><br><span class="line">    ;;</span><br><span class="line">status)    </span><br><span class="line">    /usr/local/tomcat/bin/configtest.sh</span><br><span class="line">    ;;</span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="literal">-e</span> <span class="string">&quot;\033[31mUsage: <span class="variable">$</span>(basename <span class="variable">$0</span>) (start|stop|status)\033[0m&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">&lt;!<span class="literal">--</span>这里要吐槽一下java的程序运行的是真的慢，服务刚启动的话<span class="number">8005</span>的套接字端口不会那么快就启用，而关闭服务的时候是要使用到<span class="number">8005</span>端口shutdown的，所以应该把restart服务加上一段时间<span class="literal">--</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># chmod +x /etc/init.d/tomcat</span></span><br><span class="line"><span class="comment"># vim /usr/local/tomcat/bin/catalina.sh# 把环境变量写入相应需要的文件中(tomcat的变量这里没有引用系统环境变量,所以要自己再写上)</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export JRE_HOME=/usr/local/jdk/jre</span><br><span class="line"><span class="comment"># chkconfig --add tomcat</span></span><br><span class="line"><span class="comment"># chkconfig tomcat on</span></span><br><span class="line"><span class="comment"># service tomcat start</span></span><br></pre></td></tr></table></figure><h4 id="1-优点和功能">1.优点和功能</h4><div class="note default orange simple"><p>优点和功能</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Tomcat运行时占用的系统资源小，扩展性好，支持负载均衡与邮件服务等开发应用系统常用的功能；</span><br><span class="line"></span><br><span class="line">Tomcat是一个开源的web服务器 ;</span><br><span class="line"></span><br><span class="line">Tomcat是一个小型的轻量级应用服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试JSP程序的首选。</span><br><span class="line"></span><br><span class="line">对于一个初学者来说，可以这样认为，当在一台机器上配置好Apache服务器，可利用它响应对HTML页面的访问请求。实际上Tomcat部分是Apache服务器的扩展，所以当你运行tomcat时，它实际上作为一个Apache独立的进程单独运行的。 当配置正确时，Apache为HTML页面服务，而Tomcat实际上运行JSP页面和Servlet。另外，Tomcat和IIS、Apache等Web服务器一样，具有处理HTML页面的功能，另外它还是一个Servlet和JSP容器，独立的Servlet容器是Tomcat的默认模式。</span><br><span class="line"></span><br><span class="line">不过，Tomcat处理静态HTML的能力不如Apache服务器。</span><br></pre></td></tr></table></figure><h4 id="2-组件">2.组件</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Server: 控制tomcat的启动和关闭,tomcat的生命周期由Server控制</span><br><span class="line"></span><br><span class="line">Engine: 负责处理所有的请求,处理后将结果返回给Service,而connector是作为service与engine的作为中间交流者；一个engine下可以配置一个默认主机，每个虚拟主机都有一个域名</span><br><span class="line"></span><br><span class="line">Connector 主要负责对外交流</span><br><span class="line"></span><br><span class="line">Host：代表一个虚拟主机，每个虚拟主机和某个网络域名（Domain Name）相匹配。 每个虚拟主机下都可以部署一个或多个web应用，每个web应用对应于一个context，有一个context path。 当Host获得一个请求时，将把该请求匹配到某个Context上</span><br><span class="line"></span><br><span class="line">Wrapper： 代表一个 Servlet，它负责管理一个 Servlet，包括的 Servlet 的装载、初始化、执行以及资源回收。Wrapper 是最底层的容器，它没有子容器</span><br></pre></td></tr></table></figure><h4 id="3-配置">3.配置</h4><div class="note default orange simple"><p>用户认证登陆</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/tomcat/tomcat-user.xml</span></span><br><span class="line">&lt;user username=<span class="string">&quot;tomcat&quot;</span> password=<span class="string">&quot;abcd0702&quot;</span> roles=<span class="string">&quot;manager-gui&quot;</span>/&gt;  设置登陆用户和密码,role设置为可以查看管理web界面的权限manager<span class="literal">-gui</span></span><br><span class="line"></span><br><span class="line">- manager<span class="literal">-gui</span> -允许访问HTML GUI和状态页面</span><br><span class="line"></span><br><span class="line">- manager<span class="literal">-script</span> -允许访问HTTP API和状态页面</span><br><span class="line"></span><br><span class="line">- manager<span class="literal">-jmx</span> -允许访问JMX代理和状态页</span><br><span class="line"></span><br><span class="line">- manager<span class="literal">-status</span> -只允许访问状态页</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>tomcat默认静态网页的存放位置在/usr/share/tomcat/webapps/ROOT/下</p></div><p>…还在编写中<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis持久化存储切换</title>
      <link href="/posts/86ed3030.html"/>
      <url>/posts/86ed3030.html</url>
      
        <content type="html"><![CDATA[<div class="note default orange simple"><p>分享一个坑</p></div><p>redis数据库的持久化存储有snapshot和aof两种</p><p>如果是使用过snapshot之后已经有了存储数据然后要开启aof的话,因为aof比snapshot机制的rdb文件的优先级高,redis默认会去加载第一次生成的aof的空文件,会导致全部数据未能被加载,然后如果这个时候你使用了save或bgsave或者触发了配置中的save机制,那就直接把当前的空数据库覆盖到rdb文件中了,那就可以准备收拾行李连夜坐船转到老挝,缅甸,柬埔寨了</p><p>解决方法:</p><p>命令行的动态更改,命令行的修改不会和重启服务一般去更新你的数据库,所以在你动态更改为aof机制后再执行重启会连同以前的数据一同备份进aof文件,当然动态更改后你还是需要把配置文件中的参数更改</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># redis-cli </span></span><br><span class="line"></span><br><span class="line">127.0.0.1&gt;<span class="built_in"> config </span><span class="built_in">set</span> appendonly <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># vim redis.conf</span></span><br><span class="line"></span><br><span class="line">appendonly <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl restart redis.service</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>好用的软件</title>
      <link href="/posts/3df4b4e4.html"/>
      <url>/posts/3df4b4e4.html</url>
      
        <content type="html"><![CDATA[<div class="site-card-group"><a class="site-card" href="https://dddachui.top/article/df3146b2.html"><div class="img"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/1676536555990.png"/></div><div class="info"><img src="https://dddachui.top/download/other/wanye.jpg"/><span class="title">大锤の博客</span><span class="desc">从锤老师那里搬运的</span></div></a></div><h3 id="开源软件-持续更新">开源软件(持续更新)</h3><div class="note default orange simple"><p>RSS软件</p></div><p><a href="https://github.com/yang991178/fluent-reader">https://github.com/yang991178/fluent-reader</a></p><div class="note default orange simple"><p>ssh工具windterm</p></div><p><a href="https://github.com/kingToolbox/WindTerm">https://github.com/kingToolbox/WindTerm</a></p><div class="note default orange simple"><p>代码片段管理工具massCode</p></div><p><a href="https://github.com/massCodeIO/massCode">https://github.com/massCodeIO/massCode</a></p><div class="note default orange simple"><p>远程桌面rustdesk</p></div><p><a href="https://github.com/rustdesk/rustdesk">https://github.com/rustdesk/rustdesk</a></p><div class="note default orange simple"><p>局域网网盘alist</p></div><p>在linux发行版搭建服务器,挂载各大网盘或者本地文件,有好看的ui<br><a href="https://github.com/alist-org/alist">https://github.com/alist-org/alist</a></p><div class="note default orange simple"><p>洛雪</p></div><div class="note default orange simple"><p>懂得都懂</p></div><p><a href="https://github.com/lyswhut/lx-music-desktop">https://github.com/lyswhut/lx-music-desktop</a></p><div class="note default orange simple"><p>其他软件</p></div><div class="note default orange simple"><p>卡饭输入法</p></div><p><a href="https://input.kfsafe.cn/">https://input.kfsafe.cn/</a></p><div class="note default orange simple"><p>Obsidian(markdown笔记)</p></div><p>这个软件一直在更新就不放链接了<br><a href="https://obsidian.md/">https://obsidian.md/</a></p><div class="note default orange simple"><p>获取软件下载地址(蓝奏云)</p></div><p>windterm<br><a href="https://dddachui.lanzouy.com/iDzcV0a4znoh">https://dddachui.lanzouy.com/iDzcV0a4znoh</a><br>massCode<br><a href="https://dddachui.lanzouy.com/iwAFI0a50h0d">https://dddachui.lanzouy.com/iwAFI0a50h0d</a><br>rustdesk<br><a href="https://dddachui.lanzouy.com/ii2TA0a50htc">https://dddachui.lanzouy.com/ii2TA0a50htc</a><br>alist<br><a href="https://dddachui.lanzouy.com/iF7pT0a506kh">https://dddachui.lanzouy.com/iF7pT0a506kh</a><br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xfsdump+xfsrestore</title>
      <link href="/posts/b409e427.html"/>
      <url>/posts/b409e427.html</url>
      
        <content type="html"><![CDATA[<h3 id="xfsdump-xfsrestore">xfsdump+xfsrestore</h3><div class="note default orange simple"><p>example</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsblk</span></span><br><span class="line">sdb               <span class="number">8</span>:<span class="number">16</span>   <span class="number">0</span>   <span class="number">20</span>G  <span class="number">0</span> disk</span><br><span class="line"><span class="comment"># mkdir /&#123;t1,t2,t3&#125; -v</span></span><br><span class="line"><span class="comment"># mkfs.xfs -f /dev/sdb</span></span><br><span class="line"><span class="comment"># mount /dev/sdb /t1</span></span><br><span class="line"><span class="comment"># cp -a /etc/. /t1/</span></span><br><span class="line">开始备份/dev/sdb设备的数据</span><br><span class="line"><span class="comment"># xfsdump -l 0 -L etc -M etc-dump -f /t2/etc.dump /t1        //完整备份/t1文件系统的数据到/t2/etc.dump</span></span><br><span class="line"><span class="comment"># rm -rf /t1</span></span><br><span class="line"><span class="comment"># xfsrestore -f /t2/etc.dump /t3     //把文件中的数据备份到/t3目录中去</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Btrfs</title>
      <link href="/posts/ad929b66.html"/>
      <url>/posts/ad929b66.html</url>
      
        <content type="html"><![CDATA[<h3 id="btrfs">btrfs</h3><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h4 id="1-特性">1.特性</h4></div></div><div class="note default orange simple"><p>可由多个块设备组合成一个btrfs文件系统，多物理卷支持</p></div><div class="note default orange simple"></div><div class="note default orange simple"><p>支持RAID(0,1,5,6,10),dup(冗余),single(单盘)和热更新</p></div><div class="note default orange simple"></div><div class="note default orange simple"><p>写时复制更新机制(Cow): 复制、更新及替换指针，而非就地更改源文件</p></div><div class="note default orange simple"></div><div class="note default orange simple"><p>支持元数据校验码机制，一旦文件计算后发现受损会自动尝试修复</p></div><div class="note default orange simple"></div><div class="note default orange simple"><p>支持创建子卷(子卷本质是在btrfs文件系统中由btrfs创建的一个文件夹，可以单独被拿出来挂载到别的某一个目录中)</p></div><div class="note default orange simple"></div><div class="note default orange simple"><p>快照，还支持快照的快照（可以实现快照的增量备份）</p></div><div class="note default orange simple"></div><div class="note default orange simple"><p>透明压缩（无需用户参与）</p></div><div class="note default orange simple"></div><div class="note default orange simple"><p>支持ext4的文件系统转换为btrfs</p></div><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h4 id="2-btrfs">2.btrfs</h4></div></div><h4 id="2-1-mkfs-btrfs">2.1 mkfs.btrfs</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">-L</span>         label</span><br><span class="line"><span class="comment"># mkfs.btrfs -L btr1 /dev/sdf /dev/sdg        //把/dev/sdf,sdg格式化成btrfs系统并打上btr1的标签</span></span><br><span class="line"><span class="literal">-d</span> [<span class="type">type</span>]  raid0,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">10</span>,single</span><br><span class="line"><span class="literal">-m</span> &lt;profile&gt; raid0,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">10</span>,single,dup(冗余)</span><br><span class="line"><span class="literal">-O</span> &lt;feature&gt;</span><br><span class="line">    <span class="literal">-O</span> list<span class="literal">-all</span>   列出支持的所有的feature</span><br></pre></td></tr></table></figure><h4 id="2-2-btrfs">2.2 btrfs</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># btrfs filesystem show        //查看btrfs文件系统的块设备</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs filesystem show -m(--mounted) -d(--all) //查看已挂载的btrfs文件系统的设备</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs filesystem label /dev/xxx        //查看设备的label标签</span></span><br><span class="line"></span><br><span class="line">透明压缩机制,所有文件的读取和写入会经过解压缩处理</span><br><span class="line"><span class="comment"># mount -o compress=lzo /dev/xxx xxx(path)</span></span><br><span class="line">或者</span><br><span class="line"><span class="comment"># mount -o compress=zlib /dev/xxx xxx(path)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs filesystem resize -10G /btr1       //把挂载在/btr1目录的btrfs文件系统块设备缩减10G空间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs filesystem resize +5G /btr1       //把挂载在/btr1目录的btrfs文件系统块设备增加5G空间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs filesystem resize max /btr1       //把挂载在/btr1目录的btrfs文件系统块设备增加到目前最大的存储空间 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs filesystem df /btr1       // -m -g -k 以什么磁盘单位查看挂载在/btr1下的btrfs文件系统信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs device add /dev/sdh /btr1   //把/dev/sdh设备添加到挂载在/btr1目录的btrfs文件系统中</span></span><br><span class="line"></span><br><span class="line">因为文件系统不会自动把前面存储的数据平衡到每一块硬盘块设备中,为了能让新加入的数据盘能均衡平躺存储,应该手动把数据平衡到每个存储盘中</span><br><span class="line"><span class="comment"># btrfs balance start /btr1    //加上--full-balance执行可以不经过等待立刻执行,不然会有倒计时10秒后执行</span></span><br><span class="line">btrfs balance [<span class="type">option</span>] directory</span><br><span class="line">  <span class="built_in">start</span>    开始</span><br><span class="line">    pause    暂停</span><br><span class="line">    cancel   取消</span><br><span class="line">    resume   继续</span><br><span class="line">    status   状态</span><br><span class="line">    </span><br><span class="line"><span class="comment"># btrfs device delete /dev/sdh /btr1      //把/dev/sdh设备从挂载在/btr1目录的btrfs文件系统中移除（移除时会自动把要移除的设备中的数据移动到其他的属于该原本btrfs文件系统的设备中去）</span></span><br><span class="line">如果移除操作会导致磁盘少于指定的RAID级别最低要求数,则会无法移除</span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs balance start -mconvert=raid(0,1,5,6,10,dup.single) /btr1  //修改挂载在/btr1的btrfs文件系统的元数据RAID级别(一定要达到本来RAID级别所需要的最少磁盘个数)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs balance start -dconvert=raid(0,1,5,6,10,dup.single) /btr1  //修改挂载在/btr1的btrfs文件系统的数据RAID级别(一定要达到本来RAID级别所需要的最少磁盘个数)</span></span><br><span class="line"></span><br><span class="line">创建子卷</span><br><span class="line"><span class="comment"># btrfs subvolume create /btrfs/logs</span></span><br><span class="line">查看挂载在/btr1目录下的btrfs文件系统的子卷</span><br><span class="line"><span class="comment"># btrfs subvolume list /btrfs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mount -o subvol=logs(可以换成卷ID) /dev/sdf /mnt     //把/dev/sdf中的子卷logs挂载到/mnt目录下</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs subvolume delete /btr1/cache        //把挂载在/btr1下的btrfs文件系统的cache子卷删除</span></span><br><span class="line"></span><br><span class="line">创建子卷快照(子卷的快照必须在文件系统的挂载目录下)</span><br><span class="line"><span class="comment"># btrfs subvolume snapshot /btr1/logs /btr1/logs_snapshot      //创建挂载在/btr1下的btrfs文件系统的logs子卷的快照为logs_snapshot</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持单文件快照</span></span><br><span class="line"><span class="comment"># cp --reflink /btr1/passwd /btr1/passwd_snapshot</span></span><br></pre></td></tr></table></figure><h4 id="3-example">3.example</h4><div class="note default orange simple"><p>环境</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsblk</span></span><br><span class="line">sdf                   <span class="number">8</span>:<span class="number">80</span>   <span class="number">0</span>   <span class="number">20</span>G  <span class="number">0</span> disk  </span><br><span class="line">sdg                   <span class="number">8</span>:<span class="number">96</span>   <span class="number">0</span>   <span class="number">20</span>G  <span class="number">0</span> disk  </span><br><span class="line">sdh                   <span class="number">8</span>:<span class="number">112</span>  <span class="number">0</span>   <span class="number">20</span>G  <span class="number">0</span> disk  </span><br><span class="line">sdi                   <span class="number">8</span>:<span class="number">128</span>  <span class="number">0</span>   <span class="number">20</span>G  <span class="number">0</span> disk  </span><br><span class="line">sdj                   <span class="number">8</span>:<span class="number">144</span>  <span class="number">0</span>   <span class="number">20</span>G  <span class="number">0</span> disk  </span><br><span class="line">sdk                   <span class="number">8</span>:<span class="number">160</span>  <span class="number">0</span>   <span class="number">20</span>G  <span class="number">0</span> disk </span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkfs.btrfs -L btr1 /dev/sdf /dev/sdg        //把/dev/sdf,sdg格式化成btrfs系统并打上btr1的标签</span></span><br><span class="line"><span class="comment"># btrfs filesystem show        //查看btrfs文件系统的块设备</span></span><br><span class="line">Label: <span class="string">&#x27;btr1&#x27;</span>  uuid: f1713d01<span class="literal">-0741-41d5-9062-87e46bbad575</span></span><br><span class="line">        Total devices <span class="number">2</span> FS bytes used <span class="number">112.00</span>KiB</span><br><span class="line">        devid    <span class="number">1</span> size <span class="number">20.00</span>GiB used <span class="number">2.01</span>GiB path /dev/sdf</span><br><span class="line">        devid    <span class="number">2</span> size <span class="number">20.00</span>GiB used <span class="number">2.01</span>GiB path /dev/sdg</span><br><span class="line">这里已经是一个可以挂载的类型是btrfs文件系统的块设备了,尝试挂载一下</span><br><span class="line"><span class="comment"># mkdir /btr1</span></span><br><span class="line"><span class="comment"># mount -t btrfs /dev/sdf /btr1 </span></span><br><span class="line"><span class="comment"># df -Th /btr1</span></span><br><span class="line">Filesystem     <span class="built_in">Type</span>   Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdf       btrfs   <span class="number">40</span>G   <span class="number">18</span>M   <span class="number">38</span>G   <span class="number">1</span>% /btr1</span><br><span class="line">可以看到是两个块设备绑定在了一块显示的是可用<span class="number">40</span>G存储</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在线缩小存储空间,块设备必须先挂载到目录上</span></span><br><span class="line"><span class="comment"># btrfs filesystem resize -10G /dev/sdf       //把挂载在/btr1目录的btrfs文件系统块设备缩减10G空间</span></span><br><span class="line">Resize <span class="string">&#x27;/btr1&#x27;</span> of <span class="string">&#x27;-10G&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># df -hT /btr1</span></span><br><span class="line">Filesystem     <span class="built_in">Type</span>   Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdf       btrfs   <span class="number">30</span>G   <span class="number">18</span>M   <span class="number">18</span>G   <span class="number">1</span>% /btr1</span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs filesystem df /btr1       // -m -g -k 以什么磁盘单位查看挂载在/btr1下的btrfs文件系统信息</span></span><br><span class="line"><span class="keyword">Data</span>, RAID0: total=<span class="number">2.00</span>GiB, used=<span class="number">788.00</span>KiB</span><br><span class="line">System, RAID1: total=<span class="number">8.00</span>MiB, used=<span class="number">16.00</span>KiB</span><br><span class="line">Metadata, RAID1: total=<span class="number">1.00</span>GiB, used=<span class="number">112.00</span>KiB</span><br><span class="line">GlobalReserve, single: total=<span class="number">16.00</span>MiB, used=<span class="number">0.00</span>B</span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs filesystem resize max /btr1       //把挂载在/btr1目录的btrfs文件系统块设备增加到目前最大的存储空间 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># df -Th /btr1</span></span><br><span class="line">Filesystem     <span class="built_in">Type</span>   Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdf       btrfs   <span class="number">40</span>G   <span class="number">18</span>M   <span class="number">38</span>G   <span class="number">1</span>% /btr1</span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs device add /dev/sdh /btr1   //把/dev/sdh设备添加到挂载在/btr1目录的btrfs文件系统中</span></span><br><span class="line"><span class="comment"># df -Th /btr1</span></span><br><span class="line">Filesystem     <span class="built_in">Type</span>   Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdf       btrfs   <span class="number">60</span>G   <span class="number">18</span>M   <span class="number">56</span>G   <span class="number">1</span>% /btr1</span><br><span class="line"></span><br><span class="line">因为文件系统不会自动把前面存储的数据平衡到每一块硬盘块设备中,为了能让新加入的数据盘能均衡平躺存储,应该手动把数据平衡到每个存储盘中</span><br><span class="line"><span class="comment"># btrfs balance start /btr1    //加上--full-balance执行可以不经过等待立刻执行,不然会有倒计时10秒后执行</span></span><br><span class="line">Starting balance without any filters.</span><br><span class="line">Done, had to relocate <span class="number">3</span> out of <span class="number">3</span> chunks</span><br><span class="line"><span class="comment"># btrfs device delete /dev/sdh /btr1      //把/dev/sdh设备从挂载在/btr1目录的btrfs文件系统中移除（移除时会自动把要移除的设备中的数据移动到其他的属于该原本btrfs文件系统的设备中去）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># df -hT /btr1</span></span><br><span class="line">Filesystem     <span class="built_in">Type</span>   Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdf       btrfs   <span class="number">40</span>G   <span class="number">18</span>M   <span class="number">40</span>G   <span class="number">1</span>% /btr1</span><br><span class="line"></span><br><span class="line">修改数据和元数据的RAID级别(动态更新)</span><br><span class="line"><span class="comment"># btrfs balance start -mconvert=raid(0,1,5,6,10,dup.single) /btr1  //修改挂载在/btr1的btrfs文件系统的元数据RAID级别(一定要达到本来RAID级别所需要的最少磁盘个数)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># btrfs balance start -dconvert=raid(0,1,5,6,10,dup.single) /btr1  //修改挂载在/btr1的btrfs文件系统的数据RAID级别(一定要达到本来RAID级别所需要的最少磁盘个数)</span></span><br><span class="line"></span><br><span class="line">创建子卷</span><br><span class="line"><span class="comment"># btrfs subvolume create /btrfs/logs</span></span><br><span class="line">查看挂载在/btr1目录下的btrfs文件系统的子卷</span><br><span class="line"><span class="comment"># btrfs subvolume list /btrfs</span></span><br><span class="line"><span class="comment"># btrfs subvolume create /btrfs/cache</span></span><br><span class="line"><span class="comment"># ls /btr1</span></span><br><span class="line">cache  logs</span><br><span class="line"><span class="comment"># cp /etc/passwd /btr1/logs/</span></span><br><span class="line"><span class="comment"># mount -o subvol=logs(可以换成卷ID) /dev/sdf /mnt     //把/dev/sdf中的子卷logs挂载到/mnt目录下</span></span><br><span class="line"><span class="comment"># df -Th </span></span><br><span class="line">/dev/sdf                btrfs      <span class="number">60</span>G   <span class="number">17</span>M   <span class="number">58</span>G   <span class="number">1</span>% /mnt</span><br><span class="line">/dev/sdf                btrfs      <span class="number">60</span>G   <span class="number">17</span>M   <span class="number">58</span>G   <span class="number">1</span>% /btr1</span><br><span class="line"><span class="comment"># ls /mnt</span></span><br><span class="line">passwd</span><br><span class="line"></span><br><span class="line">删除子卷</span><br><span class="line"><span class="comment"># btrfs subvolume delete /btr1/cache        //把挂载在/btr1下的btrfs文件系统的cache子卷删除</span></span><br><span class="line">Delete subvolume (no<span class="literal">-commit</span>): <span class="string">&#x27;/btr1/cache&#x27;</span></span><br><span class="line"></span><br><span class="line">创建子卷快照(子卷的快照必须在文件系统的挂载目录下)</span><br><span class="line"><span class="comment"># btrfs subvolume snapshot /btr1/logs /btr1/logs_snapshot      //创建挂载在/btr1下的btrfs文件系统的logs子卷的快照为logs_snapshot</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持单文件快照</span></span><br><span class="line"><span class="comment"># cp --reflink /btr1/passwd /btr1/passwd_snapshot</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>把ext4文件系统转换为btrfs文件系统</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mke2fs -t ext4 /dev/sdj</span></span><br><span class="line"><span class="comment"># mount /dev/sdj /mnt</span></span><br><span class="line"><span class="comment"># cp /etc/passwd /mnt/</span></span><br><span class="line"><span class="comment"># umount /mnt</span></span><br><span class="line"><span class="comment"># e2fsck -f /dev/sdj 或者 # fsck -f /dev/sdj</span></span><br><span class="line"><span class="comment"># btrfs-convert /dev/sdj</span></span><br><span class="line"><span class="comment"># mount /dev/sdj /mnt</span></span><br><span class="line"><span class="comment"># ls /mnt</span></span><br><span class="line">ext2_saved  passwd  lost+found</span><br><span class="line">*这个ext2_saved文件夹不能删除</span><br><span class="line"></span><br><span class="line">还可以重新把文件系统回滚到ext4(但是转换为btrfs之后操作的文件不会修改和保留,类似于回滚快照)</span><br><span class="line"><span class="comment"># umount /mnt</span></span><br><span class="line"><span class="comment"># btrfs-convert -r /dev/sdj</span></span><br><span class="line">rollback complete</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pxe-cobbler</title>
      <link href="/posts/d2d1d8fb.html"/>
      <url>/posts/d2d1d8fb.html</url>
      
        <content type="html"><![CDATA[<h2 id="Pxe-Cobbler">Pxe-Cobbler</h2><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>环境</p></div></div><table><thead><tr><th style="text-align:center">IP</th><th style="text-align:center">HOSTNAME</th><th style="text-align:center">ROLE</th></tr></thead><tbody><tr><td style="text-align:center">dhcp</td><td style="text-align:center">t1</td><td style="text-align:center">dhcp</td></tr><tr><td style="text-align:center">dhcp</td><td style="text-align:center">t2</td><td style="text-align:center">c1</td></tr><tr><td style="text-align:center">192.168.222.30,dhcp(192.168.222.201)</td><td style="text-align:center">t3</td><td style="text-align:center">c2</td></tr></tbody></table><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>一、dhcp</p></div></div><div class="note default orange simple"><p>dhcp是基于rarp，和arp相反，arp是通过对IP来识别物理网卡mac地址，而dhcp是通过识别客户端机器的物理网卡mac地址来判断给予客户端的IP地址</p></div><div class="note default orange simple"><p>监听在67端口</p></div><p>Server: 67/UDP</p><p>Client: 68/UDP</p><p>arp: address resolving protocol</p><p>​IP  --&gt; MAC</p><p>rarp: reverse arp</p><p>​MAC --&gt; IP</p><div class="note default orange simple"><p>工作流程:</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>) Client: dhcp discover</span><br><span class="line">(<span class="number">2</span>) Server: dhcp offer (IP/mask,gw...)</span><br><span class="line">lease time: 租约期限</span><br><span class="line">(<span class="number">3</span>) Client: dhcp request</span><br><span class="line">(<span class="number">4</span>) Sever: dhcp ack</span><br><span class="line">续租：</span><br><span class="line"><span class="number">50</span>%,<span class="number">75</span>%,<span class="number">87.5</span>%,</span><br><span class="line"></span><br><span class="line">单播给服务：</span><br><span class="line">dhcp request</span><br><span class="line">dhcp ack   //可以继续用</span><br><span class="line"></span><br><span class="line">dhcp request</span><br><span class="line">dhcp nak   //不可以继续使用</span><br><span class="line"></span><br><span class="line">dhcp discover</span><br><span class="line">(<span class="number">5</span>) Server</span><br><span class="line">dhcp:</span><br><span class="line">dhcpd: dhcp 服务</span><br><span class="line">dhcrelay: 中继,在两个网段中都起分发IP作用的dhcp服务器</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>配置文件,使用dhcp服务</p></div><div class="note default orange simple"><p>dhcp的配置模板文件在/usr/share/doc/dhcp-4.2.5下面</p></div><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">dhcp</span>]<span class="comment"># yum install -y dhcp</span></span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">dhcp</span>]<span class="comment"># cp /usr/share/doc/dhcp-4.2.5/dhcpd.conf<span class="doctag">.example</span> /etc/dhcp/dhcpd.conf //模板文件拷贝</span></span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">dhcp</span>]<span class="comment"># vim /etc/dhcp/dhcpd.conf</span></span><br><span class="line"><span class="comment"># 其余没有显示的我暂时注释掉了</span></span><br><span class="line">option domain<span class="literal">-name</span> <span class="string">&quot;linjiangyu.com&quot;</span>;   //指定默认的DNS域名 </span><br><span class="line">option domain<span class="literal">-name-servers</span> <span class="number">119.29</span>.<span class="number">29.29</span>;  //指定默认的DNS服务器IP</span><br><span class="line">default<span class="literal">-lease-time</span> <span class="number">43200</span>;            //默认租约时间</span><br><span class="line">max<span class="literal">-lease-time</span> <span class="number">86400</span>;                //最大租约时间</span><br><span class="line">log<span class="literal">-facility</span> local7;//指定日志文件不需要修改</span><br><span class="line">subnet <span class="number">10.10</span>.<span class="number">0.0</span> netmask <span class="number">255.255</span>.<span class="number">255.0</span> &#123;   //声明要分配的网段地址</span><br><span class="line">        range <span class="number">10.10</span>.<span class="number">0.150</span> <span class="number">10.10</span>.<span class="number">0.240</span>;       //分配地址池</span><br><span class="line">        option routers  <span class="number">10.10</span>.<span class="number">0.202</span>;//指定默认网关</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ t2]# dhclient -d    //-d是前台运行，不用-d是后台运行</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以看到IP地址是10.10.0.151,可能是第一个10.10.0.150被我刚开始更改为dhcp的仅主机模式的t1服务器给占了,网关是设置的10.10.0.202</span></span><br></pre></td></tr></table></figure><p>持续更新中…<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NFS的使用</title>
      <link href="/posts/1309af80.html"/>
      <url>/posts/1309af80.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>一、NFS的使用</p></div></div><div class="note default orange simple"><p>nfs是对服务器的文件夹共享，属于NAS中的一中，可以实现多个服务器读写共享文件</p></div><h4 id="1-环境">1.环境</h4><table><thead><tr><th style="text-align:center">IP</th><th style="text-align:center">HOSTNAME</th><th style="text-align:center">ROLE</th></tr></thead><tbody><tr><td style="text-align:center">10.10.0.1</td><td style="text-align:center">nfs</td><td style="text-align:center">server</td></tr><tr><td style="text-align:center">10.10.0.2</td><td style="text-align:center">client</td><td style="text-align:center">client</td></tr></tbody></table><h4 id="2-使用">2.使用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ nfs,client]# cat &gt; /etc/hosts &lt;&lt;END</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">10.10.0.1nfs</span><br><span class="line">10.10.0.2client</span><br><span class="line">END</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">nfs</span>]<span class="comment"># yum install -y nfs-utils rpcbind</span></span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">client</span>]<span class="comment"># yum install -y nfs-utils</span></span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">nfs</span>]<span class="comment"># mkdir /nfs         //创建一个目录用于测试</span></span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">nfs</span>]<span class="comment"># echo &#x27;nfs test&#x27; &gt; /nfs/t1</span></span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">nfs</span>]<span class="comment"># vim /etc/exports   //nfs服务的主配置文件，nfs的下载不会自动创建这个文件</span></span><br><span class="line">/nfs/<span class="keyword">data</span>*(rw,sync,no_root_squash)     //*代表所有的IP都可以访问挂载</span><br><span class="line"><span class="comment">#文件的编写</span></span><br><span class="line">共享主机：</span><br><span class="line">*   ：代表所有主机</span><br><span class="line"><span class="number">10.10</span>.<span class="number">0.0</span>/<span class="number">24</span>：代表共享给某个网段<span class="number">10.10</span>.<span class="number">0.1</span> ~ <span class="number">10.10</span>.<span class="number">0.254</span></span><br><span class="line"><span class="number">10.10</span>.<span class="number">0.0</span>/<span class="number">24</span>(rw) <span class="number">10.10</span>.<span class="number">1.0</span>/<span class="number">24</span>(ro) :代表共享给不同网段</span><br><span class="line"><span class="number">10.10</span>.<span class="number">0.10</span>：共享给某个IP</span><br><span class="line">*.linjiangyu.com:代表共享给某个域下的所有主机</span><br><span class="line"></span><br><span class="line">共享选项：</span><br><span class="line">ro：只读</span><br><span class="line">rw：读写</span><br><span class="line">sync：实时同步，直接写入磁盘(安全性最高)</span><br><span class="line">async：异步，先缓存数据在内存然后再同步磁盘(效率最高，但是有丢失文件风险)</span><br><span class="line">anonuid：设置访问nfs服务的用户的uid，uid需要在/etc/passwd中存在</span><br><span class="line">anongid：设置访问nfs服务的用户的gid</span><br><span class="line">root_squash ：默认选项 root用户创建的文件的属主和属组都变成nfsnobody,其他人nfs<span class="literal">-server</span>端是它自己，client端是nobody。(访问NFS服务器时，映射为匿名账号)</span><br><span class="line">no_root_squash：root用户创建的文件属主和属组还是root，其他人server端是它自己uid，client端是nobody。(访问NFS服务器时，映射为root管理员账号)</span><br><span class="line">all_squash： 不管是root还是其他普通用户创建的文件的属主和属组都是nfsnobody</span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line">anonuid和anongid参数和all_squash一起使用。</span><br><span class="line">all_squash表示不管是root还是其他普通用户从客户端所创建的文件在服务器端的拥有者和所属组都是nfsnobody；服务端为了对文件做相应管理，可以设置anonuid和anongid进而指定文件的拥有者和所属组</span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">nfs</span>]<span class="comment"># exportfs -rv  //显示当前nfs的共享</span></span><br><span class="line">exporting *:/nfs/<span class="keyword">data</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">client</span>]<span class="comment"># showmount -e nfs   //查看主机的共享文件夹</span></span><br><span class="line">Export list <span class="keyword">for</span> nfs:</span><br><span class="line">/nfs *</span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">client</span>]<span class="comment"># mkdir /nfs/data </span></span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">client</span>]<span class="comment"># mount.nfs nfs:/nfs/data /nfs  //把nfs服务器的文件夹挂载在/nfs上</span></span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">client</span>]<span class="comment"># df -Th /nfs   //查看挂载</span></span><br><span class="line">Filesystem     <span class="built_in">Type</span>  Size  Used Avail Use% Mounted on</span><br><span class="line">nfs:/nfs/<span class="keyword">data</span>       nfs4   <span class="number">15</span>G   <span class="number">66</span>M   <span class="number">15</span>G   <span class="number">1</span>% /nfs</span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">client</span>]<span class="comment"># ls /nfs</span></span><br><span class="line">t1</span><br><span class="line">[<span class="type">root</span><span class="selector-tag">@</span> <span class="type">client</span>]<span class="comment"># cat /nfs/t1</span></span><br><span class="line">nfs test</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>每次的重启服务器都要重新挂载，所以我们要写在/etc/fstab文件中实现自动开机挂载</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ nfs]# vim /etc/fstab</span><br><span class="line">nfs:/nfs/data/nfsnfsrw,sync,no_root_squash0 0</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>二、自动挂卸载的实现</p></div></div><h4 id="autofs的使用">autofs的使用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@ client]# yum install autofs -y </span><br><span class="line">[root@ client]# mkdir /nfs</span><br><span class="line">[root@ client]# vim /etc/exports</span><br><span class="line">/nfs/data*(rw,sync,no_root_squash)</span><br><span class="line">[root@ client]# vim /etc/auto.master</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加</span></span><br><span class="line">/nfs    /etc/auto.nfs -t 120    //-t 120是表示在120秒内无操作自动卸载</span><br><span class="line">[root@ client]# cp /etc/auto.misc /etc/auto.nfs</span><br><span class="line">[root@ client]# vim /etc/auto.nfs</span><br><span class="line">data-fstype=nfs,rw,sync,no_root_squashnfs:/nfs/data</span><br><span class="line">[root@ client]# systemctl start autofs</span><br><span class="line">[root@ client]# df -Th   </span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                 898M     0  898M   0% /dev</span><br><span class="line">tmpfs                    910M     0  910M   0% /dev/shm</span><br><span class="line">tmpfs                    910M  9.6M  901M   2% /run</span><br><span class="line">tmpfs                    910M     0  910M   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root   15G   66M   15G   1% /</span><br><span class="line">/dev/mapper/centos-usr    24G  1.6G   22G   7% /usr</span><br><span class="line">/dev/sr0                 9.5G  9.5G     0 100% /iso</span><br><span class="line">/dev/sda1                759M  151M  609M  20% /boot</span><br><span class="line">/dev/mapper/centos-home   15G   33M   15G   1% /home</span><br><span class="line">/dev/mapper/centos-tmp   3.8G   33M  3.7G   1% /tmp</span><br><span class="line">/dev/mapper/centos-var    15G  890M   15G   6% /var</span><br><span class="line">tmpfs                    182M     0  182M   0% /run/user/0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">是不会出现nfs的挂载的</span></span><br><span class="line">[root@ client]# cd /nfs</span><br><span class="line">[root@ client]# ls</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现是无内容的</span></span><br><span class="line">[root@ client]# cd data //进去了</span><br><span class="line">[root@ client]# ls </span><br><span class="line">t1</span><br><span class="line">[root@ client]# df -Th ./</span><br><span class="line">nfs:/nfs/data  nfs4   15G   66M   15G   1% /nfs/data</span><br><span class="line">[root@ client]# cd</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">等待120分钟,<span class="built_in">df</span> -Th，会发现已经卸载</span></span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>三、使用ansible-playbook的自动化搭建</p></div></div><div class="note default orange simple"><p>环境:</p></div><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@ master]</span># vim /etc/hosts</span><br><span class="line"><span class="number">127.0.0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"><span class="number">192.168.222.150</span> master</span><br><span class="line"><span class="number">192.168.222.151</span> node1</span><br><span class="line"><span class="number">192.168.222.152</span> node2</span><br><span class="line"><span class="string">[root@ master]</span># yum install -y ansible</span><br><span class="line"><span class="string">[root@ master]</span># for i in master node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;do ssh-copy-id $i;done</span><br><span class="line"><span class="string">[root@ master]</span># vim /etc/ansible/hosts</span><br><span class="line"><span class="string">[demo]</span></span><br><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>example:</p></div><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">[root@ master]# vim ./t1.yaml</span></span><br><span class="line"><span class="attribute">- hosts</span><span class="punctuation">:</span> <span class="string">master</span></span><br><span class="line">  <span class="attribute">remote_user</span><span class="punctuation">:</span> <span class="string">root</span></span><br><span class="line">  <span class="attribute">tasks</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: install nfs packages</span></span><br><span class="line">    <span class="attribute">yum</span><span class="punctuation">:</span> <span class="string">name=&#123;&#123; item &#125;&#125; state=latest</span></span><br><span class="line">    <span class="attribute">with_items</span><span class="punctuation">:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nfs-utils</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">rpcbind</span></span><br><span class="line">    <span class="attribute">when</span><span class="punctuation">:</span> <span class="string">ansible_os_family == &quot;RedHat&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: mkdir /nfs</span></span><br><span class="line">    <span class="attribute">file</span><span class="punctuation">:</span> <span class="string">path=/nfs state=directory</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: nfs conf setting</span></span><br><span class="line">    <span class="attribute">copy</span><span class="punctuation">:</span> <span class="string">content=&quot;/nfs *(rw,sync,no_root_squash)&quot; dest=/etc/exports</span></span><br><span class="line">    <span class="attribute">notify</span><span class="punctuation">:</span> <span class="string">restart nfs.service</span></span><br><span class="line">  <span class="attribute">handlers</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: restart nfs.service</span></span><br><span class="line">    <span class="attribute">service</span><span class="punctuation">:</span> <span class="string">name=&#123;&#123; item &#125;&#125; state=restarted</span></span><br><span class="line">    <span class="attribute">with_items</span><span class="punctuation">:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nfs</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">rpcbind</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">hosts: node</span></span><br><span class="line">  <span class="attribute">remote_user</span><span class="punctuation">:</span> <span class="string">root</span></span><br><span class="line">  <span class="attribute">tasks</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: /etc/hosts file</span></span><br><span class="line">    <span class="attribute">copy</span><span class="punctuation">:</span> <span class="string">src=/etc/hosts dest=/etc/hosts force=yes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: install nfs client package</span></span><br><span class="line">    <span class="attribute">yum</span><span class="punctuation">:</span> <span class="string">name=nfs-utils state=latest</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: mkdir mount directory</span></span><br><span class="line">    <span class="attribute">file</span><span class="punctuation">:</span> <span class="string">path=/nfs state=directory</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: client nfs-server</span></span><br><span class="line">    <span class="attribute">command</span><span class="punctuation">:</span> <span class="string">&quot;mount.nfs master:/nfs /nfs&quot;</span></span><br><span class="line">[root@ master]# ansible-playbook ./t1.yaml</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>已经是搭建好了，到各工作节点查看</p></div><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ node1,<span class="number">2</span>]<span class="comment"># df -h /nfs</span></span><br><span class="line">master:<span class="regexp">/nfs               15G  465M   15G   4% /</span>nfs</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vsftpd的简单搭建</title>
      <link href="/posts/d38cd35f.html"/>
      <url>/posts/d38cd35f.html</url>
      
        <content type="html"><![CDATA[<h3 id="vsftpd服务器搭建">vsftpd服务器搭建</h3><h4 id="1-环境">1.环境</h4><table><thead><tr><th style="text-align:center">IP</th><th style="text-align:center">HOTSNAME</th><th style="text-align:center">RULE</th></tr></thead><tbody><tr><td style="text-align:center">192.168.222.100</td><td style="text-align:center">vsftpd</td><td style="text-align:center">server</td></tr><tr><td style="text-align:center">192.168.222.101</td><td style="text-align:center">client</td><td style="text-align:center">client</td></tr></tbody></table><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cat &gt; /etc/hosts&lt;&lt;END</span><br><span class="line"><span class="number">127.0.0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"><span class="number">192.168.222.100</span> vsftpd</span><br><span class="line"><span class="number">192.168.222.101</span> client</span><br><span class="line">END</span><br></pre></td></tr></table></figure><h4 id="2-配置">2.配置</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@ vsftpd]</span><span class="comment"># yum install -y vsftpd</span></span><br><span class="line"><span class="section">[root@ vsftpd]</span><span class="comment"># useradd test</span></span><br><span class="line"><span class="section">[root@ vsftpd]</span><span class="comment"># echo 123 | passwd --stdin test</span></span><br><span class="line"><span class="section">[root@ vsftpd]</span><span class="comment"># mkdir -p /data/test</span></span><br><span class="line"><span class="section">[root@ vsftpd]</span><span class="comment"># cp -a /etc/passwd /data/test/</span></span><br><span class="line"><span class="section">[root@ vsftpd]</span><span class="comment"># chown -R test. /data</span></span><br><span class="line"><span class="section">[root@ vsftpd]</span><span class="comment"># cat /etc/vsftpd/vsftpd.conf</span></span><br><span class="line"><span class="attr">local_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">#写总开关</span></span><br><span class="line"><span class="attr">write_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">#file:644 dircovrty:755（mask）</span></span><br><span class="line"><span class="attr">local_umask</span>=<span class="number">022</span></span><br><span class="line"><span class="comment">#指定用户访问目录</span></span><br><span class="line"><span class="attr">local_root</span>=/data/test</span><br><span class="line"><span class="comment">#限定用户只能在/data/lt目录下活动</span></span><br><span class="line"><span class="attr">chroot_local_user</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">#给限定用户写入的权限</span></span><br><span class="line"><span class="attr">allow_writeable_chroot</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">#启用消息功能</span></span><br><span class="line"><span class="attr">dirmessage_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">#启用xferlog日志</span></span><br><span class="line"><span class="attr">xferlog_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">#支持主动模式(默认被动)</span></span><br><span class="line"><span class="attr">connect_from_port_20</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">#xferlog日志格式</span></span><br><span class="line"><span class="attr">xferlog_std_format</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">#ftp服务独立模式下的监听</span></span><br><span class="line"><span class="attr">listen</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">#是否支持IPv6(不支持的话一定要注释或者NO)</span></span><br><span class="line"><span class="comment">#listen_ipv6=YES</span></span><br><span class="line"><span class="comment">#指定认证文件</span></span><br><span class="line"><span class="attr">pam_service_name</span>=vsftpd</span><br><span class="line"><span class="comment">#启用用户列表</span></span><br><span class="line"><span class="attr">userlist_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">#支持tcp_wrappers功能(传输限速)</span></span><br><span class="line"><span class="attr">tcp_wrappers</span>=<span class="literal">YES</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以上是我配置完了的</p></div><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@ clinet]# yum install -<span class="keyword">y</span> ftp</span><br><span class="line">[root@client ~]# ftp vsftpd</span><br><span class="line">Connected <span class="keyword">to</span> <span class="number">192.168</span>.<span class="number">222.100</span> (<span class="number">192.168</span>.<span class="number">222.100</span>).</span><br><span class="line"><span class="number">220</span> (vsFTPd <span class="number">3.0</span>.<span class="number">2</span>)</span><br><span class="line">Name (<span class="number">192.168</span>.<span class="number">222.100</span>:root): test</span><br><span class="line"><span class="number">331</span> Please specify the password.</span><br><span class="line">Password:</span><br><span class="line"><span class="number">230</span> Login successful.</span><br><span class="line">Remote <span class="built_in">system</span> <span class="built_in">type</span> <span class="keyword">is</span> UNIX.</span><br><span class="line">Using binary <span class="keyword">mode</span> <span class="keyword">to</span> transfer <span class="keyword">files</span>.</span><br><span class="line">ftp&gt; ? //？或者<span class="keyword">help</span>可以显示命令帮助</span><br><span class="line">ftp&gt; <span class="built_in">get</span> passwd   //获取当前目录的passwd文件到本地</span><br></pre></td></tr></table></figure><p>持续更新…<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DNS服务器搭建</title>
      <link href="/posts/37824039.html"/>
      <url>/posts/37824039.html</url>
      
        <content type="html"><![CDATA[<h3 id="DNS服务器搭建">DNS服务器搭建</h3><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h4 id="1-环境准备">1.环境准备</h4></div></div><table><thead><tr><th style="text-align:center">HOSTNAME</th><th style="text-align:center">HOSTNAME</th><th style="text-align:center">AUTH</th></tr></thead><tbody><tr><td style="text-align:center">192.168.222.219</td><td style="text-align:center"><a href="http://node1.com">node1.com</a></td><td style="text-align:center">master</td></tr><tr><td style="text-align:center">192.168.222.220</td><td style="text-align:center"><a href="http://node2.com">node2.com</a></td><td style="text-align:center">work</td></tr><tr><td style="text-align:center">192.168.222.221</td><td style="text-align:center"><a href="http://node3.com">node3.com</a></td><td style="text-align:center">work</td></tr><tr><td style="text-align:center">192.168.222.222</td><td style="text-align:center"><a href="http://node4.com">node4.com</a></td><td style="text-align:center">NFS,DNS</td></tr></tbody></table><div class="note default orange simple"><p>环境我是基于k8s搭建zookeeper的，懒得改</p></div><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@ nodeX</span>]<span class="meta"># sed -ri &#x27;s/(DNS.*)=.*/\1=192.168.222.222/g&#x27; /etc/sysconfig/ifcfg-ens33</span></span><br><span class="line">[<span class="meta">root@ nodeX</span>]<span class="meta"># systemctl restart ens33</span></span><br><span class="line">[<span class="meta">root@ nodeX</span>]<span class="meta"># yum install -y bind-utils</span></span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h4 id="2-DNS服务器的配置">2.DNS服务器的配置</h4></div></div><h4 id="2-1-正向解析">2.1 正向解析</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ node4]# yum install -y bind</span><br><span class="line">[root@ node4]# vim /etc/named.conf    #修改两项</span><br><span class="line"><span class="keyword">listen</span>-<span class="keyword">on</span> port <span class="number">53</span> &#123; <span class="keyword">any</span>; &#125;;</span><br><span class="line">allow-query&#123; <span class="keyword">any</span>; &#125;;</span><br><span class="line">[root@ node4]# cat /etc/named.rfc1912.zone</span><br><span class="line"><span class="type">zone</span> &quot;0.in-addr.arpa&quot; <span class="keyword">IN</span> &#123;</span><br><span class="line">        <span class="keyword">type</span> master;</span><br><span class="line">        file &quot;named.empty&quot;;</span><br><span class="line">        allow-<span class="keyword">update</span> &#123; <span class="keyword">none</span>; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>把这5行复制到最下面4遍。</p></div><p>修改为</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">&quot;node1.com&quot;</span> IN &#123;</span><br><span class="line">        type master<span class="comment">;</span></span><br><span class="line">        file <span class="string">&quot;node1.com.zone&quot;</span><span class="comment">;</span></span><br><span class="line">        allow-update &#123; none<span class="comment">; &#125;;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;node2.com&quot;</span> IN &#123;</span><br><span class="line">        type master<span class="comment">;</span></span><br><span class="line">        file <span class="string">&quot;node2.com.zone&quot;</span><span class="comment">;</span></span><br><span class="line">        allow-update &#123; none<span class="comment">; &#125;;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;node3.com&quot;</span> IN &#123;</span><br><span class="line">        type master<span class="comment">;</span></span><br><span class="line">        file <span class="string">&quot;node3.com.zone&quot;</span><span class="comment">;</span></span><br><span class="line">        allow-update &#123; none<span class="comment">; &#125;;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;node4.com&quot;</span> IN &#123;</span><br><span class="line">        type master<span class="comment">;</span></span><br><span class="line">        file <span class="string">&quot;node4.com.zone&quot;</span><span class="comment">;</span></span><br><span class="line">        allow-update &#123; none<span class="comment">; &#125;;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@ node4]# cd /var/named</span><br><span class="line">[root@ node4]# cp -a named.localhost ./&#123;node1.com.zone,node2.com.zone,node3.com.zone,node4.com.zone&#125;</span><br><span class="line">分别改为</span><br><span class="line">[root@ node4]# cat node*.com.zone</span><br><span class="line">$TTL 1D</span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line"><span class="code">                                        0       ; serial</span></span><br><span class="line"><span class="code">                                        1D      ; refresh</span></span><br><span class="line"><span class="code">                                        1H      ; retry</span></span><br><span class="line"><span class="code">                                        1W      ; expire</span></span><br><span class="line"><span class="code">                                        3H )    ; minimum</span></span><br><span class="line"><span class="code">        NS      @</span></span><br><span class="line"><span class="section">@A   192.168.222.219</span></span><br><span class="line"><span class="section">----------------------------------------------------------</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line"><span class="code">                                        0       ; serial</span></span><br><span class="line"><span class="code">                                        1D      ; refresh</span></span><br><span class="line"><span class="code">                                        1H      ; retry</span></span><br><span class="line"><span class="code">                                        1W      ; expire</span></span><br><span class="line"><span class="code">                                        3H )    ; minimum</span></span><br><span class="line"><span class="code">        NS      @</span></span><br><span class="line"><span class="section">www     A       192.168.222.220</span></span><br><span class="line"><span class="section">----------------------------------------------------------</span></span><br><span class="line">$TTL 1D</span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line"><span class="code">                                        0       ; serial</span></span><br><span class="line"><span class="code">                                        1D      ; refresh</span></span><br><span class="line"><span class="code">                                        1H      ; retry</span></span><br><span class="line"><span class="code">                                        1W      ; expire</span></span><br><span class="line"><span class="code">                                        3H )    ; minimum</span></span><br><span class="line"><span class="code">        NS      @</span></span><br><span class="line"><span class="section">www     A       192.168.222.221</span></span><br><span class="line"><span class="section">----------------------------------------------------------</span></span><br><span class="line">$TTL 1D</span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line"><span class="code">                                        0       ; serial</span></span><br><span class="line"><span class="code">                                        1D      ; refresh</span></span><br><span class="line"><span class="code">                                        1H      ; retry</span></span><br><span class="line"><span class="code">                                        1W      ; expire</span></span><br><span class="line"><span class="code">                                        3H )    ; minimum</span></span><br><span class="line"><span class="code">        NS      @</span></span><br><span class="line">@       A       192.168.222.222</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 可以使用named-checkconf <span class="regexp">/etc/</span>named.conf <span class="regexp">/etc/</span>named.conf (<span class="regexp">/etc/</span>named.rfc1912.zone <span class="regexp">/etc/</span>named.rfc1912.zone) 检测配置文件</span><br><span class="line"># name-checkzone node(<span class="number">1</span>-<span class="number">4</span>).com.zone node(<span class="number">1</span>-<span class="number">4</span>).com.zone</span><br><span class="line"># systemctl restart named  <span class="comment">//重启服务，让配置生效</span></span><br></pre></td></tr></table></figure><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># nslookup node1.com</span></span><br><span class="line"><span class="symbol">Server:</span>         <span class="number">192.168</span><span class="number">.222</span><span class="number">.222</span></span><br><span class="line"><span class="symbol">Address:</span>        <span class="number">192.168</span><span class="number">.222</span><span class="number">.222</span><span class="meta">#53</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">Name:</span>   node1.com</span><br><span class="line"><span class="symbol">Address:</span> <span class="number">192.168</span><span class="number">.222</span><span class="number">.219</span></span><br><span class="line"><span class="meta">#其余也是一样</span></span><br></pre></td></tr></table></figure><h4 id="2-2-反向解析">2.2 反向解析</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ node4]# cat /etc/named.rpc1912.zone</span><br><span class="line"><span class="type">zone</span> &quot;1.0.0.127.in-addr.arpa&quot; <span class="keyword">IN</span> &#123;</span><br><span class="line">        <span class="keyword">type</span> master;</span><br><span class="line">        file &quot;named.loopback&quot;;</span><br><span class="line">        allow-<span class="keyword">update</span> &#123; <span class="keyword">none</span>; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">#还是把这<span class="number">5</span>行复制<span class="number">4</span>次</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@ node4]# cat /etc/named.rpc1912.zone</span><br><span class="line"><span class="type">zone</span> &quot;219.222.168.192.in-addr.arpa&quot; <span class="keyword">IN</span> &#123;</span><br><span class="line">        <span class="keyword">type</span> master;</span><br><span class="line">        file &quot;192.168.222.219.zone&quot;;</span><br><span class="line">        allow-<span class="keyword">update</span> &#123; <span class="keyword">none</span>; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">zone</span> &quot;220.222.168.192.in-addr.arpa&quot; <span class="keyword">IN</span> &#123;</span><br><span class="line">        <span class="keyword">type</span> master;</span><br><span class="line">        file &quot;192.168.222.220.zone&quot;;</span><br><span class="line">        allow-<span class="keyword">update</span> &#123; <span class="keyword">none</span>; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">zone</span> &quot;221.222.168.192.in-addr.arpa&quot; <span class="keyword">IN</span> &#123;</span><br><span class="line">        <span class="keyword">type</span> master;</span><br><span class="line">        file &quot;192.168.222.221.zone&quot;;</span><br><span class="line">        allow-<span class="keyword">update</span> &#123; <span class="keyword">none</span>; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">zone</span> &quot;222.222.168.192.in-addr.arpa&quot; <span class="keyword">IN</span> &#123;</span><br><span class="line">        <span class="keyword">type</span> master;</span><br><span class="line">        file &quot;192.168.222.222.zone&quot;;</span><br><span class="line">        allow-<span class="keyword">update</span> &#123; <span class="keyword">none</span>; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@ node4]# cd /var/named</span><br><span class="line">[root@ node4]# cp ./named.loopback ./<span class="number">192.168.222.219</span>.zone</span><br><span class="line">[root@ node4]# cp ./named.loopback ./<span class="number">192.168.222.220</span>.zone</span><br><span class="line">[root@ node4]# cp ./named.loopback ./<span class="number">192.168.222.221</span>.zone</span><br><span class="line">[root@ node4]# cp ./named.loopback ./<span class="number">192.168.222.222</span>.zone</span><br><span class="line">[root@ node4]# cat ./<span class="number">192.168.222.2</span>*.zone</span><br><span class="line"><span class="meta">$TTL</span> <span class="number">1</span>D</span><br><span class="line">@       <span class="keyword">IN</span> <span class="keyword">SOA</span>  @ rname.invalid. (</span><br><span class="line">                                        <span class="number">0</span>       <span class="comment">; serial</span></span><br><span class="line">                                        <span class="number">1</span>D      <span class="comment">; refresh</span></span><br><span class="line">                                        <span class="number">1</span>H      <span class="comment">; retry</span></span><br><span class="line">                                        <span class="number">1</span>W      <span class="comment">; expire</span></span><br><span class="line">                                        <span class="number">3</span>H )    <span class="comment">; minimum</span></span><br><span class="line">        <span class="keyword">NS</span>      @</span><br><span class="line">        <span class="keyword">A</span>       <span class="number">127.0.0.1</span></span><br><span class="line">        <span class="keyword">AAAA</span>    <span class="number">::1</span></span><br><span class="line">        <span class="keyword">PTR</span>     node1.com.</span><br><span class="line"><span class="number">19</span>      <span class="keyword">PTR</span>     node1.com.</span><br><span class="line">---------------------------------------------------------</span><br><span class="line"><span class="meta">$TTL</span> <span class="number">1</span>D</span><br><span class="line">@       <span class="keyword">IN</span> <span class="keyword">SOA</span>  @ rname.invalid. (</span><br><span class="line">                                        <span class="number">0</span>       <span class="comment">; serial</span></span><br><span class="line">                                        <span class="number">1</span>D      <span class="comment">; refresh</span></span><br><span class="line">                                        <span class="number">1</span>H      <span class="comment">; retry</span></span><br><span class="line">                                        <span class="number">1</span>W      <span class="comment">; expire</span></span><br><span class="line">                                        <span class="number">3</span>H )    <span class="comment">; minimum</span></span><br><span class="line">        <span class="keyword">NS</span>      @</span><br><span class="line">        <span class="keyword">A</span>       <span class="number">127.0.0.1</span></span><br><span class="line">        <span class="keyword">AAAA</span>    <span class="number">::1</span></span><br><span class="line">        <span class="keyword">PTR</span>     node2.com.</span><br><span class="line"><span class="number">20</span>      <span class="keyword">PTR</span>     node2.com.</span><br><span class="line">---------------------------------------------------------</span><br><span class="line"><span class="meta">$TTL</span> <span class="number">1</span>D</span><br><span class="line">@       <span class="keyword">IN</span> <span class="keyword">SOA</span>  @ rname.invalid. (</span><br><span class="line">                                        <span class="number">0</span>       <span class="comment">; serial</span></span><br><span class="line">                                        <span class="number">1</span>D      <span class="comment">; refresh</span></span><br><span class="line">                                        <span class="number">1</span>H      <span class="comment">; retry</span></span><br><span class="line">                                        <span class="number">1</span>W      <span class="comment">; expire</span></span><br><span class="line">                                        <span class="number">3</span>H )    <span class="comment">; minimum</span></span><br><span class="line">        <span class="keyword">NS</span>      @</span><br><span class="line">        <span class="keyword">A</span>       <span class="number">127.0.0.1</span></span><br><span class="line">        <span class="keyword">AAAA</span>    <span class="number">::1</span></span><br><span class="line">        <span class="keyword">PTR</span>     node3.com.</span><br><span class="line"><span class="number">21</span>      <span class="keyword">PTR</span>     node3.com.</span><br><span class="line">---------------------------------------------------------</span><br><span class="line"><span class="meta">$TTL</span> <span class="number">1</span>D</span><br><span class="line">@       <span class="keyword">IN</span> <span class="keyword">SOA</span>  @ rname.invalid. (</span><br><span class="line">                                        <span class="number">0</span>       <span class="comment">; serial</span></span><br><span class="line">                                        <span class="number">1</span>D      <span class="comment">; refresh</span></span><br><span class="line">                                        <span class="number">1</span>H      <span class="comment">; retry</span></span><br><span class="line">                                        <span class="number">1</span>W      <span class="comment">; expire</span></span><br><span class="line">                                        <span class="number">3</span>H )    <span class="comment">; minimum</span></span><br><span class="line">        <span class="keyword">NS</span>      @</span><br><span class="line">        <span class="keyword">A</span>       <span class="number">127.0.0.1</span></span><br><span class="line">        <span class="keyword">AAAA</span>    <span class="number">::1</span></span><br><span class="line">        <span class="keyword">PTR</span>     node4.com.</span><br><span class="line"><span class="number">22</span>      <span class="keyword">PTR</span>     node4.com.</span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@ node4]</span># systemctl restart named</span><br><span class="line"><span class="string">[root@ nodeX]</span># nslookup <span class="number">192</span>.<span class="number">168</span>.<span class="number">222</span>.<span class="number">219</span></span><br><span class="line"><span class="number">219.222.168.192</span>.in-addr.arpa    name = node1.com.</span><br></pre></td></tr></table></figure><p>以上。<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker详解</title>
      <link href="/posts/e58e69dc.html"/>
      <url>/posts/e58e69dc.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="一、Docker特性。">一、Docker特性。</h3></div></div><p><strong>文件系统隔离</strong>：每个进程容器运行在一个完全独立的根文件系统里。</p><p><strong>资源隔离</strong>：系统资源，像CPU和内存等可以分配到不同的容器中，使用cgroup。<br><strong>网络隔离</strong>：每个进程容器运行在自己的网路空间，虚拟接口和IP地址。</p><p><strong>日志记录</strong>：Docker将收集到和记录的每个进程容器的标准流（stdout/stderr/stdin），用于实时检索或者批量检索</p><p><strong>变更管理</strong>：容器文件系统的变更可以提交到新的镜像中，并可重复使用以创建更多的容器。无需使用模板或者手动配置。</p><p><strong>交互式shell</strong>：Docker可以分配一个虚拟终端并且关联到任何容器的标准输出上，例如运行一个一次性交互shell。</p><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="二、Docker的安装。">二、Docker的安装。</h3></div></div><h4 id="1、docker安装背景。">1、docker安装背景。</h4><p>你们知道docker有几种安装方式吗？<br>它们又有那些区别呢？<br>==Docker安装：==</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、yum -y install docker</span><br><span class="line"><span class="number">2</span>、yum -y install docker-engine</span><br><span class="line"><span class="number">3</span>、yum -y install docker-ce</span><br></pre></td></tr></table></figure><p>是的，有三种安装方式，而且，它们都是正确的！<br>因为Docker最早的版本名是docker和docker-engin，现在的名字是docker-ce和docker-ee。有兴趣的小伙伴可以通过下方链接去官网查看。</p><p>==https//docs.docker.com/install/linux/docker-ce/centos==<br>2017年初，docker公司将原先的docker开源项目改名为<strong>moby。</strong><br>moby是集成了原先的docker项目，是社区维护的开源项目，谁都可以在moby的基础打造自己的容器产品。<br><strong>docker-ce 是docker公司维护的开源项目</strong>，是一个基于moby项目的免费容器产品。<br><strong>docker-ee 是docker公司维护的闭源产品</strong>，是docker公司的商业昌平。<br>注：moby是源代码，docker-ce 和docker-ee 是产品容器，rpm包。<br>所以，目前我们经常使用的版本当然是docker-ce啦！</p><h4 id="2、部署docker容器虚拟化平台并且配置docker镜像加速地址。">2、部署docker容器虚拟化平台并且配置docker镜像加速地址。</h4><p>实验环境：centos7.6    64位。网络要求能上外网。</p><h4 id="3、安装docker依赖环境。">3、安装docker依赖环境。</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure><p>这里作者已经安装过了，所以提示Nothing to do。</p><h4 id="4、配置国内docker-ce的yum源（这里采用的是阿里云）">4、配置国内docker-ce的yum源（这里采用的是阿里云）</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo http:<span class="comment">//mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span><br></pre></td></tr></table></figure><p>yum-config-manager命令作用是添加yum源。<br>敲完命令之后大家执行一下命令去看一下有没有配置成功。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><p>看到上图中的框框里的内容就代表配置成功了。</p><h4 id="5、安装docker。">5、安装docker。</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker-ce doker-ce-cli containerd.io</span><br></pre></td></tr></table></figure><p>安装速度可能会比较慢，请耐心等待。<br>docker-ce:docker程序<br>docker-ce-cli:<br>如果不知道包名的作用，可以使用yum info  程序 命令查看</p><h2 id="6、开启网络转发功能。">6、开启网络转发功能。</h2><p>默认会自动开启。<br>路径 ：==/proc/sys/net/ipv4/ip_forward==<br>手动开启：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf   #插入以下内容</span><br><span class="line">net.ipv4.forward =<span class="number">1</span></span><br><span class="line">-------------------------</span><br><span class="line">sysctl -p   #生效</span><br><span class="line">cat /proc/sys/net/ipv4/ip_forward  #查看结果，为<span class="number">1</span>开启成功。</span><br></pre></td></tr></table></figure><p><strong>如果没有开启网络转发，我们启动实例的时候就会报错！！！</strong></p><p>关闭防火墙：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">iptables -nL #查看一下iptable规则，关闭防火墙后会自动插入新规则</span><br><span class="line"></span><br><span class="line">systemctl stop firewalld &amp;&amp; systemctl disable firewalld  #关闭防火墙</span><br><span class="line"></span><br><span class="line">sysctlrem restart docker # 关闭防火墙要把docker重启一下，不然docker</span><br><span class="line">的ip包转发功能无法使用。即便防火墙关闭了，docker依旧会调用内核模块netfilter增加规则，所以会新增iptables规则</span><br><span class="line"></span><br><span class="line">iptables -nL #再查看一下iptable规则，会发现多出很多规则</span><br></pre></td></tr></table></figure><p>==iptables -nL==</p><h4 id="7、启动服务。">7、启动服务。</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker &amp;&amp; systemctl enable docker</span><br></pre></td></tr></table></figure><p>启动完成后会该网络参数，这个是ip转发会改成1。默认0<br>这里简单教大家第一个docker命令，==docker version==查看docker版本。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version #查看docker版本</span><br></pre></td></tr></table></figure><p>这里我们很清晰的可以看到docker是一个C/S架构的模式。客户端是我们的命令行操作，服务端是一个守护进程。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info  #查看docker基本信息</span><br></pre></td></tr></table></figure><p>我们可以通过==docker info==看到机器存放docker镜像得地址，也可以看到docker仓库的地址。</p><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="三、docker入门命令。">三、docker入门命令。</h3></div></div><h4 id="1、搜索镜像">1、搜索镜像</h4><p>==docker search==</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search centos #从docker hub中搜索docker名为centos的镜像</span><br></pre></td></tr></table></figure><p>大家可以看到搜索出来的最上一行有几个表头，这里给大家介绍一下<br><strong>name</strong>:代表此镜像的名称</p><p><strong>description</strong>：此镜像的描述</p><p><strong>stars</strong>：下载次数</p><p><strong>official</strong>：是否由官方提供（官方提供可放心下载，可以基于此镜像做自己的镜像）</p><h3 id="2、拉取镜像。">2、拉取镜像。</h3><p>docker pull== ，默认是拉去docker hub上搜索到的最新版本（第一个）。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure><p>注意，如果这里报错，TLS handshake timeout，那就是网络原因导致超时，尝试多pull几次。下面介绍配置镜像加速。</p><p>==使用阿里云docker镜像加速器。==<br>地址:<strong><a href="https://cr.console.aliyun.com">https://cr.console.aliyun.com</a></strong>的控制台，使用支付宝账号登录，左侧加速器帮助页面会为你显示<strong>独立的加速地址</strong>，这个加速地址每个人的都不同。<br><strong>可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器。<br>把自己的专属加速地址放到下面的地址改一下，写入文件就可以了。</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://eu5rxjvf.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload  #启动配置</span><br><span class="line">systemctl restart docker  #重启docker服务</span><br></pre></td></tr></table></figure><p>配置好了之后，我们使用之前学的命令，docker info查看一下是否新增了阿里云的地址。<br>可以看到此地址，代表配置成功。</p><p>然后继续使用docker pull centos，下载速度会很快。(由于作者已经下载了centos，这里使用tomcat镜像演示)</p><h4 id="3、查看镜像。">3、查看镜像。</h4><p>拉去之后我们要如何看到我们下载下来的镜像呢，这里我们就需要学习一个新命令。==docker images==，查看已下载镜像。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images  #查看已下载镜像。</span><br></pre></td></tr></table></figure><p>好了，这样就拉取下来了。</p><h4 id="4、使用U盘的方式导入镜像。">4、使用U盘的方式导入镜像。</h4><p>比如把docker-centos-httpd.tar镜像上传到linux上，就需要用到==docker load -i ==命令。(记得带上路径，这里作者没有钱买U盘，就不演示了)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -i /root/docker-centos-httpd.tar</span><br></pre></td></tr></table></figure><p>导入之后可以使用docker images查看。<br>注意上图，tag代表标签，image id代表镜像ID。这是我们区别镜像的方式。<br>另外提一下，还有一种直接下载其他站点镜像的方法，命令如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull hub.c<span class="number">.163</span>.com/library/tomcat:latest</span><br></pre></td></tr></table></figure><p>==注：docker镜像相当于，对程序+程序依赖的库直接打包（后期详细解释）。==</p><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="四、Docker平台的基本使用方法。">四、Docker平台的基本使用方法。</h3></div></div><p>很开心大家耐心的看到了这里，接下来我就会详细讲解docker的使用方法。</p><h4 id="1、帮助命令。">1、帮助命令。</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dockr version     #显示docker详细信息</span><br><span class="line">docker info       #显示docker的系统信息，包括镜像和容器的数量</span><br><span class="line">docker --helo     <span class="meta">#docker帮助命令手册</span></span><br></pre></td></tr></table></figure><h4 id="2、镜像命令。">2、镜像命令。</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker images  #查看所有本地主机的镜像</span><br><span class="line">docker search 镜像名           #搜索镜像</span><br><span class="line">docker pull 镜像名 [标签]      #下载镜像（如果不写tag，默认是latest）</span><br><span class="line">docker rmi 镜像名 [标签]       #删除镜像    docker rmi -f $(docker images -aq)  删除全部镜像</span><br><span class="line">docker tag  镜像名:版本   新镜像名:版本    #复制镜像并且修改名称</span><br><span class="line">docker commit  -a <span class="string">&quot;xxx&quot;</span>  -c <span class="string">&quot;xxx&quot;</span> 镜像ID 名字：版本   #提交镜像 </span><br><span class="line">-a :提交的镜像作者；</span><br><span class="line">-c :使用Dockerfile指令来创建镜像；</span><br><span class="line">-m :提交时的说明文字；</span><br><span class="line"></span><br><span class="line">docker load -i    /xxx/xxx.tar         #导入镜像</span><br><span class="line">docker save -o   /xxx/xxx.tar          #保存一个镜像为一个tar包</span><br></pre></td></tr></table></figure><h4 id="3、容器命令。">3、容器命令。</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image 命令 #启动容器（无镜像会先下载镜像）</span><br><span class="line">#参数说明</span><br><span class="line">--name = <span class="string">&quot;Name&quot;</span>   容器名字</span><br><span class="line">-c   后面跟待完成的命令</span><br><span class="line">-d   以后台方式运行并且返回ID，启动守护进程式容器</span><br><span class="line">-i   使用交互方式运行容器，通常与t同时使用</span><br><span class="line">-t   为容器重新分配一个伪输入终端。也即启动交互式容器</span><br><span class="line">-p   指定容器端口    -p 容器端口:物理机端口  映射端口</span><br><span class="line">-P   随机指定端口</span><br><span class="line">-v   给容器挂载存储卷</span><br><span class="line"></span><br><span class="line">docker build  #创建镜像        -f：指定dockerfile文件路径   -t：镜像名字以及标签</span><br><span class="line">docker logs 容器实例的ID          #查看容器日志</span><br><span class="line">docker rename 旧名字  新名字      # 给容器重新命名</span><br><span class="line">docker top    容器实例的ID                  #查看容器内进程</span><br><span class="line">docker ps -a                    #列出所有容器（不加-a就是在运行的）</span><br><span class="line">docker rm      容器实例的ID                 #删除容器（正在运行容器不能删除，除非加-f选项）</span><br><span class="line">docker kill  容器实例的ID        #杀掉容器</span><br><span class="line">docker history   容器实例的ID    #查看docker镜像的变更历史</span><br><span class="line">docker start 容器实例的ID        #启动容器</span><br><span class="line">docke restart 容器实例的ID       #重启容器</span><br><span class="line">docker stop 容器实例的ID         #停止正在运行的容器</span><br><span class="line">docker attach /docker exec  容器实例的ID   #同为进入容器命令，不同的是attach连接终止会让容器退出后台运行，而exec不会。并且，docker attach是进入正在执行的终端，不会情动新的进程，而docker exec则会开启一个新的终端，可以在里面操作。</span><br><span class="line">docker image inspect  容器名称：容器标签       #查看容器内源数据</span><br><span class="line">docker cp  容器id：容器内路径   目的主机路径           #从容器内拷贝文件到主机（常用）或者从主机拷贝到容器（一般用挂载）</span><br><span class="line"><span class="built_in">exit</span>                           #直接退出容器 </span><br><span class="line">crlt + P + Q                   #退出容器但是不终止运行</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="五、实战测试：部署Nginx。">五、实战测试：部署Nginx。</h3></div></div><h4 id="1、搜索镜像。">1、搜索镜像。</h4><p>==docker search nginx==<br>搜索到的这些镜像代表什么意思之前已经讲过了，这里我们直接选用最新版本的。</p><h4 id="2、下载镜像。">2、下载镜像。</h4><p>==docker pull nginx==<br>未指定nginx则直接下载最新版本</p><h4 id="3、查看镜像。-2">3、查看镜像。</h4><p>==docker images==<br>这里有作者下载的其他镜像。第一个就是我们刚刚下载的镜像。</p><h4 id="4、启动容器。">4、启动容器。</h4><p>==docker run -d --name nginx01 -p 80:80 nginx==<br>e56开头那个就是容器ID</p><h4 id="5、查看容器。">5、查看容器。</h4><p>==docker ps==</p><h4 id="6、测试访问。">6、测试访问。</h4><p>==curl 127.0.0.1:80==<br>127.0.0.1是本地回环ip，就是本机啦，可以用localhost代替。</p><h4 id="7、进入容器修改页面。">7、进入容器修改页面。</h4><p>==docker exec -it 容器ID /bin/bash==<br>whereis是一个搜索文件的小命令，不如find好用但是简洁。</p><h4 id="8、外网访问。">8、外网访问。</h4><p>用公网IP，这里作者有域名（顺便给自己的网站打个广告，作者喜欢写东西，如果有投稿之类的可以留言，我会筛选之后放到我的博客网站，当然也欢迎大家加入我，一起创建文字社区。<br>地址http://xiaodengzhp.xyz/wordpress/），所以用域名代替了。（注意，外网IP需要在云平台打开端口，由于作者偷懒映射的80，所以没有去打开，如果是其他端口，就要去打开。）<br>另外，像docker top 、docker cp、 docker stop等等命令这里就不再演示了，大家有兴趣的可以自行测试。<br>到了这里，相信你已经对docker有了一定的理解，应该能尝试着自己启动容器了吧。</p><h4 id="9、实战总结。">9、实战总结。</h4><p>有的小伙伴不理解为什么要加/bin/bash,或者什么时候该加什么时候不加，这里我给大家解释一下。<br>我们先看docker run的命令参数。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image 命令 #启动容器（无镜像会先下载镜像）</span><br><span class="line">#参数说明</span><br><span class="line">--name = <span class="string">&quot;Name&quot;</span>   容器名字</span><br><span class="line">-c   后面跟待完成的命令</span><br><span class="line">-d   以后台方式运行并且返回ID，启动守护进程式容器</span><br><span class="line">-i   使用交互方式运行容器，通常与t同时使用</span><br><span class="line">-t   为容器重新分配一个伪输入终端。也即启动交互式容器</span><br><span class="line">-p   指定容器端口    -p 容器端口:物理机端口  映射端口</span><br><span class="line">-P   随机指定端口</span><br><span class="line">-v   给容器挂载存储卷</span><br></pre></td></tr></table></figure><p>大家注意-i  、 -t 、  -d这几个参数。一般it连用表示给我一个可以操作的前台终端。第二个呢就是id，以后台守护进程的方式运行容器。这样，我们就可以总结出两种运行容器的命令模式。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">第一种：交互方式创建容器，退出后容器关闭。</span><br><span class="line">docker <span class="built_in">run</span> -<span class="keyword">it</span> 镜像名称:标签 /bin/bash</span><br><span class="line"></span><br><span class="line">第二种：守护进程方式创建容器。</span><br><span class="line">docker <span class="built_in">run</span> -<span class="built_in">id</span> 镜像名称:标签</span><br><span class="line">通过这种方式创建的容器，我们不会直接进入到容器界面，而是在后台运行了容器，</span><br><span class="line">如果我们需要进去，则还需要一个命令。</span><br><span class="line">docker exec -<span class="keyword">it</span>  镜像名称:标签  /bin/bash</span><br><span class="line">通过这种方式运行的容器，就不会自动退出了。</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="六、镜像原理。">六、镜像原理。</h3></div></div><h4 id="1、镜像是什么？">1、镜像是什么？</h4><p>镜像是一种轻量级的、可执行的独立软件包。用来打包软件运行环境和基于运行环境的开发软件，它包含运行某个软件所需要的内容，包括代码、运行时、库、环境变量和配置文件。</p><h4 id="2、Docker镜像加载原理。">2、Docker镜像加载原理。</h4><p>==UnionFS（联合文件系统）==<br>UnionFS（联合文件系统）：UnionFS文件系统是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层一层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像，可以制作各种各样的应用镜像。</p><p>特性：一次同时加载多个文件系统，但是从外面开起来，只能看一个文件系统，联合加载会把各层文件系统叠加起来，最终的文件系统会包含所有的底层文件和目录。</p><p>==Docker镜像加载原理==<br>docker的镜像实际上是由一层一层的文件系统组成，这种层级关系就叫<strong>UnionFS</strong>。<br><strong>bootfs</strong>（boot file system）主要包括bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就在内存中了，此时内存的使用权由bootfs转交给内核，此时系统会卸载bootfs。</p><p><strong>rootfs</strong>（root file system），在bootfs之上。包含的就是典型Linux系统的/dev, /proc, /bin, /etc等等标准文件。rootfs就是各种不同的操作系统发行版本，比如Ubuntu、CentOS等。</p><p>如下图：<br>对于一个精简的OS，rootfs可以很小，只需要包含最基本的命令、工具和程序即可，因为底层直接用Host的kernel，自己只需要提供rootfs即可。由此可见不同的Linux发行版本，bootfs基本上是一致的，rootfs会有差别，所以不同的发行版可以公用bootfs，这也是一个镜像仅有几百MB的原因。</p><h4 id="3、分层理解。">3、分层理解。</h4><p>这里我用docker pull nginx命令，下载来一个镜像给大家看看，框起来的是不是一层一层下载的。<br>那么docker为什么会使用这种方法呢？最大的好处，就是==资源共享==。比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需要在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有容器提供服务了，而且镜像的每一层都可以被共享。</p><p>我们通过==docker image inspect ngixn:latest==查看一下。<br>这里给大家举个栗子：<br>所有的docker镜像都起始于一个<strong>基础镜像层</strong>，当进行修改或者增加新的内容时，就会在当前镜像层之上，创建新的镜像层。假如基于Ubuntu Linux 16.04创建一个新的镜像，这就是新镜像的<strong>第一层</strong>；如果在该镜像中添加Python包，就会在基础镜像之上创建<strong>第二个镜像层</strong>；如果继续添加安全补丁，就会创建<strong>第三个镜像层</strong>。如下图：<br>在添加额外的镜像的同时，==镜像始终是当前所有镜像的组合==。比如我们在添加第三层安全补丁的时候，Ubuntu和Python视为一个镜像层，在此基础上再添加安全补丁镜像层。<br>docker镜像都是<strong>只读</strong>的，当容器启动时，一个新的可写层被加载到镜像的顶部。这一层就是我们所说的==容器层==，容器之下都叫镜像层。</p><h4 id="4、提交镜像。">4、提交镜像。</h4><p>这里大家看一下</p><h5 id="1、命令。">1、命令。</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line">docker commit -m=<span class="string">&quot;提交的描述信息&quot;</span>  -a=<span class="string">&quot;作者&quot;</span>  容器id  目标镜像名:[TAG]</span><br></pre></td></tr></table></figure><h5 id="2、实验。">2、实验。</h5><p>1、下载一个默认的tomcat，这里作者已经下载好了，就不用再下载了。<br>2、启动tomcat。<br>docker run -itd -p 8080:8080  tomcat:latest   /bin/bash<br>然后进入此容器<br>docker exiec -it [容器ID] /bin/bash<br>3、默认tomcat镜像的webapp网页文件里是没有东西的，我们要从webapps.dist中把它拷贝出来。<br>4、打开8080端口，在浏览器访问tomcat docker。<br><img src="https://img-blog.csdnimg.cn/f0585cc487fb4a12ae022d5e53036310.png#pic_center" alt="tomcat"><br>5、提交镜像。<br>==docker commit -a=“This my create tomcat” -m=“add webapps app” 81 tomcat02:1.0==<br>这里我们就制作了我们的第一个镜像，之后我还会教大家怎么将镜像发布到docker hub上。</p><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="七、Docker容器数据卷。">七、Docker容器数据卷。</h3></div></div><h4 id="1、容器数据卷介绍。">1、容器数据卷介绍。</h4><p>docker容器在产生数据的时候，如果不通过docker  commit生成新的镜像，使得数据作为镜像的一部分保存下来，那么当容器删除之后，数据自然而然的也会消失。为了能保存数据，容器中引用了<strong>数据卷</strong>的概念。</p><h4 id="2、作用以及特点。">2、作用以及特点。</h4><p>卷就是<strong>目录或者文件</strong>，存在一个或者多个容器之中，由docker挂载到容器，但是不属于联合文件系统，因此能够绕过Union File System提供一些用于持续存储或者共享数据的特性。</p><p>卷的设计目的就是<strong>数据的持久化</strong>，完全<strong>独立于容器的生存周期</strong>，因此docker不会再容器删除时删除其挂载的数据卷。</p><p>它还存在以下几种==特点==：</p><p>1、数据卷可在容器之间共享或者重用数据。<br>2、卷中的更改可以直接生效。<br>3、数据卷中的更改不会包含在镜像的更新中。<br>4、数据卷的生命周期一直持续到没有容器使用它为止。</p><h4 id="3、使用数据卷。">3、使用数据卷。</h4><p>方式一：直接使用命令来挂载 ，  -v</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录:容器目录 /bin/bash</span><br></pre></td></tr></table></figure><p>我们在创建容器之前，先看看挂载路径上有没有test01这个目录，可以看到，是没有的。执行命令之后进入到容器内，我们ls看一下容器的home目录，是空的。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /home/test01:/home centos /bin/bash</span><br></pre></td></tr></table></figure><p>另外打开一个终端，cd /home目录，这下我们发现多出来了一个test01目录，这个test01目录，就是我们刚刚启动的容器内部的home目录，并且，此时这两个目录是同步的状态，我们在home目录中写入任何新的文件，都会同步到主机home目录下的test01目录。</p><p>我们在这里测试一下，echo进去一个a.txt文件。<br>然后来到宿主机上，看一眼是不是test01目录下也出现了a.txt。(双向绑定)<br>当然，我们可以使用更简单的方法查看是否挂载成功，大家还记得是那条命令吗？没错，是<strong>docker inspect  容器ID</strong>。我们找到这个==Mounts==，它代表着挂载，<strong>type</strong>是类型（绑定），<strong>source</strong>是源（/home/test01），也就是把什么挂载到哪里。<strong>destination</strong>（home）就是挂载的目标路径了。<br>这里作者只演示了修改容器内文件同步到宿主机挂载文件。其实反过来也是一样的，这里就不再赘述了。之后如果要修容器内挂载文件，只需在我们本地挂载点修改就好了，它会自动同步到docker。</p><h4 id="4、具名挂载与匿名挂载。">4、具名挂载与匿名挂载。</h4><p>这里先教给大家一个新武器。<br>==docker volum ls==    #查看所有卷的情况。</p><h5 id="1、匿名挂载">1、匿名挂载</h5><p>我们首先使用匿名挂载的命令启动一个容器。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name=nginxt01 -v /etc/nginx nginx</span><br></pre></td></tr></table></figure><p>然后使用刚刚教给大家的新武器查看卷。<br>这里84开头的那一长串就是挂载到宿主机的名字。<br>我们继续追查下去。这里教给大家一个很简单的命令，less。如果输出的信息太多了，我们找不到，就可以这样使用<br>cmd   |  less         栗子：   docker inspect 84（容器ID）  | less<br>然后输入/name, name是你想查到的内容，就可以很轻松的找到啦。<br>大家仔细看一下，是不是/etc/nginx就是叫84开头的那一长串，挂载到了我/var/lib…路径下，我们复制这个路径继续去查看。<br>怎么样，是不是在我们的宿主机就发现了这样的一个文件呢？这就是所谓的匿名挂载！是不是很简单。</p><h5 id="2、具名挂载。">2、具名挂载。</h5><p>具名挂载就很简单了，跟我们之前演示的指定路径挂载很相似，这里给大家简单地演示一下。</p><p>同样，我们使用具名挂载的方式启动一个容器。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name=nginxt02 -v jumingguazai:/etc/nginx nginx</span><br></pre></td></tr></table></figure><p>docker volume ls 查看卷<br>docker inspect ID | less 找到挂载点。<br>我们再复制一下路径，找到nginx的配置文件。</p><p>这就是具名挂载。</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如何确定是具名挂载还是匿名挂载：</span><br><span class="line"><span class="literal">-</span>v  容器内路径               <span class="comment">#匿名挂在</span></span><br><span class="line"><span class="literal">-</span>v  卷名：容器内路径          <span class="comment">#具名挂在</span></span><br><span class="line"><span class="literal">-</span>v  /宿主机路径：容器内路径    <span class="comment"># 指定路径挂载</span></span><br></pre></td></tr></table></figure><p>tips：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">通过 -v 容器内路径  :ro   rw   可以改变读写权限</span><br><span class="line">ro  readonly   <span class="comment">#只读</span></span><br><span class="line">rw  readwrite  <span class="comment">#可写可读</span></span><br><span class="line">例： docker <span class="built_in">run</span> -d <span class="comment">--name nginx01 -v test01:/etc/nginx:ro nginx</span></span><br><span class="line">    docker <span class="built_in">run</span> -d <span class="comment">--name nginx01 -v test01:/etc/nginx:rw nginx</span></span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="八、Dockerfile。">八、Dockerfile。</h3></div></div><h4 id="1、什么是Dockerfile？">1、什么是Dockerfile？</h4><p><strong>Dockerfile</strong>是一个创建镜像所有命令的文本文件，包含了一条条指令和说明, 每条指令构建一层,，通过==docker build==命令，根据Dockerfile的内容构建镜像，因此每一条指令的内容, 就是描述该层如何构建。有了Dockefile,，就可以制定自己的docker镜像规则,只需要在Dockerfile上添加或者修改指令,，就可生成docker 镜像。</p><h4 id="2、Dockerfile构建过程。">2、Dockerfile构建过程。</h4><p>dockerfile的关键字==建议使用==大写，它是从上往下按照循序执行的，在dockerfile中，#代表注释。我们可以通过这个脚本来生成镜像，脚本中的每一个命令，都是一层镜像。</p><p>我们先通过下面这张图片来理解一下镜像的构成以及运行过程。<br>在这里我们来整理一下docker容器、dockerfile、docker镜像的关系：</p><p><strong>dockerfile</strong>是面向开发的，发布项目做镜像的时候就要编写dockerfile文件。<br><strong>dockerfile</strong>：构建文件，定义了一切的步骤，源代码。<br><strong>dockerImanges</strong>：通过dockerfile构建生成的镜像，最终发布和运行的产品。<br><strong>docker容器</strong>：容器就是镜像运行起来提供服务的。</p><h4 id="3、Dockerfile-指令选项。">3、Dockerfile 指令选项。</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Dockerfile 指令选项:</span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span>                  <span class="comment">#基础镜像 。 （centos）</span></span><br><span class="line"><span class="keyword">MAINTAINER</span>            <span class="comment">#镜像的作者和邮箱。（已被弃用，结尾介绍代替词）</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash">                   <span class="comment">#镜像构建的时候需要执行的命令。</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash">                   <span class="comment">#类似于 RUN 指令，用于运行程序（只有最后一个会生效，可被替代）</span></span></span><br><span class="line"><span class="keyword">EXPOSE</span>                <span class="comment">#对外开放的端口。</span></span><br><span class="line"><span class="keyword">ENV</span>                   <span class="comment">#设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash">                   <span class="comment"># 步骤：tomcat镜像，这个tomcat压缩包。添加内容。</span></span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash">                  <span class="comment">#复制指令，将文件拷贝到镜像中。</span></span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash">                <span class="comment">#设置卷，挂载的主机目录。</span></span></span><br><span class="line"><span class="keyword">USER</span>                  <span class="comment">#用于指定执行后续命令的用户和用户组，</span></span><br><span class="line">                       这边只是切换后续命令执行的用户（用户和用户组必须提前已经存在）。</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash">               <span class="comment">#工作目录（类似CD命令）。</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash">            <span class="comment">#类似于 CMD 指令，但其不会被 docker run </span></span></span><br><span class="line">                       的命令行参数指定的指令所覆盖，会追加命令。</span><br><span class="line"><span class="keyword">ONBUILD</span>               <span class="comment">#当构建一个被继承Dokcerfile，就会运行ONBUILD的指令。出发执行。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：<span class="keyword">CMD</span><span class="language-bash">类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> 在docker run 时运行。</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> 是在 docker build。</span></span><br><span class="line">作用：为启动的容器指定默认要运行的程序，程序运行结束，容器也就结束。</span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> 指令指定的程序可被 docker run 命令行参数中指定要运行的程序所覆盖。</span></span><br><span class="line">如果 Dockerfile 中如果存在多个 <span class="keyword">CMD</span><span class="language-bash"> 指令，仅最后一个生效。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash">（MAINTALNER已经被弃用了，目前是使用LABEL代替）</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> 指令用来给镜像添加一些元数据（metadata），以键值对的形式，语法格式如下：</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span></span><br><span class="line">比如我们可以添加镜像的作者：</span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> org.opencontainers.image.authors=<span class="string">&quot;runoob&quot;</span></span></span><br></pre></td></tr></table></figure><p>Tips：构建镜像99%都是从==scratch==开始的，但是这个镜像是个虚拟的概念，并不实际存在，表示一个空白的镜像。</p><p>这里带大家回顾一下<strong>docker history</strong>命令。接下来我们就要用dockfile制作属于自己的镜像了。<br>通过这个命令，我们就能看到dockerfile制作镜像所执行的步骤，也就可以知道这个镜像是怎么制作的了。</p><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="九、实战测试：制作镜像并且发布外网。">九、实战测试：制作镜像并且发布外网。</h3></div></div><h4 id="1、注册docker-hub-账号。">1、注册docker hub 账号。</h4><p>网址：==https://hub.docker.com/==</p><h2 id="2、服务器上使用命令行登陆。">2、服务器上使用命令行登陆。</h2><p>命令</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker login -u [账号名字]   #登陆命令</span><br><span class="line">docker out                  #退出命令</span><br><span class="line">docker push 账号/容器名字：版本号</span><br></pre></td></tr></table></figure><p>看到Lgin Succeeded，就表示我们登陆成功了。</p><h4 id="3、构建镜像。">3、构建镜像。</h4><h5 id="1、创建工作目录。">1、创建工作目录。</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir dockerfile</span><br><span class="line">cd dockerfile</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><h5 id="2、编写dockerfile。">2、编写dockerfile。</h5><p>首先，我们知道官方默认的镜像，比如centos镜像里面，没有vim、ipconfig等命令，我们就基于此，创建此镜像。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim mydockerfile</span><br></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FORM centos</span><br><span class="line"><span class="keyword">MAINTAINER</span> ydk&lt;<span class="number">123</span>@qq.com&gt;</span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install vim-enhanced</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install net-tools</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="comment">#MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;------------END-------------&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure><h5 id="3、构建dockerfile。">3、构建dockerfile。</h5><p>docker build 命令：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f mydockerfile-t mycentos:<span class="number">1.0</span> .</span><br></pre></td></tr></table></figure><p>到这里，我们就制作好了我们自己的镜像，虽然它并没有什么用。<br>这里我们再启动我们自己制作的镜像，进去看看我们写的dockerfile都生效了没有。<br>注：不加标签<strong>默认是latest</strong>，所以docker run的时候要带上镜像标签。<br>同时，我们可以用<strong>docker history</strong>命令来进一步验证dockerfile的构建过程。</p><h5 id="4、推送镜像至docker-hub。">4、推送镜像至docker hub。</h5><p>官方文档要求，我们推送的镜像名字必须是<strong>YOUR_DOCKER_HUB_ID/XXXX</strong>，所以我们需要给镜像换一个名字</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag  mycentos/<span class="number">1.0</span> 自己的账号名字/mytomcat </span><br><span class="line">docker push 自己的账号名字/mytomcat </span><br></pre></td></tr></table></figure><p>镜像有点大，所以请耐心等待一下。等了几分钟之后，我们登陆docker hub就可以看到我们刚刚推送上去的镜像啦，这个镜像可是全世界人民都看得到的哦，是不是有点小激动呢！</p><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><h3 id="十、Docker网络。">十、Docker网络。</h3></div></div><h3 id="1、本机网络理解。">1、本机网络理解。</h3><p>我们使用ifconfig可以看到三组网络。<br>首先是docker0，这是我们本节的重点，docker的网络。之后是eth0，本机的外网地址。lo口，本地环回地址，可以代表localhost。<br>关于docker0呢，其实就是一个叫docker0的虚拟网桥。我们使用brctl命令来查看一下。（没有这个命令的下载<strong>yum -y install bridge-utils</strong>）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brctl show </span><br></pre></td></tr></table></figure><h3 id="2、清空本机docker环境。">2、清空本机docker环境。</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line">docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure><h3 id="3、veth-pair技术。">3、veth-pair技术。</h3><p>什么是veth-pair技术？要理解它，我们首先来启动两个tomcat容器。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name=tomcat01 tomcat:<span class="number">7</span></span><br><span class="line">docker run -d -P --name=tomcat02 tomcat:<span class="number">7</span></span><br><span class="line">提示：选择tomcat7是因为这个镜像包含了ip addr 等常用命令！</span><br></pre></td></tr></table></figure><p>启动机器之后，我们查看容器ip，通过容器的ip  去ping宿主机ip，发现是通的。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it tomcat01 ip addr</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping <span class="number">172.17</span><span class="number">.0</span><span class="number">.3</span></span><br></pre></td></tr></table></figure><p>理解：我们每启动一个docker容器，docker就会给docker容器分配一个ip，安装docker之后，会产生一个叫docker0的网卡，这里使用的就是<strong>veth-pair技术</strong>。</p><p>使用ip addr命令，查看我们的网卡。<br>我们发现多出来了两个网卡，到了这里，你已经知道这两张网卡是那里来的了吧。没错，是启动容器之后产生的！我们回过头来查看我们在启动的容器IP，就会很清晰的发现，这个网卡是成对存在的！容器内的64对应着宿主机的65，容器内的66对应宿主机的67。</p><p>什么是==veth-pair？==<br>veth-pair 就是一堆的虚拟设备接口，他们都是成对出现的，一端连接着协议，一端连接着彼此。使得它充当了一个桥梁的作用。</p><h3 id="4、docker网络详解。">4、docker网络详解。</h3><p>我们来绘制一个简单的网络模型，这样veth-pair的作用就清晰明了了。<br>不难看出，tomcat01和tomcat02是共用的同一个路由器，即docker0。所有的容器在不指定我网络的情况下，都是docker0路由的，docekr会给我们的容器分配一个默认IP。<br>docker网络就是下面这个网络模型所描述的。（docker所有的网络接口都是虚拟的，虚拟的转发效率高）</p><h4 id="5、docker网络模式。">5、docker网络模式。</h4><h5 id="1、docker网络模式有以下几种：">1、docker网络模式有以下几种：</h5><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Host</span>：容器不会虚拟出自己的网卡，配置主机的<span class="built_in">IP</span>等,而是使用宿主机的<span class="built_in">IP</span>和端口</span><br><span class="line"></span><br><span class="line"><span class="symbol">Container:</span> 创建的容器不会创建自己的网卡，配置自己的<span class="built_in">IP</span>，而是和一个指定的容器共享<span class="built_in">IP</span>。（一般不用）</span><br><span class="line"></span><br><span class="line"><span class="symbol">None:</span> 该模式关闭了容器的网络功能。（一般不用）</span><br><span class="line"></span><br><span class="line"><span class="symbol">Bridge</span>：默认为该模式（桥接，自己创建也是用它），此模式会为每一个容器分配，设置<span class="built_in">IP</span>等，并将容器连接到一个docker0 的虚拟网桥，通过docker <span class="number">0</span> 网桥以及iptables nat 表配置与宿主机通信。</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls   #列出docker网卡</span><br></pre></td></tr></table></figure><h5 id="2、创建自定义网络的容器：">2、创建自定义网络的容器：</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">我们直接启动命令， --net bridge，就是docker0（默认）</span><br><span class="line">docker run -d -P --name=tomcat01 --net bridge tomcat</span><br><span class="line"></span><br><span class="line">docker0特点：默认，域名不能访问，--link不建议使用</span><br></pre></td></tr></table></figure><p>下面我们自己来创建一个bridge。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker network create --driver bridge --subnet <span class="number">192.168</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">24</span> --gateway <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span> testnet</span><br><span class="line"></span><br><span class="line">docekr network ls</span><br></pre></td></tr></table></figure><p>只需要两条命令，你就创建完了自己的网络！<br>这里在教大家一条命令：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect 网卡名字  #查看网卡详细信息</span><br></pre></td></tr></table></figure><h5 id="3、发布两个在自己创建的网络里的容器。">3、发布两个在自己创建的网络里的容器。</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name=tomcat01-net --net=testnet tomcat:<span class="number">7</span></span><br><span class="line">docker run -d -P --name=tomcat02-net --net testnet tomcat:<span class="number">7</span></span><br></pre></td></tr></table></figure><p>然后使用docker network inspect testnet，就可以看到刚才创建的这两个容器的IP了。<br>还记得我们前面说的docker0的缺点之一，不能通过域名访问吗？而我们自定义的网络，就修复了这个功能！</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it tomcat01-net ping -c <span class="number">3</span> IP</span><br><span class="line">docker exec -it tomcat01-net ping -c <span class="number">3</span> tomcat02-net</span><br><span class="line"></span><br><span class="line">提示，ping -c可以自定义ping的次数</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>缓存加速服务器Varnish的搭建优化</title>
      <link href="/posts/6373edb1.html"/>
      <url>/posts/6373edb1.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-变量类型">1.变量类型</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">内建变量：</span><br><span class="line">req.*:request表示由客户端发来的请求报文</span><br><span class="line">req.http.*</span><br><span class="line">req.http.User-Agent,req.http.Rederer,...</span><br><span class="line"><span class="keyword">bereq.*</span>由varnish发往<span class="keyword">BE主机的httpd请求相关</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">bereq.http.*</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">beresp.*</span>由<span class="keyword">BE主机响应给varnish的响应报文相关</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">beresp.http.*</span></span><br><span class="line"><span class="keyword"></span>resp.*由varnish响应给client相关</span><br><span class="line">obj.*存储在缓存空间中的缓存对象的属性(只读)</span><br></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">常用变量：</span><br><span class="line"><span class="keyword">bereq.*, </span>req.*：</span><br><span class="line"><span class="keyword">bereq.http.HEADERS</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">bereq.request：请求方法；</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">bereq.url：请求的url；</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">bereq.proto：请求的协议版本；</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">bereq.backend：指明要调用的后端主机；</span></span><br><span class="line">req.http.Cookie：客户端的请求报文中Cookie首部的值； </span><br><span class="line">req.http.User-Agent ~ <span class="string">&quot;chrome&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">beresp.*, </span>resp.*：</span><br><span class="line"><span class="keyword">beresp.http.HEADERS</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">beresp.status：响应的状态码；</span></span><br><span class="line"><span class="keyword"></span>reresp.proto：协议版本；</span><br><span class="line"><span class="keyword">beresp.backend.name：BE主机的主机名；</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">beresp.ttl：BE主机响应的内容的余下的可缓存时长；</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line">obj.*</span><br><span class="line">obj.hits：此对象从缓存中命中的次数；</span><br><span class="line">obj.ttl：对象的ttl值</span><br><span class="line">server.*</span><br><span class="line">server.ip</span><br><span class="line">server.hostname</span><br><span class="line">client.*</span><br><span class="line">client.ip</span><br></pre></td></tr></table></figure><h3 id="Command">Command.</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-s  [name=]type,[options]   <span class="regexp">//</span>设置varnish的缓存机制(Storage Types):</span><br><span class="line"></span><br><span class="line">malloc[,size]   <span class="regexp">//</span>内存存储,[size]用于定义空间大小(重启后所有缓存失效)</span><br><span class="line"></span><br><span class="line">file[,path,[size[,granularlty]]] <span class="regexp">//</span>磁盘存储,黑盒；(重启失效)<span class="regexp">//</span>建议</span><br><span class="line"></span><br><span class="line">perslstent,path,size  <span class="regexp">//</span>文件存储,黑盒；(重启后缓存有效) <span class="regexp">//</span>(实验)</span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">varnish程序的选项：</span><br><span class="line">程序选项： /etc/varnish/varnish.params文件</span><br><span class="line">-<span class="selector-tag">a</span>  <span class="selector-tag">address</span><span class="selector-attr">[:port]</span><span class="selector-attr">[,address[:port]</span>]<span class="selector-attr">[...]</span> 默认端口为<span class="number">6081</span></span><br><span class="line">-T<span class="selector-tag">address</span><span class="selector-attr">[:port]</span> 默认端口为<span class="number">6082</span></span><br><span class="line">-s<span class="selector-attr">[name=]</span>type<span class="selector-attr">[,options]</span> 定义缓存存储机制</span><br><span class="line">-uuser</span><br><span class="line">-ggroup</span><br><span class="line">-fconfigVCL配置文件</span><br><span class="line">-F运行于前台</span><br><span class="line">...</span><br><span class="line">运行时参数： /etc/varnish/varnish.params文件,DEAMON_OPTS</span><br><span class="line">DAEMON_OPTS=<span class="string">&quot;-p thread_pool_min=5 -p thread_pool_max=500 -p thread_pool_timeout=300&quot;</span></span><br><span class="line">-<span class="selector-tag">p</span>param=value:设定运行参数及其值；可重复使用多次</span><br><span class="line">-rparam<span class="selector-attr">[,param...]</span>:设定指定的参数为只读状态</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">varnishadm -S /etc/varnish/secret -T 127.0.0.1:6082</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">&gt; vcl.list    <span class="comment">#查看已有策略组</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">&gt; vcl.use xxx  <span class="comment">#使用已有的策略组</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">&gt; vcl.load 组名 /etc/varnish/default.vcl  <span class="comment">#从文件加载策略组</span></span></span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@ varnish</span>]<span class="meta"># yum install varnish -y</span></span><br><span class="line">[<span class="meta">root@ varnish</span>]<span class="meta"># cd /etc/varnish</span></span><br><span class="line">[<span class="meta">root@ varnish</span>]<span class="meta"># vim varnish.params</span></span><br><span class="line">VARNISH_LISTEN_PORT=<span class="number">80</span> <span class="meta">#把默认值修改为80</span></span><br><span class="line"></span><br><span class="line">VARNISH_STORAGE=<span class="string">&quot;file,/data/varnish.db,10g&quot;</span>   <span class="meta">#修改缓存策略,指定缓存文件为/data/varnish.db，限制内存为10g</span></span><br><span class="line"></span><br><span class="line">保存</span><br><span class="line">[<span class="meta">root@ varnish</span>]<span class="meta"># systemctl enable --now varnish</span></span><br><span class="line"><span class="meta">#这个时候服务起来了但是访问localhost是会显示错误的，因为vcl还没设置</span></span><br><span class="line">[<span class="meta">root@ varnish</span>]<span class="meta"># vim /etc/varnish/default.vcl</span></span><br><span class="line">backend <span class="literal">default</span> &#123;</span><br><span class="line">    .host = <span class="string">&quot;WEB服务器的IP&quot;</span>;</span><br><span class="line">    .port = <span class="string">&quot;WEB服务器端口&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="meta">root@ varnish</span>]<span class="meta"># varnish_reload_vcl</span></span><br><span class="line">[<span class="meta">root@ varnish</span>]<span class="meta"># varnishadm -S /etc/varnish/secret -T 127.0.0.1:6082 //进入命令行</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>筛选规则写在default.vcl中的sub vcl_deliver段</p></div><h2 id="example：">example：</h2><h4 id="1-简单cache服务器搭建">1.简单cache服务器搭建</h4><table><thead><tr><th style="text-align:center">HOSTNAME</th><th style="text-align:center">IP</th><th style="text-align:center">GATEWAY</th></tr></thead><tbody><tr><td style="text-align:center">cache</td><td style="text-align:center">10.10.0.10,192.168.222.236</td><td style="text-align:center">10.10.0.2,192.168.222.2</td></tr><tr><td style="text-align:center">client</td><td style="text-align:center">10.10.0.20</td><td style="text-align:center">10.10.0.10</td></tr><tr><td style="text-align:center">web</td><td style="text-align:center">192.168.222.232</td><td style="text-align:center">192.168.222.236</td></tr></tbody></table><div class="note default orange simple"><p>cache也类似做了一个路由器的作用（所以需要打开路由转发功能）</p></div><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@ cache</span>]<span class="meta"># sed -i &#x27;$anet.ipv4.ip_forward = 1&#x27; &gt;&gt; /etc/sysctl.conf</span></span><br><span class="line">[<span class="meta">root@ cache</span>]<span class="meta"># sysctl -p</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>配置一个简单的Web服务器</p></div><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@ web</span>]<span class="meta"># yum install -y httpd</span></span><br><span class="line"><span class="meta"># 随便往/var/www/html里面扔点网页文件</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>配置cache服务器</p></div><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@ cache</span>]<span class="meta"># yum install -y varnish</span></span><br><span class="line">[<span class="meta">root@ cache</span>]<span class="meta"># mkdir -p /data/cache</span></span><br><span class="line">[<span class="meta">root@ cache</span>]<span class="meta"># cd /etc/varnish</span></span><br><span class="line">[<span class="meta">root@ cache</span>]<span class="meta"># vim varnish.params   //修改以下两项为</span></span><br><span class="line">VARNISH_LISTEN_PORT=<span class="number">80</span></span><br><span class="line">VARNISH_STORAGE=<span class="string">&quot;file,/data/cache,10g&quot;</span>   <span class="comment">//缓存策略改为file存储,指定目录,存储空间</span></span><br><span class="line">[<span class="meta">root@ cache</span>]<span class="meta"># vim /etc/varnish/default.vcl  //修改两项为</span></span><br><span class="line">backend <span class="literal">default</span> &#123;</span><br><span class="line">    .host = <span class="string">&quot;web&quot;</span>;</span><br><span class="line">    .port = <span class="string">&quot;80&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#添加返回响应在sub vcl_deliver段</span></span><br><span class="line">sub vcl_deliver &#123;</span><br><span class="line"><span class="keyword">if</span> (obj.hits&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">set</span> resp.http.X-Cache = <span class="string">&quot;HIT cache &quot;</span> + server.ip;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">set</span> resp.http.X-Cache = <span class="string">&quot;MISS cache &quot;</span> + server.ip;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ cache]<span class="meta"># systemctl start varnish</span></span><br><span class="line">[root@ cache]<span class="meta"># varnishadm -S /etc/varnish/secret -T 127.0.0.1:6082</span></span><br><span class="line"><span class="meta">#&gt; vcl.list  <span class="comment">//查看当前使用和拥有的策略组</span></span></span><br><span class="line"><span class="meta">#&gt; vcl.load t1 /etc/varnish/default.vcl   <span class="comment">//从文件载入策略组</span></span></span><br><span class="line"><span class="meta">#&gt; vcl.use t1   <span class="comment">//使用t1策略组</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>已经可以尝试浏览器访问10.10.0.10了，使用F12查看缓存的命中，状态码304即是已缓存响应，第二次访问可看到X-Cache: Hit cache 192.168.222.232</p></div><h4 id="2-设置不被命中规则">2.设置不被命中规则</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ web]# mkdir <span class="regexp">/var/</span>www<span class="regexp">/html/</span>&#123;admin,login&#125;</span><br><span class="line">[root@ web]# echo <span class="string">&quot;login sucessful&quot;</span> &gt; <span class="regexp">/var/</span>www<span class="regexp">/html/</span>login/index.html</span><br><span class="line">[root@ web]# echo <span class="string">&quot;admin varnish test&quot;</span> &gt; <span class="regexp">/var/</span>www<span class="regexp">/html/</span>admin/index.html</span><br><span class="line"></span><br><span class="line">[root@ cache]# vim <span class="regexp">/etc/</span>varnish/<span class="keyword">default</span>.vcl</span><br><span class="line">#在sub vcl_recv段加上命中规则,让admin和login路径不进行缓存</span><br><span class="line">sub vcl_recv &#123;</span><br><span class="line"><span class="keyword">if</span> (req.url ~ <span class="string">&quot;(?i)^/(login|admin)&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>(pass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ cache]# varnishadm -S <span class="regexp">/etc/</span>varnish/secret -T <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6082</span></span><br><span class="line">#&gt; vcl.load t2 <span class="regexp">/etc/</span>varnish/<span class="keyword">default</span>.vcl</span><br><span class="line">#&gt; vcl.use t2</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>进入浏览器打开F12访问http://10.10.0.10/admin或者http://10.10.0.10/login,多次刷新发现都没有缓存</p></div><div class="note default orange simple"><p>显示X-Cache: MISS cache10.10.0.50  //未命中</p></div><p>…持续更新中<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LVS简单搭建使用</title>
      <link href="/posts/115d8f31.html"/>
      <url>/posts/115d8f31.html</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th style="text-align:center">192.168.222.236(DIP) ,10.10.0.10(VIP)</th><th style="text-align:center">lvs</th><th style="text-align:center">lvs</th></tr></thead><tbody><tr><td style="text-align:center">192.168.222.232(RIP)</td><td style="text-align:center">rs1</td><td style="text-align:center">ceph1</td></tr><tr><td style="text-align:center">192.168.222.233 (RIP)</td><td style="text-align:center">rs2</td><td style="text-align:center">ceph2</td></tr><tr><td style="text-align:center">192.168.222.237  ,10.10.0.20(CIP)</td><td style="text-align:center">client</td><td style="text-align:center">client</td></tr></tbody></table><div class="note default orange simple"><p>了解：LVS是基于OSI模型的内核层的下四层，也是附着与netfilter的input练上</p></div><h1>环境</h1><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>1.机器准备</p></div></div><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cat &gt; /etc/hosts &lt;&lt;END</span><br><span class="line"><span class="number">192.168.222.232</span> ceph1</span><br><span class="line"><span class="number">192.168.222.233</span> ceph2</span><br><span class="line"><span class="number">192.168.222.236</span> lvs</span><br><span class="line"><span class="number">192.168.222.237</span> client</span><br><span class="line">END</span><br></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 在每台机器上使用<span class="keyword">system</span>.sh初始化os系统脚本。</span><br><span class="line"># git clone https:<span class="comment">//github.com/linjiangyu2/K.git </span></span><br><span class="line">cd K </span><br><span class="line">./<span class="keyword">system</span>.sh <span class="comment">//依次输入DEVICE,IP,HOSTNAME,yes</span></span><br><span class="line">最后在rs机器上</span><br><span class="line"># sed -ri <span class="string">&#x27;s/^(GATEWAY=).*/\1192.168.222.236/g&#x27;</span> /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line"># systemctl restart network</span><br><span class="line">在client机器上</span><br><span class="line"># sed -ri <span class="string">&#x27;s/^(GATEWAY=).*/\110.10.0.10/g&#x27;</span> /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line">在lvs服务器上</span><br><span class="line"># vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward = <span class="number">1</span> </span><br><span class="line"># sysctl -p</span><br><span class="line"># sysctl -a | grep <span class="string">&#x27;ip_forward&#x27;</span> <span class="comment">//可以查看一下</span></span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>2.时间同步</p></div></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在lvs服务器搭建一个ntp服务器或者使用xinetd服务器（需要在各个节点上下载rdate,<span class="built_in">command</span>:rdata lvs)</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>3.在rs真实后端服务器上搭建Web服务用于测试</p></div></div><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y nginx</span><br><span class="line">[root@ rs1]# echo <span class="string">&#x27;rs1&#x27;</span> &gt; <span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html/index.html</span><br><span class="line">[root@ rs2]# echo <span class="string">&#x27;rs2&#x27;</span> &gt; <span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html/index.html</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>4.开始简单的LVS配置</p></div></div><div class="note default orange simple"><p>如果rs和client的网络无法连通外网的话，需要先ifup ens33,让可连通外网的lvs网卡的网关先成为默认的网关，让节点的机器可以yum安装软件</p></div><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#可以了解一下lvs的模块以及支持的协议</span><br><span class="line"># <span class="keyword">grep</span> -i ipvs -C <span class="number">10</span> <span class="regexp">/boot/</span>config*</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@ lvs</span>]<span class="meta"># yum install -y ipvsadm</span></span><br><span class="line">[<span class="meta">root@ lvs</span>]<span class="meta"># ipvsadm -A -t 10.10.0.10:80 -s rr</span></span><br><span class="line">[<span class="meta">root@ lvs</span>]<span class="meta"># ipvsadm -a -t 10.10.0.10:80 -r 192.168.222.232 -m</span></span><br><span class="line">[<span class="meta">root@ lvs</span>]<span class="meta"># ipvsadm -a -t 10.10.0.10:80 -r 192.168.222.233 -m</span></span><br><span class="line">[<span class="meta">root@ lvs</span>]<span class="meta"># ipvsadm -Ln //查看</span></span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>5.测试</p></div></div><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@ client]</span><span class="comment"># for i in `seq 1 10`;do curl 10.10.0.10;done</span></span><br><span class="line"><span class="comment">#可以看到显示5个rs1和5个rs2,实现了一个平均分配的负载均衡</span></span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>6.分配权重</p></div></div><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@ lvs]</span><span class="comment"># ipvsadm -E -t 10.10.0.10:80 -s wrr   //修改调度策略</span></span><br><span class="line"><span class="section">[root@ lvs]</span><span class="comment"># ipvsadm -e -t 10.10.0.10:80 -r 192.168.222.232 -m -w 8 //权重设置为8</span></span><br><span class="line"><span class="section">[root@ lvs]</span><span class="comment"># ipvsadm -e -t 10.10.0.10:80 -r 192.168,222,233 -m -w 2 //权重设置为2</span></span><br><span class="line"><span class="section">[root@ lvs]</span><span class="comment"># ipvsadm -Z   //清空计数</span></span><br><span class="line"><span class="section">[root@ lvs]</span><span class="comment"># ipvsadm -Ln --rate  //查看</span></span><br><span class="line"></span><br><span class="line"><span class="section">[root@ client]</span><span class="comment"># for i in `seq 1 10`;do curl 10.10.0.10;done  //测试</span></span><br><span class="line"><span class="comment">#可以看到10个请求中，8个发给了rs1，2个发给了rs2</span></span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p><a href="http://7.sh">7.sh</a>(类似于nginx负载均衡upstream里面的hash)</p></div></div><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ipvsadm -E -t 10.10.0.10:80 -s sh</span></span><br><span class="line"><span class="comment"># ipvsadm -Z</span></span><br><span class="line"><span class="comment"># ipvsadm -Ln</span></span><br><span class="line">[root@ client]<span class="comment"># for i in `seq 1 3`;do curl 10.10.0.10;done</span></span><br><span class="line">rs1</span><br><span class="line">rs1</span><br><span class="line">rs1</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line"><span class="keyword"></span>rs2</span><br><span class="line">rs2</span><br><span class="line">rs2</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>8.wlc(DO/weight) //按RS服务器的负荷，通过调度算法分配</p></div></div><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 懒得写了，自己悟吧。</span></span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hadoop+spark分布式搭建</title>
      <link href="/posts/24c5d7d3.html"/>
      <url>/posts/24c5d7d3.html</url>
      
        <content type="html"><![CDATA[<h1>hadoop+spark分布式集群部署</h1><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>1.环境准备</p></div></div><div class="note default orange simple"><p>环境的准备基于我写的初始化脚本,自用7.x系列的CentOS,老版本的就支持CentOS/Redhat6,7,8但是有点不完善，需要可以邮箱或者博客留言。</p></div><table><thead><tr><th style="text-align:center">os\ip</th><th style="text-align:center">hostname</th><th style="text-align:center">block</th></tr></thead><tbody><tr><td style="text-align:center">centos7.9 192.168.222.226</td><td style="text-align:center">master</td><td style="text-align:center">rsmanager,datanode,namenode.snamenode,nmanager</td></tr><tr><td style="text-align:center">centos7.9 192.168.222.227</td><td style="text-align:center">node1</td><td style="text-align:center">snamenode,nmnager,datanode</td></tr><tr><td style="text-align:center">centos7.9 192.168.222.228</td><td style="text-align:center">node2</td><td style="text-align:center">datanode,nmanager</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/linjiangyu2/K.git   //可能会拉不下来，多拉几次就下来了，因为托管代码的服务器是国外的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> K</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> README.md  //不会使用的要看一下这个文件，了解脚本需要输入的配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">./ksh  //依次输入你自己的配置，第一次使用这个脚本一定要看README.md文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果需要有时候改IP地址图方便的话，直接把ksh这个二进制的脚本放在/usr/bin下，便可以在全局执行了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mv</span> ksh /usr/bin/ksh</span></span><br><span class="line">使用ksh初始化后，开始配置</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>对应自己的IP地址，最好/etc/hosts的解析名和我一致，不然下面的配置文件需要自己对应自己的解析名修改</p></div><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[master]</span># </span><br><span class="line">cat &gt; /etc/hosts &lt;&lt;END</span><br><span class="line"><span class="number">127.0.0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 </span><br><span class="line"><span class="number">192.168.222.226</span> master</span><br><span class="line"><span class="number">192.168.222.227</span> node1</span><br><span class="line"><span class="number">192.168.222.228</span> node2</span><br><span class="line">END</span><br><span class="line"><span class="string">[master]</span># ssh-keygen -P &#x27;&#x27; -f ~/.ssh/id_rsa</span><br><span class="line"><span class="string">[master]</span># for i in master node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;do ssh-copy-id $i;done</span><br><span class="line"><span class="string">[master]</span># for i in node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;do rsync -av /etc/hosts root@$i:/etc/hosts;done</span><br><span class="line"><span class="string">[master]</span># for i in master node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;do ssh $i yum install -y openssl-devel;done</span><br><span class="line"><span class="string">[master]</span># cd /usr/lib64</span><br><span class="line"><span class="string">[master]</span># ln -s libcrypto.so.<span class="number">1</span>.<span class="number">0</span>.2k libcrypto.so</span><br></pre></td></tr></table></figure><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>2.搭建</p></div></div><h4 id="上传jdk和hadoop的tar包">上传jdk和hadoop的tar包</h4><div class="note default orange simple"><p>这里使用的二进制包</p></div><div class="tag link"><a class="link-card" title="hadoop-2.8.5.tar.gz" href="https://alist.linjiangyu.com/d/Linux/hadoop-2.8.5.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">hadoop-2.8.5.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/hadoop-2.8.5.tar.gz</p></div></a></div><div class="tag link"><a class="link-card" title="jdk-8u212-linux-x64.tar.gz" href="https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz"><div class="left"><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/fa.jpg"/></div><div class="right"><p class="text">jdk-8u212-linux-x64.tar.gz</p><p class="url">https://alist.linjiangyu.com/d/Linux/jdk-8u212-linux-x64.tar.gz</p></div></a></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  [master]<span class="comment"># tar xf hadoop...  //不知道你使用的版本，写了...，以下也是，tab键或者对应修改就可以</span></span><br><span class="line">  <span class="comment"># ...是表示我不知道你使用的版本，自己改</span></span><br><span class="line">  [root@ master]<span class="comment"># tar xf jdk...</span></span><br><span class="line">  [root@ master]<span class="comment"># tar xf hadoop...</span></span><br><span class="line">  [root@ master]<span class="comment"># mv hadoop... /opt/hadoop285</span></span><br><span class="line">  [root@ master]<span class="comment"># mv jdk... /usr/local/jdk</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/opt/hadoop285</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$&#123;HADOOP_HOME&#125;</span>/bin:<span class="variable">$&#123;HADOOP_HOME&#125;</span>/sbin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class="variable">$HADOOP_HOME</span>/lib/native </span><br><span class="line"><span class="built_in">export</span> HADOOP_OPTS=<span class="string">&quot;-Djava.library.path=<span class="variable">$HADOOP_HOME</span>/lib/native&quot;</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$HADOOP_HOME</span>/lib/native/:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># source !$</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以下是自己直接写入配置，在master服务器上进行</p></div><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/hadoop285/etc/hadoop</span></span><br><span class="line"><span class="comment"># vim hadoop-env.sh  //修改文件里面的export JAVA_HOME=$&#123;JAVA_HOME&#125;为</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="comment"># vim yarn-env.sh //修改前面有注释的export JAVA_HOME为</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="comment"># vim core-site.xml</span></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>hadoop.tmp.dir<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>/opt/data<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>fs.defaultFS<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>hdfs://master:9000<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim hdfs-site.xml</span></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>dfs.replication<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>1<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>dfs.namenode.name.dir<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>/opt/data/hdfs/name<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>dfs.datanode.data.dir<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>/opt/data/hdfs/data<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim yarn-site.xml </span></span><br><span class="line"></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>yarn.resourcemanager.hostname<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>master<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line">        <span class="variable">&lt;property&gt;</span></span><br><span class="line">                <span class="variable">&lt;name&gt;</span>yarn.nodemanager.aux-services<span class="variable">&lt;/name&gt;</span></span><br><span class="line">                <span class="variable">&lt;value&gt;</span>mapreduce_shuffle<span class="variable">&lt;/value&gt;</span></span><br><span class="line">        <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cp mapred-site.xml.template mapred-site.xml</span></span><br><span class="line"><span class="comment"># vim mapred-site.xml</span></span><br><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">    <span class="variable">&lt;property&gt;</span></span><br><span class="line">        <span class="variable">&lt;name&gt;</span>mapreduce.framework.name<span class="variable">&lt;/name&gt;</span></span><br><span class="line">        <span class="variable">&lt;value&gt;</span>yarn<span class="variable">&lt;/value&gt;</span></span><br><span class="line">    <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim slaves</span></span><br><span class="line"><span class="keyword">master</span></span><br><span class="line"><span class="title">node1</span></span><br><span class="line">node2</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>然后在master节点把配置发到各个节点</p></div><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[master]# <span class="keyword">for</span> i in node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;<span class="keyword">do</span> rsync -av <span class="regexp">/usr/</span>local<span class="regexp">/jdk root@$i:/u</span>sr<span class="regexp">/local/</span>;done</span><br><span class="line"># <span class="keyword">for</span> i in node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;<span class="keyword">do</span> rsync -av <span class="regexp">/opt/</span>hadoop285 root@$i:<span class="regexp">/opt/</span>;done</span><br><span class="line"># <span class="keyword">for</span> i in node&#123;<span class="number">1</span>..<span class="number">2</span>&#125;;<span class="keyword">do</span> rsync -av <span class="regexp">/etc/</span>profile root@$i:<span class="regexp">/etc/</span>profile;done</span><br><span class="line">然后到各个节点</span><br><span class="line">[node1,<span class="number">2</span>]# <span class="keyword">source</span> <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在node1,2上操作，最后在master操作</p></div><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># hdfs namenode -format   <span class="comment">//初始化</span></span></span><br><span class="line"><span class="meta"># ls -d /opt/data   <span class="comment">//此文件夹产生就是初始化成功</span></span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>在master上操作</p></div><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ <span class="literal">master</span>]<span class="comment"># start-all.sh</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>最后可以在各个节点使用jps命令查看各自的部件</p></div><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@ xxx</span>]<span class="meta"># jps</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>当然web界面也可以访问的，浏览器访问192.168.222.226:8088和192.168.222.226:50070(对应自己IP地址)</p></div><div class="note default orange simple"><p>来尝试运行一下第一个hadoop分布式任务吧</p></div><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ master]# hdfs dfs -put <span class="regexp">/etc/</span>passwd /t1</span><br><span class="line">[root@ master]# hadoop jar <span class="regexp">/opt/</span>hadoop285<span class="regexp">/share/</span>hadoop<span class="regexp">/mapreduce/</span>hadoop-mapreduce-examples-<span class="number">2.8</span>.<span class="number">5</span>.jar wordcount <span class="regexp">/t1 /</span>output/<span class="number">00</span></span><br><span class="line">[root@ master]# hdfs dfs -ls <span class="regexp">/output/</span><span class="number">00</span>  <span class="comment">//查看运行后的结果文件,运行后的数据在part-r-00000</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>下面开始搭建分布式spark，这里使用的是spark的3.3.0版本</p></div><div class="note default orange simple"><p><a href="https://dlcdn.apache.org/spark/spark-3.3.0/spark-3.3.0-bin-hadoop3.tgz">spark官网下载软件包</a></p></div><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 把spark包上传到机器上，然后到该包的目录，这里统一以spark-3.3.0-bin-hadoop3.tgz这个包为演示</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># tar xf spark-3.3.0-bin-hadoop3.tgz</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv spark-3.3.0-bin-hadoop3 /opt/spark</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim /etc/profile</span></span><br><span class="line">export PATH=/opt/spark/bin:/opt/spark/sbin:$PATH</span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># cd /opt/spark/conf</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv spark-env.sh.template spark-env.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim spark-env.sh</span></span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export HADOOP_CONF_DIR=/opt/hadoop285/etc/hadoop</span><br><span class="line">export SPARK_MASTER_IP=master   <span class="meta">#对应自己的master机器IP或者master解析的域名，如果是按照我上面做的直接写master即可</span></span><br><span class="line">export SPARK_WORKER_MEMORY=<span class="number">1024</span>m</span><br><span class="line">export SPARK_WORKER_CORES=<span class="number">2</span> </span><br><span class="line">export SPARK_EXECUTOR_MEMORY=<span class="number">1024</span>m</span><br><span class="line">export SPARK_WORKER_INSTANCES=<span class="number">1</span></span><br><span class="line">export SOARK_MASTER_PORT=<span class="number">7077</span></span><br><span class="line">export SPARK_EXECUTOR_CORES=<span class="number">1</span></span><br><span class="line">SPARK_HISTORY_OPTS=<span class="string">&quot;-Dspark.history.fs.logDirectory=hdfs://master:9000/spark_logs&quot;</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># cp spark-defaults.conf.template spark-defaults.conf</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim spark-defaults.conf</span></span><br><span class="line">spark.master                     spark:<span class="comment">//master:7077</span></span><br><span class="line">spark.eventLog.enabled           <span class="literal">true</span></span><br><span class="line">spark.eventLog.dir               hdfs:<span class="comment">//master:9000/spark_logs</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># vim slaves     //对应自己的三台主机IP地址或者解析的域名</span></span><br><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># cd /opt/spark/sbin</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv start-all.sh spark-start.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># mv stop-all.sh spark-stop.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># source /etc/profile</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /opt/spark root@node1:/opt/</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /opt/spark root@node2:/opt/</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /etc/profile root@node1:/etc/</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># scp -r /etc/profile root@node2:/etc/</span></span><br><span class="line"><span class="meta"># 然后在各工作节点执行命令</span></span><br><span class="line">[<span class="meta">root@ node1,node2</span>]<span class="meta"># source /etc/profile</span></span><br><span class="line"><span class="meta"># 在master节点执行</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># start-all.sh</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># hdfs dfs -mkdir /spark_logs</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># spark-start.sh  //启动spark集群</span></span><br><span class="line">[<span class="meta">root@ master</span>]<span class="meta"># jps     //查看</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>以上便搭建好了spark结合hadoop的分布式集群，spark也有自己的web界面，可以浏览器访问192.168.222.226:8080来查看(对应自己IP地址)</p></div><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>学好运维的最好方法</title>
      <link href="/posts/bfb4802e.html"/>
      <url>/posts/bfb4802e.html</url>
      
        <content type="html"><![CDATA[<h1>学会百度</h1><div class="note default orange simple"><p>链接直达：<a href="https://www.baidu.com">https://www.baidu.com</a></p></div><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker-compose(wordpress)</title>
      <link href="/posts/265f6511.html"/>
      <url>/posts/265f6511.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>docker-compose</p></div></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;1&#x27;</span><br><span class="line">services: </span><br><span class="line"></span><br><span class="line">  mysql: </span><br><span class="line">    image: mysql:5.6</span><br><span class="line">    restart: always</span><br><span class="line">    volumes: </span><br><span class="line">      - &quot;./data:/var/lib/mysql&quot;</span><br><span class="line">    environment: </span><br><span class="line">      MYSQL_ROOT_PASSWORD: password</span><br><span class="line">      MYSQL_DATABASE: wordpress</span><br><span class="line">      MYSQL_USER: wordpress</span><br><span class="line">      MYSQL_PASSWORD: password</span><br><span class="line">    expose: </span><br><span class="line">      - &quot;3306&quot;</span><br><span class="line"></span><br><span class="line">  wordpress: </span><br><span class="line">    image: wordpress:latest</span><br><span class="line">    restart: always</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysql </span><br><span class="line">    links: </span><br><span class="line">      - mysql</span><br><span class="line">    environment: </span><br><span class="line">      WORDPRESS_DB_HOST: mysql:3306</span><br><span class="line">      WORDPRESS_DB_USER: wordpress</span><br><span class="line">      WORDPRESS_DB_PASSWORD: password</span><br><span class="line">      WORDPRESS_DB_NAME: wordpress</span><br><span class="line">    ports: </span><br><span class="line">      - &quot;80:80&quot;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Markdown语法与外挂标签写法汇总</title>
      <link href="/posts/2013454d.html"/>
      <url>/posts/2013454d.html</url>
      
        <content type="html"><![CDATA[<h1>1.Markdown语法自带格式</h1><div class="note info flat"><p>参考：<a href="https://blog.csdn.net/u014061630/article/details/81359144">Markdown语法图文全面详解(10分钟学会)</a></p></div><div class="note warning flat"><p>注意：此页面偶尔会存在CSS冲突问题!</p></div><h2 id="1-1-代码块">1.1 代码块</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">\```shell</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VSCode终端</span></span><br><span class="line">hexo clean; hexo s</span><br><span class="line">hexo clean; hexo g; hexo d</span><br><span class="line">git add .; git commit -m &quot;npm publish&quot;; npm version patch; </span><br><span class="line">git push</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cmder终端</span></span><br><span class="line">hexo clean &amp;&amp; hexo s</span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br><span class="line">git add . &amp;&amp; git commit -m &quot;npm publish&quot; &amp;&amp; npm version patch</span><br><span class="line">git push</span><br><span class="line">\```</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VSCode终端</span></span><br><span class="line">hexo clean; hexo s</span><br><span class="line">hexo clean; hexo g; hexo d</span><br><span class="line">git add .; git commit -m &quot;npm publish&quot;; npm version patch; </span><br><span class="line">git push</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cmder终端</span></span><br><span class="line">hexo clean &amp;&amp; hexo s</span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br><span class="line">git add . &amp;&amp; git commit -m &quot;npm publish&quot; &amp;&amp; npm version patch</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-2-多级标题">1.2 多级标题</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># H1</span></span><br><span class="line"><span class="section">## H2</span></span><br><span class="line"><span class="section">### H3</span></span><br><span class="line"><span class="section">####  H4</span></span><br><span class="line"><span class="section">##### H5</span></span><br><span class="line"><span class="section">###### H6</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><p>见本文章标题!</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-3-文字样式">1.3 文字样式</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">u</span>&gt;</span></span>下划线演示<span class="language-xml"><span class="tag">&lt;/<span class="name">u</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">文字<span class="strong">**加粗**</span>演示</span><br><span class="line"></span><br><span class="line">文字<span class="emphasis">*斜体*</span>演示</span><br><span class="line"></span><br><span class="line">文本<span class="code">`高亮`</span>演示</span><br><span class="line"></span><br><span class="line">文本~~删除~~线演示</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span> = <span class="string">5</span>&gt;</span></span>5号字<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">face</span>=<span class="string">&quot;黑体&quot;</span>&gt;</span></span>黑体<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">blue</span>&gt;</span></span>蓝色<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">MistyRose</span>&gt;</span></span>这里的背景色是：MistyRosen，此处输入任意想输入的内容<span class="language-xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><p><u>下划线演示</u></p><p>文字<strong>加粗</strong>演示</p><p>文字<em>斜体</em>演示</p><p>文本<code>高亮</code>演示</p><p>文本<s>删除</s>线演示</p><p><font size = 5>5号字</font><br><font face="黑体">黑体</font><br><font color=blue>蓝色</font></p><table><tr><td bgcolor=MistyRose>这里的背景色是：MistyRosen，此处输入任意想输入的内容</td></tr></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note info flat"><p>上述要点可参考:<a href="https://blog.csdn.net/qq_43732429/article/details/108034518">【Markdown语法】字体颜色大小及文字底色设置</a></p></div><h2 id="1-4-引用">1.4 引用</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt;  Java</span></span><br><span class="line"><span class="quote">&gt; 二级引用演示</span></span><br><span class="line"><span class="quote">&gt; MySQL</span></span><br><span class="line"><span class="quote">&gt; &gt;外键</span></span><br><span class="line"><span class="quote">&gt; &gt;</span></span><br><span class="line"><span class="quote">&gt; &gt;事务</span></span><br><span class="line"><span class="quote">&gt; &gt;</span></span><br><span class="line"><span class="quote">&gt; &gt;<span class="strong">**行级锁**</span>(引用内部一样可以用格式)</span></span><br><span class="line"><span class="quote">&gt; </span></span><br><span class="line"><span class="quote">&gt; ....</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><blockquote><p>Java<br>二级引用演示<br>MySQL</p><blockquote><p>外键</p><p>事务</p><p><strong>行级锁</strong>(引用内部一样可以用格式)</p></blockquote><p>…</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-5-分割线">1.5 分割线</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="strong">**<span class="emphasis">*</span></span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><hr><hr><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-6-列表-跟空格都可以">1.6 列表(*,+,-跟空格都可以)</h2><h3 id="1-6-1-无序列表">1.6.1 无序列表</h3><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">*</span> Java</span><br><span class="line"><span class="bullet">*</span> Python</span><br><span class="line"><span class="bullet">*</span> ...</span><br><span class="line"></span><br><span class="line"><span class="bullet">+</span> Java</span><br><span class="line"><span class="bullet">+</span> Python</span><br><span class="line"><span class="bullet">+</span> ...</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> Java</span><br><span class="line"><span class="bullet">-</span> Python</span><br><span class="line"><span class="bullet">-</span> ...</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ul><li>Java</li><li>Python</li><li>…</li></ul><ul><li>Java</li><li>Python</li><li>…</li></ul><ul><li>Java</li><li>Python</li><li>…</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="1-6-2-有序列表">1.6.2 有序列表</h3><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 注意后面有空格</span></span><br><span class="line"><span class="bullet">1.</span> </span><br><span class="line"><span class="bullet">2.</span> </span><br><span class="line"><span class="bullet">3.</span> </span><br><span class="line"><span class="bullet">4.</span> </span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li></li><li></li><li></li><li></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-7-图片">1.7 图片</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 本地图片</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/assets/pusheencode.webp&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;示例图片&quot;</span> <span class="attr">style</span>=<span class="string">&quot;zoom:50%;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="section"># 在线图片</span></span><br><span class="line">![<span class="string">code</span>](<span class="link">https://cdn.jsdelivr.net/gh/fomalhaut1998/markdown_pic/img/code.png</span>)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><p>本地图片:<br><img src="/assets/pusheencode.webp" alt="示例图片" style="zoom:50%;" /><br>在线图片:<br><img src="https://cdn.jsdelivr.net/gh/fomalhaut1998/markdown_pic/img/code.png" alt="code"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-8-表格">1.8 表格</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| 项目标号 | 资金     | 备注 |</span><br><span class="line">| -------- | -------- | ---- |</span><br><span class="line">| 1        | 100，000 | 无   |</span><br><span class="line">| 2        | 200，000 | 无   |</span><br><span class="line">| 3        | 300,600  | 重要 |</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><table><thead><tr><th>项目标号</th><th>资金</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>100，000</td><td>无</td></tr><tr><td>2</td><td>200，000</td><td>无</td></tr><tr><td>3</td><td>300,600</td><td>重要</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-9-公式">1.9 公式</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">\Gamma(z)=\int<span class="emphasis">_0^\infty t^&#123;z-1&#125;e^&#123;-t&#125;dt.</span></span><br><span class="line"><span class="emphasis">$$</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><p>$$<br>\Gamma(z)=\int_0^\infty t^{z-1}e^{-t}dt.<br>$$</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>2.Butterfly外挂标签</h1><div class="note info flat"><p>这部分参考安知鱼:<a href="https://anzhiy.cn/posts/7d58.html">基于Butterfly的外挂标签引入</a></p></div><h2 id="2-1-行内文本样式-text">2.1 行内文本样式 text</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% u 文本内容 %&#125;</span><br><span class="line">&#123;% emp 文本内容 %&#125;</span><br><span class="line">&#123;% wavy 文本内容 %&#125;</span><br><span class="line">&#123;% del 文本内容 %&#125;</span><br><span class="line">&#123;% kbd 文本内容 %&#125;</span><br><span class="line">&#123;% psw 文本内容 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 带 &#123;% u 下划线 %&#125; 的文本</span><br><span class="line"><span class="bullet">2.</span> 带 &#123;% emp 着重号 %&#125; 的文本</span><br><span class="line"><span class="bullet">3.</span> 带 &#123;% wavy 波浪线 %&#125; 的文本</span><br><span class="line"><span class="bullet">4.</span> 带 &#123;% del 删除线 %&#125; 的文本</span><br><span class="line"><span class="bullet">5.</span> 键盘样式的文本 &#123;% kbd command %&#125; + &#123;% kbd D %&#125;</span><br><span class="line"><span class="bullet">6.</span> 密码样式的文本：&#123;% psw 这里没有验证码 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><ol><li>带 <u>下划线</u> 的文本</li><li>带 <emp>着重号</emp> 的文本</li><li>带 <wavy>波浪线</wavy> 的文本</li><li>带 <del>删除线</del> 的文本</li><li>键盘样式的文本 <kbd>command</kbd> + <kbd>D</kbd></li><li>密码样式的文本：<psw>这里没有验证码</psw></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-2-行内文本-span">2.2 行内文本 span</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% span 样式参数(参数以空格划分), 文本内容 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>字体</code>: logo, code</li><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>大小</code>: small, h4, h3, h2, h1, large, huge, ultra</li><li><code>对齐方向</code>: left, center, right</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> 彩色文字</span><br><span class="line">在一段话中方便插入各种颜色的标签，包括：&#123;% span red, 红色 %&#125;、&#123;% span yellow, 黄色 %&#125;、&#123;% span green, 绿色 %&#125;、&#123;% span cyan, 青色 %&#125;、&#123;% span blue, 蓝色 %&#125;、&#123;% span gray, 灰色 %&#125;。</span><br><span class="line"><span class="bullet">-</span> 超大号文字</span><br><span class="line">文档「开始」页面中的标题部分就是超大号文字。</span><br><span class="line">&#123;% span center logo large, Volantis %&#125;</span><br><span class="line">&#123;% span center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><ul><li>彩色文字<br>在一段话中方便插入各种颜色的标签，包括：<span class='p red'>红色</span>、<span class='p yellow'>黄色</span>、<span class='p green'>绿色</span>、<span class='p cyan'>青色</span>、<span class='p blue'>蓝色</span>、<span class='p gray'>灰色</span>。</li><li>超大号文字<br>文档「开始」页面中的标题部分就是超大号文字。<br><span class='p center logo large'>Volantis</span><br><span class='p center small'>A Wonderful Theme for Hexo</span></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-3-段落文本-p">2.3 段落文本 p</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% p 样式参数(参数以空格划分), 文本内容 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>字体</code>: logo, code</li><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>大小</code>: small, h4, h3, h2, h1, large, huge, ultra</li><li><code>对齐方向</code>: left, center, right</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> 彩色文字</span><br><span class="line">在一段话中方便插入各种颜色的标签，包括：&#123;% p red, 红色 %&#125;、&#123;% p yellow, 黄色 %&#125;、&#123;% p green, 绿色 %&#125;、&#123;% p cyan, 青色 %&#125;、&#123;% p blue, 蓝色 %&#125;、&#123;% p gray, 灰色 %&#125;。</span><br><span class="line"><span class="bullet">-</span> 超大号文字</span><br><span class="line">文档「开始」页面中的标题部分就是超大号文字。</span><br><span class="line">&#123;% p center logo large, Volantis %&#125;</span><br><span class="line">&#123;% p center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><ul><li>彩色文字<br>在一段话中方便插入各种颜色的标签，包括：<p class='p red'>红色</p>、<p class='p yellow'>黄色</p>、<p class='p green'>绿色</p>、<p class='p cyan'>青色</p>、<p class='p blue'>蓝色</p>、<p class='p gray'>灰色</p>。</li><li>超大号文字<br>文档「开始」页面中的标题部分就是超大号文字。</li></ul><p class='p center logo large'>Volantis</p><p class='p center small'>A Wonderful Theme for Hexo</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-4-引用note">2.4 引用note</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">通用配置</button></li><li class="tab"><button type="button" data-href="#分栏-2">语法格式</button></li><li class="tab"><button type="button" data-href="#分栏-3">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-4">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-5">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">note:</span><br><span class="line">  # Note tag style values:</span><br><span class="line">  #  - simple    bs-callout old alert style. Default.</span><br><span class="line">  #  - modern    bs-callout new (v2-v3) alert style.</span><br><span class="line">  #  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span><br><span class="line">  #  - disabled  disable all CSS styles import of note tag.</span><br><span class="line">  style: simple</span><br><span class="line">  icons: false</span><br><span class="line">  border<span class="emphasis">_radius: 3</span></span><br><span class="line"><span class="emphasis">  # Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line"><span class="emphasis">  # Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line"><span class="emphasis">  light_</span>bg<span class="emphasis">_offset: 0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 自带icon</span></span><br><span class="line">&#123;% note [class] [no-icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"><span class="section"># 外部icon</span></span><br><span class="line">&#123;% note [color] [icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.自带icon</p><table><thead><tr><th>参数</th><th style="text-align:center">用法</th></tr></thead><tbody><tr><td>class</td><td style="text-align:center">【可选】标识，不同的标识有不同的配色 （ default / primary / success / info / warning / danger ）</td></tr><tr><td>no-icon</td><td style="text-align:center">【可选】不显示 icon</td></tr><tr><td>style</td><td style="text-align:center">【可选】可以覆盖配置中的 style （simple/modern/flat/disabled）</td></tr></tbody></table><p>2.外部icon</p><table><thead><tr><th>参数</th><th style="text-align:center">用法</th></tr></thead><tbody><tr><td>class</td><td style="text-align:center">【可选】标识，不同的标识有不同的配色 （ default / blue / pink / red / purple / orange / green ）</td></tr><tr><td>no-icon</td><td style="text-align:center">【可选】可配置自定义 icon (只支持 fontawesome 图标, 也可以配置 no-icon )</td></tr><tr><td>style</td><td style="text-align:center">【可选】可以覆盖配置中的 style （simple/modern/flat/disabled）</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><details class="folding-tag" blue><summary> 1.自带icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note simple %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default simple %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary simple %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success simple %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info simple %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning simple %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger simple %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>2.<code>modern</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note modern %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default modern %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary modern %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success modern %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info modern %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning modern %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger modern %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>3.<code>flat</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note flat %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default flat %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary flat %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success flat %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info flat %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning flat %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger flat %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>4.<code>disabled</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note disabled %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default disabled %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary disabled %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success disabled %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info disabled %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning disabled %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger disabled %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>5.<code>no-icon</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default no-icon %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary no-icon %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success no-icon %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info no-icon %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning no-icon %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger no-icon %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" blue><summary> 2.外部icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; simple %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; simple %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; simple %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; simple%&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; simple %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; simple %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; simple %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>2.<code>modern</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; modern %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; modern %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; modern%&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; modern %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; modern %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; modern %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>3.<code>flat</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; flat %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; flat %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; flat %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; flat%&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; flat %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; flat %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; flat %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>4.<code>disabled</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; disabled %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; disabled %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; disabled %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; disabled %&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; disabled %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; disabled %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; disabled %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>5.<code>no-icon</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue no-icon %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink no-icon %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red no-icon %&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange no-icon %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple no-icon %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green no-icon %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-5"><details class="folding-tag" blue><summary> 1.自带icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><div class="note simple"><p>默认 提示块标签</p></div><div class="note default simple"><p>default 提示块标签</p></div><div class="note primary simple"><p>primary 提示块标签</p></div><div class="note success simple"><p>success 提示块标签</p></div><div class="note info simple"><p>info 提示块标签</p></div><div class="note warning simple"><p>warning 提示块标签</p></div><div class="note danger simple"><p>danger 提示块标签</p></div>2.`modern`样式<div class="note modern"><p>默认 提示块标签</p></div><div class="note default modern"><p>default 提示块标签</p></div><div class="note primary modern"><p>primary 提示块标签</p></div><div class="note success modern"><p>success 提示块标签</p></div><div class="note info modern"><p>info 提示块标签</p></div><div class="note warning modern"><p>warning 提示块标签</p></div><div class="note danger modern"><p>danger 提示块标签</p></div><p>3.<code>flat</code>样式</p><div class="note flat"><p>默认 提示块标签</p></div><div class="note default flat"><p>default 提示块标签</p></div><div class="note primary flat"><p>primary 提示块标签</p></div><div class="note success flat"><p>success 提示块标签</p></div><div class="note info flat"><p>info 提示块标签</p></div><div class="note warning flat"><p>warning 提示块标签</p></div><div class="note danger flat"><p>danger 提示块标签</p></div><p>4.<code>disabled</code>样式</p><div class="note disabled"><p>默认 提示块标签</p></div><div class="note default disabled"><p>default 提示块标签</p></div><div class="note primary disabled"><p>primary 提示块标签</p></div><div class="note success disabled"><p>success 提示块标签</p></div><div class="note info disabled"><p>info 提示块标签</p></div><div class="note warning disabled"><p>warning 提示块标签</p></div><div class="note danger disabled"><p>danger 提示块标签</p></div><p>5.<code>no-icon</code>样式</p><div class="note no-icon flat"><p>默认 提示块标签</p></div><div class="note default no-icon flat"><p>default 提示块标签</p></div><div class="note primary no-icon flat"><p>primary 提示块标签</p></div><div class="note success no-icon flat"><p>success 提示块标签</p></div><div class="note info no-icon flat"><p>info 提示块标签</p></div><div class="note warning no-icon flat"><p>warning 提示块标签</p></div><div class="note danger no-icon flat"><p>danger 提示块标签</p></div>              </div>            </details><details class="folding-tag" blue><summary> 2.外部icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><div class="note icon-padding simple"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding simple"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了…</p></div><div class="note pink icon-padding simple"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding simple"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding simple"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding simple"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding simple"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>2.<code>modern</code>样式</p><div class="note icon-padding modern"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了…</p></div><div class="note pink icon-padding modern"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding modern"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding modern"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding modern"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding modern"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>3.<code>flat</code>样式</p><div class="note icon-padding flat"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding flat"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了…</p></div><div class="note pink icon-padding flat"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding flat"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding flat"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding flat"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding flat"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>4.<code>disabled</code>样式</p><div class="note icon-padding disabled"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding disabled"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了…</p></div><div class="note pink icon-padding disabled"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding disabled"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding disabled"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding disabled"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding disabled"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>5.<code>no-icon</code>样式</p><div class="note no-icon flat"><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue no-icon flat"><p>2021年快到了…</p></div><div class="note pink no-icon flat"><p>小心开车 安全至上</p></div><div class="note red no-icon flat"><p>这是三片呢？还是四片？</p></div><div class="note orange no-icon flat"><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple no-icon flat"><p>剪刀石头布</p></div><div class="note green no-icon flat"><p>前端最讨厌的浏览器</p></div>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-5-上标标签-tip">2.5 上标标签 tip</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip [参数，可选] %&#125;文本内容&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>样式</code>: success,error,warning,bolt,ban,home,sync,cogs,key,bell</li><li><code>自定义图标</code>: 支持fontawesome。</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip %&#125;default&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip info %&#125;info&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip success %&#125;success&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip error %&#125;error&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip warning %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip bolt %&#125;bolt&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban %&#125;ban&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip home %&#125;home&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip sync %&#125;sync&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip cogs %&#125;cogs&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip key %&#125;key&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip bell %&#125;bell&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip fa-atom %&#125;自定义font awesome图标&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class="tip "><p>default</p></div><div class="tip info"><p>info</p></div><div class="tip success"><p>success</p></div><div class="tip error"><p>error</p></div><div class="tip warning"><p>warning</p></div><div class="tip bolt"><p>bolt</p></div><div class="tip ban"><p>ban</p></div><div class="tip home"><p>home</p></div><div class="tip sync"><p>sync</p></div><div class="tip cogs"><p>cogs</p></div><div class="tip key"><p>key</p></div><div class="tip bell"><p>bell</p></div><div class="tip fa-atom"><p>自定义font awesome图标</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-6-动态标签-anima">2.6 动态标签 anima</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip [参数，可选] %&#125;文本内容&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><div class="note info flat"><ol><li>将所需的CSS类添加到图标（或DOM中的任何元素）。</li><li>对于父级悬停样式，需要给目标元素添加指定CSS类，同时还要给目标元素的父级元素添加CSS类<code>faa-parent animated-hover</code>。（详情见示例及示例源码）<br>You can regulate the speed of the animation by adding the CSS class or . faa-fastfaa-slow</li><li>可以通过给目标元素添加CSS类<code>faa-fast</code>或<code>faa-slow</code>来控制动画快慢。</li></ol></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.On DOM load（当页面加载时显示动画）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>2.调整动画速度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated faa-fast %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated faa-slow %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>3.On hover（当鼠标悬停时显示动画）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated-hover %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated-hover %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>4.On parent hover（当鼠标悬停在父级元素时显示动画）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-parent animated-hover %&#125;<span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;faa-horizontal&quot;</span>&gt;</span></span>warning<span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-parent animated-hover %&#125;<span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;faa-flash&quot;</span>&gt;</span></span>ban<span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.On DOM load（当页面加载时显示动画）</p><div class="tip warning faa-horizontal animated"><p>warning</p></div><div class="tip ban faa-flash animated"><p>ban</p></div>2.调整动画速度<div class="tip warning faa-horizontal animated faa-fast"><p>warning</p></div><div class="tip ban faa-flash animated faa-slow"><p>ban</p></div>3.On hover（当鼠标悬停时显示动画）<div class="tip warning faa-horizontal animated-hover"><p>warning</p></div><div class="tip ban faa-flash animated-hover"><p>ban</p></div>4.On parent hover（当鼠标悬停在父级元素时显示动画）<div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">warning</p></div><div class="tip ban faa-parent animated-hover"><p class="faa-flash">ban</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-7-复选列表-checkbox">2.7 复选列表 checkbox</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox 样式参数（可选）, 文本（支持简单md） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>样式</code>: plus, minus, times</li><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>选中状态</code>: checked</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox 纯文本测试 %&#125;</span><br><span class="line">&#123;% checkbox checked, 支持简单的 [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) 语法 %&#125;</span><br><span class="line">&#123;% checkbox red, 支持自定义颜色 %&#125;</span><br><span class="line">&#123;% checkbox green checked, 绿色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox yellow checked, 黄色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox cyan checked, 青色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox blue checked, 蓝色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox plus green checked, 增加 %&#125;</span><br><span class="line">&#123;% checkbox minus yellow checked, 减少 %&#125;</span><br><span class="line">&#123;% checkbox times red checked, 叉 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class='checkbox'><input type="checkbox" />            <p>纯文本测试</p>            </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>            <p>支持简单的 <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> 语法</p>            </div><div class='checkbox red'><input type="checkbox" />            <p>支持自定义颜色</p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p>绿色 + 默认选中</p>            </div><div class='checkbox yellow checked'><input type="checkbox" checked="checked"/>            <p>黄色 + 默认选中</p>            </div><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>青色 + 默认选中</p>            </div><div class='checkbox blue checked'><input type="checkbox" checked="checked"/>            <p>蓝色 + 默认选中</p>            </div><div class='checkbox plus green checked'><input type="checkbox" checked="checked"/>            <p>增加</p>            </div><div class='checkbox minus yellow checked'><input type="checkbox" checked="checked"/>            <p>减少</p>            </div><div class='checkbox times red checked'><input type="checkbox" checked="checked"/>            <p>叉</p>            </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-8-单选列表-radio">2.8 单选列表 radio</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% radio 样式参数（可选）, 文本（支持简单md） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>选中状态</code>: checked</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% radio 纯文本测试 %&#125;</span><br><span class="line">&#123;% radio checked, 支持简单的 [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) 语法 %&#125;</span><br><span class="line">&#123;% radio red, 支持自定义颜色 %&#125;</span><br><span class="line">&#123;% radio green, 绿色 %&#125;</span><br><span class="line">&#123;% radio yellow, 黄色 %&#125;</span><br><span class="line">&#123;% radio cyan, 青色 %&#125;</span><br><span class="line">&#123;% radio blue, 蓝色 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class='checkbox'><input type="radio" />            <p>纯文本测试</p>            </div><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>支持简单的 <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> 语法</p>            </div><div class='checkbox red'><input type="radio" />            <p>支持自定义颜色</p>            </div><div class='checkbox green'><input type="radio" />            <p>绿色</p>            </div><div class='checkbox yellow'><input type="radio" />            <p>黄色</p>            </div><div class='checkbox cyan'><input type="radio" />            <p>青色</p>            </div><div class='checkbox blue'><input type="radio" />            <p>蓝色</p>            </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-9-时间轴-timeline">2.9 时间轴 timeline</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 时间线标题（可选）[,color] %&#125;</span><br><span class="line">&lt;!-- timeline 时间节点（标题） --&gt;</span><br><span class="line">正文内容</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&lt;!-- timeline 时间节点（标题） --&gt;</span><br><span class="line">正文内容</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>title</code>:标题/时间线</li><li><code>color</code>:<code>timeline</code>颜色:default(留空) / blue / pink / red / purple / orange / green</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 时间轴样式,blue %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-07-24 [<span class="string">2.6.6 -&gt; 3.0</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases</span>) --&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 如果有 <span class="code">`hexo-lazyload-image`</span> 插件，需要删除并重新安装最新版本，设置 <span class="code">`lazyload.isSPA: true`</span>。</span><br><span class="line"><span class="bullet">2.</span> 2.x 版本的 css 和 js 不适用于 3.x 版本，如果使用了 <span class="code">`use_cdn: true`</span> 则需要删除。</span><br><span class="line"><span class="bullet">3.</span> 2.x 版本的 fancybox 标签在 3.x 版本中被重命名为 gallery 。</span><br><span class="line"><span class="bullet">4.</span> 2.x 版本的置顶 <span class="code">`top: true`</span> 改为了 <span class="code">`pin: true`</span>，并且同样适用于 <span class="code">`layout: page`</span> 的页面。</span><br><span class="line"><span class="bullet">5.</span> 如果使用了 <span class="code">`hexo-offline`</span> 插件，建议卸载，3.0 版本默认开启了 pjax 服务。</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-05-15 [<span class="string">2.6.3 -&gt; 2.6.6</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.6</span>) --&gt;</span><br><span class="line"></span><br><span class="line">不需要额外处理。</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-04-20 [<span class="string">2.6.2 -&gt; 2.6.3</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.3</span>) --&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 全局搜索 <span class="code">`seotitle`</span> 并替换为 <span class="code">`seo_title`</span>。</span><br><span class="line"><span class="bullet">2.</span> group 组件的索引规则有变，使用 group 组件的文章内，<span class="code">`group: group_name`</span> 对应的组件名必须是 <span class="code">`group_name`</span>。</span><br><span class="line"><span class="bullet">2.</span> group 组件的列表名优先显示文章的 <span class="code">`short_title`</span> 其次是 <span class="code">`title`</span>。</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>时间轴样式</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-07-24 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases">2.6.6 -&gt; 3.0</a></p></div></div><div class='timeline-item-content'><ol><li>如果有 <code>hexo-lazyload-image</code> 插件，需要删除并重新安装最新版本，设置 <code>lazyload.isSPA: true</code>。</li><li>2.x 版本的 css 和 js 不适用于 3.x 版本，如果使用了 <code>use_cdn: true</code> 则需要删除。</li><li>2.x 版本的 fancybox 标签在 3.x 版本中被重命名为 gallery 。</li><li>2.x 版本的置顶 <code>top: true</code> 改为了 <code>pin: true</code>，并且同样适用于 <code>layout: page</code> 的页面。</li><li>如果使用了 <code>hexo-offline</code> 插件，建议卸载，3.0 版本默认开启了 pjax 服务。</li></ol></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-05-15 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.6">2.6.3 -&gt; 2.6.6</a></p></div></div><div class='timeline-item-content'><p>不需要额外处理。</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-04-20 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.3">2.6.2 -&gt; 2.6.3</a></p></div></div><div class='timeline-item-content'><ol><li>全局搜索 <code>seotitle</code> 并替换为 <code>seo_title</code>。</li><li>group 组件的索引规则有变，使用 group 组件的文章内，<code>group: group_name</code> 对应的组件名必须是 <code>group_name</code>。</li><li>group 组件的列表名优先显示文章的 <code>short_title</code> 其次是 <code>title</code>。</li></ol></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-10-链接卡片-link">2.10 链接卡片 link</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% link 标题, 链接, 图片链接（可选） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% link 糖果屋教程贴, https://akilar.top/posts/615e2dec/, https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><div class="tag link"><a class="link-card" title="糖果屋教程贴" href="https://akilar.top/posts/615e2dec/"><div class="left"><img src="https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico"/></div><div class="right"><p class="text">糖果屋教程贴</p><p class="url">https://akilar.top/posts/615e2dec/</p></div></a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-11-按钮-btns">2.11 按钮 btns</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns 样式参数 %&#125;</span><br><span class="line">&#123;% cell 标题, 链接, 图片或者图标 %&#125;</span><br><span class="line">&#123;% cell 标题, 链接, 图片或者图标 %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li>圆角样式：rounded, circle</li><li>增加文字样式：可以在容器内增加 <code>&lt;b&gt;</code>标题<code>&lt;/b&gt;</code>和<code>&lt;p&gt;</code>描述文字<code>&lt;/p&gt;</code></li><li>布局方式：<br>默认为自动宽度，适合视野内只有一两个的情况。</li></ol><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>wide</td><td>宽一点的按钮</td></tr><tr><td>fill</td><td>填充布局，自动铺满至少一行，多了会换行</td></tr><tr><td>center</td><td>居中，按钮之间是固定间距</td></tr><tr><td>around</td><td>居中分散</td></tr><tr><td>grid2</td><td>等宽最多2列，屏幕变窄会适当减少列数</td></tr><tr><td>grid3</td><td>等宽最多3列，屏幕变窄会适当减少列数</td></tr><tr><td>grid4</td><td>等宽最多4列，屏幕变窄会适当减少列数</td></tr><tr><td>grid5</td><td>等宽最多5列，屏幕变窄会适当减少列数</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.如果需要显示类似「团队成员」之类的一组含有头像的链接</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns circle grid5 %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><p>2.或者含有图标的按钮</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns rounded grid5 %&#125;</span><br><span class="line">&#123;% cell 下载源码, /, fas fa-download %&#125;</span><br><span class="line">&#123;% cell 查看文档, /, fas fa-book-open %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><p>3.圆形图标 + 标题 + 描述 + 图片 + 网格5列 + 居中</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns circle center grid5 %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://apps.apple.com/cn/app/heart-mate-pro-hrm-utility/id1463348922?ls=1&#x27;</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&#x27;fab fa-apple&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span></span>心率管家<span class="language-xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">  &#123;% p red, 专业版 %&#125;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_pro.png&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1&#x27;</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&#x27;fab fa-apple&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span></span>心率管家<span class="language-xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">  &#123;% p green, 免费版 %&#125;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_lite.png&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.如果需要显示类似「团队成员」之类的一组含有头像的链接</p><div class="btns circle grid5">            <a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a>          </div>2.或者含有图标的按钮<div class="btns rounded grid5">            <a class="button" href='/' title='下载源码'><i class='fas fa-download'></i>下载源码</a><a class="button" href='/' title='查看文档'><i class='fas fa-book-open'></i>查看文档</a>          </div>3.圆形图标 + 标题 + 描述 + 图片 + 网格5列 + 居中<div class="btns circle center grid5">            <a href='https://apps.apple.com/cn/app/heart-mate-pro-hrm-utility/id1463348922?ls=1'>  <i class='fab fa-apple'></i>  <b>心率管家</b>  <p class='p red'>专业版</p>  <img src='https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_pro.png'></a><a href='https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1'>  <i class='fab fa-apple'></i>  <b>心率管家</b>  <p class='p green'>免费版</p>  <img src='https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_lite.png'></a>          </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-12-github卡片-ghcard">2.12 github卡片 ghcard</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ghcard 用户名, 其它参数（可选） %&#125;</span><br><span class="line">&#123;% ghcard 用户名/仓库, 其它参数（可选） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><p>使用<code>,</code>分割各个参数。写法为：<code>参数名=参数值</code><br>以下只写几个常用参数值。</p><table><thead><tr><th><strong>参数名</strong></th><th>取值</th><th>释义</th></tr></thead><tbody><tr><td>hide</td><td>stars,commits,prs,issues,contribs</td><td>隐藏指定统计</td></tr><tr><td>count_private</td><td>true</td><td>将私人项目贡献添加到总提交计数中</td></tr><tr><td>show_icons</td><td>true</td><td>显示图标</td></tr><tr><td>theme</td><td>查阅:<a href="https://github.com/anuraghazra/github-readme-stats/blob/master/themes/README.md">Available Themes</a></td><td>主题</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.用户信息卡片</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| &#123;% ghcard fomalhaut1998 %&#125; | &#123;% ghcard fomalhaut1998, theme=vue %&#125; |</span><br><span class="line">| -- | -- |</span><br><span class="line">| &#123;% ghcard fomalhaut1998, theme=buefy %&#125; | &#123;% ghcard fomalhaut1998, theme=solarized-light %&#125; |</span><br><span class="line">| &#123;% ghcard fomalhaut1998, theme=onedark %&#125; | &#123;% ghcard fomalhaut1998, theme=solarized-dark %&#125; |</span><br><span class="line">| &#123;% ghcard fomalhaut1998, theme=algolia %&#125; | &#123;% ghcard fomalhaut1998, theme=calm %&#125; |</span><br></pre></td></tr></table></figure><p>2.仓库信息卡片</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=vue %&#125; |</span><br><span class="line">| -- | -- |</span><br><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis, theme=buefy %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=solarized-light %&#125; |</span><br><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis, theme=onedark %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=solarized-dark %&#125; |</span><br><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis, theme=algolia %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=calm %&#125; |</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.用户信息卡片</p><table><thead><tr><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&show_owner=true"/></a></th><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=vue&show_owner=true"/></a></th></tr></thead><tbody><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=buefy&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=solarized-light&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=onedark&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=solarized-dark&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=algolia&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=calm&show_owner=true"/></a></td></tr></tbody></table><p>2.仓库信息卡片</p><table><thead><tr><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&show_owner=true"/></a></th><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=vue&show_owner=true"/></a></th></tr></thead><tbody><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=buefy&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=solarized-light&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=onedark&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=solarized-dark&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=algolia&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=calm&show_owner=true"/></a></td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-13-github徽标-ghbdage">2.13 github徽标 ghbdage</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage [right],[left],[logo]||[color],[link],[title]||[option] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>left</code>：徽标左边的信息，必选参数。</li><li><code>right</code>: 徽标右边的信息，必选参数，</li><li><code>logo</code>：徽标图标，图标名称详见<a href="https://simpleicons.org/">simpleicons</a>，可选参数。</li><li><code>color</code>：徽标右边的颜色，可选参数。</li><li><code>link</code>：指向的链接，可选参数。</li><li><code>title</code>：徽标的额外信息，可选参数。主要用于优化SEO，但<code>object</code>标签不会像<code>a</code>标签一样在鼠标悬停显示<code>title</code>信息。</li><li><code>option</code>：自定义参数，支持<a href="https://shields.io/">shields.io</a>的全部API参数支持，具体参数可以参看上文中的拓展写法示例。形式为<code>name1=value2&amp;name2=value2</code>。</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.基本参数,定义徽标左右文字和图标</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage Theme,Butterfly %&#125;</span><br><span class="line">&#123;% bdage Frame,Hexo,hexo %&#125;</span><br></pre></td></tr></table></figure><p>2.信息参数，定义徽标右侧内容背景色，指向链接</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage CDN,JsDelivr,jsDelivr||abcdef,https://metroui.org.ua/index.html,本站使用JsDelivr为静态资源提供CDN加速 %&#125;</span><br><span class="line">//如果是跨顺序省略可选参数，仍然需要写个逗号,用作分割</span><br><span class="line">&#123;% bdage Source,GitHub,GitHub||,https://github.com/ %&#125;</span><br></pre></td></tr></table></figure><p>3.拓展参数，支持shields的API的全部参数内容</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage Hosted,Vercel,Vercel||brightgreen,https://vercel.com/,本站采用双线部署，默认线路托管于Vercel||style=social&amp;logoWidth=20 %&#125;</span><br><span class="line">//如果是跨顺序省略可选参数组，仍然需要写双竖线||用作分割</span><br><span class="line">&#123;% bdage Hosted,Vercel,Vercel||||style=social&amp;logoWidth=20&amp;logoColor=violet %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.基本参数,定义徽标左右文字和图标</p><p><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/Butterfly-Theme-orange?logo=&color=orange&link=&"></object><br><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/Hexo-Frame-orange?logo=hexo&color=orange&link=&"></object></p><p>2.信息参数，定义徽标右侧内容背景色，指向链接</p><p><object class="ghbdage" style="margin-inline:5px" title="本站使用JsDelivr为静态资源提供CDN加速" standby="loading..." data="https://img.shields.io/badge/JsDelivr-CDN-orange?logo=jsDelivr&color=abcdef&link=https://metroui.org.ua/index.html&"></object><br>//如果是跨顺序省略可选参数，仍然需要写个逗号,用作分割<br><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/GitHub-Source-orange?logo=GitHub&color=orange&link=https://github.com/&"></object></p><p>3.拓展参数，支持shields的API的全部参数内容</p><p><object class="ghbdage" style="margin-inline:5px" title="本站采用双线部署，默认线路托管于Vercel" standby="loading..." data="https://img.shields.io/badge/Vercel-Hosted-orange?logo=Vercel&color=brightgreen&link=https://vercel.com/&style=social&logoWidth=20"></object><br>//如果是跨顺序省略可选参数组，仍然需要写双竖线||用作分割<br><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/Vercel-Hosted-orange?logo=Vercel&color=orange&link=&style=social&logoWidth=20&logoColor=violet"></object></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-14-网站卡片-sites">2.14 网站卡片 sites</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% sitegroup %&#125;</span><br><span class="line">&#123;% site 标题, url=链接, screenshot=截图链接, avatar=头像链接（可选）, description=描述（可选） %&#125;</span><br><span class="line">&#123;% site 标题, url=链接, screenshot=截图链接, avatar=头像链接（可选）, description=描述（可选） %&#125;</span><br><span class="line">&#123;% endsitegroup %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% sitegroup %&#125;</span><br><span class="line">&#123;% site xaoxuu, url=https://xaoxuu.com, screenshot=https://i.loli.net/2020/08/21/VuSwWZ1xAeUHEBC.jpg, avatar=https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/avatar/avatar.png, description=简约风格 %&#125;</span><br><span class="line">&#123;% site inkss, url=https://inkss.cn, screenshot=https://i.loli.net/2020/08/21/Vzbu3i8fXs6Nh5Y.jpg, avatar=https://cdn.jsdelivr.net/gh/inkss/common@master/static/web/avatar.jpg, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% site MHuiG, url=https://blog.mhuig.top, screenshot=https://i.loli.net/2020/08/22/d24zpPlhLYWX6D1.png, avatar=https://cdn.jsdelivr.net/gh/MHuiG/imgbed@master/data/p.png, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% site Colsrch, url=https://colsrch.top, screenshot=https://i.loli.net/2020/08/22/dFRWXm52OVu8qfK.png, avatar=https://cdn.jsdelivr.net/gh/Colsrch/images/Colsrch/avatar.jpg, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% site Linhk1606, url=https://linhk1606.github.io, screenshot=https://i.loli.net/2020/08/21/3PmGLCKicnfow1x.png, avatar=https://i.loli.net/2020/02/09/PN7I5RJfFtA93r2.png, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% endsitegroup %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><div class="site-card-group"><a class="site-card" href="https://fomalhaut1998.com"><div class="img"><img src="https://i.loli.net/2020/08/21/VuSwWZ1xAeUHEBC.jpg"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/avatar/avatar.png"/><span class="title">fomalhaut1998</span><span class="desc">简约风格</span></div></a><a class="site-card" href="https://inkss.cn"><div class="img"><img src="https://i.loli.net/2020/08/21/Vzbu3i8fXs6Nh5Y.jpg"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/inkss/common@master/static/web/avatar.jpg"/><span class="title">inkss</span><span class="desc">这是一段关于这个网站的描述文字</span></div></a><a class="site-card" href="https://blog.mhuig.top"><div class="img"><img src="https://i.loli.net/2020/08/22/d24zpPlhLYWX6D1.png"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/MHuiG/imgbed@master/data/p.png"/><span class="title">MHuiG</span><span class="desc">这是一段关于这个网站的描述文字</span></div></a><a class="site-card" href="https://colsrch.top"><div class="img"><img src="https://i.loli.net/2020/08/22/dFRWXm52OVu8qfK.png"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/Colsrch/images/Colsrch/avatar.jpg"/><span class="title">Colsrch</span><span class="desc">这是一段关于这个网站的描述文字</span></div></a><a class="site-card" href="https://linhk1606.github.io"><div class="img"><img src="https://i.loli.net/2020/08/21/3PmGLCKicnfow1x.png"/></div><div class="info"><img src="https://i.loli.net/2020/02/09/PN7I5RJfFtA93r2.png"/><span class="title">Linhk1606</span><span class="desc">这是一段关于这个网站的描述文字</span></div></a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-15-行内图片-inlineimage">2.15 行内图片 inlineimage</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% inlineimage 图片链接, height=高度（可选） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>高度</code>：height=20px</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这是 &#123;% inlineimage https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/0000.gif %&#125; 一段话。</span><br><span class="line"></span><br><span class="line">这又是 &#123;% inlineimage https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/5150.gif, height=40px %&#125; 一段话。</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>这是 <img no-lazy class="inline" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/0000.gif" style="height:1.5em"/> 一段话。</p><p>这又是 <img no-lazy class="inline" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/5150.gif" style="height:40px;"/> 一段话。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-16-单张图片-image">2.16 单张图片 image</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image 链接, width=宽度（可选）, height=高度（可选）, alt=描述（可选）, bg=占位颜色（可选） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li>图片宽度高度：width=300px, height=32px</li><li>图片描述：alt=图片描述（butterfly需要在主题配置文件中开启图片描述）</li><li>占位背景色：bg=#f2f2f2</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.添加描述：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, alt=每天下课回宿舍的路，没有什么故事。 %&#125;</span><br></pre></td></tr></table></figure><p>2.指定宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px %&#125;</span><br></pre></td></tr></table></figure><p>3.指定宽度并添加描述：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px, alt=每天下课回宿舍的路，没有什么故事。 %&#125;</span><br></pre></td></tr></table></figure><p>4.设置占位背景色：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px, bg=#1D0C04, alt=优化不同宽度浏览的观感 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.添加描述：</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="每天下课回宿舍的路，没有什么故事。"/></div><span class="image-caption">每天下课回宿舍的路，没有什么故事。</span></div>2..指定宽度<div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" style="width:400px;"/></div></div>3.指定宽度并添加描述：<div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="每天下课回宿舍的路，没有什么故事。" style="width:400px;"/></div><span class="image-caption">每天下课回宿舍的路，没有什么故事。</span></div>4.设置占位背景色：<div class="img-wrap"><div class="img-bg" style="background:#1D0C04"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="优化不同宽度浏览的观感" style="width:400px;"/></div><span class="image-caption">优化不同宽度浏览的观感</span></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-17-音频-audio">2.17 音频 audio</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% audio 音频链接 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% audio https://github.com/volantis-x/volantis-docs/releases/download/assets/Lumia1020.mp3 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><div class="audio"><audio controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/Lumia1020.mp3' type='audio/mp3'>Your browser does not support the audio tag.</audio></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-18-视频-video">2.18 视频 video</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% video 视频链接 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>对齐方向</code>：left, center, right</li><li><code>列数</code>：逗号后面直接写列数，支持 1 ～ 4 列。</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.100%宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br></pre></td></tr></table></figure><p>2.50%宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% videos, 2 %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% endvideos %&#125;</span><br></pre></td></tr></table></figure><p>3.25%宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% videos, 4 %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% endvideos %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.100%宽度</p><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div>2.50%宽度<div class="videos" col='2'><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div></div>3.25%宽度<div class="videos" col='4'><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-19-相册-gallery">2.19 相册 gallery</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><p>1.gallerygroup 相册图库</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;gallery-group-main&quot;</span>&gt;</span></span></span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>2.gallery 相册</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">markdown 圖片格式</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ul><li>gallerygroup 相册图库</li></ul><table><thead><tr><th>参数名</th><th>释义</th></tr></thead><tbody><tr><td>name</td><td>图库名字</td></tr><tr><td>description</td><td>图库描述</td></tr><tr><td>link</td><td>链接到对应相册的地址</td></tr><tr><td>img-url</td><td>图库封面</td></tr></tbody></table><ul><li><p>gallery 相册</p><p>区别于旧版的Gallery相册,新的Gallery相册会自动根据图片长度进行排版，书写也更加方便，与markdown格式一样。可根据需要插入到相应的md。无需再自己配置长宽。<strong>建议在粘贴时故意使用长短、大小、横竖不一的图片</strong>，会有更好的效果。（尺寸完全相同的图片只会平铺输出，效果很糟糕）</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.gallerygroup 相册图库</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;gallery-group-main&quot;</span>&gt;</span></span></span><br><span class="line">&#123;% galleryGroup MC 在Rikkaの六花服务器里留下的足迹 &#x27;/gallery/MC/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/1.jpg %&#125;</span><br><span class="line">&#123;% galleryGroup Gundam 哦咧哇gundam哒！ &#x27;/gallery/Gundam/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907110508327.png %&#125;</span><br><span class="line">&#123;% galleryGroup I-am-Akilar 某种意义上也算自拍吧 &#x27;/gallery/I-am-Akilar/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907113116651.png %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>2.gallery 相册</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg</span>)</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg</span>)</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.gallerygroup 相册图库</p><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/1.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">MC</div>  <p>在Rikkaの六花服务器里留下的足迹</p>  <a href='/gallery/MC/'></a>  </figcaption>  </figure>  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907110508327.png' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">Gundam</div>  <p>哦咧哇gundam哒！</p>  <a href='/gallery/Gundam/'></a>  </figcaption>  </figure>  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907113116651.png' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">I-am-Akilar</div>  <p>某种意义上也算自拍吧</p>  <a href='/gallery/I-am-Akilar/'></a>  </figcaption>  </figure></div>2.gallery 相册<div class="fj-gallery"><p><img src="https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg" alt=""><br><img src="https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg" alt=""></p>          </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-20-折叠框-folding">2.20 折叠框 folding</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><p>1.gallerygroup 相册图库</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding 参数（可选）, 标题 %&#125;</span><br><span class="line">![](<span class="link">https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg</span>)</span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure><!-- tab 参数配置 --><ol><li><p><code>颜色</code>：blue, cyan, green, yellow, red</p></li><li><p><code>状态</code>：状态填写 open 代表默认打开。</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding 查看图片测试 %&#125;</span><br><span class="line"></span><br><span class="line">![](<span class="link">https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg</span>)</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding cyan open, 查看默认打开的折叠框 %&#125;</span><br><span class="line"></span><br><span class="line">这是一个默认打开的折叠框。</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding green, 查看代码测试 %&#125;</span><br><span class="line">假装这里有代码块（代码块没法嵌套代码块）</span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding yellow, 查看列表测试 %&#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> haha</span><br><span class="line"><span class="bullet">-</span> hehe</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding red, 查看嵌套测试 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding blue, 查看嵌套测试2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding 查看嵌套测试3 %&#125;</span><br><span class="line"></span><br><span class="line">hahaha <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/tieba/%E6%BB%91%E7%A8%BD.png&#x27;</span> <span class="attr">style</span>=<span class="string">&#x27;height:24px&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><details class="folding-tag" ><summary> 查看图片测试 </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg" alt=""></p>              </div>            </details><details class="folding-tag" cyan open><summary> 查看默认打开的折叠框 </summary>              <div class='content'>              <p>这是一个默认打开的折叠框。</p>              </div>            </details><details class="folding-tag" green><summary> 查看代码测试 </summary>              <div class='content'>              <p>假装这里有代码块（代码块没法嵌套代码块）</p>              </div>            </details><details class="folding-tag" yellow><summary> 查看列表测试 </summary>              <div class='content'>              <ul><li>haha</li><li>hehe</li></ul>              </div>            </details><details class="folding-tag" red><summary> 查看嵌套测试 </summary>              <div class='content'>              <details class="folding-tag" blue><summary> 查看嵌套测试2 </summary>              <div class='content'>              <details class="folding-tag" ><summary> 查看嵌套测试3 </summary>              <div class='content'>              <p>hahaha <span><img src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/tieba/%E6%BB%91%E7%A8%BD.png' style='height:24px'></span></p>              </div>            </details>              </div>            </details>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-21-分栏-tab">2.21 分栏 tab</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs Unique name, [index] %&#125;</span><br><span class="line">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line">Any content (support inline tags too).</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><p>Unique name :</p><ul><li><p>选项卡块标签的唯一名称，不带逗号。</p></li><li><p>将在#id中用作每个标签及其索引号的前缀。</p></li><li><p>如果名称中包含空格，则对于生成#id，所有空格将由破折号代替。</p></li><li><p>仅当前帖子/页面的URL必须是唯一的！</p></li></ul></li><li><p>[index]:</p><ul><li><p>活动选项卡的索引号。</p></li><li><p>如果未指定，将选择第一个标签（1）。</p></li><li><p>如果index为-1，则不会选择任何选项卡。</p></li><li><p>可选参数。</p></li></ul></li><li><p>[Tab caption]:</p><ul><li><p>当前选项卡的标题。</p></li><li><p>如果未指定标题，则带有制表符索引后缀的唯一名称将用作制表符的标题。</p></li><li><p>如果未指定标题，但指定了图标，则标题将为空。</p></li><li><p>可选参数。</p></li></ul></li><li><p>[@icon]:</p><ul><li><p>FontAwesome图标名称（全名，看起来像“ fas fa-font”）</p></li><li><p>可以指定带空格或不带空格；</p></li><li><p>例如’Tab caption @icon’ 和 ‘Tab caption@icon’.</p></li><li><p>可选参数。</p></li></ul></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.Demo 1 - 预设选择第一个【默认】</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test1 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>2.Demo 2 - 预设选择tabs</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test2, 3 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>3.Demo 3 - 没有预设值</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test3, -1 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>4.Demo 4 - 自定义Tab名 + 只有icon + icon和Tab名</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test4 %&#125;</span><br><span class="line">&lt;!-- tab 第一个Tab --&gt;</span><br><span class="line"><span class="strong">**tab名字为第一个Tab**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab @fab fa-apple-pay --&gt;</span><br><span class="line"><span class="strong">**只有图标 没有Tab名字**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab 炸弹@fas fa-bomb --&gt;</span><br><span class="line"><span class="strong">**名字+icon**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.Demo 1 - 预设选择第一个【默认】</p><div class="tabs" id="test1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test1-1">test1 1</button></li><li class="tab"><button type="button" data-href="#test1-2">test1 2</button></li><li class="tab"><button type="button" data-href="#test1-3">test1 3</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test1-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test1-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test1-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>2.Demo 2 - 预设选择tabs</p><div class="tabs" id="test2"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#test2-1">test2 1</button></li><li class="tab"><button type="button" data-href="#test2-2">test2 2</button></li><li class="tab active"><button type="button" data-href="#test2-3">test2 3</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="test2-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test2-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="test2-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>3.Demo 3 - 没有预设值</p><div class="tabs" id="test3"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#test3-1">test3 1</button></li><li class="tab"><button type="button" data-href="#test3-2">test3 2</button></li><li class="tab"><button type="button" data-href="#test3-3">test3 3</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="test3-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test3-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test3-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>4.Demo 4 - 自定义Tab名 + 只有icon + icon和Tab名</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">第一个Tab</button></li><li class="tab"><button type="button" data-href="#test4-2"><i class="fab fa-apple-pay" style="text-align: center;"></i></button></li><li class="tab"><button type="button" data-href="#test4-3"><i class="fas fa-bomb"></i>炸弹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><p><strong>tab名字为第一个Tab</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><p><strong>只有图标 没有Tab名字</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><p><strong>名字+icon</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-22-诗词标签-poem">2.22 诗词标签 poem</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><ol><li><code>title</code>：诗词标题</li><li><code>author</code>：作者，可以不写</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% poem 水调歌头,苏轼 %&#125;</span><br><span class="line">丙辰中秋，欢饮达旦，大醉，作此篇，兼怀子由。</span><br><span class="line">明月几时有？把酒问青天。</span><br><span class="line">不知天上宫阙，今夕是何年？</span><br><span class="line">我欲乘风归去，又恐琼楼玉宇，高处不胜寒。</span><br><span class="line">起舞弄清影，何似在人间？</span><br><span class="line"></span><br><span class="line">转朱阁，低绮户，照无眠。</span><br><span class="line">不应有恨，何事长向别时圆？</span><br><span class="line">人有悲欢离合，月有阴晴圆缺，此事古难全。</span><br><span class="line">但愿人长久，千里共婵娟。</span><br><span class="line">&#123;% endpoem %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><div class='poem'><div class='poem-title'>水调歌头</div><div class='poem-author'>苏轼</div><p>丙辰中秋，欢饮达旦，大醉，作此篇，兼怀子由。<br>明月几时有？把酒问青天。<br>不知天上宫阙，今夕是何年？<br>我欲乘风归去，又恐琼楼玉宇，高处不胜寒。<br>起舞弄清影，何似在人间？</p><p>转朱阁，低绮户，照无眠。<br>不应有恨，何事长向别时圆？<br>人有悲欢离合，月有阴晴圆缺，此事古难全。<br>但愿人长久，千里共婵娟。</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-23-阿里图标-icon">2.23 阿里图标 icon</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% icon [icon-xxxx],[font-size] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>icon-xxxx</code>：表示图标<code>font-class</code>,可以在自己的阿里矢量图标库项目的<code>font-class</code>引用方案内查询并复制。</li><li><code>font-size</code>：表示图标大小，直接填写数字即可，单位为<code>em</code>。图标大小默认值为<code>1em</code>。</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% icon icon-rat<span class="emphasis">_zi %&#125;&#123;% icon icon-rat,2 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-ox_</span>chou,3 %&#125;&#123;% icon icon-ox,4 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-tiger<span class="emphasis">_yin,5 %&#125;&#123;% icon icon-tiger,6 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-rabbit_</span>mao,1 %&#125;&#123;% icon icon-rabbit,2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-dragon<span class="emphasis">_chen,3 %&#125;&#123;% icon icon-dragon,4 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-snake_</span>si,5 %&#125;&#123;% icon icon-snake,6 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-horse<span class="emphasis">_wu %&#125;&#123;% icon icon-horse,2 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-goat_</span>wei,3 %&#125;&#123;% icon icon-goat,4 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-monkey<span class="emphasis">_shen,5 %&#125;&#123;% icon icon-monkey,6 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-rooster_</span>you %&#125;&#123;% icon icon-rooster,2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-dog<span class="emphasis">_xu,3 %&#125;&#123;% icon icon-dog,4 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-boar_</span>hai,5 %&#125;&#123;% icon icon-boar,6 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rat_zi"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rat"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-ox_chou"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-ox"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-tiger_yin"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-tiger"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rabbit_mao"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rabbit"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-dragon_chen"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-dragon"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-snake_si"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-snake"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-horse_wu"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-horse"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-goat_wei"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-goat"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-monkey_shen"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-monkey"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rooster_you"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rooster"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-dog_xu"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-dog"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-boar_hai"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-boar"></use></svg></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-24-特效标签wow">2.24 特效标签wow</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow [animete],[duration],[delay],[offset],[iteration] %&#125;</span><br><span class="line">内容</span><br><span class="line">&#123;% endwow %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>animate</code>: 动画样式，效果详见<a href="https://animate.style/">animate.css参考文档</a></li><li><code>duration</code>: 选填项，动画持续时间，单位可以是<code>ms</code>也可以是<code>s</code>。例如<code>3s</code>，<code>700ms</code>。</li><li><code>delay</code>: 选填项，动画开始的延迟时间，单位可以是<code>ms</code>也可以是<code>s</code>。例如<code>3s</code>，<code>700ms</code>。</li><li><code>offset</code>: 选填项，开始动画的距离（相对浏览器底部）</li><li><code>iteration</code>: 选填项，动画重复的次数</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.flip动画效果。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__zoomIn,5s,5s,100,10 %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`zoomIn`动画效果，持续`5s`，延时`5s`，离底部`100`距离时启动，重复`10`次</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><p>2.zoomIn动画效果，持续5s，延时5s，离底部100距离时启动，重复10次</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__zoomIn,5s,5s,100,10 %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`zoomIn`动画效果，持续`5s`，延时`5s`，离底部`100`距离时启动，重复`10`次</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><p>3.slideInRight动画效果，持续5s，延时5s</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__slideInRight,5s,5s %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note orange &#x27;fas fa-car&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`slideInRight`动画效果，持续`5s`，延时`5s`。</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><p>4.heartBeat动画效果，延时5s，重复10次。此处注意不用的参数位置要留空，用逗号间隔。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__heartBeat,,5s,,10 %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note red &#x27;fas fa-battery-half&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`heartBeat`动画效果，延时`5s`，重复`10`次。</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.flip动画效果。</p><div class='wow animate__zoomIn' data-wow-duration='5s' data-wow-delay='5s' data-wow-offset='100'  data-wow-iteration='10' ><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p><code>zoomIn</code>动画效果，持续<code>5s</code>，延时<code>5s</code>，离底部<code>100</code>距离时启动，重复<code>10</code>次</p></div></div><p>2.zoomIn动画效果，持续5s，延时5s，离底部100距离时启动，重复10次</p><div class='wow animate__zoomIn' data-wow-duration='5s' data-wow-delay='5s' data-wow-offset='100'  data-wow-iteration='10' ><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p><code>zoomIn</code>动画效果，持续<code>5s</code>，延时<code>5s</code>，离底部<code>100</code>距离时启动，重复<code>10</code>次</p></div></div><p>3.slideInRight动画效果，持续5s，延时5s</p><div class='wow animate__slideInRight' data-wow-duration='5s' data-wow-delay='5s' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-car"></i><p><code>slideInRight</code>动画效果，持续<code>5s</code>，延时<code>5s</code>。</p></div></div><p>4.heartBeat动画效果，延时5s，重复10次。此处注意不用的参数位置要留空，用逗号间隔。</p><div class='wow animate__heartBeat' data-wow-duration='' data-wow-delay='5s' data-wow-offset=''  data-wow-iteration='10' ><div class="note red icon-padding modern"><i class="note-icon fas fa-battery-half"></i><p><code>heartBeat</code>动画效果，延时<code>5s</code>，重复<code>10</code>次。</p></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-25-进度条-progress">2.25  进度条 progress</h2><div class="note info flat"><p>进度条标签参考<a href="https://rongbuqiu.com/jdt.html">沂佰孜猫-给HEXO文章添加彩色进度条</a>。<br>源样式提取自<a href="https://zwying0814.gitbook.io/cuteen/">Cuteen</a>主题。</p></div><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-2">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% progress [width] [color] [text] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>width</code>: 0到100的阿拉伯数字</li><li><code>color</code>: 颜色，取值有red,yellow,green,cyan,blue,gray</li><li><code>text</code>:进度条上的文字内容</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% progress 10 red 进度条样式预览 %&#125;</span><br><span class="line">&#123;% progress 30 yellow 进度条样式预览 %&#125;</span><br><span class="line">&#123;% progress 50 green 进度条样式预览 %&#125;</span><br><span class="line">&#123;% progress 70 cyan 进度条样式预览 %&#125;</span><br><span class="line">&#123;% progress 90 blue 进度条样式预览 %&#125;</span><br><span class="line">&#123;% progress 100 gray 进度条样式预览 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-red"  style="width: 10%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-yellow"  style="width: 30%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-green"  style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-cyan"  style="width: 70%" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-blue"  style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-gray"  style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-26-注释-notation">2.26 注释 notation</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% nota [label] , [text] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><p><code>label</code>: 注释词汇</p></li><li><p><code>text</code>: 悬停显示的注解内容</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% nota 把鼠标移动到我上面试试 ,可以看到注解内容出现在顶栏 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p><span class='nota' data-nota='可以看到注解内容出现在顶栏'>把鼠标移动到我上面试试</span></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-27-气泡注释-bubble">2.27 气泡注释 bubble</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bubble [content] , [notation] ,[background-color] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>content</code>: 注释词汇</li><li><code>notation</code>: 悬停显示的注解内容</li><li><code>background-color</code>: 可选，气泡背景色。默认为“#71a4e3”</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最近我学到了不少新玩意儿（虽然对很多大佬来说这些已经是旧技术了），比如CSS的&#123;% bubble 兄弟相邻选择器,&quot;例如 h1 + p &#123;margin-top:50px;&#125;&quot; %&#125;，&#123;% bubble flex布局,&quot;Flex 是 Flexible Box 的缩写，意为&quot;弹性布局&quot;，用来为盒状模型提供最大的灵活性&quot;,&quot;#ec5830&quot; %&#125;，&#123;% bubble transform变换,&quot;transform 属性向元素应用 2D 或 3D 转换。该属性允许我们对元素进行旋转、缩放、移动或倾斜。&quot;,&quot;#1db675&quot; %&#125;，animation的&#123;% bubble 贝塞尔速度曲线,&quot;贝塞尔曲线(Bézier curve)，又称贝兹曲线或贝济埃曲线，是应用于二维图形应用程序的数学曲线。一般的矢量图形软件通过它来精确画出曲线，贝兹曲线由线段与节点组成，节点是可拖动的支点，线段像可伸缩的皮筋&quot;,&quot;#de4489&quot; %&#125;写法，还有今天刚看到的&#123;% bubble clip-path,&quot;clip-path属性使用裁剪方式创建元素的可显示区域。区域内的部分显示，区域外的隐藏。&quot;,&quot;#868fd7&quot; %&#125;属性。这些对我来说很新颖的概念狠狠的冲击着我以前积累起来的设计思路。</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>最近我学到了不少新玩意儿（虽然对很多大佬来说这些已经是旧技术了），比如CSS的<span class="bubble-content">兄弟相邻选择器</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#71a4e3;">例如 h1 + p {margin-top:50px;}</span></span>，<span class="bubble-content">flex布局</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#ec5830;">Flex 是 Flexible Box 的缩写，意为弹性布局&quot;，用来为盒状模型提供最大的灵活性&quot;</span></span>，<span class="bubble-content">transform变换</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#1db675;">transform 属性向元素应用 2D 或 3D 转换。该属性允许我们对元素进行旋转、缩放、移动或倾斜。</span></span>，animation的<span class="bubble-content">贝塞尔速度曲线</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#de4489;">贝塞尔曲线(Bézier curve)，又称贝兹曲线或贝济埃曲线，是应用于二维图形应用程序的数学曲线。一般的矢量图形软件通过它来精确画出曲线，贝兹曲线由线段与节点组成，节点是可拖动的支点，线段像可伸缩的皮筋</span></span>写法，还有今天刚看到的<span class="bubble-content">clip-path</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#868fd7;">clip-path属性使用裁剪方式创建元素的可显示区域。区域内的部分显示，区域外的隐藏。</span></span>属性。这些对我来说很新颖的概念狠狠的冲击着我以前积累起来的设计思路。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-28-引用文献-reference">2.28 引用文献 reference</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% referto [id] , [literature] %&#125;</span><br><span class="line">&#123;% referfrom [id] , [literature] , [url] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><p>referto 引用上标</p><ul><li><p><code>id</code>: 上标序号内容，需与referfrom标签的id对应才能实现跳转</p></li><li><p><code>literature</code>: 引用的参考文献名称</p></li></ul></li><li><p>referfrom 引用出处</p><ul><li><p><code>id</code>: 序号内容，需与referto标签的id对应才能实现 跳转</p></li><li><p><code>literature</code>: 引用的参考文献名称</p></li><li><p><code>url</code>: 引用的参考文献链接，可省略</p></li></ul></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Akilarの糖果屋(akilar.top)是一个私人性质的博客&#123;% referto &#x27;[1]&#x27;,&#x27;Akilarの糖果屋群聊简介&#x27; %&#125;，从各类教程至生活点滴，无话不谈。建群的目的是提供一个闲聊的场所。博客采用Hexo框架&#123;% referto &#x27;[2]&#x27;,&#x27;Hexo中文文档&#x27; %&#125;，Butterfly主题&#123;% referto &#x27;[3]&#x27;,&#x27;Butterfly 安装文档(一) 快速开始&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">本项目参考了Volantis&#123;% referto &#x27;[4]&#x27;,&#x27;hexo-theme-volantis 标签插件&#x27; %&#125;的标签样式。引入<span class="code">`[tag].js`</span>，并针对<span class="code">`butterfly`</span>主题修改了相应的<span class="code">`[tag].styl`</span>。在此鸣谢<span class="code">`Volantis`</span>主题众开发者。</span><br><span class="line">主要参考内容包括各个volantis的内置标签插件文档&#123;% referto &#x27;[5]&#x27;,&#x27;Volantis文档:内置标签插件&#x27; %&#125;</span><br><span class="line">Butterfly主题的各个衍生魔改&#123;% referto &#x27;[6]&#x27;,&#x27;Butterfly 安装文档:标签外挂（Tag Plugins&#x27; %&#125;&#123;% referto &#x27;[7]&#x27;,&#x27;小弋の生活馆全样式预览&#x27; %&#125;&#123;% referto &#x27;[8]&#x27;,&#x27;l-lin-font-awesome-animation&#x27; %&#125;&#123;% referto &#x27;[9]&#x27;,&#x27;小康的butterfly主题使用文档&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% referfrom &#x27;[1]&#x27;,&#x27;Akilarの糖果屋群聊简介&#x27;,&#x27;https://jq.qq.com/?<span class="emphasis">_wv=1027&amp;k=pGLB2C0N&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[2]&#x27;,&#x27;Hexo中文文档&#x27;,&#x27;https://hexo.io/zh-cn/docs/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[3]&#x27;,&#x27;Butterfly 安装文档(一) 快速开始&#x27;,&#x27;https://butterfly.js.org/posts/21cfbf15/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[4]&#x27;,&#x27;hexo-theme-volantis 标签插件&#x27;,&#x27;https://volantis.js.org/v5/tag-plugins/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[5]&#x27;,&#x27;Volantis文档:内置标签插件&#x27;,&#x27;https://volantis.js.org/tag-plugins/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[6]&#x27;,&#x27;Butterfly 安装文档:标签外挂（Tag Plugins&#x27;,&#x27;https://butterfly.js.org/posts/4aa8abbe/#%E6%A8%99%E7%B1%A4%E5%A4%96%E6%8E%9B%EF%BC%88Tag-Plugins%EF%BC%89&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[7]&#x27;,&#x27;小弋の生活馆全样式预览&#x27;,&#x27;https://lovelijunyi.gitee.io/posts/c898.html&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[8]&#x27;,&#x27;l-lin-font-awesome-animation&#x27;,&#x27;https://github.com/l-lin/font-awesome-animation&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[9]&#x27;,&#x27;小康的butterfly主题使用文档&#x27;,&#x27;https://www.antmoe.com/posts/3b43914f/&#x27; %&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>Akilarの糖果屋(akilar.top)是一个私人性质的博客<span class="hidden-anchor" id="referto_[1]"></span><sup class="reference"><a href="#referfrom_[1]">[1]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Akilarの糖果屋群聊简介</span><span class="reference-title">参考资料</span></span></span>，从各类教程至生活点滴，无话不谈。建群的目的是提供一个闲聊的场所。博客采用Hexo框架<span class="hidden-anchor" id="referto_[2]"></span><sup class="reference"><a href="#referfrom_[2]">[2]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Hexo中文文档</span><span class="reference-title">参考资料</span></span></span>，Butterfly主题<span class="hidden-anchor" id="referto_[3]"></span><sup class="reference"><a href="#referfrom_[3]">[3]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Butterfly 安装文档(一) 快速开始</span><span class="reference-title">参考资料</span></span></span></p><p>本项目参考了Volantis<span class="hidden-anchor" id="referto_[4]"></span><sup class="reference"><a href="#referfrom_[4]">[4]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">hexo-theme-volantis 标签插件</span><span class="reference-title">参考资料</span></span></span>的标签样式。引入<code>[tag].js</code>，并针对<code>butterfly</code>主题修改了相应的<code>[tag].styl</code>。在此鸣谢<code>Volantis</code>主题众开发者。<br>主要参考内容包括各个volantis的内置标签插件文档<span class="hidden-anchor" id="referto_[5]"></span><sup class="reference"><a href="#referfrom_[5]">[5]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Volantis文档:内置标签插件</span><span class="reference-title">参考资料</span></span></span><br>Butterfly主题的各个衍生魔改<span class="hidden-anchor" id="referto_[6]"></span><sup class="reference"><a href="#referfrom_[6]">[6]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Butterfly 安装文档:标签外挂（Tag Plugins</span><span class="reference-title">参考资料</span></span></span><span class="hidden-anchor" id="referto_[7]"></span><sup class="reference"><a href="#referfrom_[7]">[7]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">小弋の生活馆全样式预览</span><span class="reference-title">参考资料</span></span></span><span class="hidden-anchor" id="referto_[8]"></span><sup class="reference"><a href="#referfrom_[8]">[8]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">l-lin-font-awesome-animation</span><span class="reference-title">参考资料</span></span></span><span class="hidden-anchor" id="referto_[9]"></span><sup class="reference"><a href="#referfrom_[9]">[9]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">小康的butterfly主题使用文档</span><span class="reference-title">参考资料</span></span></span></p><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://jq.qq.com/?_wv=1027&k=pGLB2C0N">Akilarの糖果屋群聊简介</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[2]"></span><a class="reference-anchor" href="#referto_[2]">[2]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://hexo.io/zh-cn/docs/">Hexo中文文档</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[3]"></span><a class="reference-anchor" href="#referto_[3]">[3]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://butterfly.js.org/posts/21cfbf15/">Butterfly 安装文档(一) 快速开始</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[4]"></span><a class="reference-anchor" href="#referto_[4]">[4]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://volantis.js.org/v5/tag-plugins/">hexo-theme-volantis 标签插件</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[5]"></span><a class="reference-anchor" href="#referto_[5]">[5]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://volantis.js.org/tag-plugins/">Volantis文档:内置标签插件</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[6]"></span><a class="reference-anchor" href="#referto_[6]">[6]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://butterfly.js.org/posts/4aa8abbe/#%E6%A8%99%E7%B1%A4%E5%A4%96%E6%8E%9B%EF%BC%88Tag-Plugins%EF%BC%89">Butterfly 安装文档:标签外挂（Tag Plugins</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[7]"></span><a class="reference-anchor" href="#referto_[7]">[7]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://lovelijunyi.gitee.io/posts/c898.html">小弋の生活馆全样式预览</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[8]"></span><a class="reference-anchor" href="#referto_[8]">[8]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://github.com/l-lin/font-awesome-animation">l-lin-font-awesome-animation</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[9]"></span><a class="reference-anchor" href="#referto_[9]">[9]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://www.antmoe.com/posts/3b43914f/">小康的butterfly主题使用文档</a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-29-PDF展示">2.29 PDF展示</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% pdf 文件路径 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>文件路径</code>: 可以是相对路径或者是在线链接</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.本地文件:在md文件路径下创建一个同名文件夹，其内放pdf文件名为xxx.pdf的文件</span></span><br><span class="line">&#123;% pdf xxx.pdf %&#125;</span><br><span class="line"><span class="section"># 2.在线链接</span></span><br><span class="line">&#123;% pdf https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/pdf/小作文讲义.pdf %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>2.在线链接(要放到最外层才能起作用)</p><pre><code>&lt;div class=&quot;row&quot;&gt;&lt;embed src=&quot;https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/pdf/小作文讲义.pdf&quot; width=&quot;100%&quot; height=&quot;550&quot; type=&quot;application/pdf&quot;&gt;&lt;/div&gt;</code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-30-Hexo-tag-map-插件">2.30 Hexo-tag-map 插件</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% + 标签值 + 经度 + 纬度 + 文本 + 缩放等级 + 宽 + 高 + 默认图层 + %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><table><thead><tr><th style="text-align:center">地图名</th><th style="text-align:center">标签值 &lt;必填&gt;</th><th style="text-align:center">宽 (默认 100%) / 高 (默认 360px)</th><th style="text-align:center">缩放等级 (默认 14)</th><th style="text-align:center">宽 (默认 100%) / 高 (默认 360px)</th><th style="text-align:center">默认图层 (默认 1)</th></tr></thead><tbody><tr><td style="text-align:center">混合地图</td><td style="text-align:center">map</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 3~18</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~7</td></tr><tr><td style="text-align:center">谷歌地图</td><td style="text-align:center">googleMap</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~20</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~3</td></tr><tr><td style="text-align:center">高德地图</td><td style="text-align:center">gaodeMap</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 3~18</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~3</td></tr><tr><td style="text-align:center">百度地图</td><td style="text-align:center">baiduMap</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 4~18</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~2</td></tr><tr><td style="text-align:center">Geoq 地图</td><td style="text-align:center">geoqMap</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~18</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~5</td></tr><tr><td style="text-align:center">openstreet 地图</td><td style="text-align:center">openstreetMap</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~18</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">不支持此参数</td></tr></tbody></table><ol><li>参数之间，用英文逗号相隔</li><li>参数必须按上述事例顺序输入，不得为空</li><li>同一个页面，同一组经纬度值，只能插入一个相同标签值的地图 (若有需要，可以将第二个地图上，经度或纬度末尾删除一两个数)</li><li>参数取值必须在上述范围内</li><li>默认图层：即地图叠加层的值，默认常规地图还是卫星地图，可按地图显示顺序取值</li><li>缩放等级，数字越大，地图比例尺越小，显示的越精细</li><li>除标签值外，其他参数选填，但 每个参数的左边的参数必填</li><li>谷歌地图需要外网才能加载查看</li></ol><p>坐标获取：<a href="https://lbs.amap.com/tools/picker">高德地图坐标拾取系统</a> 、<a href="https://api.map.baidu.com/lbsapi/getpoint/index.html">百度地图坐标拾取系统</a></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% map 120.101101,30.239119 %&#125;</span><br><span class="line">&#123;% googleMap 120.101101,30.239119, 这里是西湖灵隐寺，据说求姻缘很灵验哦！ %&#125;</span><br><span class="line">&#123;% geoqMap 120.101101,30.239119, 这里是西湖灵隐寺，据说求姻缘很灵验哦！, 13, 90%, 320px, 3 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div class="map-box"><div id="map-120.101101-30.239119" style="max-width:100%; height:360px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div></div><script type="text/javascript">var normalm=L.tileLayer.chinaProvider('GaoDe.Normal.Map',{maxZoom:20,minZoom:1,attribution:'Amap'});var imgm=L.tileLayer.chinaProvider('GaoDe.Satellite.Map',{maxZoom:20,minZoom:1,attribution:'Amap'});var imga=L.tileLayer.chinaProvider('GaoDe.Satellite.Annotion',{maxZoom:20,minZoom:1,attribution:'Amap'});var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:20,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'});routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:21,minZoom:1});var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'}),routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:21,minZoom:1,attribution:'Google Maps'});var normalm1=L.tileLayer.chinaProvider('Geoq.Normal.Map',{maxZoom:21,minZoom:1,attribution:'GeoQ'});var normal=L.layerGroup([normalm]),image=L.layerGroup([imgm,imga]);var baseLayers={"高德地图":normal,"智图地图":normalm1,"谷歌地图":normalMap,"高德卫星地图":imgm,"谷歌卫星地图":satelliteMap,"高德卫星标注":image,"谷歌卫星标注":routeMap};var mymap=L.map('map-120.101101-30.239119',{center:[30.239119,120.101101],zoom:14,layers:[normal],zoomControl:false});L.control.layers(baseLayers,null).addTo(mymap);L.control.zoom({zoomInTitle:'放大',zoomOutTitle:'缩小'}).addTo(mymap);</script><br><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div id="googleMap-120.101101-30.239119" style="max-width:100%; height:360px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div><script type="text/javascript">var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:22,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:22,minZoom:1,attribution:'Google Maps'}),routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:22,minZoom:1,attribution:'Google Maps'});var baseLayers={"谷歌地图":normalMap,"谷歌卫星图":satelliteMap,"谷歌卫星标注": routeMap};var overlayLayers={};var mymap=L.map("googleMap-120.101101-30.239119",{center:[30.239119,120.101101],zoom:14,layers:[normalMap],zoomControl:false});L.control.layers(baseLayers,null).addTo(mymap);L.control.zoom({zoomInTitle:'放大',zoomOutTitle:'缩小'}).addTo(mymap);var marker = L.marker(['30.239119','120.101101']).addTo(mymap);marker.bindPopup("这里是西湖灵隐寺，据说求姻缘很灵验哦！").openPopup();</script><br><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div id="geoqMap-120.101101-30.239119" style="max-width:90%; height:320px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div><script type="text/javascript">var normalm1=L.tileLayer.chinaProvider('Geoq.Normal.Map',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm2=L.tileLayer.chinaProvider('Geoq.Normal.PurplishBlue',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm3=L.tileLayer.chinaProvider('Geoq.Normal.Gray',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm4=L.tileLayer.chinaProvider('Geoq.Normal.Warm',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm5=L.tileLayer.chinaProvider('Geoq.Theme.Hydro',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normal=L.layerGroup([normalm1,normalm2,normalm3,normalm4,normalm5]);var baseLayers={"智图地图":normalm1,"午夜蓝":normalm2,"灰色":normalm3,"暖色":normalm4,"水系":normalm5};var mymap=L.map("geoqMap-120.101101-30.239119",{center:[30.239119,120.101101],zoom:13,layers:[normalm3],zoomControl:false});L.control.layers(baseLayers,null).addTo(mymap);L.control.zoom({zoomInTitle:'放大',zoomOutTitle:'缩小'}).addTo(mymap);var marker = L.marker(['30.239119','120.101101']).addTo(mymap);marker.bindPopup("这里是西湖灵隐寺，据说求姻缘很灵验哦！").openPopup();</script><br><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-31-隐藏块">2.31 隐藏块</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% hideBlock display,bg,color %&#125;</span><br><span class="line">content</span><br><span class="line">&#123;% endhideBlock %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li>content：要隐藏的内容</li><li>display：展示前按钮显示的文字（可选）</li><li>bg：按钮的背景颜色（可选）</li><li>color：按钮显示的文字的颜色（可选）</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% hideBlock 点我预览, blue %&#125;</span><br><span class="line">这里有张图片：</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://s1.vika.cn/space/2022/10/30/b35fce448bc9404a8d65c3ce1e6e46eb&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;image (1)&quot;</span> <span class="attr">style</span>=<span class="string">&quot;zoom:67%;&quot;</span> /&gt;</span></span></span><br><span class="line">&#123;% endhideBlock %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class="hide-block"><button type="button" class="hide-button" style="background-color:  blue;">点我预览    </button><div class="hide-content"><p>这里有张图片：<br><img src="https://s1.vika.cn/space/2022/10/30/b35fce448bc9404a8d65c3ce1e6e46eb" alt="image (1)" style="zoom:67%;" /></p></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> 外挂标签 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ceph分布式集群文件存储的简单搭建</title>
      <link href="/posts/829779e4.html"/>
      <url>/posts/829779e4.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>ceph集群搭建</p></div></div><p>环境</p><div class="note default orange simple"><p>node1:192.168.222.246</p></div><p>node2:192.168.222.249<br>node3:192.168.222.211<br>client:192.168.222.141<br>写入每个机器的/etc/hosts文件</p><div class="note default orange simple"><p>推荐在三节点的任意一台做全部机器的ssh免密，这里我在node1上完成。</p></div><div class="note default orange simple"><p>一、环境准备</p></div><p>给每个node节点加上一块硬盘，不能是逻辑卷，这里我的三个设备的都是/dev/sdb<br>修改主机名，必须与hosts文件一致<br>systemctl disable --now firewalld NetworkMnager //这里是测试关闭防火墙，有需要的开启6789,3300,6800.7300端口<br>selinux关闭<br>上传ceph.repo文件，最好使用国内的镜像源，不让速度会很慢<br>server端：yum install -y ntp ceph ceph-radosgw<br>client端：yum install -y ceph ceph-common<br>node1: yum install -y ceph-deploy<br>echo “systemctl restart ntpd” &gt;&gt; /etc/rc.local<br>#最好在加上for i in node{1…3};do echo “*/10 * * * * systemctl restart ntpd” &gt;&gt; /var/spool/cron/root<br>#我当前的测试是在root下进行，可自己更换，因为ceph集群对于时间同步的要求十分严格</p><div class="note default orange simple"><p>二、开始配置，在node1上操作</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">for i in node&#123;1..3&#125;;do ssh $i mkdir /etc/ceph;done  //官方有些版本没有固定的配置文件目录，自己创建一下</span><br><span class="line">cd /etc/ceph</span><br><span class="line">ceph-deploy new node1  //创建集群，这里可以看到当前目录已经有了三个配置文件</span><br><span class="line">for i in node&#123;1..3&#125;;do ssh $i yum install -y ceph ceph-radosgw;done    //下载软件，这里官方是使用</span><br><span class="line">ceph-deploy install node2 node3来通过官方下载的，但是一般会出问题，因为是外国的网站，所以我们自己</span><br><span class="line">上传国内的ceph.repo在节点上然后下载</span><br><span class="line">echo &quot;public network = 192.168.222.0/24&quot; &gt;&gt; ./ceph.conf     //监控网络</span><br><span class="line">ceph-deploy mon create-initial     //创建初始化mon</span><br><span class="line">ceph-deploy admin node&#123;1..3&#125;    //同步配置文件到每个节点</span><br><span class="line">ceph-deploy mon add node&#123;2..3&#125;   //可加可不加，类似做了mon的HA，建议奇数个，因为有quorum的仲裁投票</span><br><span class="line">ceph -s    //查看集群状态</span><br><span class="line">ceph config set mon auth_allow_insecure_global_id_reclaim false  //关闭不安全提示</span><br><span class="line">ceph -s</span><br><span class="line">在ceph.conf文件加上</span><br><span class="line">mon clock drift allowed = 2         //monitor间的时间滴答数（默认为0.5秒）</span><br><span class="line">mon clock drift warn backoff = 30   //警告时间允许的偏移量（默认为5秒） #这里我试过了1秒的偏移，系统警告了</span><br><span class="line">ceph-deploy --overwrite-conf admin node&#123;1..3&#125;  //记得每次修改完配置文件都要同步到每个节点</span><br><span class="line">for i in node&#123;1..3&#125;;do ssh $i systemctl restart ceph-mon.target;done  //重启每个节点的服务，让配置生效</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建mgr(管理)</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ceph luminous版本中新增加了一个组件：Ceph Manager Daemon，简称ceph-mgr,该组件的主要作用是分担和扩展monitor的部分功能，减轻monitor的负担，让更好地管理ceph存储系统</span></span><br><span class="line">ceph-deploy mgr create node1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这里是为了实现HA,把node2,node3也做mgr</span></span><br><span class="line">ceph-deploy mgr create node2</span><br><span class="line">ceph-deploy mgr create node3</span><br><span class="line">ceph -s </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以看到mgr以node1为主节点，node2,node3为备</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后创建osd存储盘</span></span><br><span class="line">ceph-deploy disk list node&#123;1..3&#125;  //查看节点上的磁盘</span><br><span class="line">ceph-deploy disk zap node1 /dev/sdb   //初始化磁盘，类似格式化</span><br><span class="line">ceph-deploy disk zap node2 /dev/sdb</span><br><span class="line">ceph-deploy disk zap node3 /dev/sdb</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将磁盘创建为osd</span></span><br><span class="line">ceph-deploy osd create --data /dev/sdb node1</span><br><span class="line">ceph-deploy osd create --data /dev/sdb node2</span><br><span class="line">ceph-deploy osd create --data /dev/sdb node3</span><br><span class="line">ceph -s 可以看到已经加了三个osd</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">（扩容方式：假设要加入一台node4，先写入hosts文件和同步文件和主机名，做ssh免密，然后yum install ceph ceph-radosgw ntp (rsync)），关闭selinux,NetworkManager,firewalld，写入定时任务同步时间，在node1操作ceph-deploy admin node4，按需求选择在node4上添加mon,mgr,osd等等）</span></span><br><span class="line">尝试创建pool并使用删除2的倍数，与osd的数量有关，一般5个osd以下的，分128的pg即可，多了会报错，可以适当通过报错调整pg数</span><br><span class="line">注释：pg数为</span><br><span class="line">ceph osd pool create test 128  //创建一个名为test的pg数为128的pool</span><br><span class="line">ceph osd pool get test pg_num  //查看test的pg数</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ceph osd pool <span class="built_in">set</span> <span class="built_in">test</span> pg_num 64   //可以使用此命令把<span class="built_in">test</span>的pg数从128改为64，此处不执行</span></span><br><span class="line">使用存储测试</span><br><span class="line">rados put testfile /etc/fstab --pool=test   //上传/etc/fstab文件到test pool中作为testfile</span><br><span class="line">rados -p test ls           //查看test pool的根文件</span><br><span class="line">rados rm testfile --pool=test     //删除 test pool里面的testfile</span><br><span class="line">删除pool</span><br><span class="line">在配置文件写下允许删除pool的参数，默认是不允许删除</span><br><span class="line">vim ./ceph.conf</span><br><span class="line">加入</span><br><span class="line">mon_allow_pool_delete = true</span><br><span class="line">然后同步配置文件</span><br><span class="line">ceph-deploy --overwrite-conf admin node&#123;1..3&#125;</span><br><span class="line">重启监控服务让配置生效</span><br><span class="line">for i in node&#123;1..3&#125;;do ssh $i systemctl restart ceph-mon.target;done</span><br><span class="line">删除test pool</span><br><span class="line">ceph osd pool delete test test --yes-i-really-really-mean-it    //这里要输入两次pool名</span><br><span class="line">创建文件存储并在client端连接使用</span><br><span class="line">创建mds服务，多个是HA，我这里还是全部加上</span><br><span class="line">ceph-deploy mds create node&#123;1..3&#125;</span><br><span class="line">注释：一个ceph文件系统需要至少两个rados存储池，一个是数据另一个是元数据</span><br><span class="line">ceph osd pool create cephfs_pool 128</span><br><span class="line">ceph osd pool create cephfs_cache 64</span><br><span class="line">查看一下</span><br><span class="line">ceph osd pool ls</span><br><span class="line">创建ceph文件系统</span><br><span class="line">ceph fs new cephfs cephfs_pool cephfs_cache  //以上面两个pool创建文件系统cephfs</span><br><span class="line">查看一下</span><br><span class="line">ceph fs ls</span><br><span class="line">ceph mds stat</span><br><span class="line"></span><br><span class="line">给客户端加上认证文件</span><br><span class="line">cat ./ceph.client.admin.keyring</span><br><span class="line"></span><br><span class="line">在client的下</span><br><span class="line">echo “AQDEKlJdiLlKAxAARx/PXR3glQqtvFFMhlhPmw==” &gt; /root/key</span><br><span class="line">mkdir /root/test  //测试挂载目录</span><br><span class="line">挂载</span><br><span class="line">mount.ceph node1:6789,node2:6789,node3:6789:/ /root/test -o name=admin,secretfile=/root/key   // 这里要挂载多个monitor节点，避免因为只挂载的一个节点宕机了影响客户端使用</span><br><span class="line">sed -i &#x27;$anode1:6789,node2:6789,node3:6789://root/testcephname=admin,secretfile=/root/key&#x27;  /etc/fstab    //开机自动挂载</span><br><span class="line">df -h 查看</span><br><span class="line">以上一个文件存储便搭建完毕，可以正常使用了</span><br><span class="line">二、删除文件存储方法</span><br><span class="line">在client端删除数据并卸载</span><br><span class="line">rm -rf /root/test/* &amp;&amp; umount /root/test</span><br><span class="line">停掉所有server端的mds（不然是无法删除文件存储的）</span><br><span class="line">for i in node&#123;1..3&#125;;do ssh $i systemctl stop ceph-mds.target;done</span><br><span class="line">ceph fs rm cephfs --yes-i-really-mean-it  //删除文件系统cephfs</span><br><span class="line">ceph osd pool delete cephfs_pool cephfs_pool --yes-i-really-really-mean-it  //删除pool中的cephfs_pool，记得是写两次pool的名字</span><br><span class="line">ceph osd pool delete cephfs_cache cephfs_cache --yes-i-really-really-mean-it //删除pool中的cephfs_cache</span><br><span class="line">删完再重新启动mds服务</span><br><span class="line">for i in node&#123;1..3&#125;;do ssh $i systemctl start ceph-mds.target</span><br><span class="line">sed -i &#x27;$d&#x27; /etc/fstab   //删除后别忘记删除fstab文件中的加入</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 服务集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web状态响应码</title>
      <link href="/posts/bd934ac8.html"/>
      <url>/posts/bd934ac8.html</url>
      
        <content type="html"><![CDATA[<div class="note default orange simple"><p>403 Forbidden.服务器已经理解请求,但是拒绝执行它(大部分原因是因为文件的属性和权限问题)</p></div><div class="note default orange simple"><p>404 Not Found.请求失败,请求所希望得到的资源未在服务器上发现.</p></div><p>404这个状态码被广泛应用于当服务器不想揭示为何请求被拒绝,或者没有其他适合的响应可⽤的情况下.</p><div class="note default orange simple"><p>500 Internal Server Error.服务器遇到某个未曾预料的状况,导致它无法完成对请求的处理.</p></div><p>一般来说,这个问题都会在服务器的程序码出错时出现.</p><div class="note default orange simple"><p>502 Bad Gateway.作为网关或代理工作的服务器尝试执行请求时,从上游服务器接收到无效的响应.</p></div><div class="note default orange simple"><p>503 Service Unavailable.由于临时的服务器维护或过载,服务器当前无法处理请求.这个状况是临时的,</p></div><p>并且将在一段时间以后恢复.503状态码的存在并不意味着服务器在过载的时候必须使用它.<br>某些服务器只不过是希望拒绝客户端的连接.</p><div class="note default orange simple"><p>504 Gateway Timeout作为网关或代理工作的服务器尝试执行请求时,未能及时从上游服务器(URI标识出的服务器,</p></div><p>例如HTTP,FTP,LDAP)或辅助服务器(例如DNS)收到响应<br><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Docker的TLS安全远程连接配置</title>
      <link href="/posts/adf659df.html"/>
      <url>/posts/adf659df.html</url>
      
        <content type="html"><![CDATA[<div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>了解一下为什么做基于TLS传输协议和CA证书的远程连接</p></div></div><div class="note default orange simple"><p>在docker中，默认是不允许远程连接主机容器服务的，在普通的没有进行别的安全防护下开启的远程连接，只要隔壁老王知道你的IP地址再对你端口进行一下扫描尝试，便可以自由进出你的容器的房间，对你的容器们嘿嘿嘿，就问你怕不怕就完事了。</p></div><div class='wow animate__flip' data-wow-duration='' data-wow-delay='' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-fan"></i><p>所以如果有需要远程连接docker的需求，就需要基于TLS和CA的认证来保护我方容器不被嘿嘿嘿。</p></div></div><div class="note default orange simple"><p>1.生成证书和密钥</p></div><div class="note default orange simple"><p>这里我的环境是IP:192.168.222.222，基于2375端口的远程连接，需要按自己的实际情况更改。</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/ca &amp;&amp; cd /opt/ca //自己随便在一个最好空的文件夹里面便可以，我默认是在/opt/ca下面进行操作</span><br><span class="line"></span><br><span class="line">openssl genrsa -aes256 -out ca-key.prm 4096 //输入两次密码，生成CA证书私钥</span><br><span class="line"></span><br><span class="line">openssl req -new -x509 -days 365 -key ca-key.pem -sha256 -out ca.pem //生成一个有效期365天的CA证书。example输入的依次是CN,Guangdong,Guangzhou...都可以随意填写。</span><br><span class="line"></span><br><span class="line">openssl genrsa -out server-key.pem 4096 //生成服务端私钥</span><br><span class="line"></span><br><span class="line">openssl req -subj &quot;/CN=192.168.222.222&quot; -sha256 -new -key server-key.pem -out server.csr //生成服务器端的证书签名请求文件</span><br><span class="line"></span><br><span class="line">echo &quot;subjectAltName = IP:192.168.222.222,IP:0.0.0.0&quot; &gt; extfile.cnf //限制可连接到服务器的IP，这里我默认是0.0.0.0全部允许，有指定服务器连接需求可更改</span><br><span class="line"></span><br><span class="line">echo &quot;extendedKeyUsage = serverAuth&quot; &gt;&gt; extfile.cnf //设置此密钥仅使用于服务器身份验证</span><br><span class="line"></span><br><span class="line">openssl x509 -req -days 365 -sha256 -in server.csr -CA ca.pem -CAkey ca-key.pem \-CAcreateserial -out server-cert.pem -extfile extfile.cnf  //输入CA私钥密码，生成签名好的服务器端证书</span><br><span class="line"></span><br><span class="line">openssl genrsa -out key.pem 4096 //生成客户端的私钥</span><br><span class="line"></span><br><span class="line">openssl req -subj &#x27;/CN=client&#x27; -new -key key.pem -out client.csr  //生成客户端的证书签名请求文件</span><br><span class="line"></span><br><span class="line">echo &quot;extendedKeyUsage = clientAuth&quot; &gt;&gt; extfile.cnf //拓展密钥的用途</span><br><span class="line"></span><br><span class="line">openssl x509 -req -days 365 -sha256 -in client.csr -CA ca.pem -CAkey ca-key.pem \-CAcreateserial -out cert.pem -extfile extfile.cnf //输入CA证书私钥密码，生成已签名认证好的客户端证书</span><br><span class="line"></span><br><span class="line">cp ./&#123;ca.pem,ca-key.pem,server-cert.pem,server-key.pem,cert.pem,key.pem&#125; /etc/docker/</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>2.修改docker守护进程服务文件</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/docker.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把ExecStart=/usr/bin/docker -H ......</span></span><br><span class="line">修改为</span><br><span class="line">ExecStart=/usr/bin/dockerd --tlsverify --tlscacert=/etc/docker/ca.pem --tlscert=/etc/docker/server-cert.pem --tlskey=/etc/docker/server-key.pem -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</span><br><span class="line">然后重启服务</span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart docker</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>3.在客户端主机远程连接测试</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp root@192.168.222.222:/etc/docker/&#123;ca.pem,cert.pem,key.pem&#125; /etc/docker/    //从服务器端拉取密钥和证书</span><br><span class="line"></span><br><span class="line">docker --tlsverify --tlscacert=/etc/docker/ca.pem --tlscert=/etc/docker/cert.pem --tlskey=/etc/docker/key.pem -H tcp://192.168.222.222:2375 images  //尝试查看远程镜像</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redhat/CentOS用yum命令下载依赖和安装包到本地，自建yum源仓库</title>
      <link href="/posts/1b152b3a.html"/>
      <url>/posts/1b152b3a.html</url>
      
        <content type="html"><![CDATA[<h3 id="拓展：同步网络源到本地目录，以方便内网快速传输，更利于制作本地yum源。">拓展：同步网络源到本地目录，以方便内网快速传输，更利于制作本地yum源。</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reposync --repoid=xxxx        #xxxx为镜像仓库名称</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>命令使用后会在当前目录生成一个一样xxxx 的文件夹，里面放的便是你选择仓库的rpm包，一样xxxx目录下会有一个repodata目录可以为写入repo文件做指定的。写入repo文件便于以下自制本地源一样。</p></div><h3 id="自建yum源就是使用自己本地的rpm包来作为yum的源仓库。扩展-使用yum命令下载安装包以及依赖文件到本地。">自建yum源就是使用自己本地的rpm包来作为yum的源仓库。扩展 使用yum命令下载安装包以及依赖文件到本地。</h3><div class="note default orange simple"><p>1.可以在yum命令安装的同时不清除安装包</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.conf</span><br><span class="line"> </span><br><span class="line">cachedir=/var/cache/yum/$basearch/$releasever    //自定义安装包及依赖下载目录</span><br><span class="line">keepcache=0       //1为启用，0不启用，把这里改为1</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>2.直接用命令下载包和依赖（不包括安装）</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum install -y yum-utils</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yumdownloader --resolve --destdir=&lt;PATH&gt; &lt;packages&gt;</span></span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>3.创建yum自建仓库</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum install -y createrepo    </span><br><span class="line"> </span><br><span class="line">createrepo 本地存放安装包的文件夹</span><br><span class="line"> </span><br><span class="line">vim /etc/yum.repos.d/dly.repo</span><br><span class="line"> </span><br><span class="line">[dly]</span><br><span class="line">name=dly</span><br><span class="line">baseurl=file:///本地存放安装包文件夹路径</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure><p>然后执行一下清理和缓存命令就可以了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all &amp;&amp; yum makecache</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Linux基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redhat/CentOS7本地源配置详解</title>
      <link href="/posts/45b04385.html"/>
      <url>/posts/45b04385.html</url>
      
        <content type="html"><![CDATA[<div class="note default orange simple"><p>一级标题 第一确定你的CD连接上了，段落引用如果是图形化界面只需要看看自己桌面也有没有一个光盘文件即可，不是图形化的可以在VM上分的导航栏里点击虚拟机→可移动设备→CD→连接</p></div><p>段落引用如果以上都做了之后还提示错误的话就检查一下VM中你的虚拟机的设置里面ISO指向文件是否有指定路径。</p><div class="note default orange simple"><p>第二步在根目录下创建ISO文件夹</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /iso</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>第三切换到yum源文件夹/etc/repos.d/并备份移动没有用的repo文件，一些没有用的reop文件因为已经启用，在设置新的源的时候会再次检测而产生错误</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d</span><br><span class="line"></span><br><span class="line">mkdir /etc/yumrepo.bak</span><br><span class="line"> </span><br><span class="line">mv ./* ../yumrepo.bak/</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>第四写下本地源配置.repo文件</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;[local]\nname =local\nbaseurl=file:///iso\nenabled=1                \ngpgcheck=0&quot; &gt; /etc/yum.repos.d/local.repo</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>第五挂载到虚拟机并写入文件系统表</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">​</span><br><span class="line">mount /dev/sr0 /iso</span><br><span class="line"> </span><br><span class="line">echo &quot;/dev/sr0        /iso        iso9660    defaults    0 0&quot; &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure><div class="note default orange simple"><p>第六生成缓存</p></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all &amp;&amp; yum makecache </span><br><span class="line">yum repolist all //查看yum仓库</span><br></pre></td></tr></table></figure><p>以上便可以使用yum命令进行操作了。</p><p><img src="https://gcore.jsdelivr.net/gh/linjiangyu2/halo@master/img/siMAqL1Zewz3QlJ.webp" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Linux基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
